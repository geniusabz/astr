!function(){var e=setTimeout;function n(){}function t(e){if(!(this instanceof t))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(e,this)}function r(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void i(n.promise,e)}o(n.promise,r)}else(1===e._state?o:i)(n.promise,e._value)})):e._deferreds.push(n)}function o(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var r=n.then;if(n instanceof t)return e._state=3,e._value=n,void a(e);if("function"==typeof r)return void u((o=r,c=n,function(){o.apply(c,arguments)}),e)}e._state=1,e._value=n,a(e)}catch(n){i(e,n)}var o,c}function i(e,n){e._state=2,e._value=n,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var n=0,o=e._deferreds.length;n<o;n++)r(e,e._deferreds[n]);e._deferreds=null}function c(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function u(e,n){var t=!1;try{e(function(e){t||(t=!0,o(n,e))},function(e){t||(t=!0,i(n,e))})}catch(e){if(t)return;t=!0,i(n,e)}}t.prototype.catch=function(e){return this.then(null,e)},t.prototype.then=function(e,t){var o=new this.constructor(n);return r(this,new c(e,t,o)),o},t.prototype.finally=function(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})},t.all=function(e){return new t(function(n,t){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);var o=r.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(n){i(e,n)},t)}r[e]=a,0==--o&&n(r)}catch(e){t(e)}}for(var a=0;a<r.length;a++)i(a,r[a])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(n){n(e)})},t.reject=function(e){return new t(function(n,t){t(e)})},t.race=function(e){return new t(function(n,t){for(var r=0,o=e.length;r<o;r++)e[r].then(n,t)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(n){e(n,0)},t._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var s=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();s.Promise||(s.Promise=t);var l="stats",d=function(e){return e},f=function(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",function(){e()})},h=function(){return document.cookie.replace(/(?:(?:^|.*;\s*)mos_id\s*=\s*([^;]*).*$)|^.*$/,"$1")};function v(){return v=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},v.apply(this,arguments)}var m="function"==typeof fetch?fetch.bind():function(e,n){return n=n||{},new Promise(function(t,r){var o=new XMLHttpRequest;for(var i in o.open(n.method||"get",e,!0),n.headers)o.setRequestHeader(i,n.headers[i]);function a(){var e,n=[],t=[],r={};return o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(o,i,a){n.push(i=i.toLowerCase()),t.push([i,a]),r[i]=(e=r[i])?e+","+a:a}),{ok:2==(o.status/100|0),status:o.status,statusText:o.statusText,url:o.responseURL,clone:a,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},headers:{keys:function(){return n},entries:function(){return t},get:function(e){return r[e.toLowerCase()]},has:function(e){return e.toLowerCase()in r}}}}o.withCredentials="include"==n.credentials,o.onload=function(){t(a())},o.onerror=r,o.send(n.body||null)})};"function"!=typeof window.CustomEvent&&(window.CustomEvent=function(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r},window.Event&&(CustomEvent.prototype=window.Event.prototype),window.CustomEvent=CustomEvent);var w="https://www.mos.ru";"localhost"===window.location.hostname&&(w=""),window.location.hostname.match(/\w+-tech.mos.ru/)&&(w=window.location.origin);var p=w+"/upload/common/places/config.json",y=!1;if("maxTouchPoints"in navigator)y=navigator.maxTouchPoints>0;else{var g=window.matchMedia&&matchMedia("(pointer:coarse)");g&&"(pointer:coarse)"===g.media?y=!!g.matches:"orientation"in window&&(y=!0)}var b={_config:null,_configRequest:null,_getConfig:function(){var e=this;return this._config?Promise.resolve(this._config):(this._configRequest||(this._configRequest=m(p,{}).then(function(e){return e.json()}).then(function(n){return e._config=n,n}).catch(function(e){console.error("mosTizer: config of places not loaded."),console.error(e)})),this._configRequest)},_isHitWithCurrentLocation:function(e,n,t){var r=function(e){var t=e.indexOf("**");return e===n||t>0&&new RegExp("^"+e.replace("**","(.*)")+"$").test(n)};return!(!r(e)||t&&Array.isArray(t)&&t.some(function(e){return r(e)}))},_checkLocationAndFindBannerPath:function(e){try{var n=this;return Promise.resolve(n._getConfig()).then(function(t){if(!t)return"";var r=window.location,o=r.hostname,i=r.pathname,a="";return t.forEach(function(t){var r=t.path,c=t.domain,u=t.exclude_path,s=t.exclude_domain;r&&r.forEach(function(r){var l=!1;if(c&&c.filter(function(e){return e===o&&n._isHitWithCurrentLocation(r,i,u)}).length&&(l=!0),c||!s||u||!s.filter(function(e){return e===o}).length&&n._isHitWithCurrentLocation(r,i,u)&&(l=!0),l){var d=t.places;if(d&&d[e])return a=d[e],!0}})}),a})}catch(e){return Promise.reject(e)}},reload:function(){return!0},create:function(e){try{var n=e.element,t=e.onRender,r=e.onError,o=e.params,i=o.p1;return n&&o?Promise.resolve(this._checkLocationAndFindBannerPath(i)).then(function(o){if(!o)return null;var a=""+w+o+"/banner.html",c=document.createElement("div");c.style.width="100%",c.style.height="100%";var u=document.createElement("iframe");u.src=a,u.scrolling="no",u.marginWidth="0",u.marginHeight="0",u.frameBorder="0",u.style.height="100%",u.style.minHeight="100%",u.style.minWidth="100%",u.style.width="1px",u.style.display="block",u.onload=t,u.onerror=function(){r&&r(),console.error('mosTizer: banner "'+i+'" not found.')},u.sandbox.add("allow-top-navigation"),u.sandbox.toggle("allow-same-origin"),u.sandbox.toggle("allow-popups"),u.sandbox.toggle("allow-scripts"),c.appendChild(u),n.innerHTML="",n.appendChild(c);var s={};return v({},e,{iframe:u,windowListeners:s,bannerId:"mosTizerBanner_"+i,destroy:function(){n.innerHTML="",Object.keys(s).forEach(function(e){window.removeEventListener(e,s[e],!1)})}})}):Promise.resolve(null)}catch(e){return Promise.reject(e)}},createAdaptive:function(e,n,t){try{return Promise.resolve(this.create(e)).then(function(e){if(!e)return null;if(n&&t&&Array.isArray(n)){var r=t.phoneWidth,o=void 0===r?480:r,i=t.tabletWidth,a=void 0===i?830:i;if(o&&a&&a<o)return console.error("mosTizer: checkAdaptiveOptions: phoneWidth must be less than tabletWidth"),e;if(n.includes("phone")||n.includes("tablet")||n.includes("desktop")){var c,u=function(){var t=document.body.scrollWidth;(n.includes("tablet")||n.includes("desktop")&&a&&!y)&&(e.element.style.display=a>t?"none":""),n.includes("phone")&&o&&y&&(e.element.style.display=t>o?"none":"")},s=function(){c||(c=setTimeout(function(){c=null,u()},100))};window.addEventListener("resize",s,!1),window.addEventListener("orientationchange",s,!1),e.windowListeners={resize:s,orientationchange:s},u()}}return e})}catch(e){return Promise.reject(e)}},createScroll:function(e){try{return Promise.resolve(this.create(e))}catch(e){return Promise.reject(e)}}},_=null,E=function(){if(_)return _;var e=h();return _=new Promise(function(n){if(!e)return n({});try{var t=JSON.parse(window.sessionStorage.getItem(e+"-targeting")||null);if(t)return n(t);var r=window.setTimeout(function(){n({})},500);m("https://www.mos.ru/services/segments/v3/"+e).then(function(e){return clearTimeout(r),e}).then(function(e){return e.json()}).catch(function(e){return[]}).then(function(e){return e.reduce(function(e,n){var t;return v({},e,((t={})["puid"+n.segmentId]=n.value,t))},{})}).then(function(t){window.sessionStorage.setItem(e+"-targeting",JSON.stringify(t)),n(t)})}catch(e){n({})}}),_},T=function(){return b},C=new WeakMap,L={init:function(){window.mosTizer=L,f(L.renderAll),document.dispatchEvent(new CustomEvent("mosTizer.initialized"))},renderAll:function(e){var n;void 0===e&&(void 0===n&&(n=window.document),e=n.querySelectorAll("[data-mos-teaser]")),e.length&&[].forEach.call(e,function(e){return L.renderBanner(e)})},reloadAll:function(){T().then(function(e){e.reload()})},getBanner:function(e){return C.get(e)},renderBanner:function(e,n){var t=void 0===n?{}:n,r=t.onLoad,o=void 0===r?d:r,i=t.onError,a=void 0===i?d:i,c=t.onStub,u=void 0===c?d:c,s=t.onRender,l=void 0===s?d:s;return C.has(e)?C.get(e):(C.set(e,{reload:d}),Promise.all([T(),E()]).then(function(n){var t,r=n[0],i=n[1],c=JSON.parse(e.dataset.mosTeaser),s=c.scroll,d=c.adaptive,f=c.adaptiveOptions,h=c.placementParams,m={ownerId:255877,params:v({},void 0===h?{}:h,i),element:e,onError:a,onLoad:o,onStub:u,onRender:function(){e.dispatchEvent(new CustomEvent("bannerRendered")),l(e)}};return t=s?r.createScroll(m):f?r.createAdaptive(m,d,f):r.create(m),C.set(e,t),t}).catch(d))},reloadBanner:function(e){L.getBanner(e)?T().then(function(n){return n.reload(e)}):L.renderBanner(e)},destroyBanner:function(e){var n=L.getBanner(e);n&&C.delete(e),n&&n.destroy&&n.destroy()}};function P(){return P=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},P.apply(this,arguments)}var j,k,R,x,O=["eventLoc","eventRef"],A={bannerLoad:"Load",bannerClick:"Click",bannerClose:"Close"},S=["eventType"],B=(k=!1,[function(e){k||(j=e,k=!0)},function(){return j}]),I=B[0],z=B[1],H=(R={},function(){var e;try{e=window.top.location.href}catch(n){e=window.location.href}return e===R.eventSrc||(R.bannerId=z(),R.mosId=h(),R.eventSrc=e),R}),W=null,q=function(){var e=arguments;return function(n){return[].slice.call(e).reduceRight(function(e,n){return n(e)},n)}}(function(e){var n=function(e){var n=e.eventLoc,t=e.eventRef,r=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}(e,O),o=window!==window.parent,i=o&&n||window.location.href,a=o&&t||window.document.referrer;return encodeURIComponent(JSON.stringify(P({eventDst:"stats",mosId:document.cookie.replace(/(?:(?:^|.*;\s*)mos_id\s*=\s*([^;]*).*$)|^.*$/,"$1")||null,eventTime:Math.round(Date.now()/1e3),eventLoc:i,eventRef:a},r)))}(e);(new Image).src="https://stats.mos.ru/eds.gif?o="+n},function(e){return(W||(W=new Promise(function(e){try{var n=new XMLHttpRequest;n.addEventListener("load",function(){!function(e){var n=document.createElement("script");n.text=e;var t=document.head;t.appendChild(n),t.removeChild(n)}(this.responseText),window.yaCounter45066689=new window.Ya.Metrika({id:45066689,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0}),e(window.yaCounter45066689)}),n.open("GET","https://mc.yandex.ru/metrika/watch.js"),n.send()}catch(n){e(null)}}),W)).then(function(n){if(n){var t=e.eventType,r=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n.indexOf(t=i[r])>=0||(o[t]=e[t]);return o}(e,S);try{var o,i,a,c;n.reachGoal("AdFox",((c={})[A[t]]=((a={})[r.bannerId]=((i={})[r.mosId]=((o={})[r.eventSrc]=r.eventTime,o),i),a),c))}catch(e){}}}),e},function(e){return v({},H(),{eventType:e,eventTime:+new Date})}),F=function(){return q("bannerClick")},M=function(e){e.addEventListener("click",F)},$={pushEvent:q,click:F,init:function(){window.mosTizer=$,f(function(){window.mosTizer||f(function(){if(!/^(newmos\.||\w-tech\.||www\.)?mos\.ru/gi.test(location.host))for(var e=document.querySelectorAll("a"),n=0;n<e.length;n+=1)e[n].setAttribute("target","_blank")}),I(window.bannerId),q("bannerLoad"),[].forEach.call(window.document.querySelectorAll("a"),M)})}};window.mosTizer||(window.mosTizer={reloadBanner:d},((x=window)===x.top?"api":l)===l?$.init():L.init())}();
//# sourceMappingURL=mosTizer.js.map
