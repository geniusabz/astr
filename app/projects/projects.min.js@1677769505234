!function(window,angular,undefined){angular.module("projects",["mosapp","ngAnimate","ui.router","mgcrea.ngStrap","projects.templates","mosapp.sharing","mosapp.banner","mosapp.sharing.popup","mosapp.projects.main","mosapp.mosError","mosapp.special.map","mosapp.map.seasons","mosapp.map.events","mosapp.map.events.datasets","mosapp.special.photobank","mosapp.calendar.list.mosCalendarLite","mosapp.calendar.list.mosCalendarLiteNew","mosapp.calendar.list.mosInteractiveSchedule","mosapp.calendar.list.mosCalendarMonth","mosapp.news.list.mosNewsLite","mosapp.banner.service","mosapp.parallax","mosapp.news.feed.newsfeedMixedList","mosapp.fields.period","mosapp.fields.select"]).service("metaConfig",["$translate","$q",function(e,t){var a=!1,i={main:{image:"img",url:"en/city/projects/"}};return this.config=i,this.init=function(){return a?t.when(i):t.when(e(["projects.sectionTitle","projects.section","projects.title","projects.description"]).then(function(e){i.main.sectionTitle=e["projects.sectionTitle"],i.main.section=e["projects.section"],i.main.title=e["projects.title"],i.main.description=e["projects.description"],a=!0}))},this}]).config(["$compileProvider","$stateProvider","$urlRouterProvider","$locationProvider","$translatePartialLoaderProvider","$translateProvider","$filterProvider",function(e,t,a,i,o,n,r){i.html5Mode({enabled:!0,requireBase:!0,rewriteLinks:!1}),i.hashPrefix("!"),e.debugInfoEnabled(!1),n.useSanitizeValueStrategy("escaped"),o.addPart("projects"),a.rule(function(e,t){t=t.path();if(!(t.length<=1))return"/"===t[t.length-1]?void 0:t+"/"}),t.state("mosapp",{abstract:!0}).state("404",{url:"/404/",template:'<div data-mos-error="404"></div>'}).state("projects",{url:"/",views:{"@":{template:'<div data-projects-main="" data-root-state="projects"></div>'}},onEnter:function(){}}).state("projects.page",{url:"page-{page:[0-9]+}/",onEnter:function(){}})}]).run(["mosconfig","toolsSrvc","$rootScope","$location",function(e,t,a,i){var o=window.metaTitle||"",n=window.metaPageDescription||"",r=window.metaImage||"";angular.isDefined(window.metaTitle)&&angular.isDefined(window.metaPageDescription)&&t.setMeta({},{projects:{title:o,description:n}},"projects"),angular.isDefined(window.metaImage)&&(e.domain&&(path=(path=(0===e.domain.indexOf("http")?"":location.protocol+"//")+e.domain).replace(new RegExp("/$"),"")),r=0===(r=(e.imagesPath||"")+r).indexOf("http")?r:path+"/"+r.replace(new RegExp("^/"),""),$('meta[property="og:image"]').attr("content",r),$('meta[property="og:image:url"]').attr("content",r)),angular.isDefined(window.pageTitle)&&""!=o&&t.setTitle(o,window.pageTitle),a.$watch(function(){return t.colorScheme()},function(e){setTimeout(function(){t.togglerBlackAndWhite("img",e,".b-fix-wrapper")},700)})}]).directive("mosFixedHeader",["$interval","$timeout",function(i,o){return{restrict:"A",scope:{},link:function(t,a,e){a.on("$destroy",function(){_WINDOW.off("resize.correctFixedHeader"),t.$destroy()}),t.correctPosition=function(){t.headerEl=angular.element("header"),t.navEl=angular.element(".b-second-navbar-wrapper"),t.contWrap=angular.element(".b-content"),t.top=0,"fixed"===t.headerEl.css("position")&&(t.top+=t.headerEl.outerHeight(!0)),"fixed"===t.navEl.css("position")&&(t.top+=t.navEl.outerHeight(!0));var e=t.navEl.css("z-index");angular.element(a).css({top:t.top,"z-index":e-1}),t.contWrap.css("max-width")&&angular.element(a).css({"max-width":t.contWrap.css("max-width")})},t.correctPosition(),o(function(){_WINDOW.on("resize.correctFixedHeader",t.correctPosition),t.fixInterval=i(t.correctPosition,1e3)},500)}}}]),angular.module("mosapp.banner.service",[]).directive("mosExtcontsService",[function(){return{scope:{domain:"=",urlPath:"=",item:"="},link:function(e,t,a){if(e.banner=e.item,e.hideMe=!1,!e.item)return!(e.hideMe=!0);e.item.domain||(e.domain?e.item.domain=e.domain:e.item.domain="//"+window.location.hostname),e.item.urlPath||(e.banner.urlPath=e.urlPath),e.item.link=e.item.domain+(location.port?":"+location.port:"")+e.item.urlPath+"?id="+e.item.id;var i=document.createElement("script");i.type="text/javascript",i.language="JavaScript",i.id="mos-platform-"+e.item.id,i.src=e.item.link,angular.element(t).find(".extconts-service-container").append(i)},templateUrl:"mosBanner/mosBanner.tpl.html"}}]),angular.module("mosapp.social.widget",[]).directive("socialWidget",["UrlSrvc","LangSrvc",function(o,n){return{restrict:"A",scope:{stripeColor:"@?"},link:function(e,t){function a(){return-1<navigator.appVersion.indexOf("Edge/13",0)}function i(){a()&&angular.element(document).find(".mayor-social .icon").css({"background-size":"14px 14px"})}i(),a()&&e.$watch(function(){return angular.element(window).width()},function(){i()}),e.lang=n.getCurrentLang(),e.social=o.linksPath("social"),e.social=e.social[e.lang],e.stripeColor?e.border={"border-bottom":"3px solid "+e.stripeColor}:e.border={"border-bottom":"border: 3px solid #666"}},templateUrl:o.tmplPath("socialWidget/socialWidget.tpl.html")}}]).directive("informerWeatherTraffic",["UrlSrvc","dataSrvc",function(e,a){return{restrict:"A",scope:{color:"@"},link:function(e,t){a.el=t,e.informers=a.data.informers,e.colorScheme=a.data.colorScheme,e.error=a.data.error},templateUrl:e.tmplPath("socialWidget/informerWeatherTraffic.tpl.html")}}]).service("dataSrvc",["UrlSrvc","apiSrvc","toolsSrvc","$translate",function(e,t,i,o){this.data={informers:[{api:"infoTraffic",title:"social_widget.jam",units:"social_widget.jam_units_many",hideme:!0}],error:!1,colorScheme:!1,flag:!1},this.el=!1;var n=this;function a(a){t.getData("citypulse",a.api,{},!0,n.el).then(function(e){var t;angular.isObject(e)?(n.data.error=!1,a.data=e,a.hideme=!1,"infoTraffic"==a.api&&(e=a,t=parseInt(e.data.value),e.class=t<4?"icon-traffic-lights__green":t<8?"icon-traffic-lights__yellow":"icon-traffic-lights__red",e.units=1===t?"social_widget.jam_units_one":1<t&&t<5?"social_widget.jam_units_few":"social_widget.jam_units_many"),n.data.colorScheme=i.colorScheme(),o([a.title,a.units]).then(function(e){a.title=e[a.title],a.units=e[a.units]})):a.hideme=!0},function(e){n.data.error=e})}if(!this.flag)for(var r=0;r<this.data.informers.length;r++)a(this.data.informers[r])}]),angular.module("mosapp.filters.containers",[]).directive("containerRatio",["$timeout",function(e){return{restrict:"A",link:function(a,e,t){for(var i="containerRatio"+(new Date).getTime()+(9998*Math.random()+1),o=(e.on("$destroy",function(){$(window).off("resize."+i),a.$destroy()}),a.attrParams=t.containerRatio,a.attrParams=a.attrParams.split(":"),a.params={},a.attrParams.length);o--;){var n=a.attrParams[o].split("|");a.params[n[0]]=n[1]}a.getRatio=function(){var e=document.documentElement.clientWidth;return e?1170<e?"e":970<e?"d":750<e?"c":463<e?"b":"a":"a"},a.setElementSize=function(){a.ratio=a.getRatio(),e.height(e.width()*a.params[a.ratio])},a.setElementSize(),a.$watch(function(){return e.width()},function(e,t){e!==t&&(a.t&&clearTimeout(a.t),a.t=setTimeout(function(){a.setElementSize()},50))})},scope:{containerRatio:"@"}}}]),angular.module("mosapp.filters.imageSrc",[]).value("imageSet",{defaultImage:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",ratioMask:"x1_",size:{s:"small",m:"middle",b:"big"}}).service("imgSrvc",["mosconfig",function(t){this.isMarkupImage=function(e){return-1<e.indexOf("%markup_images_dir%")?e.replace("%markup_images_dir%",t.imagesPath):e},this.testSrc=function(e){return""!==e&&e},this.testObj=function(e,t){return!!(angular.isObject(e)&&angular.isObject(e[t])&&angular.isDefined(e[t].src)&&this.testSrc(e[t].src))&&e[t].src}}]).filter("imgThumb",["imgSrvc","imageSet",function(a,i){return function(e){var t=i.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&a.testSrc(e.src)?a.isMarkupImage(e.src):(e=a.testObj(e,"thumb")||a.testObj(e,"small")||a.testObj(e,"middle")||a.testObj(e,"big"))?a.isMarkupImage(e):t:t}}]).filter("imgShow",["imgSrvc","imageSet",function(a,i){return function(e){var t=i.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&a.testSrc(e.src)?a.isMarkupImage(e.src):(e=a.testObj(e,"show")||a.testObj(e,"big")||a.testObj(e,"original"))?a.isMarkupImage(e):t:t}}]).filter("imgDownload",["imgSrvc","imageSet",function(i,o){return function(e){var t,a=o.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&i.testSrc(e.src)?i.isMarkupImage(e.src):(t=(t=i.testObj(e,"download")||i.testObj(e,"show")||i.testObj(e,"big")||i.testObj(e,"original"))&&0===i.isMarkupImage(t).split("/").pop().indexOf("undefined(",0)?i.testObj(e,"show")||i.testObj(e,"big")||i.testObj(e,"original"):t)?i.isMarkupImage(t):a:a}}]).filter("imageSrc",["imgSrvc","imageSet",function(a,i){return function(e){var t=i.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&a.testSrc(e.src)?a.isMarkupImage(e.src):(e=a.testObj(e,"small")||a.testObj(e,"middle")||a.testObj(e,"big"))?a.isMarkupImage(e):t:t}}]).filter("imageSrcBig",["imgSrvc","imageSet",function(a,i){return function(e){var t=i.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&a.testSrc(e.src)?a.isMarkupImage(e.src):(e=device.mobile()?a.testObj(e,"small")||a.testObj(e,"middle")||a.testObj(e,"big"):device.tablet()?a.testObj(e,"middle")||a.testObj(e,"big")||a.testObj(e,"small"):a.testObj(e,"big")||a.testObj(e,"middle")||a.testObj(e,"small"))?a.isMarkupImage(e):t:t}}]).filter("imageSrcMiddle",["imgSrvc","imageSet",function(a,i){return function(e){var t=i.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&a.testSrc(e.src)?a.isMarkupImage(e.src):(e=a.testObj(e,"middle")||a.testObj(e,"big")||a.testObj(e,"small"))?a.isMarkupImage(e):t:t}}]).filter("imageSetSrc",["imgSrvc","imageSet",function(l,c){return function(e,t,a,i,o,n){var r=c.defaultImage,s=document.documentElement.clientWidth,n=s?1280<s?n:1024<s?o:768<s?i:480<s?a:t:i,o=(n=n.split("|"))[1]||"3",s=n[2]||"m";return angular.isObject(e)?angular.isDefined(e.src)&&l.testSrc(e.src)?l.isMarkupImage(e.src):(a=l.testObj(e,o+c.ratioMask+s)||l.testObj(e,c.size[s]))?l.isMarkupImage(a):r:r}}]).filter("imageSrcOriginal",["imgSrvc","imageSet",function(a,i){return function(e){var t=i.defaultImage;return angular.isObject(e)?angular.isDefined(e.src)&&a.testSrc(e.src)?a.isMarkupImage(e.src):(e=a.testObj(e,"original")||a.testObj(e,"big")||a.testObj(e,"middle")||a.testObj(e,"small"))?a.isMarkupImage(e):t:t}}]).filter("imgFileName",["imgSrvc",function(i){return function(e){var t="Moscow.jpg",a=angular.isObject(e)&&(a=angular.isDefined(e.src)&&i.testSrc(e.src)?i.isMarkupImage(e.src):i.isMarkupImage(i.testObj(e,"original")))?a.split("/").pop():t;return a}}]).directive("fixHeadImage",[function(){return{restrict:"A",scope:{},link:function(i,e){e.on("$destroy",function(){i.$destroy()}),i.EL=$(e),i.HDR=$(".b-header.attached"),i.WND=$(window),i.WND.on("scroll",function(){var e=i.EL.offset().top,t=i.HDR.length?i.HDR.height():0,a=e-t<(a=i.WND.scrollTop())?a+t-e:0;i.EL.css({"background-position":"center "+a+"px"})})}}}]).directive("imageSetElement",["imgSrvc","imageSet","$timeout","toolsSrvc","loader",function(r,s,e,t,l){return{restrict:"A",link:function(o,n){n.on("$destroy",function(){o.$destroy()}),o.removeLoader=function(){var e=n;o.loaderType&&(e={loaderType:o.loaderType,elems:n}),l.switchOff(e)},o.firstStart=!0,o.getSrc=function(){var e=s.defaultImage,t=n.width(),a=n.height(),i=(o.firstStart&&(i=n,o.loaderType&&(i={loaderType:o.loaderType,elems:n}),l.switchOn(i)),Math.round(t/a)),a=(i=(i=4<i?4:i)<1?1:i,800<t?"b":480<t?"m":"s");return angular.isObject(o.imageSetElement)?angular.isDefined(o.imageSetElement.src)&&r.testSrc(o.imageSetElement.src)?r.isMarkupImage(o.imageSetElement.src):(t=r.testObj(o.imageSetElement,i+s.ratioMask+a)||r.testObj(o.imageSetElement,s.size[a]))?r.isMarkupImage(t):e:e},o.setBackground=function(){o.firstStart&&(o.firstStart=!1,t.hideContentArea(angular.element(n))),o.removeLoader(),n.css("background-image",'url("'+o.img.src+'")'),t.showContentArea(angular.element(n))},o.loadBackground=function(){o.img=new Image,o.img.src=o.getSrc(),angular.element(o.img).on("load",o.setBackground).on("error",o.removeLoader)},e(function(){o.childImgEl=n.children("img"),o.childImgEl.length&&o.childImgEl[0]?o.$watch(function(){return o.childImgEl[0].src},function(){e.cancel(o.loadBGTimer),o.loadBGTimer=e(function(){o.loadBackground()},1e3)}):(o.loadBackground(),o.enableWatch&&(o.parentNode=angular.element(n[0].parentNode),o.$watch(function(){return{width:n.width(),height:n.height()}},function(e,t){e.width===t.width&&e.height===t.height||o.loadBackground()},!0)))})},scope:{imageSetElement:"=",loadHeight:"@",enableWatch:"@",loaderType:"@"}}}]).directive("imgSpacer",[function(){return{restrict:"A",link:function(e,t,a){for(var i="imgSpacer"+(new Date).getTime()+(9998*Math.random()+1),o=(t.on("$destroy",function(){$(window).off("resize."+i),e.$destroy()}),e.attrParams=a.imgSpacer,e.attrParams=e.attrParams.split(":"),e.params={},e.attrParams.length);o--;){var n=e.attrParams[o].split("|");e.params[n[0]]=n[1]}e.images={"1x1":"data:image/gif;base64,R0lGODlhDwAPAIAAAP///wAAACH5BAEAAAAALAAAAAAPAA8AAAINhI+py+0Po5y02otnAQA7","2x1":"data:image/gif;base64,R0lGODlhHgAPAIAAAP///wAAACH5BAEAAAAALAAAAAAeAA8AAAIThI+py+0Po5y02ouz3rz7D4ZTAQA7","3x1":"data:image/gif;base64,R0lGODlhLQAPAIAAAP///wAAACH5BAEAAAAALAAAAAAtAA8AAAIYhI+py+0Po5y02ouz3rz7D4biSJbmiTYFADs=","4x1":"data:image/gif;base64,R0lGODlhPAAPAIAAAP///wAAACH5BAEAAAAALAAAAAA8AA8AAAIchI+py+0Po5y02ouz3rz7D4biSJbmiabqyrZrAQA7"},e.rewriteSet=function(){e.w=document.documentElement.clientWidth,e.set="a",e.w&&(e.set="a",463<e.w&&(e.set="b"),750<e.w&&(e.set="c"),970<e.w&&(e.set="d"),1170<e.w&&(e.set="e")),t[0].src=e.images[e.params[e.set]+"x1"],t[0].style.width="100%",t[0].style.height="auto"},e.rewriteSet(),$(window).on("resize."+i,function(){e.t&&clearTimeout(e.t),e.t=setTimeout(function(){e.rewriteSet()},Math.floor(400*Math.random())+100)})},scope:{imgSpacer:"@"}}}]).directive("imgRatio",["mosconfig","$timeout","imgSrvc","imageSet","toolsSrvc","loader",function(e,r,s,l,c,d){return{restrict:"A",link:function(o,a,t){for(var e="imgRatio"+(new Date).getTime()+(9998*Math.random()+1),i=(a.on("$destroy",function(){$(window).off("resize."+e),o.$destroy()}),o.images={"1x1":"data:image/gif;base64,R0lGODlhDwAPAIAAAP///wAAACH5BAEAAAAALAAAAAAPAA8AAAINhI+py+0Po5y02otnAQA7","2x1":"data:image/gif;base64,R0lGODlhHgAPAIAAAP///wAAACH5BAEAAAAALAAAAAAeAA8AAAIThI+py+0Po5y02ouz3rz7D4ZTAQA7","3x1":"data:image/gif;base64,R0lGODlhLQAPAIAAAP///wAAACH5BAEAAAAALAAAAAAtAA8AAAIYhI+py+0Po5y02ouz3rz7D4biSJbmiTYFADs=","4x1":"data:image/gif;base64,R0lGODlhPAAPAIAAAP///wAAACH5BAEAAAAALAAAAAA8AA8AAAIchI+py+0Po5y02ouz3rz7D4biSJbmiabqyrZrAQA7"},o.noAnimation="true"===t.noAnimation,o.attrParams=t.imgRatio,o.attrParams=o.attrParams.split(":"),o.params={},o.attrParams.length);i--;){var n=o.attrParams[i].split("|");o.params[n[0]]=n[1]}o.parentNode=angular.element(a[0].parentNode),o.removeLoader=function(){d.switchOff(o.parentNode[0])},o.firstStart=!0,o.getSrc=function(e){var t=o.images[e+"x1"],a=o.parentNode.width(),i=(!o.noAnimation&&o.firstStart&&d.switchOn(o.parentNode[0]),800<a?"b":480<a?"m":"s");return o.parentNode.height(a/e),angular.isObject(o.imgSource)?angular.isDefined(o.imgSource.src)&&s.testSrc(o.imgSource.src)?(a=s.isMarkupImage(o.imgSource.src),/^(\/)|(http(s):\/\/)/.test(a)?a:"/"+a):(a=s.testObj(o.imgSource,e+l.ratioMask+i)||s.testObj(o.imgSource,l.size[i]))?s.isMarkupImage(a):t:t},o.restoreStyle=function(e){o.needForRestore=!1,r.cancel(o.needForRestoreTimer),o.noAnimation||o.removeLoader(),!o.noAnimation&&o.firstStart&&(o.firstStart=!1,c.hideContentArea(o.parentNode)),a[0].src=e,a[0].style.height="auto",o.noAnimation||c.showContentArea(o.parentNode)},o.brokenImageSrc=function(e){t.setBrokenImageSrc&&o.setBrokenImageSrc(e)},o.rewriteSet=function(){o.needForRestore=!0,a[0].style.width="100%";var e=new Image,t=o.params[o.ratio];e.src=o.getSrc(t),o.noAnimation&&(a[0].src=e.src),angular.element(e).on("load",function(){o.needForRestore&&(o.brokenImageSrc(!1),o.restoreStyle(e.src,t))}),angular.element(e).on("error",function(){e.src=o.images[t+"x1"],o.needForRestore&&(o.brokenImageSrc(!0),o.restoreStyle(e.src,t))}),o.needForRestoreTimer=r(function(){o.needForRestore&&(o.brokenImageSrc(!1),o.restoreStyle(e.src,t))},1e4)},o.getRatio=function(){var e=document.documentElement.clientWidth;return e?1170<e?"e":970<e?"d":750<e?"c":463<e?"b":"a":"a"},o.ratio=o.getRatio(),o.rewriteSet(),o.$watch(function(){return o.parentNode.width()},function(e,t){e!==t&&(o.ratio=o.getRatio(),o.parentNode.css({height:e/o.params[o.ratio],overflow:"hidden"}),a[0].style.height="100%",o.t&&clearTimeout(o.t),o.t=setTimeout(function(){o.rewriteSet()},Math.floor(100*Math.random())+50))})},scope:{imgRatio:"@",imgSource:"=",noAnimation:"@",setBrokenImageSrc:"=?"}}}]),angular.module("mosapp.filters.prepareDate",[]).filter("prepareDate",function(){return function(e){var t,a,i=[];return-1===e.indexOf("-")?e:((i=e.split("-"))[0]=i[0].slice(0,i[0].length-1),i[1]=i[1].slice(1,i[1].length+1),i[0]===i[1]?i[0]:(t=i[0].split(" "),a=i[1].split(" "),1===t.length&&1===a.length?e:t[1]===a[1]?t[0]+"–"+a[0]+" "+a[1]:i[0]!==i[1]?e:void 0))}}),angular.module("mosapp.filters.prepareDateSince",[]).filter("prepareDateSince",["$filter",function(o){return function(e,t){var a=new Date,i=a.getTimezoneOffset()/60,i=(a=-3!=i?new Date(a.getTime()+3600*i*1e3+108e5):a).getFullYear();if(new Date(e).getFullYear()<i)return o("date")(e,t+" yyyy");i=Math.abs(e-a.getTime());if(1<=Math.floor(i/864e5))return o("date")(e,t);a=Math.floor(i/36e5);if(0<a&&a<24)return a+o("translate")("prepareDateSince.hours");a=Math.floor(i/6e4);return 0<a&&a<60?a+o("translate")("prepareDateSince.minutes"):0==a?o("translate")("prepareDateSince.momentAgo"):o("date")(e,t)}}]),angular.module("mosapp.projects.main",[]).directive("projectsMain",["UrlSrvc","apiSrvc","$state","$stateParams","LangSrvc","mosconfig","toolsSrvc","metaConfig",function(r,s,i,l,c,e,d,p){return{restrict:"A",link:function(o,e,t,a){function n(e){return 1===e?r.pagePath("projects",""):1<e?r.pagePath("projects","page-"+e):""}o.params={expand:"image"},l.page&&(l.page*=1,1===l.page&&i.go("projects"),o.params.page=l.page),o.linksLoaded=!1,e.on("$destroy",function(){o.$destroy()}),o.lang=c.getCurrentLang(),o.getProjects=function(i){i&&(o.contentArea=e.find(".projects-main__items"),d.hideContentArea(o.contentArea));s.getData("projects","projectsMain",o.params,!0,angular.element(document).find(".projects-main__items_get-more")).then(function(e){if(angular.isArray(e.items)&&e.items.length){o.mosError=!1;for(var t,a=0;a<e.items.length;a++)e.items[a].type&&"tilda"===e.items[a].type&&(t=r.pagePath("projects",e.items[a].code),e.items[a].url=(/\/&/.test(t),t),"ru"!==o.lang&&(e.items[a].url="/"+o.lang+e.items[a].url));i&&(o.items=[]);for(a=0;a<e.items.length;a++)o.items.push(e.items[a]);e._meta.currentPage==e._meta.pageCount?o.isThereMorePages=!1:(o.isThereMorePages=!0,o.params.page=e._meta.currentPage),i&&d.showContentArea(o.contentArea),o.linksLoaded||(o.linksLoaded=!0,r.setPrevNextLinks(o.params.page,o.isThereMorePages,n))}else o.mosError=404},function(){o.mosError=err.code,o.error=err.code})},p.init().then(function(){o.canonicalLink=r.getLangLink(r.pagePath("projects","")),o.canonicalLink&&r.setCanonical(o.canonicalLink),d.setMeta(o,{main:{title:p.config.main.title,description:p.config.main.description,image:p.config.main.image}},"main"),d.setTitle(p.config.main.section,p.config.main.sectionTitle)}),o.getNextPageUrl=function(){return r.getNextPageUrl(o.params.page,n)},o.$watch(function(){return d.colorScheme()},function(e){o.colorScheme=e}),o.isThereMorePages=!1,o.getMore=function(){o.params.page?o.params.page++:o.params.page=2,o.getProjects()},o.getProjects(!0)},templateUrl:r.tmplPath("projectsMain/projectsMain.tpl.html")}}]),angular.module("mosapp.sharing",["mosapp.sharing.popup"]).directive("mosSharing",["UrlSrvc","$compile","$modal","$stateParams","apiSrvc","$timeout","mosconfig","LangSrvc",function(s,e,l,t,a,c,u,d){return{restrict:"A",priority:0,link:function(i,e,t){e.on("$destroy",function(){i.$destroy()}),i.$watch(function(){return angular.element(document).width()},function(e){i.direction=t.dynDirect?i.dynDirect:t.direction,i.dynClass="b-sharing-links_type_"+i.direction+" b-sharing-links_behaviour_plain"}),t.socials||(i.lang=d.getCurrentLang(),"ru"===i.lang?i.socials="vkontakte,odnoklassniki":i.socials="vkontakte");var a=["plain","modal"],p="icon-share",m={vkontakte:"vk",facebook:"facebook",twitter:"twitter",odnoklassniki:"odnoklassniki"},o=null;function n(e){return(e=e?String(e).replace(/\&\w{4,5};/gm," "):"")?String(e).replace(/<[^>]+>/gm,""):""}function r(){c(function(){var e="";u.domain&&(e=(e=(0===u.domain.indexOf("http")?"":location.protocol+"//")+u.domain).replace(new RegExp("/$"),""));var s=0===(s=i.image&&""!==i.image&&i.image.indexOf("data:image",0)<0?i.image:(u.imagesPath||"")+"icon200x200.png").indexOf("http")?s:e+"/"+s.replace(new RegExp("^/"),""),l=e+"/"+location.pathname.replace(new RegExp("^/"),""),c=n(i.title||i.text||document.title),d=n(i.description||i.preview||i.title||i.text||document.title),e=("article"!==t.itemType&&0!==window.location.pathname.indexOf("/city/about/symbols/")&&0!==window.location.pathname.indexOf("/city/about/honors/")||(s="https://"+window.location.hostname+"/open-graph/v1/frontend"+window.location.pathname,$('meta[property="og:image:width"]').attr("content","1200"),$('meta[property="og:image:height"]').attr("content","630")),i.letAloneOg||($('meta[property="og:url"]').attr("content",l),$('meta[property="og:title"]').attr("content",c),$('meta[property="og:description"]').attr("content",d),$('meta[property="og:image"]').attr("content",s),$('meta[property="og:image:url"]').attr("content",s)),"undefined"===i.showCounter||i.showCounter);i.socials&&i.id&&document.getElementById(i.id)&&(o?o.updateContent({url:l,title:c,description:d,image:s}):o=new Ya.share2(i.id,{content:{url:l,title:c,description:d,image:s},theme:{services:i.socials,counter:e,lang:"ru",bare:!1},hooks:{onready:function(){var o=$("#"+i.id),e=o.find(".ya-share2__icon"),a=i.getSocials(),n=(e.each(function(e,t){$(t).addClass(p).addClass(p+"-"+m[a[e]])}),new Date),r=setInterval(function(){var e=new Date;if(e-n<1e4&&o.find(".ya-share2__item_service_odnoklassniki").find(".ya-share2__link").attr("href","https://connect.ok.ru/dk?st.cmd=WidgetSharePreview&&st.imageUrl="+encodeURIComponent(s)+"&st.description="+encodeURIComponent(d)+"&st.shareUrl="+encodeURIComponent(l)+"&st.title="+encodeURIComponent(c)+"&utm_source=share2"),e-n<6e4)for(var t=o.find(".ya-share2__counter"),a=t.length-1;0<=a;a--){var i=$(t[a]);isNaN(parseInt(i.text()))?isNaN(i.data("count"))?i.removeClass("show-counter"):i.text($(t[a]).data("count")):i.hasClass("show-counter")||(i.css({opacity:0}).addClass("show-counter"),TweenLite.to(i,.75,{opacity:1,ease:Power1.easeOut}))}else clearInterval(r)},1e3)},onshare:function(e){for(var t=$("#"+i.id).find(".ya-share2__counter"),a=t.length-1;0<=a;a--)isNaN($(t[a]).text())||$(t[a]).css({opacity:1}).addClass("show-counter")}}})),i.calculatePos=function(){var e=angular.element(document).height(),t=angular.element(document).find(".b-popup-sharing__body").height();angular.element(document).find(".b-sharing").offset().top;return currentTop=(e-t)/2},i.isModal()&&i.$watch(function(){return angular.element(document).width()},function(e){i.widthShareItem&&(767<e?(angular.element(document).find(".ya-share2__item").attr("style","width: "+i.widthShareItem+"%"),i.calculatePos()):angular.element(document).find(".ya-share2__item").removeAttr("style"))})},10)}i.getSocials=function(){return i.socials.split(",")},i.isModal=function(){return i.type===a[1]||a.indexOf(i.type)<0},i.openPopup=function(e){i.widthShareItem=Math.round(100/i.getSocials().length),i.popup=l({scope:i,template:s.tmplPath("sharingPopup/sharingPopup.tpl.html"),show:!1,prefixClass:"share-modal",backdropAnimation:"am-fade"}),i.popup.$promise.then(function(){i.popup.show(),r()})},i.isModal()&&angular.element(window).on("click",function(e){angular.element(document).find(e.target).hasClass("am-fade")&&i.closePopup()}),i.closePopup=function(){o=null,i.popup.hide()},i.$watch("text",function(e){e&&!i.isModal()&&r()}),i.$watch("image",function(e){e&&!i.isModal()&&r()}),r()},scope:{id:"@",type:"@",socials:"@",direction:"@",dynDirect:"=",image:"@",text:"@",showCounter:"=",title:"@",preview:"@",description:"@",letAloneOg:"="},templateUrl:s.tmplPath("sharing/sharing.tpl.html")}}]),angular.module("mosapp.sharing.popup",[]).directive("mosSharingPopup",["UrlSrvc","$compile","$modal","$stateParams","apiSrvc","$timeout",function(e,t,a,i,o,n){return{restrict:"A",link:function(e,t,a){},scope:{},templateUrl:e.tmplPath("sharingPopup/sharingPopup.tpl.html")}}]),angular.module("mosapp.banner",[]).directive("mosBanner",["UrlSrvc","apiSrvc","mosconfig","$sce",function(e,t,o,n){return{restrict:"A",scope:{},link:function(t,e,a,i){try{t.flagon=o.insertionHeader.current,"on"===t.flagon&&(t.path=n.trustAsResourceUrl(o.insertionHeader.path))}catch(e){t.flagon="off"}},templateUrl:e.tmplPath("banner/banner.tpl.html")}}]),angular.module("mosapp.mosError",["mosapp.filters.imageSrc","ngSanitize"]).filter("to_trusted",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).directive("mosError",["UrlSrvc","apiSrvc","toolsSrvc","$state","$stateParams","$timeout","libsLoader","LangSrvc","headmetaSrvc","$translate",function(e,a,i,t,o,n,r,s,l,c){return{scope:{mosError:"="},link:function(t){r.get({js:"error/index.js",css:"error/index.css",id:"error-app.js",api:"Error"});["msapplication-tap-highlight","fb:pages","og:url","og:title","og:type","og:description","og:image","og:site_name","twitter:card"].forEach(function(e){l.removeMetaTag(e)}),c("mosError.errorMessage_"+t.mosError).then(function(e){i.setTitleClean(e)}),t.$watch("mosError",function(e){e!=undefined&&a.getData("mosError","page",{code:t.mosError},!0).then(function(e){t.pageInfo=e,n(function(){"function"==typeof window.phantomJsError&&window.phantomJsError(t.mosError)})})}),t.lang=s.getCurrentLang(),t.appId="en"===t.lang?"app-en":"app",t.isClientError="4"===t.mosError.toString()[0],t.showSearch=!("en"!==t.lang&&"ru"!==t.lang||!t.isClientError),"404"==t.mosError&&i.statCounter({metrika:{TARGET_NAME:"error_404"}})},templateUrl:e.tmplPath("mosError/mosError.tpl.html")}}]),angular.module("mosapp.special.map.lightbox",[]).directive("lightbox",["$modal","UrlSrvc","$timeout",function(n,r,s){return{restrict:"A",transclude:!0,scope:{fullImageLink:"@",description:"@",prefixClass:"@",scrollOn:"@"},template:"<ng-transclude></ng-transclude>",link:function(a,e,t){var i=angular.element(document);a.hidePop=function(){a.popup&&(a.popup.hide(),o.off("resize.popup"),a.popup=null)};var o=angular.element(window);angular.element(e).on("click",function(){a.popupImage={src:a.fullImageLink||angular.element(e).find("img").attr("src"),description:a.description||angular.element(e).find("img").attr("alt")},a.popup=n({scope:a,template:r.tmplPath("mosSpecialMap/lightbox.tpl.html"),show:!1,prefixClass:"lightbox",backdropAnimation:"am-fade"}),a.popup.$promise.then(function(){var e;a.popup.show(),a.popupImage&&a.popupImage.src&&((e=new Image).src=a.popupImage.src,e.onload=function(){s(function(){var e,t;e=i.find(".lightbox-popup-modal"),t=e.find("img").height(),a.popH=Math.min(o.height()-60,t+60),a.popupY=o.height()/2-t/2,a.popupY=30<a.popupY?a.popupY:30,a.popupX=o.width()/2-e.outerWidth()/2,a.popupX=0<a.popupX?a.popupX:0,e.css({top:a.popupY,left:a.popupX,height:a.popH}),a.scrollOn&&e.find(".lightbox-popup-modal__wrapper").mCustomScrollbar({axis:"yx",theme:"minimal-dark",advanced:{updateOnImageLoad:!0,updateOnContentResize:!0}}),o.on("resize.popup",a.hidePop)},10)})})})}}}]),angular.module("mosapp.special.map",["mosapp.2gis.map","mosapp.filters.imageSrc","mosapp.special.map.lightbox","mosapp.mosLightbox","ngSanitize","slick"]).run(["$templateCache",function(e){e.put("dropdown/dropdown.mosSpecialMap.category.tpl.html",'<ul class="dropdown-menu customScrollbar" data-dropdown-control=""> <li data-ng-repeat="item in categories.items"><a data-ng-click="setCurrentCategory(item)"> <span class="text">{{ item.title }}</span><span class="count">{{ item.points_count }}</span> </a> </li> </ul>'),e.put("dropdown/dropdown.mosSpecialMap.point.tpl.html",'<ul class="dropdown-menu customScrollbar" data-dropdown-control=""> <li data-ng-repeat="item in categories.currentCategory.points"><a data-ng-click="setCurrentPoint(mapId, item)"> <span class="text">{{ item.title }}</span></a> </li> </ul>')}]).directive("mosSpecialMap",["UrlSrvc","mosconfig","apiSrvc","$timeout","$interval","toolsSrvc","$state","mos2GisMapMarkersCtrl","mos2GisMapSrvc",function(m,e,u,g,t,a,i,f,h){return{restrict:"A",scope:{localId:"@",zoom:"@",scrollZoom:"@",centerCoordsDesktop:"@?",centerCoordsMobile:"@?"},templateUrl:m.tmplPath("mosSpecialMap/mosSpecialMap.tpl.html"),link:function(i,a,o){var n,r,s,l,t,e;function c(e){var t,a;e?(n=_WINDOW.scrollTop(),window.scrollTo(0,1),angular.element("body").addClass("full-screen-app")):(angular.element("body").removeClass("full-screen-app"),_WINDOW.scrollTop(n)),i.isMobileMapView=e,void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!e),t=i.mapId,a=function(){var e=0,t=0,a=50;i.isMobileMapView&&i.isMobileDevice&&(e=0,t=a=50);i.isMobileDevice||(e=350);return{paddingLeft:e,paddingBottom:t,paddingTop:a}}(),g(function(){r&&t&&(r.invalidateSize(!1),h.fitMap(t,{paddingTopLeft:DG.point(a.paddingLeft,a.paddingTop),paddingBottomRight:DG.point(0,a.paddingBottom)}))},100)}function d(e){if(e){e=e.split(",");if(angular.isArray(e)&&1<e.length)return{y:+e[0],x:+e[1]}}return null}function p(e){try{var t=JSON.parse(e)}catch(e){return!1}return t}i.element=a,i.localId?(i.zoomLevel=parseInt(i.zoom),i.zoomLevel=isNaN(i.zoomLevel)||i.zoomLevel<0||18<i.zoomLevel?12:i.zoomLevel,i.isActiveIcon=!1,i.areas=[],i.currentPoint=!1,i.mapReady=!1,i.categories={activeCategoryIndex:9999,currentCategory:!1,items:[]},i.pointChanged=!1,window.device&&(i.isMobileDevice=window.device.mobile()||window.device.tablet(),i.isMobileDevice&&(i.scrollZoom=!1)),i.isMobileMapView=!1,i.toggleMapOn=function(){c(!0)},i.toggleMapOff=function(){c(!1)},r=i.mapId=!1,s=!1,function e(){var t=$(a).find("[data-mos2-gis-map]");i.mapId=t.attr("data-map-id"),i.mapId&&(r=h.getMap(i.mapId),s=h.getMapEl(i.mapId)),i.mapId&&r&&s||setTimeout(e,300)}(),i.isMobile=!1,i.centerCoords=d(angular.isDefined(i.centerCoordsDesktop)&&angular.isString(i.centerCoordsDesktop)?i.centerCoordsDesktop:null),i.$watch(function(){return!i.isMobile&&angular.isDefined(i.centerCoordsDesktop)&&angular.isString(i.centerCoordsDesktop)?i.centerCoordsDesktop:i.isMobile&&angular.isDefined(i.centerCoordsMobile)&&angular.isString(i.centerCoordsMobile)?i.centerCoordsMobile:null},function(e){i.centerCoords=d(e)}),i.isMapReady=function(){i.mapReady=!0},l=angular.element(a).find(".specMap-preloader")[0],t=function(){i.isMobile=window.innerWidth<992},_WINDOW.resize(function(){g.cancel(e),e=g(t,100)}),i.toggleInfoOff=function(){i.setCurrentPoint(i.mapId,!1),i.pointChanged=!i.pointChanged,i.currentPoint=!1},i.setCurrentPoint=function(e,t){var a;t&&!t.images&&(a=t,u.getData("directories","placesPoints",{id:a.id,expand:"images,description,event_ids,link"},!0,l).then(function(e){a.images=e.images,a.description=e.description,a.link=e.link,angular.isArray(e.event_ids)&&e.event_ids.length&&!isNaN(e.event_ids[0])&&(a.eventLink=m.pagePath("afisha","event/"+e.event_ids[0]+"/")),a.sideBarSize=300<a.description.replace(/<[^>]+>/g,"").length?"big":"small"},function(e){i.areas=e})),i.currentPoint.id==t.id?i.currentPoint.doubleClicked=!0:(i.currentPoint.focus=!1,f.unsetHover(i.currentPoint),t&&(i.currentPoint=!1,setTimeout(function(){i.pointChanged=!i.pointChanged,i.currentPoint=t,f.focusOnPoint(e,t),i.currentPoint.focus=!0},100)))},i.setDoubleClick=function(e){e.doubleClicked=!0},i.setCurrentCategory=function(e,t){e&&i.categories.currentCategory&&e!==i.categories.currentCategory&&f.clearPoints(i.mapId,i.categories.currentCategory.points),i.categories.currentCategory&&i.categories.currentCategory===e||f.setPoints(i.mapId,{callback:i.setCurrentPoint,icon:e.icon,icon_hover:e.icon_hover},e.points,!(!t||!o.zoom)),i.categories.currentCategory=e,i.setCurrentPoint(i.mapId,!1),t&&(i.categories.activeCategoryIndex=angular.isArray(i.categories.items)&&1===i.categories.items.length?0:9999)},u.getData("directories","placesGroups",{filter:'{"local_id":"'+i.localId+'"}',expand:"icon,icon_hover"},!0,l).then(function(e){e&&e.items&&0<e.items.length&&g(function(){var a=e.items[0];u.getData("directories","placesGroups",{expand:"points,points_count,icon,icon_hover,image,image_hover",filter:'{"parent_id":"'+a.id+'"}'},!0,l).then(function(e){e&&e.items&&0<e.items.length&&(angular.forEach(e.items,function(t){t.points_count&&!t.icon_hover&&(t.icon_hover=a.icon),angular.forEach(t.points,function(e){e.icon=t.icon,e.focus=!1,e.path=e.path&&p(e.path),e.polygon=e.polygon&&p(e.polygon)[0],a.icon&&a.icon.src&&(i.isActiveIcon=!0)}),this.push(t)},i.categories.items),i.setCurrentCategory(i.categories.items[0],!0),t())})},10)},function(e){i.areas=e})):console.warn("Add local-id attribute!")}}}]).directive("dropdownControl",[function(){return{scope:!1,link:function(e,t,a){angular.element(t).on("click",function(){e.$parent.$hide()})}}}]).directive("scrollToCurrent",[function(){return{scope:!1,link:function(e,t,a){function i(){t.mCustomScrollbar("scrollTo",".specMap__area_active",{scrollEasing:"easeOut",scrollInertia:300})}a.$observe("currentPoint",function(){a.currentPoint&&""!==a.currentPoint&&setTimeout(i,300)}),t.on("$destroy",function(){e.$destroy()})}}}]).directive("repeatIsFinished",["$timeout",function(o){return{restrict:"A",scope:{parent:"=",slider:"@",last:"="},link:function(e,t,a){var i;e.last&&(e.sliderEl,o(function(){e.sliderEl=e.parent.find(e.slider),e.parent.find(e.slider).slick({infinite:!0,prevArrow:"<span class='slick-arrow-prev s-prev'><span class='ico'><span></span></span></span>",nextArrow:"<span class='slick-arrow-next s-next'><span class='ico'><span></span></span></span>",centerMode:!0,adaptiveHeight:!0,centerPadding:0}),i=setInterval(function(){e.sliderEl.height()<50?e.parent.find(e.slider).slick("slickSetOption","infinite",!0,!0):clearInterval(i)},500)},100))}}}]),angular.module("mosapp.map.seasons.api.directories",[]).service("mosSeasonsService",["apiSrvc","$q",function(u,a){var t=[];function i(){for(var e=0;e<i.arguments.length;e++)t[e]=new Image,t[e].src=i.arguments[e]}function n(e,t,a){e.menu_color?t.color=e.menu_color:a&&a.color&&(t.color=a.menu_color),e.menu_color_hover?t.colorActive=e.menu_color_hover:a&&a.color&&(t.color=a.menu_color_hover),e.icon?(t.pin=e.icon,i(t.pin.src)):a&&a.icon&&(t.color=a.icon),e.icon_hover?(t.pinActive=e.icon_hover,i(t.pinActive.src)):a&&a.icon_hover&&(t.color=a.icon_hover),e.image?(t.icon=e.image,i(t.icon.src)):a&&a.image&&(t.color=a.image),e.image_hover?(t.iconActive=e.image_hover,i(t.iconActive.src)):a&&a.image_hover&&(t.color=a.image_hover)}return{rootId:!1,pin:!1,pinActive:!1,icon:!1,iconActive:!1,color:!1,colorActive:!1,categories:[],getRootElement:function(e,t){var a=this;return u.getData("directories","placesGroups",{filter:'{"local_id":"'+e+'"}',expand:"image,image_hover,icon,icon_hover,menu_color,menu_color_hover"},!1).then(function(e){e&&e.items&&0<e.items.length&&(n(e=e.items[0],a),a.rootId=e.id,t&&"function"==typeof t&&t())})},getCategories:function(t,a){var i=[],o=this;return u.getData("directories","placesGroups",{expand:"points,image,image_hover,icon,icon_hover,menu_color,menu_color_hover",filter:'{"parent_id":"'+this.rootId+'"}'},!0).then(function(e){e&&e.items&&0<e.items.length&&(e.items.forEach(function(e){n(e,e,o),e.points.forEach(function(e){e.icon=t.icon,e.icon_hover=t.icon_hover,e.color=t.color,e.color_hover=t.color_hover}),e.count=e.points?e.points.length:0,e.cluster={size:55},e.showLabel=!1,i.push(e)}),o.categories=i,a&&"function"==typeof a&&a())})},getPoint:function(t,e){return t.loaded?a.when(t):u.getData("directories","placesPoints",{id:t.id,expand:"images,description,event_ids,link"},!1,e).then(function(e){if(e&&e.group_id)return e.MapMarker=t.MapMarker,(t=e).loaded=!0,t})},getEvents:function(e,r,s){if(r.eventsLoaded)return a.when(r);var l=[],c=r,d=1,p=!0,m=e.filter(function(e){return"257"===e.toString().substr(-3)});!function t(){if(c===r&&m.length){var e={filter:{id:m.join(",")}};if(p)e.page=++d,u.getData("newsfeed","afishaBricks",e,!1).then(function(e){e&&e.items&&e.items.length?(l.push(e.items),p=d<e._meta.pageCount,t()):l=[]});else{for(var a=[],i=(new Date).getTime(),o=0;o<l.length;o++)a=a.concat(l[o]);var n=[];a.forEach(function(e){1e3*e.date_to_timestamp>=i&&n.push(e)}),r.eventsLoaded=!0,r.events=n,s(r)}}else l=[]}()}}}]),angular.module("mosapp.map.seasons.categories",["mosapp.2gis.map","mosapp.filters.imageSrc","ngSanitize","mosapp.map.helpers"]).directive("mosSeasonsMapCategories",["UrlSrvc",function(e){return{restrict:"A",scope:{colors:"=",categories:"=",activeCategory:"=",toggleCategory:"=",activePoint:"=",popupIsClosed:"=",setCategory:"&",setPoint:"&",isMobile:"=",isTablet:"=",isActive:"="},templateUrl:e.tmplPath("mosSeasonsMap/mosSeasonsMap_categories.tpl.html"),link:function(a,e,t){a.toggleCategory={showSub:!1},a.setActiveCategory=function(e){a.toggleCategory.showSub=!1,a.setCategory()(e)},a.setActivePoint=function(e,t){e.preventDefault(),a.setPoint()(t)}}}}]),angular.module("mosapp.map.seasons.pin",["mosapp.map.helpers","mosapp.map.seasons.api.directories","mosapp.map.seasons.categories"]).directive("mosSeasonsMapPin",["UrlSrvc","mosSeasonsService","apiEhd","$timeout","loader",function(o,n,e,r,t){return{restrict:"A",scope:{point:"=",colors:"=",mobile:"=",close:"&?",maxHeight:"@?"},templateUrl:o.tmplPath("mosSeasonsMap/mosSeasonsMap_pin.tpl.html"),link:function(t,e,a){function i(e){Array.isArray(e.events)&&e.events.forEach(function(e){e.occurrence_id?e.link=t.calendarPage+"/"+e.id+"/"+e.occurrence_id:e.link=t.calendarPage+"/"+e.id}),e.popup&&r(function(){e.popup.update()},100)}t.maxHeight&&e.find(".wrapper").css({"max-height":t.maxHeight+"px"}),t.calendarPage=o.pagePath("afisha","event"),t.eventsLoaded=!1,n.getPoint(t.point,e).then(function(e){angular.extend(t.point,e),t.point.popup&&r(function(){t.point.popup.update()},100),t.point.event_ids&&0<t.point.event_ids.length&&n.getEvents(t.point.event_ids,t.point,i)}),t.closeMap=function(){t.close()()}}}}]),angular.module("mosapp.map.seasons",["ngSanitize","mosapp.2gis.map","mosapp.filters.imageSrc","mosapp.map.helpers","mosapp.map.seasons.api.directories","mosapp.map.seasons.categories","mosapp.map.seasons.pin"]).directive("mosSeasonsMap",["$compile","$q","$timeout","mosSeasonsService","loader","mos2GisMapMarkersCtrl","mos2GisMapMarkersLayer","mos2GisMapSrvc","UrlSrvc",function(g,e,f,h,t,a,v,y,i){return{restrict:"A",scope:{localId:"@",zoom:"@?",scrollZoom:"@?",mapHeight:"@?",pointType:"@?",ehdApi:"@?",title:"@?",tabsTitle:"@?",backgroundColor:"@?",borderRadius:"@?",centerCoordsDesktop:"@?",centerCoordsMobile:"@?"},templateUrl:i.tmplPath("mosSeasonsMap/mosSeasonsMap.tpl.html"),link:function(o,a,e){var t,i="cluster",n="point",r=(o.hide=!1,o.mapCategories=[],o.activeCategory=!1,o.activeMap=!1,o.activePoint=!1,o.colors={color:!1,color_hover:!1},o.icons={icon:!1,icon_hover:!1},o.view={toggleCategory:{}},o.mapOpened=!0,o.isMobile=device.mobile(),o.isTablet=device.tablet(),o.isIpad=device.ipad(),o.isPortrait=window.innerWidth<window.innerHeight,o.categoriesActive=!1,o.popupIsClosed=!1,o.toggleCategories=function(){o.categoriesActive=!o.categoriesActive},(o.isMobile||o.isTablet)&&(o.mapOpened=!1),!1),s=!1,l=!1,c=!o.isMobile&&!o.isTablet,c=c&&angular.isDefined(o.centerCoordsDesktop)&&angular.isString(o.centerCoordsDesktop)?o.centerCoordsDesktop:!c&&angular.isDefined(o.centerCoordsMobile)&&angular.isString(o.centerCoordsMobile)?o.centerCoordsMobile:null;function d(){var e,t,a,i;h.rootId?(o.colors={color:h.color,color_hover:h.colorActive},o.icons={icon:h.pin,icon_hover:h.pinActive},e={icon:o.icons.icon,icon_hover:o.icons.icon_hover,color:o.colors.color,color_hover:o.colors.color_hover},t=".seasonsMap .marker-cluster div { background-color: "+o.colors.color+"!important; } .seasonsMap .marker-cluster:hover div { background-color: "+o.colors.color_hover+"!important; } .seasonsMap .seasonsMap__map .dg-control-round__icon { background-color: "+o.colors.color+"!important; } .seasonsMap .seasonsMap__map .dg-control-round__icon:before,.seasonsMap .seasonsMap__map .dg-control-round__icon:after { background-color: "+o.colors.color_hover+"!important; }.seasonsMap .seasonsMap__map .dg-control-round__icon:hover { background-color: "+o.colors.color_hover+"!important; } .seasonsMap .seasonsMap__map .dg-control-round__icon:hover:before,.seasonsMap .seasonsMap__map .dg-control-round__icon:hover:after { background-color: "+o.colors.color+"!important; } .mosSeasonsMap_categories ul li.active .mosSeasonsMap_categories__title { color: "+o.colors.color_hover+"; }.mosSeasonsMap_categories__points { background-color: "+o.colors.color+"; }.mosSeasonsMap_categories { border-radius:"+o.borderRadius+"; }.seasonsMap .leaflet-popup-content-wrapper { border-radius:"+o.borderRadius+"; }.seasonsMap .leaflet-popup:after {bottom: -"+o.icons.icon_hover.height/2+'px;background-image: url("'+o.icons.icon_hover.src+'"); width: '+o.icons.icon_hover.width+"px; height: "+o.icons.icon_hover.height+"px; }.seasonsMap .leaflet-popup-content-wrapper { border-color: "+o.colors.color_hover+";}",a=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),a.appendChild(i),h.getCategories(e,function(){o.mapCategories=h.categories,0<o.mapCategories.length&&o.setActiveCategory(o.mapCategories[0])}),s.on("popupclose",function(){o.activePoint.MapMarker.setOpacity(1),o.popupIsClosed=!0})):o.hide=!0}function p(){angular.element(".mosSeasonsMap_categories__list.customScrollbar").mCustomScrollbar("scrollTo",".mosSeasonsMap_categories__point.active-point",{scrollEasing:"easeInOut",scrollInertia:300})}function m(){angular.element(".mosSeasonsMap_categories__list.customScrollbar").mCustomScrollbar("scrollTo",".mosSeasonsMap_categories__scroll-list li.active",{scrollEasing:"easeInOut",scrollInertia:300})}function u(){t=e=0,a=50,o.isMobile&&o.mapOpened?(a=50,e=0):o.isTablet&&o.mapOpened&&(a=90),o.isMobile&&o.mapOpened&&(t=50);var e,t,a,i={paddingLeft:e=o.isMobile||o.isTablet?e:350,paddingBottom:t,paddingTop:a};f(function(){s.invalidateSize(!1),y.fitMap(r,{paddingTopLeft:DG.point(i.paddingLeft,i.paddingTop),paddingBottomRight:DG.point(0,i.paddingBottom)})},100),(o.isMobile||o.isTablet)&&o.mapOpened&&window.innerHeight>l.height()+i.paddingTop+i.paddingBottom&&f(u,500)}o.centerCoords=function(e){if(e){e=e.split(",");if(angular.isArray(e)&&1<e.length)return{y:+e[0],x:+e[1]}}return null}(c),function e(){var t=$(a).find("[data-mos2-gis-map]");r=t.attr("data-map-id"),!angular.isDefined(o.mapHeight)||o.isMobile||o.isTablet||(o.mapHeight.match(/[0-9]+px/g)||o.mapHeight.match(/[0-9]+vh/g))&&angular.element(a).find(".seasonsMap__wrapper").css({height:o.mapHeight}),r&&(s=y.getMap(r),l=y.getMapEl(r),angular.element(a).find(".seasonsMap__wrapper")),r&&s&&l?(o.mapElHeight=l.height(),_WINDOW.on("resize",function(){o.isPortrait=window.innerWidth<window.innerHeight,o.isPortrait&&angular.element(a).find(".seasonsMap__groups").mCustomScrollbar("destroy")}),h.getRootElement(o.localId,d)):setTimeout(e,300)}(),o.openMap=function(){t=_WINDOW.scrollTop(),window.scrollTo(0,1),void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!1),o.mapOpened=!0,angular.element("body").addClass("full-screen-app"),u()},o.closeMap=function(){o.mapOpened=!1,s.closePopup(),void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!0),angular.element("body").removeClass("full-screen-app"),_WINDOW.scrollTop(t),u()},o.setActivePoint=function(e){o.activePoint&&(o.activePoint.MapMarker.setZIndexOffset(0),o.activePoint.MapMarker.setOpacity(1)),o.categoriesActive=!1,e.MapMarker.setZIndexOffset(1),e.MapMarker.setOpacity(0),(o.activePoint=e)&&(o.view.toggleCategory.showSub?setTimeout(p,200):setTimeout(m,200)),o.makePopUp()},o.makePopUp=function(){var e,t;o.isMobile?o.mobilePinOpened=!0:(e={top:o.isMobile||o.isTablet?80:110,left:o.isMobile||o.isTablet?0:500,bottom:(o.isMobile||o.isTablet,60),right:o.isMobile||o.isTablet?0:60},o.maxHeigth=angular.element(a).find(".seasonsMap__map").height()-120,t=g('<div mos-seasons-map-pin="" data-point="activePoint" data-colors="colors" data-mobile="isMobile" data-max-height="{{maxHeigth}}"></div>')(o)[0],o.activePoint.popup=L.popup({offset:DG.point(0,0),maxWidth:350,minWidth:350,autoPanPaddingTopLeft:DG.point(e.left,e.top),autoPanPaddingBottomRight:DG.point(e.left,e.bottom)}).setContent(t).setLatLng(o.activePoint.MapMarker.getLatLng()).openOn(s),o.popupIsClosed=!1,f(function(){o.activePoint.popup.update()},100))},o.closeMobilePopup=function(){o.mobilePinOpened=!1,o.activePoint.MapMarker.setZIndexOffset(0),o.activePoint.MapMarker.setOpacity(1)},o.setActiveCategory=function(e){o.activePoint&&o.activePoint.popup&&s.closePopup(),o.activeCategory&&(o.pointType===n?o.activeCategory.points.forEach(function(e){v.clearMarker(e.MapMarker)}):o.pointType===i&&v.clearClusterGroup(r,o.activeCategory)),e&&(o.activeCategory=e,setTimeout(m,200)),y.setPointsLength(r,o.activeCategory.count),o.pointType===n?o.activeCategory.points.forEach(function(e){v.init(r,{point:e,icon:o.activeCategory.icon,onClick:function(e){o.setActivePoint(e)}})}):o.pointType===i&&(o.activeCategory.onClick=function(e){o.setActivePoint(e)},v.initClusterGroup(r,o.activeCategory)),u()}}}}]),angular.module("mosapp.map.helpers.customcolors",[]).directive("customColors",[function(){return{restrict:"A",scope:!0,link:function(e,t,a){var i=a.hover,o=a.color,n=a.active,r=a.text,s=a.borders,l={};function c(){t.css("background-color",l.color_hover)}function d(){t.css("background-color",l.color)}function p(){r||s?r?n?t.css("color",l.color_hover):t.css("color",l.color):s&&(n?t.css("border-color",l.color_hover):t.css("border-color",l.color)):i&&!n?(t.css({"background-color":l.color}),t.on({mouseenter:c,mouseleave:d})):n?(t.off({mouseenter:c,mouseleave:d}),c()):void 0!==o&&(o?d:c)()}a.colors&&(l=JSON.parse(a.colors)),t.addClass("eventsMapCustomColor"),i="true"===i,o="true"===o,n="true"===n,r="true"===r,s="true"===s,p(),a.$observe("active",function(e){n="true"===e,p()}),a.$observe("color",function(e){o="true"===e,p()}),a.$observe("colors",function(e){e&&(l=JSON.parse(e),p())}),t.on("$destroy",function(){t.off("mouseenter","setHover"),t.off("mouseleave","setColor"),e.$destroy()})}}}]).directive("customColorsSmart",[function(){return{restrict:"A",scope:!0,link:function(e,a,i){var o=Object.create(null),n=[];function t(){i.colors&&(o=JSON.parse(i.colors),l())}function r(){var t;i.params&&(t=[],i.params.split("|").forEach(function(e){var a={key:(e=e.split(":"))[0],val:"true"===e[1],enter:!1,leave:!1,inactive:!1};e.slice(2).forEach(function(e,t){void 0!==a[e]?a[e]=!0:0==t&&"boolean"==typeof e&&(a.inactive=e)}),t.push(a)}),n=t,l())}var s={color:function(e,t){t?a.css("color",""):e?a.css("color",o.color_hover):a.css("color",o.color)},border:function(e,t){t?a.css("border-color",""):e?a.css("border-color",o.color_hover):a.css("border-color",o.color)},background:function(e,t){t?a.css("background-color",""):e?a.css("background-color",o.color_hover):a.css("background-color",o.color)},active:function(e,t){e?(a.on("mouseenter",null,t,this.setHover),a.on("mouseleave",null,t,this.setLeave)):this.destroy()},setHover:function(){n.forEach(function(e){var t;s[e.key]&&"active"!==e.key&&(t=e.leave?!e.val:e.val,s[e.key](t,e.leave))})},setLeave:function(){n.forEach(function(e){var t;s[e.key]&&"active"!==e.key&&(t=e.enter?!e.val:e.val,s[e.key](t,e.enter))})},destroy:function(){a.off("mouseenter",this.setHover),a.off("mouseleave",this.setLeave)}};function l(){0!==Object.keys(o).length&&0!==Object.keys(n).length&&(s.destroy(),n.forEach(function(e){s[e.key]&&!e.inactive&&s[e.key](e.val,e.enter)}))}t(),r(),i.$observe("params",function(e){e&&r()}),i.$observe("colors",function(e){e&&t()}),a.on("$destroy",function(){s.destroy(),e.$destroy()})}}}]),angular.module("mosapp.map.helpers.bg",[]).directive("eventsMapGroupBg",[function(){return{restrict:"A",link:function(e,t,a){function i(e){t.css({"background-image":'url("'+e.src+'")',"background-size":e.width+"px "+e.height+"px","padding-left":e.width+"px"})}a.background&&""!==a.background&&i(JSON.parse(a.background)),a.$observe("background",function(){a.background&&""!==a.background&&i(JSON.parse(a.background))}),t.on("$destroy",function(){e.$destroy()})}}}]).directive("eventsMapEventImage",[function(){return{restrict:"A",link:function(e,t,a){function i(e){t.css({"background-image":'url("'+e.src+'")',"background-size":e.width+"px "+e.height+"px","padding-left":e.width+"px"})}a.background&&""!==a.background&&i(JSON.parse(a.background)),a.$observe("background-image",function(){a.background&&""!==a.background&&i(JSON.parse(a.background))}),t.on("$destroy",function(){e.$destroy()})}}}]),angular.module("mosapp.map.helpers.mobile",[]).directive("eventsMapMobile",[function(){return{restrict:"A",link:function(e,t){(device.mobile()||device.tablet())&&t.addClass("eventsMap__portable"),t.on("$destroy",function(){e.$destroy()})}}}]),angular.module("mosapp.map.helpers",["mosapp.map.helpers.mobile","mosapp.map.helpers.bg","mosapp.map.helpers.customcolors"]),angular.module("mosapp.map.events",["mosapp.2gis.map","mosapp.filters.imageSrc","ngSanitize","mosapp.map.helpers"]).directive("mosEventsMap",["UrlSrvc","mosconfig","apiSrvc","$timeout","$interval","toolsSrvc","$state","mos2GisMapMarkersCtrl","mos2GisMapSrvc","loader","mos2GisMapMarkersLayer","$log",function(e,t,y,_,a,b,i,o,w,n,M,k){return{restrict:"A",scope:{localId:"@",zoom:"@?",scrollZoom:"@?",mapHeight:"@?",pointType:"@?",centerCoordsDesktop:"@?",centerCoordsMobile:"@?"},templateUrl:e.tmplPath("00_map/mosEventsMap/mosEventsMap.tpl.html"),link:function(r,a,i){var e,t,o,n,s,l,c="cluster",d="point";function p(e){var t,a=window.document,i=a.body,o=i.requestFullscreen||i.mozRequestFullScreen||i.webkitRequestFullScreen||i.msRequestFullscreen,n=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;navigator.userAgent.match(/iPhone|iPad|iPod/i)&&!(t=angular.element("head")).find('meta[name="apple-mobile-web-app-capable"]').length&&t.append('<meta name="apple-mobile-web-app-capable" content="yes">'),_(function(){!e||i||a.mozFullScreenElement||a.webkitFullscreenElement||a.msFullscreenElement||!o?n&&n.call(a):o.call(i)})}function m(){var t=[];y.getData("directories","placesGroups",{filter:'{"local_id":"'+r.localId+'"}',expand:"image,image_hover,icon,icon_hover,menu_color,menu_color_hover"},!1).then(function(e){e&&e.items&&0<e.items.length&&(r.rootGroup=e.items[0]),r.rootGroup.menu_color&&(r.colors.color=r.rootGroup.menu_color),r.rootGroup.menu_color_hover&&(r.colors.color_hover=r.rootGroup.menu_color_hover),function e(){var t=angular.element(a).find(".dg-control-round");0===t.length&&setTimeout(function(){e()},300),t.css("background-color",r.colors.color),angular.element(a).on({mouseenter:function(){$(this).css("background-color",r.colors.color_hover)},mouseleave:function(){$(this).css("background-color",r.colors.color)}},".dg-control-round")}(r.colors),y.getData("directories","placesGroups",{expand:"points,image,image_hover,icon,icon_hover,menu_color,menu_color_hover",filter:'{"parent_id":"'+r.rootGroup.id+'"}'},!0,angular.element.find(this.loaderGroupsEl)).then(function(e){e&&e.items&&0<e.items.length&&(e.items.forEach(function(e){if(!e.points)return!1;e.icon||(e.icon=r.rootGroup.icon),e.icon_hover||(e.icon_hover=r.rootGroup.icon_hover),e.image||(e.image=e.icon),e.image_hover||(e.image_hover=e.icon_hover),e.activeImage=e.image,e.cluster={size:40},t.push(e)}),r.groups=t,e=1<r.groups.length,r.groupsVisible=e,r.setActiveGroup(t[0],!!i.zoom))})}),y.getData("newsfeed","directories").then(function(e){e&&e.items&&0<e.items.length&&e.items.forEach(function(e){var t;t=e.id,e=e.title,r.districts[t]=e})})}function u(e,t){e&&(r.activePointVisible=!0,r.activePointLoading=!1),t&&(r.activePointVisible=!1),r.activePoint.id!==e.id&&(r.activePoint&&r.activePoint.MapMarker&&r.activeGroup.icon&&(r.activePoint.MapMarker.setZIndexOffset(1),r.activePoint.MapMarker.setIcon(DG.icon({iconUrl:r.activeGroup.icon.src,iconSize:[r.activeGroup.icon.width,r.activeGroup.icon.height]}))),r.activePoint=e,r.activePoint&&r.activePoint.MapMarker&&r.activeGroup.icon_hover&&(r.activePoint.MapMarker.setZIndexOffset(1e3),r.activePoint.MapMarker.setIcon(DG.icon({iconUrl:r.activeGroup.icon_hover.src,iconSize:[r.activeGroup.icon_hover.width,r.activeGroup.icon_hover.height]}))),g([]),r.eventsPage=0,r.isThereMoreEvents=!0)}function g(e){r.events=e,e=0<e.length,r.eventsVisible=e}function f(e){r.activeEvent.id!==e.id&&(r.activeEvent=e,h(!!e))}function h(e,t){r.activeEventVisible=!!e,v(t)}function v(e){a=t=i=0,r.isMobile&&r.mapOpened?a=40:r.isTablet&&r.mapOpened&&(a=80),r.isMobile||r.isTablet&&r.isPortrait?r.mapOpened?r.groups&&1<r.groups.length&&(t=80):t=60:(r.groups&&1<r.groups.length&&r.mapOpened&&(i=300),(r.activeEventVisible||r.activePointVisible)&&r.mapOpened&&(i+=300));var t,a,i={paddingLeft:i,paddingBottom:t,paddingTop:a};s.css({"margin-left":i.paddingLeft+"px","margin-bottom":i.paddingBottom+"px","margin-top":i.paddingTop+"px",width:"calc(100% - "+i.paddingLeft+"px)",height:"calc(100% - "+(i.paddingBottom+i.paddingTop)+"px)"}),n.invalidateSize(!1),(r.isMobile||r.isTablet)&&r.mapOpened&&window.innerHeight>s.height+i.paddingTop+i.paddingBottom?setTimeout(v,500):r.activePoint||r.activePointLoading||r.eventsLoading?r.activePoint&&w.senterPoint(o,r.activePoint):e||w.fitMap(o)}r.pointType?r.pointType!==c&&r.pointType!==d&&(k.warn('Допустимые типы точек "point" или "cluster", текущее значение - "'+r.pointType+'"'),r.pointType=d):r.pointType="point",r.localId?(r.scrollZoom||(r.scrollZoom=!0),a.find(".eventsMapCustomScrollbar").mCustomScrollbar({live:!0,theme:"eventsMap",callbacks:{whileScrolling:function(e){this.mcs.topPct<100?$(this).children(".mCS-eventsMap").removeClass("no-shadow"):$(this).children(".mCS-eventsMap").addClass("no-shadow")}}}),r.colors={color:"#555555",color_hover:"#c92723"},r.zoomLevel=parseInt(r.zoom),r.zoomLevel=isNaN(r.zoomLevel)||r.zoomLevel<0||18<r.zoomLevel?12:r.zoomLevel,r.mapOpened=!0,r.isMobile=device.mobile(),r.isTablet=device.tablet(),r.isIpad=device.ipad(),r.isPortrait=window.innerWidth<window.innerHeight,(r.isMobile||r.isTablet)&&(r.mapOpened=!1),e=(e=!r.isMobile&&!r.isTablet)&&angular.isDefined(r.centerCoordsDesktop)&&angular.isString(r.centerCoordsDesktop)?r.centerCoordsDesktop:!e&&angular.isDefined(r.centerCoordsMobile)&&angular.isString(r.centerCoordsMobile)?r.centerCoordsMobile:null,r.centerCoords=function(e){if(e){e=e.split(",");if(angular.isArray(e)&&1<e.length)return{y:+e[0],x:+e[1]}}return null}(e),t=r.mapElInitialHeight=0,r.openMap=function(){t=_WINDOW.scrollTop(),window.scrollTo(0,1),p(!0),void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!1),r.mapOpened=!0,angular.element("body").addClass("full-screen-app"),setTimeout(v,500),function e(){r.mapElHeight!==s.height()&&(r.mapElHeight=s.height(),setTimeout(function(){e()},500))}()},r.closeMap=function(){p(r.mapOpened=!1),void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!0),angular.element("body").removeClass("full-screen-app"),_WINDOW.scrollTop(t),setTimeout(v,500),r.activePointVisible=!1,r.eventsLoading=!1,r.eventsVisible=!1,r.eventsPage=0,r.isThereMoreEvents=!0,r.activeEventVisible=!1},r.dropDownOpened=!1,r.toggleDropDown=function(){r.dropDownOpened=!r.dropDownOpened},r.rootGroup=!1,r.setActiveGroup=function(e,t){var a;r.eventsLoading||r.activeGroup.id===e.id||(r.dropDownOpened=!1,r.activeEvent=!1,r.activeEventVisible=!1,r.activePoint=!1,r.activePointVisible=!1,e=e,t=t,r.activeGroup!==e&&e.points&&0!==e.points.length&&(r.activeGroup&&(a=r.activeGroup,r.activeGroup.activeImage=r.activeGroup.image,r.activeGroup.active=!1,r.pointType===d?a.points.forEach(function(e){M.clearMarker(e.MapMarker)}):r.pointType===c&&M.clearClusterGroup(o,a)),r.activeGroup=e,r.activeGroup.activeImage=e.image_hover,r.activeGroup.active=!0,e&&e.points&&w.setPointsLength(o,e.points.length),a=r.activeGroup,r.pointType===d?a.points.forEach(function(e){M.init(o,{point:e,icon:a.icon,onClick:function(e){r.setActivePoint(e)}})}):r.pointType===c&&(a.onClick=function(e){r.setActivePoint(e)},M.initClusterGroup(o,a)),t||w.fitMap(o),r.activePoint=!1,h(!1,t),g([])),v(o))},r.setActiveEvent=function(e){e.isPast||r.eventLoading||(h(!1),e=e.id,r.eventLoading=!0,h(!1),v(),y.getData("newsfeed","afishaV4Event",{id:e},!1).then(function(e){var t;e&&(e.dates=b.dateRange(1e3*e.date_from_timestamp,1e3*e.date_to_timestamp),e.dates+="<span> "+b.formatHoursMinutes(e.date_from_timestamp)+" &mdash; "+b.formatHoursMinutes(e.date_to_timestamp)+"</span>",(t=$("<div></div>").append(e.text)).find("img").remove(),e.text=t.html(),f(e),r.eventLoading=!1)}))},r.setActivePoint=function(e){var t;r.eventsLoading||r.activePoint.id===e.id||(r.activePointLoading=!0,t=e,u(!1),y.getData("directories","placesPoints",{id:t.id,expand:"images,description,event_ids,link"},!1).then(function(e){e&&e.event_ids&&e.group_id==r.activeGroup.id&&(e.MapMarker=t.MapMarker,u(e),w.senterPoint(o,r.activePoint),0<e.event_ids.length&&function i(){var e=r.activePoint&&Array.isArray(r.activePoint.event_ids)?r.activePoint.event_ids:[];e=e.filter(function(e){e=e.toString();return"257"===e.substr(-3)});if(!e.length)return void(l=[]);r.eventsLoading=!0;v();e={filter:{id:e.join(",")}};if(r.isThereMoreEvents)e.page=++r.eventsPage,y.getData("newsfeed","afishaBricks",e,!1).then(function(e){if(e&&e.items&&e.items.length){for(var t=(new Date).getTime(),a=0;a<e.items.length;a++)e.items[a].dates=b.dateRange(1e3*e.items[a].date_from_timestamp,1e3*e.items[a].date_to_timestamp),e.items[a].isPast=1e3*e.items[a].date_to_timestamp<t;l.push(e.items),r.isThereMoreEvents=r.eventsPage<e._meta.pageCount,i()}else l=[],r.eventsLoading=!1});else{for(var t=[],a=(new Date).getTime(),o=0;o<l.length;o++)t=t.concat(l[o]);var n=[];t.forEach(function(e){1e3*e.date_to_timestamp>=a&&n.push(e)}),g(n),v(),r.eventsLoading=!1,l=[]}}())}))},r.closeActivePoint=function(){u(!1,!0),h(!1),r.eventsLoading=!1,r.eventLoading=!1,v(o)},o=!(r.closeEvent=function(){h(!1),f(!1),r.eventsLoading=!1,r.eventLoading=!1,v(o)}),s=n=!1,function e(){var t=$(a).find("[data-mos2-gis-map]");o=t.attr("data-map-id"),angular.isDefined(r.mapHeight)&&(r.mapHeight.match(/[0-9]+px/g)||r.mapHeight.match(/[0-9]+vh/g))&&angular.element(a).find(".eventsMap").css({height:r.mapHeight}),o&&(n=w.getMap(o),s=w.getMapEl(o)),o&&n&&s?(r.mapElHeight=s.height(),_WINDOW.on("resize",function(){r.isPortrait=window.innerWidth<window.innerHeight,r.isPortrait&&angular.element(a).find(".eventsMap__groups").mCustomScrollbar("destroy"),v()}),m()):setTimeout(e,300)}(),r.events=[],r.eventsEl=!1,r.eventEl=!1,r.pointEl=!1,r.activeGroup=!1,r.groups=[],r.groupsVisible=!1,r.activePoint=!1,r.activePointLoading=!1,r.activePointVisible=!1,r.events=[],r.eventsLoading=!1,r.eventsVisible=!1,r.eventsPage=0,r.isThereMoreEvents=!0,r.activeEvent=!1,r.activeEventVisible=!1,r.eventLoading=!1,r.districts=new Object(null),l=[]):console.warn("Add local-id attribute!")}}}]),angular.module("mosapp.map.events.datasets.api.directories",[]).service("apiDirectories",["apiSrvc","$q",function(u,a){var t=new Array;function i(){for(var e=0;e<i.arguments.length;e++)t[e]=new Image,t[e].src=i.arguments[e]}function n(e,t,a){e.menu_color?t.color=e.menu_color:a&&a.color&&(t.color=a.menu_color),e.menu_color_hover?t.colorActive=e.menu_color_hover:a&&a.color&&(t.color=a.menu_color_hover),e.icon?(t.pin=e.icon,i(t.pin.src)):a&&a.icon&&(t.color=a.icon),e.icon_hover?(t.pinActive=e.icon_hover,i(t.pinActive.src)):a&&a.icon_hover&&(t.color=a.icon_hover),e.image?(t.icon=e.image,i(t.icon.src)):a&&a.image&&(t.color=a.image),e.image_hover?(t.iconActive=e.image_hover,i(t.iconActive.src)):a&&a.image_hover&&(t.color=a.image_hover)}return{rootId:!1,pin:!1,pinActive:!1,icon:!1,iconActive:!1,color:!1,colorActive:!1,categories:[],getRootElement:function(e,t){var a=this;return u.getData("directories","placesGroups",{filter:'{"local_id":"'+e+'"}',expand:"image,image_hover,icon,icon_hover,menu_color,menu_color_hover"},!1).then(function(e){e&&e.items&&0<e.items.length&&(n(e=e.items[0],a),a.rootId=e.id,t&&"function"==typeof t&&t())})},getCategories:function(t,a){var i=[],o=this;return u.getData("directories","placesGroups",{expand:"points,image,image_hover,icon,icon_hover,menu_color,menu_color_hover",filter:'{"parent_id":"'+this.rootId+'"}'},!0).then(function(e){e&&e.items&&0<e.items.length&&(e.items.forEach(function(e){n(e,e,o),e.points.forEach(function(e){e.icon=t.icon,e.icon_hover=t.icon_hover,e.color=t.color,e.color_hover=t.color_hover,e.type="dir"}),e.count=e.points?e.points.length:0,e.cluster={size:55},e.showLabel=!1,i.push(e)}),o.categories=i,a&&"function"==typeof a&&a())})},getPoint:function(t,e){return t.loaded?a.when(t):u.getData("directories","placesPoints",{id:t.id,expand:"description,event_ids"},!1,e).then(function(e){if(e&&e.group_id)return e.MapMarker=t.MapMarker,(t=e).loaded=!0,t})},getEvents:function(e,r,s){if(r.eventsLoaded)return a.when(r);var l=[],c=r,d=1,p=!0,m=e.filter(function(e){return"257"===e.toString().substr(-3)});!function t(){if(c===r&&m.length){var e={filter:{id:m.join(",")}};if(p)e.page=++d,u.getData("newsfeed","afishaBricks",e,!1).then(function(e){e&&e.items&&e.items.length?(l.push(e.items),p=d<e._meta.pageCount,t()):l=[]});else{for(var a=[],i=(new Date).getTime(),o=0;o<l.length;o++)a=a.concat(l[o]);var n=[];a.forEach(function(e){1e3*e.date_to_timestamp>=i&&n.push(e)}),r.eventsLoaded=!0,r.events=n,s(r)}}else l=[]}()}}}]),angular.module("mosapp.map.events.datasets.api.ehd",[]).service("apiEhd",["apiSrvc","$q",function(o,n){return{categories:[],parseCategories:function(e){var e=e.split("|"),t=this;return e.forEach(function(e){e=e.split(":");t.categories.push({id:e[1],title:e[0],active:!1,points:[],count:!1})}),this.categories},fetchCollection:function(i,e){var t=[],a=this;return this.categories.forEach(function(a,e){t.push(o.postData("ehd","getData",{id:a.id,fetchGeodata:!0},!0,!1,{"Content-Type":"application/json"},!0).then(function(e){var t,o,n;e&&e.response&&0<e.response.length?(a.points=(t=e.response,o=i,n=[],t.forEach(function(e){var t="",a=(e.hasOwnProperty("PhotoWinter")&&Array.isArray(e.PhotoWinter)&&0<e.PhotoWinter.length&&e.PhotoWinter[0].Photo?t=e.PhotoWinter[0].Photo:e.hasOwnProperty("Photo")?t=e.Photo:e.hasOwnProperty("PhotoSummer")&&Array.isArray(e.PhotoSummer)&&0<e.PhotoSummer.length&&e.PhotoSummer[0].Photo&&(t=e.PhotoSummer[0].Photo),!1),i=(e.hasOwnProperty("WorkingHoursSummer")&&Array.isArray(e.WorkingHoursSummer)&&0<e.WorkingHoursSummer.length?a=e.WorkingHoursSummer:e.hasOwnProperty("WorkingHoursWinter")&&Array.isArray(e.WorkingHoursWinter)&&0<e.WorkingHoursWinter.length&&(a=e.WorkingHoursWinter),"");e.hasOwnProperty("ObjectName")?i=e.ObjectName:e.hasOwnProperty("Location")&&(i=e.Location),e.hasOwnProperty("geoData")&&n.push({title:i,address:e.Address,WebSite:e.WebSite,tel:e.HelpPhone,features:[{key:"HasEquipmentRental",val:"да"===e.HasEquipmentRental,title:"Прокат оборудования"},{key:"Lighting",val:"да"===e.Lighting,title:"Освещение"},{key:"HasTechService",val:"да"===e.HasTechService,title:"Техническое обслуживание"},{key:"HasDressingRoom",val:"да"===e.HasDressingRoom,title:"Раздевалки"},{key:"HasEatery",val:"да"===e.HasEatery,title:"Точки питания"},{key:"HasToilet",val:"да"===e.HasToilet,title:"Туалет"},{key:"HasWifi",val:"да"===e.HasWifi,title:"Wi-Fi"},{key:"HasCashMachine",val:"да"===e.HasCashMachine,title:"Банкомат"},{key:"HasFirstAidPost",val:"да"===e.HasFirstAidPost,title:"Медпункт"},{key:"HasMusic",val:"да"===e.HasMusic,title:"Звуковое сопровождение"},{key:"DisabilityFriendly",val:"да"===e.DisabilityFriendly,title:"Приспособленность для инвалидов"}],WorkingHoursWinter:a,focus:!1,id:e.global_id,lat:!!(e.geoData&&e.geoData.coordinates&&e.geoData.coordinates[0])&&e.geoData.coordinates[0],lon:!!(e.geoData&&e.geoData.coordinates&&e.geoData.coordinates[1])&&e.geoData.coordinates[1],image:t||e.Photo,icon:o.icon,icon_hover:o.icon_hover,color:o.color,color_hover:o.color_hover,type:"ehd",WebSiteLink:(i=e.WebSite,/^(http(s?):\/\/)/.test(i)||/^\//.test(i)?i:"http://"+i)})}),n),a.count=e.response.length,a.icon=i.icon,a.icon_hover=i.icon_hover,a.color=i.color,a.color_hover=i.color_hover,a.showLabel=!1,a.cluster={size:55}):a=!1}))}),n.all(t).then(function(){a.categories=a.categories.filter(function(e){return!!e}),e&&"function"==typeof e&&e()})}}}]),angular.module("mosapp.map.events.datasets.categories",["mosapp.2gis.map","mosapp.filters.imageSrc","ngSanitize","mosapp.map.helpers"]).directive("mosEventsDatasetsMapCategories",["UrlSrvc",function(e){return{restrict:"A",scope:{colors:"=",categories:"=",activeCategory:"=",set:"&",isMobile:"=",isTablet:"=",isActive:"="},templateUrl:e.tmplPath("00_map/mosEventsDatasetsMap/mosEventsDatasetsMap_categories.tpl.html"),link:function(t,e,a){t.setActive=function(e){t.set()(e)}}}}]),angular.module("mosapp.map.events.datasets.pin",["mosapp.map.helpers","mosapp.map.events.datasets.api.directories","mosapp.map.events.datasets.api.ehd","mosapp.map.events.datasets.categories"]).directive("mosEventsDatasetsMapPin",["UrlSrvc","apiDirectories","apiEhd","$timeout","loader",function(o,n,e,r,t){return{restrict:"A",scope:{point:"=",colors:"=",mobile:"=",close:"&?",maxHeight:"@?"},templateUrl:o.tmplPath("00_map/mosEventsDatasetsMap/mosEventsDatasetsMap_pin.tpl.html"),link:function(t,e,a){function i(e){Array.isArray(e.events)&&e.events.forEach(function(e){e.occurrence_id?e.link=t.calendarPage+"/"+e.id+"/"+e.occurrence_id:e.link=t.calendarPage+"/"+e.id}),e.popup&&r(function(){e.popup.update()},100)}t.maxHeight&&e.find(".wrapper").css({"max-height":t.maxHeight+"px"}),t.calendarPage=o.pagePath("afisha","event"),"dir"===t.point.type&&(t.eventsLoaded=!1,n.getPoint(t.point,e).then(function(e){angular.extend(t.point,e),t.point.popup&&r(function(){t.point.popup.update()},100),t.point.event_ids&&0<t.point.event_ids.length&&n.getEvents(t.point.event_ids,t.point,i)})),"ehd"===t.point.type&&(e=new Date,t.day=e.getDay(),t.open=!1,t.openText="",t.scheduleOpened=!1,t.toggleSchedule=function(){t.scheduleOpened=!t.scheduleOpened},t.point.WorkingHoursWinter&&Array.isArray(t.point.WorkingHoursWinter)&&(t.open=t.point.WorkingHoursWinter.some(function(e,t){var a=new Date;if(t!==a.getDay())return!1;var i,o,t=/(\d{2}):(\d{2})-(\d{2}):(\d{2})/;return"круглосуточно"===e||"закрыто"!==e&&(!!t.test(e.Hours)&&(t=(e=e.Hours.match(t))[1],i=e[2],o=e[3],e=e[4],t=(new Date).setHours(t,i),a<(new Date).setHours(o,e)&&t<a))}),t.openText=t.open?"Открыто":"Закрыто"),t.point.popup&&r(function(){t.point.popup.update()},100)),t.closeMap=function(){t.close()()}}}}]),angular.module("mosapp.map.events.datasets",["mosapp.2gis.map","mosapp.filters.imageSrc","ngSanitize","mosapp.map.helpers","mosapp.map.events.datasets.api.directories","mosapp.map.events.datasets.api.ehd","mosapp.map.events.datasets.categories","mosapp.map.events.datasets.pin"]).directive("mosEventsDatasetsMap",["UrlSrvc","apiDirectories","apiEhd","mos2GisMapMarkersCtrl","mos2GisMapSrvc","mos2GisMapMarkersLayer","$q","$timeout","$compile","loader",function(e,m,u,t,g,f,h,v,y,_){return{restrict:"A",scope:{localId:"@",zoom:"@?",scrollZoom:"@?",mapHeight:"@?",pointType:"@?",ehdApi:"@?",title:"@?",tabsTitle:"@?",backgroundColor:"@?",centerCoordsDesktop:"@?",centerCoordsMobile:"@?"},templateUrl:e.tmplPath("00_map/mosEventsDatasetsMap/mosEventsDatasetsMap.tpl.html"),link:function(o,n,e){o.backgroundColor&&n.css("background-color",o.backgroundColor);var t="cluster",a="point";o.hide=!1,o.maps={dir:{opened:!1,categories:[],initialized:!1,api:m},ehd:{opened:!1,categories:[],initialized:!1,api:u}},o.activeCategory=!1,o.tabs=[],o.activeTab=!1,o.activeMap=!1,o.activePoint=!1,o.tabsTitle?o.tabsTitle.split("|").forEach(function(e){e=e.split(":"),o.tabs.push({title:e[0],map:e[1]})}):o.ehdApi?o.tabs=[{title:"",map:"ehd"}]:o.tabs=[{title:"",map:"dir"}],o.colors={color:!1,color_hover:!1},o.icons={icon:!1,icon_hover:!1},o.mapOpened=!0,o.isMobile=device.mobile(),o.isTablet=device.tablet(),o.isIpad=device.ipad(),o.isPortrait=window.innerWidth<window.innerHeight,o.categoriesActive=!1,o.toggleCategories=function(){o.categoriesActive=!o.categoriesActive},(o.isMobile||o.isTablet)&&(o.mapOpened=!1),$(".pinCustomScrollbar").mCustomScrollbar({live:!0,scrollInertia:0,advanced:{autoExpandHorizontalScroll:!1,updateOnContentResize:!0}});var i,r=!1,s=!1,l=!1,c=!o.isMobile&&!o.isTablet,c=c&&angular.isDefined(o.centerCoordsDesktop)&&angular.isString(o.centerCoordsDesktop)?o.centerCoordsDesktop:!c&&angular.isDefined(o.centerCoordsMobile)&&angular.isString(o.centerCoordsMobile)?o.centerCoordsMobile:null;function d(){var e,t,a,i;m.rootId?(o.colors={color:m.color,color_hover:m.colorActive},o.icons={icon:m.pin,icon_hover:m.pinActive},e={icon:o.icons.icon,icon_hover:o.icons.icon_hover,color:o.colors.color,color_hover:o.colors.color_hover},t=".eventsDatasetsMap .marker-cluster div { background-color: "+o.colors.color+"!important; } .eventsDatasetsMap .marker-cluster:hover div { background-color: "+o.colors.color_hover+"!important; } .eventsDatasetsMap .eventsDatasetsMap__map .dg-control-round__icon { background-color: "+o.colors.color+"!important; } .eventsDatasetsMap .eventsDatasetsMap__map .dg-control-round__icon:before,.eventsDatasetsMap .eventsDatasetsMap__map .dg-control-round__icon:after { background-color: "+o.colors.color_hover+"!important; }.eventsDatasetsMap .eventsDatasetsMap__map .dg-control-round__icon:hover { background-color: "+o.colors.color_hover+"!important; } .eventsDatasetsMap .eventsDatasetsMap__map .dg-control-round__icon:hover:before,.eventsDatasetsMap .eventsDatasetsMap__map .dg-control-round__icon:hover:after { background-color: "+o.colors.color+"!important; } .mosEventsDatasetsMap_categories__list li:hover span > span { color: "+o.colors.color+"; }.mosEventsDatasetsMap_categories__list li:hover { background-color: "+o.colors.color_hover+"; }.mosEventsDatasetsMap_categories__list li.active { background-color: "+o.colors.color+"; }",a=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),a.appendChild(i),t=[],_.switchOn(angular.element(n).find(".eventsDatasetsMap__top-bar__tabs")),t.push(m.getCategories(e,function(){o.maps.dir.categories=m.categories})),u.parseCategories(o.ehdApi),t.push(u.fetchCollection(e,function(){o.maps.ehd.categories=u.categories})),h.all(t).then(function(){_.switchOff(angular.element(n).find(".eventsDatasetsMap__top-bar__tabs")),o.tabs[0]&&!o.activeTab&&(o.selectTab(o.tabs[0]),o.setActiveCategory(o.activeMap.api.categories[0]))}),s.on("popupclose",function(){o.activePoint.MapMarker.setOpacity(1)})):o.hide=!0}function p(){t=e=0,a=50,o.isMobile&&o.mapOpened?(a=50,e=0):o.isTablet&&o.mapOpened&&(a=90),o.isMobile&&o.mapOpened&&(t=50);var e,t,a,i={paddingLeft:e=o.isMobile||o.isTablet?e:350,paddingBottom:t,paddingTop:a};v(function(){s.invalidateSize(!1),g.fitMap(r,{paddingTopLeft:DG.point(i.paddingLeft,i.paddingTop),paddingBottomRight:DG.point(0,i.paddingBottom)})},100),(o.isMobile||o.isTablet)&&o.mapOpened&&window.innerHeight>l.height()+i.paddingTop+i.paddingBottom&&v(p,500)}o.centerCoords=function(e){if(e){e=e.split(",");if(angular.isArray(e)&&1<e.length)return{y:+e[0],x:+e[1]}}return null}(c),function e(){var t=$(n).find("[data-mos2-gis-map]");r=t.attr("data-map-id"),!angular.isDefined(o.mapHeight)||o.isMobile||o.isTablet||(o.mapHeight.match(/[0-9]+px/g)||o.mapHeight.match(/[0-9]+vh/g))&&angular.element(n).find(".eventsDatasetsMap__wrapper").css({height:o.mapHeight}),r&&(s=g.getMap(r),l=g.getMapEl(r),angular.element(n).find(".eventsDatasetsMap__wrapper")),r&&s&&l?(o.mapElHeight=l.height(),_WINDOW.on("resize",function(){o.isPortrait=window.innerWidth<window.innerHeight,o.isPortrait&&angular.element(n).find(".eventsMap__groups").mCustomScrollbar("destroy")}),m.getRootElement(o.localId,d)):setTimeout(e,300)}(),o.openMap=function(){i=_WINDOW.scrollTop(),window.scrollTo(0,1),void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!1),o.mapOpened=!0,angular.element("body").addClass("full-screen-app"),p()},o.closeMap=function(){o.mapOpened=!1,void 0!==window.$mos_layouts&&window.$mos_layouts.api.header.set("displayHeader",!0),angular.element("body").removeClass("full-screen-app"),_WINDOW.scrollTop(i),p()},o.selectTab=function(e){o.maps[e.map].api.categories[0]&&o.maps[e.map].api.categories[0].points&&(o.activeTab=e,o.activeMap=o.maps[e.map],o.setActiveCategory(o.activeMap.api.categories[0]),o.activePoint&&o.activePoint.popup&&s.closePopup(),p())},o.setActivePoint=function(e){o.activePoint&&(o.activePoint.MapMarker.setZIndexOffset(0),o.activePoint.MapMarker.setOpacity(1)),o.categoriesActive=!1,e.MapMarker.setZIndexOffset(1),e.MapMarker.setOpacity(0),o.activePoint=e,o.makePopUp()},o.makePopUp=function(){var e,t;o.isMobile?o.mobilePinOpened=!0:(e={top:o.isMobile||o.isTablet?80:60,left:o.isMobile||o.isTablet?0:400,bottom:(o.isMobile||o.isTablet,60),right:o.isMobile||o.isTablet?0:60},o.maxHeigth=angular.element(n).find(".eventsDatasetsMap__map").height()-120,t=y('<div mos-events-datasets-map-pin="" data-point="activePoint" data-colors="colors" data-mobile="isMobile" data-max-height="{{maxHeigth}}"></div>')(o)[0],o.activePoint.popup=L.popup({offset:DG.point(0,-+o.activePoint.icon.options.iconSize[1]/2),maxWidth:300,minWidth:300,autoPanPaddingTopLeft:DG.point(e.left,e.top),autoPanPaddingBottomRight:DG.point(e.left,e.bottom)}).setContent(t).setLatLng(o.activePoint.MapMarker.getLatLng()).openOn(s),v(function(){o.activePoint.popup.update()},100))},o.closeMobilePopup=function(){o.mobilePinOpened=!1,o.activePoint.MapMarker.setZIndexOffset(0),o.activePoint.MapMarker.setOpacity(1)},o.setActiveCategory=function(e){o.activePoint&&o.activePoint.popup&&s.closePopup(),o.activeCategory&&(o.pointType===a?o.activeCategory.points.forEach(function(e){f.clearMarker(e.MapMarker)}):o.pointType===t&&f.clearClusterGroup(r,o.activeCategory)),e&&(o.activeCategory=e),g.setPointsLength(r,o.activeCategory.count),o.pointType===a?o.activeCategory.points.forEach(function(e){f.init(r,{point:e,icon:o.activeCategory.icon,onClick:function(e){o.setActivePoint(e)}})}):o.pointType===t&&(o.activeCategory.onClick=function(e){o.setActivePoint(e)},f.initClusterGroup(r,o.activeCategory)),p()}}}}]),angular.module("mosapp.egipmap.map",[]).directive("mosEgipMap",["UrlSrvc","mosconfig","$q","apiSrvc","$timeout","$interval","$filter","LangSrvc",function(e,s,l,t,c,a,i,d){return{restrict:"A",scope:{center:"=?",zoom:"=?",onClick:"&",controls:"@?",onMapReady:"&"},transclude:!0,controller:["$scope",function(e){e.mapDeffered=l.defer(),this.getMap=function(){return e.mapDeffered.promise},this.getMapId=function(){return e.mapId}}],link:function(a,i,t,e){var o=a.mapDeffered,n=l.defer();function r(){var t=a.mapId;o.promise.then(function(e){c(function(){e.MapSetSize({width:$(i).width(),height:$(i).height(),idmap:t})},100)})}a.center=a.center||{y:55.75583,x:37.61778},a.zoom=a.zoom||0,a.controls=(a.controls||"").split(" "),a.map=null,a.mapId="map"+(new Date).getTime(),a.mapElement=$("<div/>").attr("id",a.mapId),a.mapElement.width("auto"),a.mapElement.height(i.height()),$(i).append(a.mapElement),c(function(){a.loader=$('<div class="loader"><div class="loader-image"><div class="cssload-progress cssload-float cssload-shadow"><div class="cssload-progress-item"></div></div></div></div>').appendTo(a.mapElement)},10),angular.element(window).resize(r),a.zoomIn=function(){gcapi.SetZoomLevelPlus()},a.zoomOut=function(){gcapi.SetZoomLevelMinus()},a.hasControl=function(e){return-1!==a.controls.indexOf(e)},a.$on("$destroy",function(){angular.element(window).off("resize",r)}),function(){if(window.gcapi)return l.when();var e=document.createElement("script");return e.id="egipApi",e.async="true",document.getElementsByTagName("head")[0].appendChild(e),e.src=s.egipApi.url+"&key="+s.egipApi.key,$(e).on("load",function(){window.gcapi===undefined?n.reject("API not found"):n.resolve()}),n.promise}().then(function(){function e(){gcapi.Slider=!1,gcapi.Zoom=a.zoom,gcapi.Center.x=a.center.x,gcapi.Center.y=a.center.y,gcapi.MapContainer=a.mapId,gcapi.OnMapLoad="onMapApiLoad",window.onMapApiLoad=function(){a.loader.remove(),a.mapLoadedAndReady=!0,t.onMapReady&&a.onMapReady(),setTimeout(function(){o.resolve(a.map)},500);var e=d.getCurrentLang();"ru"!==e&&gcapi.Lang({lang:e})},a.map=window.gcapi}return window.gcapi.GotFirstMap?(e(),window.gcapi.MapReinit(a.mapId)):window.gcapi.ready=e,o.promise}).then(function(e){return t.onClick&&(e.uFuncs.mapClick=function(e){a.onClick({event:e})}),e}).then(r).then(function(){gcapi.MoveAndZoom({idmap:a.mapId,x:a.center.x,y:a.center.y,zoom:a.zoom})})},templateUrl:e.tmplPath("egipMap/egipMap.tpl.html")}}]),angular.module("mosapp.egipmap.map.markers.layer",["mosapp.egipmap.map"]).directive("mosEgipMapMarkersLayer",["UrlSrvc","mosconfig","$q","apiSrvc","$timeout",function(e,t,a,i,o){return{restrict:"A",scope:{latLng:"=?",label:"=?",labelStyle:"=?",labelPosition:"=?",focus:"=?",name:"=?",doubleClicked:"=?",iconUrl:"=?",width:"@?",height:"@?",iconOffsetX:"@?",iconOffsetY:"@?",onClick:"&?"},require:"^mosEgipMap",link:function(o,e,n,t){function a(e){var t=+o.width||24,a=+o.height||24,i={x:(o.latLng=e).x,y:e.y,symbolurl:o.iconUrl,symbolwidth:t,symbolheight:a,pic_x_offset:o.iconOffsetX!==undefined?+o.iconOffsetX:t/2,pic_y_offset:o.iconOffsetY!==undefined?+o.iconOffsetY:a/2,txt:"",text_x_offset:0,text_y_offset:0};o.label&&(i.txt=o.label,o.labelPosition&&(i.text_x_offset=+o.labelPosition.x,i.text_y_offset=+o.labelPosition.y),o.labelStyle&&["fontsize","fontcolor","fontname","fontbold"].forEach(function(e){o.labelStyle[e]&&(i[e]=o.labelStyle[e])})),o.markerId=i.idlayer=i.idpoint=[o.mapId,i.x,i.y].join("_"),i.idmap=o.mapId,o.map.AddPoint(i),o.map.AddLayerHoverFunction({idmap:o.mapId,idlayer:o.markerId,over_fnc:function(){o.map.InfoWindowShow({position:"lowerleft",InfoWindowClass:"toolTip",width:160,height:70,crds:{x:e.x,y:e.y},title:o.name,content:""})},out_fnc:function(e){o.map.InfoWindowHide({idmap:o.mapId})}}),n.onClick&&angular.isFunction(o.onClick)&&o.map.AddLayerClickFunction({idmap:o.mapId,idlayer:o.markerId,click_fnc:function(){o.map.InfoWindowHide({idmap:o.mapId}),o.onClick()}}),r()}function r(){o.focus&&o.latLng&&o.map.MoveAndZoom({x:o.latLng.x,y:o.latLng.y,zoom:o.map.GetZoomLevel()})}function i(){o.focus&&o.doubleClicked&&(o.map.MoveAndZoom({x:o.latLng.x,y:o.latLng.y,zoom:7}),o.doubleClicked=!1)}function s(){o.markerId&&o.map.RemoveLayer({idmap:o.mapId,idlayer:o.markerId}),o.map.InfoWindowHide({idmap:o.mapId})}t.getMap().then(function(e){o.map=e,o.mapId=t.getMapId(),o.$watch("focus",r),o.$watch("doubleClicked",i),a(o.latLng),o.$watch("iconUrl",function(e,t){e!==t&&(o.iconUrl=e,o.map.RemoveLayer({idmap:o.mapId,idlayer:o.markerId}),a(o.latLng))}),o.$on("$destroy",s)})}}}]),angular.module("mosapp.egipmap.map.bubble",["mosapp.egipmap.map"]).directive("mosEgipMapBubble",["UrlSrvc","mosconfig","$q","apiSrvc","$timeout",function(e,t,a,i,o){return{restrict:"A",scope:{title:"=",content:"=",point:"=",address:"=",width:"@",height:"@",position:"@"},require:"^mosEgipMap",link:function(t,e,a,i){i.getMap().then(function(e){console.log(t),e.InfoWindowShow({crds:t.point,title:t.title||"",content:t.content||"",position:t.position||"auto",width:+t.width,height:+t.height})})}}}]),angular.module("mosapp.egipmap.map.regions",["mosapp.egipmap.map"]).directive("mosEgipMapRegions",["UrlSrvc","mosconfig","$q","apiSrvc","$timeout",function(e,t,a,i,o){return{restrict:"A",scope:{onClick:"&",activeUnit:"=",hoverUnit:"="},require:"^mosEgipMap",link:function(s,e,t,a){a.getMap().then(function(e){s.map=e,s.mapId=a.getMapId();var r=[];require(["gcapi/breadcrumbs/Breadcrumbs"],function(e){var a=new e(s.mapId),t=null,i=250;function o(e){t=null===t?(e(),setTimeout(function(){t=null},i)):(clearTimeout(t),setTimeout(function(){e(),t=null},i))}function n(e,t){!e&&t&&o(function(){a.unhighlight(a.getById(t.id))}),e&&o(function(){a.highlight(a.getById(e.id))})}a.on("breadcrumbsLoaded",function(){a.showNavigation(),r.push(s.$watch("activeUnit",function(e,t){n(e,t)})),r.push(s.$watch("hoverUnit",function(e,t){n(e,t),e&&(e.attributes=a.getById(e.id).attributes)})),a.on("breadcrumbsUnitClick",function(e){s.onClick&&s.onClick({$mapUnit:e.attributes})}),s.$on("$destroy",function(){r.map(function(e){e()})})})})})}}}]),angular.module("mosapp.2gis.map",[]).directive("mos2GisMap",["UrlSrvc","mosconfig","$q","apiSrvc","$timeout","$interval","$filter","LangSrvc","GIS2srvc","mos2GisMapSrvc",function(e,t,a,i,l,o,n,c,d,p){return{restrict:"A",scope:{center:"=?",height:"=?",zoom:"=?",onClick:"&",controls:"@?",onMapReady:"&",eventsMap:"=?",scrollZoom:"@?"},transclude:!0,controller:["$scope",function(e){e.mapDeffered=a.defer(),this.getMap=function(){return e.mapDeffered.promise},this.getMapId=function(){return e.mapId}}],link:function(t,e,a,i){var o=t.mapDeffered,n=(t.center=t.center||{y:55.751206,x:37.61778},t.zoom=a.zoom?parseInt(t.zoom):12,t.zoom=isNaN(t.zoom)?12:t.zoom,"false"!==t.scrollZoom),r={};function s(){o.promise.then(function(e){l(function(){e.invalidateSize()},100)})}t.eventsMap?(r.zoom=!1,r.fullScreen=!1):(r.zoom=!0,r.fullScreen=!0),t.map=null,t.mapId="map"+(new Date).getTime(),t.mapElement=$('<div id = "'+t.mapId+'"/>').width("auto"),t.height&&t.mapElement.height(t.height),e.attr("data-map-id",t.mapId),$(e).append(t.mapElement),l(function(){t.loader=$('<div class="loader"><div class="loader-image"><div class="cssload-progress cssload-float cssload-shadow"><div class="cssload-progress-item"></div></div></div></div>').appendTo(t.mapElement)},10),t.zoomIn=function(){gcapi.SetZoomLevelPlus()},t.zoomOut=function(){gcapi.SetZoomLevelMinus()},t.$on("$destroy",function(){angular.element(window).off("resize",s)}),d.loadLibrary().then(function(){function e(){t.loader.remove(),t.mapLoadedAndReady=!0,o.resolve(t.map);var e=c.getCurrentLang();"ru"!==e&&t.map.setLang(e)}return DG.then(function(){return DG.config=Object.assign(DG.config,{tileServer:"//tile{s}.maps.2gis.com/tiles?x={x}&y={y}&z={z}&v=1&ts=online_sd&layerType=nc",retinaTileServer:"//tile{s}.maps.2gis.com/tiles?x={x}&y={y}&z={z}&v=1&ts=online_hd&layerType=nc",poiMetaServer:"//tile{s}.maps.2gis.com/poi?x={x}&y={y}&z={z}&v=1&ts=online_sd&layerType=nc",retinaPoiMetaServer:"//tile{s}.maps.2gis.com/poi?x={x}&y={y}&z={z}&v=1&ts=online_hd&layerType=nc"}),DG.plugin("//2gis.github.io/mapsapi/vendors/Leaflet.markerCluster/leaflet.markercluster-src.js")}).then(function(){if(t.map)return o.promise;t.map=DG.map(t.mapId,{scrollWheelZoom:n,center:[t.center.y,t.center.x],zoom:t.zoom,minZoom:9,zoomControl:r.zoom,fullscreenControl:r.fullScreen}),e(),d.add(t.mapId,t.map),p.setMap(t.mapId,t.map),p.setMapEl(t.mapId,t.mapElement),t.eventsMap&&DG.control.zoom({position:"bottomright"}).addTo(t.map),t.onMapReady&&"function"==typeof t.onMapReady&&t.onMapReady()}),window.onMapApiLoad=e,o.promise}).then(function(e){return a.onClick&&e.on("click",function(e){t.onClick({event:e})}),e}).then(function(){t.height||(angular.element(window).on("resize",s),s())}).then(function(){t.map.setView([t.center.y,t.center.x],t.zoom)})},templateUrl:e.tmplPath("mos2GisMap/mos2GisMap.tpl.html")}}]).service("mos2GisMapSrvc",[function(){var i={};return{setMap:function(e,t){i[e]={id:e,map:t,pointsLength:0,latlngs:[]}},getMap:function(e){if(e&&i[e]&&i[e].map)return i[e].map},setMapEl:function(e,t){i[e].el=t},getMapEl:function(e){if(e&&i[e]&&i[e].el)return i[e].el},setPointsLength:function(e,t){i[e].pointsLength=t,i[e].latlngs=[]},addLatLng:function(e,t){i[e].latlngs.push(t)},fitMap:function(e,t){t=t||{},i[e].pointsLength==i[e].latlngs.length&&0<i[e].pointsLength&&0<i[e].latlngs.length&&(i[e].map.invalidateSize(!0),i[e].map.fitBounds(DG.latLngBounds(i[e].latlngs,{}),t))},senterPoint:function(e,t){var a=i[e].map.getZoom();i[e].map.setView([t.lon,t.lat],13<a?a:13)}}}]),angular.module("mosapp.2gis.map").factory("mos2GisMapMarkersLayer",["$timeout","GIS2srvc","mos2GisMapSrvc","mosconfig",function(e,t,l,c){function d(e,t,a,i){e.insertRule?e.insertRule(t+"{"+a+"}",i):e.addRule&&e.addRule(t,a,i)}function p(e,t){e.onClick&&e.onClick(t)}function m(e,t){l.getMap(e).setView([t.point.lon,t.point.lat],11)}return{init:function(e,t){var a,i,o,n;a=e,(i=t).point.lon&&i.point.lat&&(e=l.getMap(a),t=i.icon&&i.icon.src?DG.icon({iconUrl:i.icon.src,iconSize:[i.icon.width,i.icon.height],iconClass:i.icon.iconClass||""}):DG.icon({iconUrl:c.imagesPath+"map-marker.png",iconSize:[16,23]}),o=i.icon_hover&&i.icon_hover.src?DG.icon({iconUrl:i.icon_hover.src,iconSize:[i.icon_hover.width,i.icon_hover.height],iconClass:i.icon_hover.iconClass||""}):t,e=DG.marker([i.point.lon,i.point.lat],{icon:t}).addTo(e),n=i.point,i.point.polygon&&(n.mapPolygon=DG.polygon(i.point.polygon,{color:"red",opacity:.3,weight:3,lineJoin:"round",lineCap:"round",fill:!0,fillColor:"red",fillOpacity:.05})),i.point.path&&(n.mapPath=DG.polyline(i.point.path,{color:"red",opacity:.5,weight:5,lineJoin:"round",lineCap:"round"})),n.MapMarker=e,n.icon=t,n.icon_hover=o,void 0!==i.showLabel&&!i.showLabel||e.bindLabel(i.point.title,i.labelOptions),e.on("dblclick",function(){m(a,i)}),e.on("click",function(){p(i,n)}),l.addLatLng(a,e._latlng))},initClusterGroup:function(e,t){var i,o,a,n,r,s;i=e,o=t,e=l.getMap(i),o.style&&(a="cluster-item-"+(new Date).getTime()),n=o.icon&&o.icon.src?DG.icon({iconUrl:o.icon.src,iconSize:[o.icon.width,o.icon.height],iconClass:o.icon.iconClass||"",iconAnchor:DG.point(o.icon.width/2,o.icon.height)}):DG.icon({iconUrl:c.imagesPath+"map-marker.png",iconSize:[16,23]}),r=o.icon_hover&&o.icon_hover.src?DG.icon({iconUrl:o.icon_hover.src,iconSize:[o.icon_hover.width,o.icon_hover.height],iconClass:o.icon_hover.iconClass||"",iconAnchor:DG.point(o.icon_hover.width/2,o.icon_hover.height)}):n,s=DG.markerClusterGroup({showCoverageOnHover:!1,iconCreateFunction:function(e){var e=e.getChildCount(),t=[];return t.push("marker-cluster"),e<10?t.push("marker-cluster-small"):e<100?t.push("marker-cluster-medium"):t.push("marker-cluster-large"),a&&t.push(a),new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:t.join(" "),iconSize:new L.Point(angular.isObject(o.cluster)&&o.cluster.size?o.cluster.size:40,angular.isObject(o.cluster)&&o.cluster.size?o.cluster.size:40)})}}),o.points.forEach(function(e){var t,a;e.lon&&e.lat&&(t=DG.marker([e.lon,e.lat],{icon:n,title:e.title}),(a=e).MapMarker=t,a.icon=n,a.icon_hover=r,e.point=e,void 0!==o.showLabel&&!o.showLabel||t.bindLabel(e.title,e.labelOptions),s.addLayer(t),t.on("dblclick",function(){m(i,e)}),t.on("click",function(){p(o,a)}),l.addLatLng(i,t._latlng))}),e.addLayer(s),o.markers=s,a&&(d(styleSheets=(styleSheets=document.getElementById("clusterStyles"))?styleSheets.sheet:(styleSheets=$('<style type="text/css" id="clusterStyles"></style>'),$("head").append(styleSheets),styleSheets[0].sheet),"."+a," background-color: #000;",0),d(styleSheets,"."+a+"  div "," background-color: #000;",0),d(styleSheets,"."+a+"  span "," background-color: #000;",0))},clearClusterGroup:function(e,t){t=t,l.getMap(e).removeLayer(t.markers)},clearMarker:function(e){(e=e)&&e.remove()},clearPaths:function(e,t){t=t,(e=e)&&e.remove(),t&&t.remove()}}}]).service("mos2GisMapMarkersCtrl",["mos2GisMapSrvc","mos2GisMapMarkersLayer","$timeout",function(r,s,l){return{focusOnPoint:function(e,t,a){r.senterPoint(e,t),t.mapPath&&t.mapPath.addTo(r.getMap(e)),t.mapPolygon&&t.mapPolygon.addTo(r.getMap(e)),this.setHover(t),a&&a(e,t)},setHover:function(e){e&&e.MapMarker&&e.MapMarker.setIcon(e.icon_hover).setZIndexOffset(1e3)},unsetHover:function(e){e&&e.MapMarker&&e.MapMarker.setIcon(e.icon).setZIndexOffset(1),e.mapPath&&e.mapPath.remove(),e.mapPolygon&&e.mapPolygon.remove()},setPoints:function(t,a,i,o){var n=this;!function e(){r.getMap(t)?(r.setPointsLength(t,i.length),i.forEach(function(e){s.init(t,{point:e,icon:a.icon,icon_hover:a.icon_hover,onClick:function(e){n.focusOnPoint(t,e,a.callback)}})}),o||r.fitMap(t)):l(function(){e()},100)}()},clearPoints:function(e,t){t.forEach(function(e){s.clearMarker(e.MapMarker),s.clearPaths(e.mapPath,e.mapPolygon)}),r.setPointsLength(e,0)}}}]),angular.module("mosapp.special.photobank",["masonry","mosapp.media.photo","mosapp.media.photo.carousel","mosapp.media.photo.tiles"]).directive("mosSpecialPhotobank",["UrlSrvc","mosconfig","apiSrvc","$timeout","toolsSrvc",function(e,t,a,i,o){return{restrict:"A",scope:{galleryId:"@",mode:"@"},templateUrl:e.tmplPath("mosSpecialPhotobank/mosSpecialPhotobank.tpl.html"),link:function(e,t,a){if(!e.galleryId||isNaN(e.galleryId))return!1;e.mode=e.mode||"tiles",e.apiRoot="photoBank",e.galleryApi="photobankGallery",e.imagesApi="photobankImages"}}}]),angular.module("mosapp.photoBank",[]).directive("photoBank",["UrlSrvc","apiSrvc","toolsSrvc","$stateParams","loader",function(o,n,r,s,e){return{scope:{stateRoot:"@",stateMode:"@",personPhoto:"@",firstPerson:"@",apiRoot:"@",galleryApi:"@",imagesApi:"@",paramsId:"@",personApi:"@",personDetailsApiRoot:"@",personDetailsApi:"@",isAuthority:"@"},link:function(a,e,t){function i(){var e;a.person.section&&res.person.section.id&&(e=o.pagePath("department",""+a.person.section.id),a.person.sectionUrl=e+"view/",t.firstPerson?a.person.personUrl=o.pagePath("mayor",""):(a.person.personUrl=e+"person/"+a.person.id+"/",a.postfix=". "+a.person.post))}a.isAuthority="true"==a.isAuthority,t.firstPerson?(a.personId=o.apiPath("photoBank").firstPersonId,a.firstPerson=!0):(a.personId=s[a.paramsId],a.firstPerson=!1),a.getPersonDetails=function(){a.personId;return n.getData(a.personDetailsApiRoot,a.personDetailsApi,{id:a.personId},!0,e[0].querySelectorAll(".photobank-loader")[0]).then(function(e){var t;e&&e.id&&(t={title:e.surname+" "+e.name+" "+e.patronymic,post:r.joinProperty(e.posts,"name",", ")},s.structureId?(e=s.structureId,n.getData("structure","institution",{id:e}).then(function(e){e&&e.id&&(e.title=e.name,t.section=e.title,a.person=t,i())})):(a.person=t,i()))},function(e){})},a.getPersonData=function(){return n.getData(a.apiRoot,a.personApi,{id:a.personId},!0,e[0].querySelectorAll(".photobank-loader")[0]).then(function(e){angular.isArray(e.items)&&e.items[0]&&e.items[0].title&&(a.galleryId=e.items[0].id)},function(e){a.errCode=404})},a.personId=+a.personId,a.personId?a.getPersonDetails().then(a.getPersonData):a.errCode=404},templateUrl:o.tmplPath("photoBank/photoBank.tpl.html")}}]),angular.module("mosapp.photoBankTabs",[]).directive("photoBankTabs",["UrlSrvc","apiSrvc","$stateParams","mosconfig","toolsSrvc","galleryInfo","galleryItems","LangSrvc",function(e,n,t,a,i,r,s,l){return{scope:{mayorKey:"@",apiRoot:"@",galleryApi:"@",imagesApi:"@",postfixImg:"@"},link:function(o,e,t){o.blockVisible=!0,o.actives=0,o.confKeys=o.mayorKey.split("."),o.data=a[o.confKeys[0]][o.confKeys[1]][o.confKeys[2]],o.tabs=[],o.lang=l.getCurrentLang(),o.changeTab=function(t){o.galleryInfoId=t,o.tabs.forEach(function(e){delete e.active,e.id==t&&(e.active=!0)})},o.$watch(function(){return s.getInfo()},function(t){var a;0==t[Object.keys(t)[0]]&&(a=[],o.tabs.forEach(function(e){e.id!=Object.keys(t)[0]&&a.push(e)}),o.tabs=[],o.tabs=a,o.tabs[0]&&(o.tabs[0].active=!0,o.galleryInfoId=o.tabs[0].id))},!0),o.data.forEach(function(e,t){var a,i;a=e,i=t,n.getData(o.apiRoot,o.galleryApi,{id:a.id}).then(function(e){angular.isArray(e.items)&&e.items.length&&a.id==e.items[0].id&&(r.setInfo(a.id,e),o.tabs.push(a),a.active&&(o.galleryInfoId=a.id,o.actives++)),i==o.data.length-1&&0===o.actives&&o.tabs[0]&&(o.tabs[0].active=!0,o.actives++,o.galleryInfoId=o.tabs[0].id,o.blockVisible=!0),i===o.data.length-1&&0===o.actives&&(o.blockVisible=!1)},function(e){a.active&&(o.galleryInfoId=o.tabs[0]&&o.tabs[0].id,o.actives++,o.tabs[0]&&(o.tabs[0].active=!0))})})},templateUrl:e.tmplPath("photoBankTabs/photoBankTabs.tpl.html")}}]),angular.module("masonry",[]).directive("masonry",["UrlSrvc","masonrysrvc","$rootScope","$timeout",function(e,c,d,p){return{restrict:"A",link:function(t,e,a,i){e.on("$destroy",function(){t.$destroy()});var o,n=e[0],r={itemSelector:a.itemSelector||".tiles__item"},s=(c.load({}).then(function(e){o=t.masonry=new Masonry(n,r),t.showItem=t.photoItems,o.on("layoutComplete",function(e){t.$emit("masonryLayoutComplete",{totalItems:e.length})})},function(e){}),0),l=(t.update=function(){"ready"===d.masonry.status&&(s&&p.cancel(s),s=p(function(){s=0,o.reloadItems(),o.layout(),e.children(r.itemSelector).css("visibility","visible")},120))},t.removeBrick=function(){"ready"===d.masonry.status&&p(function(){o.reloadItems(),o.layout()},500)},t.appendBricks=function(e){"ready"===d.masonry.status&&o.appended(e)},t.$on("masonry.layout",function(){o.layout()}),t.update(),0);$(window).on("resize",function(){l&&p.cancel(l),l=p(function(){l=0,o.reloadItems(),o.layout(),e.children(r.itemSelector).css("visibility","visible")},375)})}}}]).directive("masonryTile",["masonrysrvc",function(r){return{restrict:"A",link:function(t,a){a.css("visibility","hidden");var i=t,o=i.update,e=i.removeBrick,n=i.appendBricks;o&&r.load({}).then(function(e){imagesLoaded(a.get(0),o),a.ready(o),i.item.current&&t.$emit("masonrySayYes")},function(e){}),n&&r.load({}).then(function(e){imagesLoaded(a.get(0),n(a))},function(e){}),t.$on("$destroy",function(){e&&e()})}}}]).service("masonrysrvc",["UrlSrvc","$q","$rootScope","$window",function(i,t,o,e){this.load=function(e){return t(function(e,t){var a;o.masonry?"ready"!==o.masonry.status?(a=document.getElementById("masonryapiscript"),$(a).on("load",function(){e()})):e():(o.masonry={},o.masonry.status="load",(a=document.createElement("script")).id="masonryapiscript",a.async="true",document.getElementsByTagName("head")[0].appendChild(a),a.src=i.jsPath("masonry.pkgd.min.js"),$(a).on("load",function(){o.masonry.status="ready",e()}))})}}]),angular.module("mosapp.media.photo",["ngAnimate"]).directive("mosMediaPhoto",["UrlSrvc","apiSrvc","$state","$stateParams","$filter","metaConfig","galleryInfo","$timeout","galleryItems","tmplSrvc","headmetaSrvc","loader","districtsSrvc","$translate",function(t,o,a,r,s,l,c,d,p,m,u,g,f,h){return{restrict:"A",scope:{inline:"@",galleryInfoId:"=",mode:"@",galleryId:"@",apiRoot:"@",galleryApi:"@",imagesApi:"@",similarApi:"@",stateRoot:"@",stateMode:"@",person:"=",firstPerson:"=",errCode:"=",sectionState:"@",postfix:"@",pageType:"@",isAuthority:"@"},link:function(n,i,e){if(n.firstInit=!0,n.galleryCache={},!n.inline&&n.errCode)return n.mosError=n.errCode;if(i.on("$destroy",function(){n.$destroy()}),n.galleryVisible=!0,!n.inline){if(n.params={id:n.galleryId||r.photoID,page:r.page?Number(r.page):1,item:r.item?Number(r.item):0,mode:"carousel"!=r.mode?"tiles":"carousel",stateRoot:n.stateRoot,stateMode:n.stateMode},!n.params.stateRoot||!n.params.stateMode)return console.error("Add states to the ui-router!"),n.mosError=404;if(n.params.pages=[],!n.params.id)return console.error("ID doesn`t exist!"),n.mosError=404;if(!n.apiRoot||!n.galleryApi||!n.imagesApi)return console.error("API key`s doesn`t exist!"),n.mosError=404}n.inline&&n.galleryId&&!e.galleryInfoId&&(n.params={id:n.galleryId,page:1,item:0,mode:"carousel"!=n.mode?"tiles":"carousel"}),n.error=!1,n.hideme=!1,n.currentTileItem=n.params&&n.params.item||0,n.picsTotal=0,n.currentItem={},n.currentImageSrc="",n.inline||a.go(n.params.stateMode,{photoID:n.params.id,mode:n.params.mode,page:n.params.page,item:n.params.item},{notify:!1}),n.changeMode=function(e){n.currentTileItem=n.params.item,n.params.mode=e,n.inline||a.go(n.params.stateMode,{mode:e,page:n.params.page,item:n.params.item},{notify:!1}),n.currentImage=n.currentSlide},n.$watch("params.mode",function(e,t){"tiles"===e&&"carousel"===t?(n.fromCarousel=!0,t=Math.floor(n.params.item+1/n.perPage),n.params.pages[t]&&(n.params.page=n.params.pages[t])):n.fromCarousel=!1,"tiles"===e&&(n.firstInit=!1),"carousel"===e&&(n.inline&&(n.firstInit=!1),n.firstInit?n.firstInit=!1:d(function(){var e,t=angular.element(i).find(".carousel__header");t.length&&(t=t.offset().top-t.height(),e=n.inline?40:0,TweenLite.to(window,1,{scrollTo:{y:t-e,autoKill:!1},ease:Power1.easeInOut,onComplete:function(){}})),n.firstInit=!1},100))}),n.getMoreItems=function(e){if(!n.lockMore){if(n.lockMore=!0,!n.params.pages.length)return n.lockMore=!0;var t=n.params.pages[n.params.pages.length-1]+1,a=(t>n.pageCount&&(t=1),n.params.page=t,i),a="tiles"==n.params.mode?a.find(".tiles__container"):a.find(".carousel:not(.container-fluid)");g.switchOn(a),o.getData(n.apiRoot,n.imagesApi,{id:n.params.id,page:t},!0).then(function(e){n.lockMore=!1,n.params.pages.push(t),n.setData(e,1)},function(){n.lockMore=!1}).finally(function(){var e=a.children(".loader");e.length&&e.remove()})}},n.setCurrentImage=function(e,t){var a;e&&(n.currentItem=angular.copy(e),n.currentImageSrc=s("imgDownload")(e.image),a=(n.person||n.media||n.gallery).title,!n.isAuthority||"tiles"!==n.params.mode&&"carousel"!==n.params.mode?n.setCurrentMeta({title:a,pic:e}):n.setCurrentMetaAuthorityPhoto({title:a,pic:e,order:t+1}))},n.setCurrentMetaAuthorityPhoto=function(e){var t,a,i,o;n.inline||(n.image=s("imgDownload")(e.pic.image),-1!==n.image.indexOf("data:image",0)&&(n.image=""),e&&e.pic&&e.pic.image&&((o=e.pic.image.middle).fullTitle="Фотография "+o.title,(t=(o=document.querySelector("head")).querySelector("title"))||(t=document.createElement("title"),o.appendChild(t)),o="tiles"===n.params.mode?(a="Фотобанк — "+e.title,i="фотографии "+e.title.toLowerCase()+", фотобанк","Фотографии: "+e.title):(a=e.pic.image.title+". Фотография №"+e.order+": "+e.title,i="фотография "+e.title.toLowerCase()+", фотография "+e.order+", фотография "+e.title.toLowerCase()+" "+e.order+", "+e.pic.image.title,"Фотография №"+e.order+": "+e.title+". "+e.pic.image.title),t.innerHTML=o,u.withoutSiteName().setPageMeta({mediaPhoto:{type:"article",title:o,description:a,image:e.pic.image.middle,published_time:n.gallery.date_timestamp}},"mediaPhoto").setKeywords(i)))},n.setCurrentMeta=function(e){var t,a,i;n.inline||(n.image=s("imgDownload")(e.pic.image),-1!==n.image.indexOf("data:image",0)&&(n.image=""),e&&(e.pic&&e.pic.image&&((t=e.pic.image.middle).title&&0!==t.title.indexOf("Фотография ")&&(t.title="Фотография "+t.title),a=e.title+l.photo.description,i=e.title.toLowerCase()+l.photo.keywords,u.withoutSiteName().setPageMeta({mediaPhoto:{type:"article",title:e.title||t.title,description:a,image:e.pic.image.middle,published_time:n.gallery.date_timestamp}},"mediaPhoto").setKeywords(i)),!n.pageType||"mayor"!==n.pageType&&"media"!==n.pageType?u.setTitle(e.title):u.setTitle(e.title,l.photo.sectionTitle,l.photo.section)))},n.showSlide=function(e,t){n.action=t,n.currentTileItem=e},n.setData=function(e,t){if(!e)return!1;e&&e._meta&&e._meta.currentPage&&e._meta.pageCount?(n.pageCount=e._meta.pageCount,n.perPage=e._meta.perPage,n.picsTotal=e._meta.totalCount,n.inline||"tiles"===n.params.mode&&a.go(n.params.stateMode,{mode:n.params.mode,page:n.params.page,item:n.params.item},{notify:!1}),e._meta.currentPage<n.pageCount&&angular.isArray(n.params.pages)&&n.params.pages.length<n.pageCount||angular.isArray(n.params.pages)&&n.params.pages.length<n.pageCount?n.lockMore=!1:n.lockMore=!0):n.lockMore=!0,0===t?(n.mosError=!1,n.gallery=e&&!e.id&&angular.isArray(e.items)&&e.items.length?angular.copy(e.items[0]):angular.copy(e),n.setMediaTitle()):e.items&&angular.isArray(e.items)&&e.items.length?angular.forEach(e.items,function(e){e={image:e,showImage:!1};n.photoItems.push(e)}):n.lockMore=!0},n.setMediaTitle=function(){n.person||(n.media={title:n.gallery.title,date_timestamp:n.gallery.date_timestamp})},n.initGallery=function(){var e={id:n.params.id,page:n.params.page};n.getPhoto=o.getData(n.apiRoot,n.imagesApi,e,!0,i[0].querySelectorAll(".media-photo-loader")[0]),n.getPhoto.then(function(e){n.lockMore=!0,n.mosError=!1,angular.isArray(n.params.pages)||(n.params.pages=[]),n.params.pages.push(n.params.page),n.setData(e,1)},function(e){n.error=e,n.photoItems.length<1&&(n.mosError=e.code)})},n.getInfo=function(){var e={id:n.params.id,expand:"districts"};o.getData(n.apiRoot,n.galleryApi,e,!0,i[0].querySelectorAll(".media-photo-loader")[0]).then(function(e){var t;angular.isArray(e.items)&&e.items[0]&&e.items[0].id?t=e.items[0]:angular.isObject(e)&&e.id&&(t=e),t?(n.lockMore=!0,n.setData(t,0),n.initGallery(),!n.inline&&t.date_timestamp&&m.transferToPhantom(t.date_timestamp),h(["mediaPhoto.districtsTitle","mediaPhoto.areasTitle"]).then(function(e){n.districtsTitle=e["mediaPhoto.districtsTitle"],n.areasTitle=e["mediaPhoto.areasTitle"]}),e="","mayor"===n.pageType?e="photo":"media"===n.pageType&&(e="mainphoto"),f.handleDistricts(n.gallery.districts,n,{category:e,maxExtra:2})):n.inline&&n.galleryId?(n.gallery=null,$(document).trigger("dataMosSpecialPhotobankNotFound")):n.mosError=404},function(e){"410"==e.code&&n.sectionState?a.go(n.sectionState):(n.inline&&n.galleryId?(n.gallery=null,$(document).trigger("dataMosSpecialPhotobankNotFound")):n.mosError=e.code,n.lockMore=!0)})},n.inline&&e.galleryInfoId?(n.mode="tiles",n.params={},n.params.pages=[],n.params.page=1,n.params.item=0,n.params.mode="tiles",n.lockMore=!0,n.photoItems=[],n.$watch("galleryInfoId",function(t){angular.isDefined(t)&&angular.isNumber(+t)&&"on"===n.inline&&(n.lockMore=!1,n.photoItems=[],n.params.pages=[],n.params.id=n.galleryInfoId,o.getData(n.apiRoot,n.imagesApi,{id:n.params.id,page:n.params.page},!0,i[0].querySelectorAll(".media-photo-loader")[0]).then(function(e){angular.isArray(e.items)&&e.items.length?p.setInfo(t,!0):p.setInfo(t,!1),n.params.pages.push(e._meta.currentPage),n.setData(c.getInfo(t),0),n.setData(e,1)},function(e){p.setInfo(t,!1)}))})):n.photoItems=[],(!n.inline||n.inline&&n.galleryId&&!e.galleryInfoId)&&n.getInfo(),n.pageType&&"mayor"===n.pageType&&(n.canonicalLink=t.getLangLink(t.pagePath("mayorMain","media/photo/"+n.params.id+"/"+n.params.mode+"/"+n.params.page+"/"+n.params.item)),n.canonicalLink&&t.setCanonical(n.canonicalLink)),n.getSimilarItems=function(e){return!1}},templateUrl:t.tmplPath("mediaPhoto/mediaPhoto.tpl.html")}}]).factory("galleryInfo",function(){var a={};return{setInfo:function(e,t){a[e]=t},getInfo:function(e){return a[e]}}}).factory("galleryItems",function(){var a={};return{setInfo:function(e,t){(a={})[e]=t},getInfo:function(e){return a}}}),angular.module("mosapp.media.photo.carousel",["ngAnimate","ngTouch"]).directive("mosMediaPhotoCarousel",["UrlSrvc","toolsSrvc","$state","$filter","$timeout","$window",function(e,i,f,t,h,o){return{restrict:"A",scope:{inline:"=",getMoreItems:"=",gallery:"=",picsTotal:"=",lockMore:"=",photoItems:"=",perPage:"=",currentItem:"=",currentTileItem:"=",action:"=",currentImageSrc:"=",params:"=",setCurrentImage:"&",postfix:"@",pageType:"@",isAuthority:"@"},link:function(l,t){l.$watch(function(){return i.colorScheme()},function(e){l.colorScheme=e}),l.setSharingPreview=function(){!l.pageType||"mayor"!==l.pageType&&"media"!==l.pageType?l.sharingPreview="Фотография "+l.currentItem.image.title:l.sharingPreview=l.gallery.title},l.$watch("currentItem",l.setSharingPreview),l.slidesCount=l.slidesCount||5,t.on("$destroy",function(){l.$destroy(),$(window).off("resize.mosMediaPhotoCarousel")}),l.currentSlide=l.currentTileItem||0,l.isMobile=device&&(device.mobile()||device.tablet()),l.speed=.6,l.easing="Power1.easeOut";var c,d,e,s=t.find(".carousel-vertical__list"),p=0,m=0,u=l.slidesCount,a=(l.initFullCarousel=function(){var e,t;l.fullItems&&(e=(c=s.find(".slick-track")).find(".carousel-vertical__item"),t=s.width(),c.width(l.fullItems.length*t),e.width(t),e.css({display:"block"}),d=t,0<p&&c.css({left:-d*p}))},null);function g(e){var t,a=Math.floor(u/2),i=p,a=p-a,o=(0<a?0<(t=Math.min(Math.abs(a),l.picsTotal-(m+u)))&&(m+=t,p-=t):a<0&&0<(t=Math.min(m,Math.abs(a)))&&(m-=t,p+=t),m+u-1);if(o>l.picsTotal-1&&(o=l.picsTotal-1,0<m&&o-m<u-1&&(a=Math.min(m,u-1-(o-m)),m-=a,p+=a)),!e||0<t){for(var n=m,r=0;n<=o;n++,r++){var s=angular.copy(l.photoItems[n]);0<t&&e&&r===i||(s?(s.index=r,s.currentSlide=l.currentSlide,l.fullItems[r]=s):l.fullItems[r]={})}0<t&&c&&h(function(){c.css({left:-d*p}),e&&(l.fullItems[i]=l.photoItems[m+i])},0)}}$(window).on("resize.mosMediaPhotoCarousel",function(){a&&h.cancel(a),a=h(l.initFullCarousel,10)}),l.vertGoTo=function(a,i){var o,n,r,e;!l.photoItems[a]||!i&&a===l.currentSlide?l.lock=!1:(o=angular.element(t).find(".carousel-vertical__nav_list"),c=s.find(".slick-track"),n=o.find(".carousel-vertical__nav-item").height(),r=a-2,l.photoItems.length<6||r<=0?r=0:l.photoItems.length-r<=5&&(r=l.photoItems.length-5),e=a-l.currentSlide,0!=e&&(p+=e),h(function(){var e=-r*n,e=(TweenLite.to(o,(l.isMobile||i?0:l.speed/3)||.25,{marginTop:e,ease:l.easing,onComplete:function(){}}),TweenLite.to(c,(l.isMobile?l.speed/1.5:l.speed/3)||.75,{left:-d*p,ease:l.easing,onComplete:function(){g(!0),l.$apply(),l.lock=!1}}),l.params.page),t=(!l.lockMore&&l.photoItems.length-l.currentSlide<e*(l.perPage-3)&&(l.getMoreItems(),l.unwatchPhotoItems=l.$watch("photoItems",function(e,t){if(e&&t&&e.length>t.length){var a=m+u-1;a>l.picsTotal-1&&(a=l.picsTotal-1,0<m&&a-m<u-1&&(e=Math.min(m,u-1-(a-m)),m-=e));for(var i=m,o=0;i<=a;i++,o++){var n=l.fullItems[o];n&&n.image||(l.fullItems[o]=l.photoItems[i])}l.unwatchPhotoItems()}},!0)),l.photoItems[l.currentSlide].current=!1,l.photoItems[a].current=!0,l.currentItem=l.photoItems[a],l.currentSlide=a,l.currentTileItem=a,l.params.item=a,Math.floor(a/l.perPage));l.params.pages[t]&&(e=l.params.pages[t]),l.params.page=e,l.inline||f.go(l.params.stateMode,{mode:l.params.mode,page:l.params.page,item:l.params.item},{notify:!1}).then(function(){h(function(){l.setCurrentImage({pic:l.photoItems[a],order:a})},100)})},50))},l.getPrevSlide=function(){var e=0===l.currentSlide?0:l.currentSlide-1;l.goToSlide(e,!1)},l.getNextSlide=function(){var e=(e=l.currentSlide+1)<l.photoItems.length?e:l.photoItems.length;l.goToSlide(e,!1)},l.goToSlide=function(e,t){(t||!l.lock&&e!==l.currentSlide)&&(l.lock=!0,l.vertGoTo(e,t))},l.clearCurrent=function(){l.photoItems.forEach(function(e,t){t=t===l.currentSlide;angular.extend(e,{current:t,showImage:t})})},l.photoItems&&l.photoItems.length&&(l.clearCurrent(),l.params.item=l.currentSlide,l.currentSlide>l.photoItems.length-1&&(e=Math.ceil(l.currentSlide/l.perPage),0<(e=l.currentSlide-l.perPage*(e-1))&&e<l.photoItems.length?l.currentSlide=e:l.currentSlide=0),l.setCurrentImage({pic:l.photoItems[l.currentSlide],order:l.currentSlide}),l.fullItems=l.fullItems||[],l.picsTotal<u&&(u=l.picsTotal),m=l.currentSlide,l.fullItems=[],g(),h(function(){l.initFullCarousel(),l.goToSlide(l.currentSlide,!0)})),l.printThis=function(){return o.print()}},templateUrl:e.tmplPath("mediaPhotoCarousel/mediaPhotoCarousel.tpl.html")}}]).directive("mediaPhotoCarouselThumb",["UrlSrvc","toolsSrvc",function(e,a){return{restrict:"A",scope:{item:"=",currentSlide:"=",ind:"=",picsTotal:"=",gallery:"=",postfix:"@"},link:function(t,e){t.$watch(function(){return a.colorScheme()},function(e){t.colorScheme=e}),e.on("$destroy",function(){t.$destroy()}),t.postfix?t.metaImage=a.getMetaForImage(t.gallery.title+t.postfix):t.metaImage=a.getMetaForImage(t.gallery.title),t.$watch("currentSlide",function(e){t.item.showImage=Math.abs(t.ind-e)<6})},templateUrl:e.tmplPath("mediaPhotoCarousel/mediaPhotoCarouselThumb.tpl.html")}}]).directive("mediaPhotoCarouselFull",["UrlSrvc","toolsSrvc","$filter","loader",function(e,l,i,c){return{restrict:"A",scope:{item:"=",currentSlide:"=",ind:"@",getPrevSlide:"&",getNextSlide:"&",picsTotal:"=",gallery:"=",postfix:"@"},link:function(o,n){function r(e,t){var a=new Image;return $(a).on("load error",function(){c.switchOff(n),o.loading=!1,o.displayInfo=!0,window.location.pathname.match("^/en/")||(o.showPhotoTitle=!0)}),a.src=i("imgShow")(e),s(),a.alt=t.alt,a.title=t.title,a}function s(){o.loading||(c.switchOn(n),o.loading=!0,o.displayInfo=!1,o.showPhotoTitle=!1)}n.on("$destroy",function(){o.$destroy()}),o.postfix?o.metaImage=l.getMetaForImage(o.gallery.title+o.postfix):o.metaImage=l.getMetaForImage(o.gallery.title),o.item&&o.item.image||s(),o.$watch("item",function(e){var t,a,i;e&&e.image?(o.item.showImage=!0,t=n.find("img"),a=l.getMetaForImage(o.gallery.title+(o.postfix||"")),s(),t&&t.length?(i=r(e.image,a),t.replaceWith(i)):(i=r(e.image,a),n.find(".carousel-vertical__image-wrap").prepend(i))):s()})},templateUrl:e.tmplPath("mediaPhotoCarousel/mediaPhotoCarouselFull.tpl.html")}}]),angular.module("mosapp.media.photo.tiles",[]).directive("mosMediaPhotoTiles",["UrlSrvc","$timeout","toolsSrvc",function(e,o,n){return{restrict:"A",scope:{photoItems:"=",gallery:"=",lockMore:"=",params:"=",showSlide:"=",perPage:"=",getMoreItems:"=",currentTileItem:"=",fromCarousel:"=",setCurrentImage:"&",postfix:"@"},link:function(a,t,e){var i;!0!=(-1!=(i=navigator.userAgent.toLowerCase()).indexOf("safari")&&-1===i.indexOf("chrome"))&&a.$watch(function(){return n.colorScheme()},function(e){a.colorScheme=e}),t.on("$destroy",function(){a.$destroy()}),a.postfix?a.metaImage=n.getMetaForImage(a.gallery.title+a.postfix):a.metaImage=n.getMetaForImage(a.gallery.title),a.scrollToEl=function(e){e&&a.tryScroll&&((e=t.find(e)).length&&(a.scrollTw&&a.scrollTw.kill(),a.destination=angular.element(e[0]).offset().top-120,a.scrollTw=TweenLite.to(window,1,{scrollTo:{y:a.destination,autoKill:!1},ease:Power1.easeInOut,onComplete:function(){a.tryScroll=!1}})))},a.goToTop=function(){TweenLite.to(window,1,{scrollTo:{y:document.getElementsByClassName("carousel__header")[0].offsetTop-45,autoKill:!1},ease:Power2.easeInOut,onComplete:function(){a.tryScroll=!1}})},a.$watch("destination",function(e,t){e&&t&&e!==t&&a.scrollToEl(".tiles_anchor")}),a.gotoCurrent=function(){o(function(){a.destination=0,a.scrollToEl(".tiles_anchor")})},a.$watch("fromCarousel",function(e){e&&o(function(){a.tryScroll=!0,a.currentPos=0})}),a.$on("masonrySayYes",function(){}),a.$on("masonryLayoutComplete",function(e,t){t&&t.totalItems&&t.totalItems===a.photoItems.length&&a.gotoCurrent()}),a.clearCurrent=function(){for(var e=a.photoItems.length;e--;)if(a.photoItems[e].current){delete a.photoItems[e].current;break}},a.$watch("photoItems.length",function(e){e&&!a.fromCarousel&&a.setCurrentImage({pic:a.photoItems[0],order:0})}),a.open=function(e){a.clearCurrent(),a.params.mode="carousel",e.item.current=!0,a.showSlide(e.index,"tiles")}},templateUrl:e.tmplPath("mediaPhotoTiles/mediaPhotoTiles.tpl.html")}}]),angular.module("mosapp.mosLightbox",[]).directive("mosLightbox",["$modal","UrlSrvc","$timeout","loader",function(ne,re,se,le){return{restrict:"A",scope:{fullImageLink:"@",description:"@",prefixClass:"@",scrollOn:"@",container:"@"},template:"",link:function(i,r,e){var o,n,a,s,l,c,d,p=document.body,t=document.documentElement,m=angular.element(document),u=angular.element(window),g=i.container&&r.parents(i.container),f=parseInt(r.attr("width")),h=parseInt(r.attr("height")),v=!f&&(h||0);function y(e,t,a,i,o,n){!t&&e!=a||t&&t!=a?(r.attr("height",Math.ceil(a/n)),!t&&h&&g&&g.width()>a&&i<o&&(e=Math.ceil(g.width()/n),r.attr("height",o<e?o:e))):t===a&&o&&r.attr("height",o)}function H(){var e=angular.element(r);i.popupImage={src:i.fullImageLink||e.attr("src"),description:i.description||(e.attr("data-jsalt")?"":e.attr("alt"))},i.popup=ne({scope:i,template:re.tmplPath("mosLightbox/mosLightbox.tpl.html"),show:!1,prefixClass:"mos-lightbox",prefixEvent:"mos-lightbox",backdropAnimation:"am-fade",placement:"center",backdrop:"static"}),i.popup.$promise.then(function(){i.popup.show();var e,t=angular.element(i.popup.$element),a=t.find(".mos-lightbox-popup-modal__cont");le.switchOn(a),i.popupImage&&i.popupImage.src&&(e=new Image,n=$(e),o=$(i.popup.$element),e.onload=function(){le.switchOff(a),t.find(".mos-lightbox-popup-modal__wrapper").prepend(e),se(function(){o.addClass("positioned"),u.on("resize.popup",B)},10)},n.on("mousedown",q),n.on("mousemove",V),n.on("mouseup mouseleave",Z),n.on("touchstart pointerdown",te),n.on("touchmove pointermove",ae),n.on("touchend pointerup",ie),e.src=i.popupImage.src)})}h||r.attr("height",""),i.maxZoom=2,i.$on("$destroy",function(){m.off("keyup.mos-lightbox"),u.off("resize.lightboxImage")}),r.on("load",function(){var a=this.naturalWidth,e=this.naturalHeight,i=f&&h?f/h:a/e,e=r.width(),t=r.height();f&&(y(a,f,e,t,v,i),u.on("resize.lightboxImage",function(){var e=r.width(),t=r.height();y(a,f,e,t,v,i)}))}),i.$on("mos-lightbox.show",function(e,t){i.zoom=1,s=null,a=window.pageYOffset||p.scrollTop,p.style.position="fixed",p.style.top=-a+"px",p.style.width="100%",m.on("keyup.mos-lightbox",function(e){27===e.keyCode&&t.hide()}),(l=o.find(".mos-lightbox-popup-modal__cont-wrapper")).width(o.width()),c=o.find(".mos-lightbox-popup-modal__cont"),d=o.find(".mos-lightbox-popup-modal__wrapper"),l.css({height:o.height()}),o.mCustomScrollbar({axis:"yx",scrollbarPosition:"inside",theme:"minimal-dark",advanced:{updateOnImageLoad:!0,autoExpandHorizontalScroll:!0}}),S(),b=o.data("mCS"),w=o.find(".mCSB_container"),o.find(".mCSB_scrollTools_vertical"),o.find(".mCSB_scrollTools_horizontal"),touchMoveY=[],touchMoveX=[]}),i.$on("mos-lightbox.hide",function(){p.style.position="",p.style.width="",p.style.top="",t.scrollTop=a,p.scrollTop=a,u.off("resize.popup"),m.off("keyup.mos-lightbox")}),i.hidePop=function(){i.popup&&(i.popup.hide(),i.popup=null)};var _,b,w,M,k,z,R,G=angular.element(r);function B(){var e=1!==i.zoom?s*i.zoom:0;e<o[0].clientWidth?l.width(o[0].clientWidth):l.width(e),o.mCustomScrollbar("update")}function S(){c.outerHeight()<=o.height()?o.addClass("mos-lightbox-popup-modal_center"):o.removeClass("mos-lightbox-popup-modal_center")}function U(e){var t,e=W(i.zoom,e=e||.2);i.zoom!==(e=2<e?2:e)&&(t=(s=s||n.width())*e,c.width(t),t>l.width()&&l.css({"max-width":"none"}),n.height()>=d.height()&&l.css({height:"auto"}),t>l[0].clientWidth&&l.width(t),n.css({width:"100%"}),i.zoom=e,S(),o.mCustomScrollbar("update"))}function Y(e){var t,e=W(i.zoom,-(e=e||.2));i.zoom!==(e=e<1?1:e)&&(1!==e?((t=s*e)<o[0].clientWidth?l.width(o[0].clientWidth):l.width(t),c.width(t)):(l.css({"max-width":"",width:o[0].clientWidth,height:o[0].clientHeight}),c.css({width:""}),n.css("width","")),i.zoom=e,S(),o.mCustomScrollbar("update"))}function W(e,t){return e=e||1,Math.round(10*(e+t))/10}function q(e){e=e.originalEvent||e,_=!0,(new Date).getTime();var e=J(e),t=w.offset();k=e[0]-t.top,M=e[1]-t.left}function V(e){var t,a;_&&((e=e.originalEvent||e).preventDefault(),e.stopImmediatePropagation(),(new Date).getTime(),e=J(e),t=o.offset(),a=e[0]-t.top,e=e[1]-t.left,touchMoveY.push(a),touchMoveX.push(e),w[0].idleTimer=250,b.overflowed[0]&&0<k-a&&o.mCustomScrollbar("scrollTo",[k-a,null],{scrollEasing:"mcsLinearOut",dur:0,dir:"y",drag:!0,overwrite:"all"}),b.overflowed[1]&&0<M-e&&o.mCustomScrollbar("scrollTo",[null,M-e],{scrollEasing:"mcsLinearOut",dur:0,dir:"x",drag:!0,overwrite:"none",timeout:0}))}function Z(){_=!1}function J(e){return[e.pageY,e.pageX,!1]}G.on("click",function(e){e.stopPropagation(),H()}),G.parent(".mos-lightbox__wrapper").on("click",function(e){e.preventDefault(),H()}),i.zoomIn=U,i.zoomOut=Y;var D="",K=0,X=0,T=1,C=1,P=1,x=parseInt(e.maxScale,10),A=((isNaN(x)||x<=1)&&(x=3),0),I=0,E=0,O=0,L=0,F=0,Q=0,ee=0,N=0,j=0;function te(e){var t=(e.originalEvent||e).touches;t?(Q=t[0].clientX,ee=t[0].clientY,E=A,O=I,j=N=0):e.stopPropagation()}function ae(e){var t=(e.originalEvent||e).touches;t?(""===D&&(1===t.length&&1<T?D="swipe":2===t.length&&(D="pinch",P=T,X=oe(t),L=t[0].clientX-parseInt((t[0].clientX-t[1].clientX)/2,10)-n[0].offsetLeft-E,F=t[0].clientY-parseInt((t[0].clientY-t[1].clientY)/2,10)-n[0].offsetTop-O)),"swipe"===D?(N=t[0].clientX-Q,j=t[0].clientY-ee,A=E+N,I=O+j):"pinch"===D&&2===t.length&&(K=oe(t),A=L*(1-(C=K/X))+E+N,I=F*(1-C)+O+j,(1<(T=C*P)?U:Y)(.1))):e.stopPropagation()}function ie(e){var t=(e.originalEvent||e).touches;e.stopImmediatePropagation(),""===D||!t||0<t.length||(T<1?(T=1,I=A=0):x<T?(A=L*(1-(C=(T=x)/P))+E+N,I=F*(1-C)+O+j):(0<A?A=0:A<z*(1-T)&&(A=z*(1-T)),0<I?I=0:I<R*(1-T)&&(I=R*(1-T))),D="")}function oe(e){e=2===e.length?Math.sqrt(Math.pow(e[0].clientX-e[1].clientX,2)+Math.pow(e[0].clientY-e[1].clientY,2)):0;return parseInt(e,10)}}}}]),angular.module("mosapp.calendar.list.mosCalendarLite",["mosapp.press.categories","mosapp.press.categoriesCheckbox","mosapp.press.category","mosapp.filter.calendar","mosapp.responce.dialog","mosapp.calendar.filter.lite"]).directive("mosCalendarLite",["UrlSrvc","apiSrvc","$timeout","$filter","toolsSrvc","LangSrvc",function(m,u,g,f,e,h){return{scope:{category:"@",sphere:"@",placeType:"@",filterOperator:"@",limit:"@",target:"@",style:"@",dateFrom:"@",dateTo:"@",ids:"@",baseHref:"@",nodate:"@",filter:"@",filterClearOn:"@",newYearFlag:"@",newYearEventTypes:"@",newYearEventDates:"@",displayDate:"@",dateColor:"@",titleColor:"@",eventBackgroundColor:"@"},link:function(o,a){var e,i,t,n=/^[\d,&]*$/,r=((o.dateColor||o.titleColor||o.eventBackgroundColor)&&(r="",o.dateColor&&(r+=".calendar-lite.main-style .calendar-lite__time { color: "+o.dateColor+"!important }"),o.titleColor&&(r+=".calendar-lite.main-style .calendar-lite__title { color: "+o.titleColor+"!important }"),o.eventBackgroundColor&&(r+=".calendar-lite.main-style .calendar-lite__item { background-color: "+o.eventBackgroundColor+"!important; } .calendar-lite.main-style .calendar-lite__textwrapper {padding:8px 16px !important;}"),t=document.head||document.getElementsByTagName("head")[0],(e=document.createElement("style")).type="text/css",e.styleSheet?e.styleSheet.cssText=r:e.appendChild(document.createTextNode(r)),t.appendChild(e)),o.controlsInited=!1,o.startFindPosts=!1,o.lang=h.getCurrentLang(),o.noData="ru"===h.getCurrentLang()?"Событий не найдено":"No events were found",o.queryBlock=!1,o.params={},o.newYearEventTypes&&(i=[],o.newYearEventTypes.split("|").forEach(function(e){var t=e.indexOf(":");-1<t&&i.push(e.slice(0,t))}),o.params.auditory=i.join("|"),""===o.params.auditory&&delete o.params.auditory),o.filterSettings={},o.category&&(o.cacheCats=p(o.category).replace(",","|")),o.sphere&&(o.cacheCats=p(o.sphere).replace(",","|")),o.sphere||o.category);function s(i){var e=i?a.find(".calendar__more-loader"):a.find(".calendar-lite__loader-container"),t=function(e){angular.isObject(o.params)||(o.params={});var t,a=angular.copy(o.params);a.filter=a.filter||{},"or"===o.filterOperator?(t={},a.filter["="]=t):"and"===o.filterOperator?(t={},a.filter["&"]=t):t=a.filter;o.filterSettings.spheres&&o.filterSettings.spheres.length&&(t[o.spheresOperator+"spheres.id"]=o.filterSettings.spheres);o.ids&&(a.ids=o.ids);o.filterSettings.placeTypes&&(t["spots.place_type_id"]=o.filterSettings.placeTypes);a.place_type&&(t["spots.place_type_id"]=a.place_type.split("|").map(function(e){return+e}),delete a.place_type);a.auditory&&(t.auditory=a.auditory.split("|").map(function(e){return+e}),delete a.auditory);a.place&&(t["districts.id"]=a.place,delete a.place);o.params.page||(a.page=1);e?a.page++:(a.page=1,o._params={},Object.keys(a).forEach(function(e){a[e]!=undefined&&null!=a[e]&&"all"!=a[e]||delete a[e]}));o.nodate||o.filter&&(!o.filter||a.from||a.to)||(d(o.params),a.from=o.params.from,a.to=o.params.to);a.from&&(a.filter[">=date_to"]=a.from,delete a.from);a.to&&(a.filter["<=date_from"]=a.to,delete a.to);return a.fields="id,title,image,date_timestamp,date_from_timestamp,date_to_timestamp",a.filter=JSON.stringify(a.filter),a}(i);return u.getData("newsfeed","afishaBricks",t,!1,{elems:e,loaderType:"plainDots"}).then(function(e){if(e){if(e.items&&e.items.length){e.items=e.items.sort(o.sortingFromDate),o.notFound=!1;for(var t=e.items,a=0;a<t.length;a++)t[a].link=o.baseHref+"/"+t[a].id,t[a].occurrence_id&&(t[a].link+="/"+t[a].occurrence_id);o.displayDate&&e.items.forEach(function(e){e.dateString="";var t=1e3*e.date_from_timestamp,a=1e3*e.date_to_timestamp;new Date(t).toDateString()===new Date(a).toDateString()?e.dateString=f("date")(t,o.displayDate):e.dateString=f("date")(t,o.displayDate)+" - "+f("date")(a,o.displayDate)}),i||(o.items=[],o.events=[]),o.items=o.items.concat(e.items)}else o.filter||o.dateTo||o.nodate?i||(o.notFound=!0):(o.nodate=1,o.params.from&&delete o.params.from,o.params.to&&delete o.params.to,s());e._meta&&(o.meta=e._meta,o.page=e._meta.currentPage)}else i||(o.notFound=!0)})}function l(){var e;if(o.items.length>=o.limit?e=o.items.splice(0,o.limit):0<o.items.length&&(e=o.items.splice(0,o.items.length)),!angular.isArray(e))return o.loading=!1,void(o.canBeMore=!1);for(var t=e.length;t--;)e[t].isNew=!0;o.events=o.events.concat(e),g(function(){for(var e=o.events.length;e--;)o.events[e].isNew=!1},50),(0<o.items.length||o.meta&&o.meta.currentPage<o.page.pageCount)&&(o.canBeMore=!0)}function c(e){o.loading=!0,o.canBeMore=!1,o.items.length>o.limit&&!o.mustUpdate&&e?(l(),o.loading=!1):angular.isObject(o.meta)&&o.meta.currentPage<o.meta.pageCount||!o.items.length?s(e).then(function(){l(),o.mustUpdate=!1,o.loading=!1,o.queryBlock=!1}):(l(),o.loading=!1,o.queryBlock=!1)}function d(e){o.newYearFlag&&o.newYearEventDates&&(o.dateFrom=o.newYearEventDates.split("-")[0]+" 00:00:00",o.dateTo=o.newYearEventDates.split("-")[1]+" 23:59:59");var t,a=moment().toDate(),i=a.getTimezoneOffset()/60;return(a=-3!=i?new Date(a.getTime()+3600*i*1e3+108e5):a).setHours(0,0,0,0),i=o.dateFrom?moment(o.dateFrom,"YYYY-MM-DD HH:mm:ss").toDate().setHours(0,0,0,0):a,t=o.dateTo?moment(o.dateTo,"YYYY-MM-DD HH:mm:ss").toDate().setHours(23,59,59):((t=new Date).setMonth(a.getMonth()+1),t.setHours(23,59,59)),e.from=!(a<=i)&&i<=a&&a<t?f("date")(a,"yyyy-MM-dd HH:mm:ss"):f("date")(i,"yyyy-MM-dd HH:mm:ss"),e.to=f("date")(t,"yyyy-MM-dd HH:mm:ss"),e}function p(e){return e.replace(" ","")}r&&n.test(r)&&(r=p(r),o.filterSettings.spheres=r.split(/[,&]/).map(function(e){return+e}),o.spheresOperator="",t=r.search(/,/),r=r.search(/&/),-1<t&&-1<r?o.spheresOperator=t<r?"&":"":-1<r&&(o.spheresOperator="&")),o.placeType&&(o.filterSettings.placeTypes=p(o.placeType).split(",").map(function(e){return+e}),o.params.place_type=o.filterSettings.placeTypes.join("|")),o.buttonFromFind=!0,o.page=1,o.today=new Date,o.data=[],o.showFilter=!1,o.full=!1,o.nosphere=!1,o.dateOnly=!1,o.buttonAnimate=!0,o.defaultFilter={},d(o.defaultFilter),o.onFilterApply=function(){o.loading||(o.items=[],o.events=[],c())},o.overImg={src:"%markup_images_dir%"+("main"===o.style?"pt_calendar-lite":"pt")+".png"},o.items=[],o.events=[],o.baseHref||(o.baseHref=m.getLangLink(m.pagePath("afisha","event"))),o.limit=o.limit&&parseInt(o.limit)<10?o.limit:10,c(),o.sortingFromDate=function(e,t){return e.date_from_timestamp>t.date_from_timestamp?-1:e.date_from_timestamp<t.date_from_timestamp?1:e.date_from_timestamp==t.date_from_timestamp?0:void 0},o.checkedFiltersInputSettings=function(){var e={full:function(){o.nosphere=!1,o.dateOnly=!1,o.showFilter=!0},nosphere:function(){o.nosphere=!0,o.dateOnly=!1,o.showFilter=!0,o.filterDisplay="date,eventType,dayTime,area,placeType"},date:function(){o.nosphere=!0,o.dateOnly=!0,o.showFilter=!0,o.filterDisplay="date"}};"function"!=typeof e[o.filter]?o.showFilter=!1:e[o.filter]()},o.filter&&o.checkedFiltersInputSettings(),o.filterSettings.placeTypes&&1==o.filterSettings.placeTypes.length&&(o.filterDisplay&&-1<o.filterDisplay.indexOf("placeType")?o.filterDisplay=o.filterDisplay.split(",").filter(function(e){return"placeType"!==e}).join(","):o.filterDisplay="date,eventType,dayTime,area"),o.clearFilter=function(){function e(){var e=window.navigator.userAgent.toLowerCase();return/trident/gi.test(e)||/msie/gi.test(e)}e()&&angular.element(document).find(".b-dropdown__opener.ng-hide").css({display:"none"}),a.find(".calendar_v1-event").removeClass("calendar_v1-event_active"),o.params=d({}),o.params.page=1,o.cacheCats,g(function(){o.$broadcast("calendarFilter:update")},0),o.defFrom=o.params.from.slice(0,o.params.from.indexOf(" ")),o.defto=o.params.to.slice(0,o.params.to.indexOf(" ")),o.loading||(o.events=[],c()),e()&&setTimeout(function(){angular.element(document).find(".b-dropdown__opener").css({display:"inline-block"})},10)},o.setParams=function(){return o.params.from=o.params.from||o.today,o.params.to=o.params.to||o.today,o.params},o.getMoreData=function(){o.loading||c(!0)}},templateUrl:"mosCalendarLite/mosCalendarLite.tpl.html"}}]).filter("listTitles",[function(){return function(e){var a=e.length,i="",o=",";return angular.forEach(e,function(e,t){a-1==t&&(o=""),i+=e.title+o}),i}}]),angular.module("mosapp.calendar.list.mosCalendarLiteNew",["mosapp.press.categories","mosapp.press.categoriesCheckbox","mosapp.press.category","mosapp.filter.calendar","mosapp.responce.dialog","mosapp.calendar.filter.lite"]).directive("mosCalendarLiteNew",["UrlSrvc","apiSrvc","$timeout","$filter","toolsSrvc","LangSrvc",function(m,u,g,f,e,h){return{scope:{category:"@",sphere:"@",placeType:"@",filterOperator:"@",limit:"@",target:"@",style:"@",dateFrom:"@",dateTo:"@",ids:"@",baseHref:"@",nodate:"@",filter:"@",filterClearOn:"@",newYearFlag:"@",newYearEventTypes:"@",newYearEventDates:"@",displayDate:"@",displayFree:"@",displaySphere:"@",dateColor:"@",titleColor:"@",eventBackgroundColor:"@"},link:function(o,a){var e,i,t,n=/^[\d,&]*$/,r=((o.dateColor||o.titleColor||o.eventBackgroundColor)&&(r="",o.dateColor&&(r+=".calendar-lite-new.main-style .calendar-lite-new__time { color: "+o.dateColor+"!important }"),o.titleColor&&(r+=".calendar-lite-new.main-style .calendar-lite-new__title { color: "+o.titleColor+"!important }"),o.eventBackgroundColor&&(r+=".calendar-lite-new.main-style .calendar-lite-new__item { background-color: "+o.eventBackgroundColor+"!important; } .calendar-lite-new.main-style .calendar-lite-new__textwrapper {padding:8px 16px !important;}"),t=document.head||document.getElementsByTagName("head")[0],(e=document.createElement("style")).type="text/css",e.styleSheet?e.styleSheet.cssText=r:e.appendChild(document.createTextNode(r)),t.appendChild(e)),o.controlsInited=!1,o.startFindPosts=!1,o.lang=h.getCurrentLang(),o.noData="ru"===h.getCurrentLang()?"Событий не найдено":"No events were found",o.queryBlock=!1,o.params={},o.newYearEventTypes&&(i=[],o.newYearEventTypes.split("|").forEach(function(e){var t=e.indexOf(":");-1<t&&i.push(e.slice(0,t))}),o.params.auditory=i.join("|"),""===o.params.auditory&&delete o.params.auditory),o.filterSettings={},o.category&&(o.cacheCats=p(o.category).replace(",","|")),o.sphere&&(o.cacheCats=p(o.sphere).replace(",","|")),o.sphere||o.category);function s(i){var e=i?a.find(".calendar__more-loader"):a.find(".calendar-lite-new__loader-container"),t=function(e){angular.isObject(o.params)||(o.params={});var t,a=angular.copy(o.params);a.filter=a.filter||{},"or"===o.filterOperator?(t={},a.filter["="]=t):"and"===o.filterOperator?(t={},a.filter["&"]=t):t=a.filter;o.filterSettings.spheres&&o.filterSettings.spheres.length&&(t[o.spheresOperator+"spheres.id"]=o.filterSettings.spheres);o.ids&&(a.ids=o.ids);o.filterSettings.placeTypes&&(t["spots.place_type_id"]=o.filterSettings.placeTypes);a.place_type&&(t["spots.place_type_id"]=a.place_type.split("|").map(function(e){return+e}),delete a.place_type);a.auditory&&(t.auditory=a.auditory.split("|").map(function(e){return+e}),delete a.auditory);a.place&&(t["districts.id"]=a.place,delete a.place);o.params.page||(a.page=1);e?a.page++:(a.page=1,o._params={},Object.keys(a).forEach(function(e){a[e]!=undefined&&null!=a[e]&&"all"!=a[e]||delete a[e]}));o.nodate||o.filter&&(!o.filter||a.from||a.to)||(d(o.params),a.from=o.params.from,a.to=o.params.to);a.from&&(a.filter[">=date_to"]=a.from,delete a.from);a.to&&(a.filter["<=date_from"]=a.to,delete a.to);return a.fields="id,title,free,image,date_timestamp,date_from_timestamp,date_to_timestamp",a.expand="spheres",a.filter=JSON.stringify(a.filter),a}(i);return u.getData("newsfeed","afishaBricks",t,!1,{elems:e,loaderType:"plainDots"}).then(function(e){if(e){if(e.items&&e.items.length){e.items=e.items.sort(o.sortingFromDate),o.notFound=!1;for(var t=e.items,a=0;a<t.length;a++)t[a].link=o.baseHref+t[a].id,t[a].occurrence_id&&(t[a].link+="/"+t[a].occurrence_id);o.displayDate&&e.items.forEach(function(e,t){var t=o.items.length+t,a=(e.dateString="",1e3*e.date_from_timestamp),i=1e3*e.date_to_timestamp,a=(new Date(a).toDateString()===new Date(i).toDateString()?e.dateString=f("date")(a,o.displayDate):e.dateString=f("date")(a,o.displayDate)+" - "+f("date")(i,o.displayDate),Math.floor(t/3));e.hasImage=0===a||a%3==0}),i||(o.items=[],o.events=[]),o.items=o.items.concat(e.items)}else o.filter||o.dateTo||o.nodate?i||(o.notFound=!0):(o.nodate=1,o.params.from&&delete o.params.from,o.params.to&&delete o.params.to,s());e._meta&&(o.meta=e._meta,o.page=e._meta.currentPage)}else i||(o.notFound=!0)})}function l(){var e;if(o.items.length>=o.limit?e=o.items.splice(0,o.limit):0<o.items.length&&(e=o.items.splice(0,o.items.length)),!angular.isArray(e))return o.loading=!1,void(o.canBeMore=!1);for(var t=e.length;t--;)e[t].isNew=!0;o.events=o.events.concat(e),g(function(){for(var e=o.events.length;e--;)o.events[e].isNew=!1},50),(0<o.items.length||o.meta&&o.meta.currentPage<o.page.pageCount)&&(o.canBeMore=!0)}function c(e){o.loading=!0,o.canBeMore=!1,o.items.length>o.limit&&!o.mustUpdate&&e?(l(),o.loading=!1):angular.isObject(o.meta)&&o.meta.currentPage<o.meta.pageCount||!o.items.length?s(e).then(function(){l(),o.mustUpdate=!1,o.loading=!1,o.queryBlock=!1}):(l(),o.loading=!1,o.queryBlock=!1)}function d(e){o.newYearFlag&&o.newYearEventDates&&(o.dateFrom=o.newYearEventDates.split("-")[0]+" 00:00:00",o.dateTo=o.newYearEventDates.split("-")[1]+" 23:59:59");var t,a=moment().toDate(),i=a.getTimezoneOffset()/60;return(a=-3!=i?new Date(a.getTime()+3600*i*1e3+108e5):a).setHours(0,0,0,0),i=o.dateFrom?moment(o.dateFrom,"YYYY-MM-DD HH:mm:ss").toDate().setHours(0,0,0,0):a,t=o.dateTo?moment(o.dateTo,"YYYY-MM-DD HH:mm:ss").toDate().setHours(23,59,59):((t=new Date).setMonth(a.getMonth()+1),t.setHours(23,59,59)),e.from=!(a<=i)&&i<=a&&a<t?f("date")(a,"yyyy-MM-dd HH:mm:ss"):f("date")(i,"yyyy-MM-dd HH:mm:ss"),e.to=f("date")(t,"yyyy-MM-dd HH:mm:ss"),e}function p(e){return e.replace(" ","")}r&&n.test(r)&&(r=p(r),o.filterSettings.spheres=r.split(/[,&]/).map(function(e){return+e}),o.spheresOperator="",t=r.search(/,/),r=r.search(/&/),-1<t&&-1<r?o.spheresOperator=t<r?"&":"":-1<r&&(o.spheresOperator="&")),o.placeType&&(o.filterSettings.placeTypes=p(o.placeType).split(",").map(function(e){return+e}),o.params.place_type=o.filterSettings.placeTypes.join("|")),o.buttonFromFind=!0,o.page=1,o.today=new Date,o.data=[],o.showFilter=!1,o.full=!1,o.nosphere=!1,o.dateOnly=!1,o.buttonAnimate=!0,o.defaultFilter={},d(o.defaultFilter),o.onFilterApply=function(){o.loading||(o.items=[],o.events=[],c())},o.overImg={src:"%markup_images_dir%"+("main"===o.style?"pt_calendar-lite":"pt")+".png"},o.items=[],o.events=[],o.baseHref||(o.baseHref=m.getLangLink(m.pagePath("afisha","event"))),o.limit=o.limit&&parseInt(o.limit)<10?o.limit:10,c(),o.sortingFromDate=function(e,t){return e.date_from_timestamp>t.date_from_timestamp?-1:e.date_from_timestamp<t.date_from_timestamp?1:e.date_from_timestamp==t.date_from_timestamp?0:void 0},o.checkedFiltersInputSettings=function(){var e={full:function(){o.nosphere=!1,o.dateOnly=!1,o.showFilter=!0},nosphere:function(){o.nosphere=!0,o.dateOnly=!1,o.showFilter=!0,o.filterDisplay="date,eventType,dayTime,area,placeType"},date:function(){o.nosphere=!0,o.dateOnly=!0,o.showFilter=!0,o.filterDisplay="date"}};"function"!=typeof e[o.filter]?o.showFilter=!1:e[o.filter]()},o.filter&&o.checkedFiltersInputSettings(),o.filterSettings.placeTypes&&1==o.filterSettings.placeTypes.length&&(o.filterDisplay&&-1<o.filterDisplay.indexOf("placeType")?o.filterDisplay=o.filterDisplay.split(",").filter(function(e){return"placeType"!==e}).join(","):o.filterDisplay="date,eventType,dayTime,area"),o.clearFilter=function(){function e(){var e=window.navigator.userAgent.toLowerCase();return/trident/gi.test(e)||/msie/gi.test(e)}e()&&angular.element(document).find(".b-dropdown__opener.ng-hide").css({display:"none"}),a.find(".calendar_v1-event").removeClass("calendar_v1-event_active"),o.params=d({}),o.params.page=1,o.cacheCats,g(function(){o.$broadcast("calendarFilter:update")},0),o.defFrom=o.params.from.slice(0,o.params.from.indexOf(" ")),o.defto=o.params.to.slice(0,o.params.to.indexOf(" ")),o.loading||(o.events=[],c()),e()&&setTimeout(function(){angular.element(document).find(".b-dropdown__opener").css({display:"inline-block"})},10)},o.setParams=function(){return o.params.from=o.params.from||o.today,o.params.to=o.params.to||o.today,o.params},o.getMoreData=function(){o.loading||c(!0)}},templateUrl:"mosCalendarLiteNew/mosCalendarLiteNew.tpl.html"}}]).filter("listTitles",[function(){return function(e){var a=e.length,i="",o=",";return angular.forEach(e,function(e,t){a-1==t&&(o=""),i+=e.title+o}),i}}]),angular.module("mosapp.calendar.list.mosCalendarMonth",[]).directive("mosCalendarMonth",["UrlSrvc","apiSrvc","$timeout","$filter","toolsSrvc","LangSrvc","daterangepickerlibsrvc","mosCalendarMonthEvents","mosCalendarMonthInternational",function(e,t,a,l,n,c,d,p,m){return{scope:{sphere:"@",dateFrom:"@",dateTo:"@",colToday:"@",colCurrent:"@",colEmpty:"@",colBack:"@",colMonth:"@",colDate:"@",colEvtTitle:"@",colEvtLead:"@",colEvtDate:"@",colEvtMore:"@",colEvtBack:"@",colScrollBar:"@",colScrollTrack:"@"},link:function(r,s,i){s.on("$destroy",function(){var e=document.getElementById("style_calendar_month_"+r.time);e.parentNode.removeChild(e),r.$destroy()}),r.lang=c.getCurrentLang(),angular.extend(r,m.words(r.lang)),r.include=[],r.items=[],r.events=[],r.baseHref||(r.baseHref=e.getLangLink(e.pagePath("afisha","event"))),r.time=(new Date).getTime();var o="calendar-month_"+r.time;s[0].className+=" "+o,r.createCSS=function(){var e,t,a="";i.colToday&&(a=(a+="."+o+" .date-picker-wrapper .real-today { background-color: "+r.colToday+"!important }")+"."+o+" .date-picker-today:before {background-color: "+r.colToday+"!important}"),i.colCurrent&&(a=(a+="."+o+" .date-picker-wrapper .first-date-selected { background-color: "+r.colCurrent+"!important }")+"."+o+" .date-picker-active:before { background-color: "+r.colCurrent+"!important }"),i.colEmpty&&(a=(a+="."+o+" .date-picker-wrapper .invalid{ background-color: "+r.colEmpty+"!important }")+"."+o+" .date-picker-invalid:before { background-color: "+r.colEmpty+"!important }"),i.colBack&&(a=(a+="."+o+" { background-color: "+r.colBack+"!important }")+"."+o+" .date-picker-wrapper .caption .next,  ."+o+" .date-picker-wrapper .caption .prev {color:"+r.colBack+"!important}"),i.colMonth&&(a=(a+="."+o+" .date-picker-wrapper .caption .month-name { color: "+r.colMonth+"!important }")+"."+o+" .date-picker-wrapper .caption .next:after, ."+o+" .date-picker-wrapper .caption .prev:before { border-color: "+r.colMonth+"!important }"),i.colDate&&(a+="."+o+" .calendar-month__item { background-color: "+r.colDate+"!important }"),i.colEvtTitle&&(a+="."+o+" .calendar-month__title { color: "+r.colEvtTitle+"!important }"),i.colEvtLead&&(a+="."+o+" .calendar-month__text { color: "+r.colEvtLead+"!important }"),i.colEvtDate&&(a+="."+o+" .calendar-month__place, ."+o+" .calendar-month__time { color: "+r.colEvtDate+"!important }"),i.colEvtMore&&(a+="."+o+" .calendar-month__more { color: "+r.colEvtMore+"!important }"),i.colEvtBack&&(a+="."+o+" .calendar-month__item { color: "+r.colEvtBack+"!important }"),i.colScrollBar&&(a+="."+o+" .customScrollbar .mCSB_scrollTools .mCSB_dragger .mCSB_dragger_bar, ."+o+" .customScrollbar .mCSB_scrollTools .mCSB_dragger.mCSB_dragger_onDrag .mCSB_dragger_bar, ."+o+" .customScrollbar .mCSB_scrollTools .mCSB_dragger:active .mCSB_dragger_bar, ."+o+" .customScrollbar .mCSB_scrollTools .mCSB_dragger:hover .mCSB_dragger_bar { background-color: "+r.colScrollBar+"!important }"),i.colScrollTrack&&(a+="."+o+" .customScrollbar .mCSB_scrollTools .mCSB_draggerRail { background-color: "+r.colScrollTrack+"!important }"),""!==a&&(e=document.head||document.getElementsByTagName("head")[0],(t=document.createElement("style")).type="text/css",t.id="style_calendar_month_"+r.time,t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),e.appendChild(t))},r.scrollUp=function(){var e=angular.element(s[0].parentNode).offset();TweenLite.to(window,.75,{scrollTo:{y:e.top},onComplete:function(){}})},r.isEqualDate=function(e,t,a){a=a.setHours(23,59,59),e=e.setHours(0,0,0),t=t.setHours(23,59,59);return e<=a&&a<=t},r.cleanUpView=function(){r.currentDateView="",r.events=[],r.noEvents=!1},r.prepareViewModel=function(t){r.noEvents=!1,t=new Date(t.valueOf())||r.today,r.currentDateView=moment(t).format("D MMMM"),r.events=[],r.events=r.items.filter(function(e){return r.isEqualDate(new Date(1e3*e.date_from_timestamp),new Date(1e3*e.date_to_timestamp),t)}),r.events.length||(r.noEvents=!0),s.find(".mCustomScrollbar").mCustomScrollbar("scrollTo",0)},r.generateFillOut=function(){r.filloutobj=[];for(var e=0;e<r.days;e++){var t={busy:!1,start_timestamp:new Date(r.year,r.month,e+1,0,0,0).getTime()/1e3,end_timestamp:new Date(r.year,r.month,e+1,23,59,59).getTime()/1e3};r.filloutobj.push(t),r.filloutobj[e].start=new Date(1e3*r.filloutobj[e].start_timestamp)}},r.fillBusyDays=function(){e:for(var e=0;e<r.items.length;e++)for(var t=r.items[e],a=0,i=0;i<r.filloutobj.length;i++){var o=r.filloutobj[i];if(!o.busy&&o.start_timestamp<t.date_to_timestamp&&o.end_timestamp>t.date_from_timestamp&&(o.busy=!0),o.busy&&a++,a>=r.filloutobj.length)break e}},r.fillInclude=function(){r.include=[];for(var e=0;e<r.filloutobj.length;e++)r.filloutobj[e].busy&&r.include.push(e+1)},r.trimByWords=function(e,t){var a="";return e=$.trim(e),(a=l("limitTo")(e,t,0)).length<e.length&&(-1<(t=a.lastIndexOf(" "))&&(a=a.substring(0,t)),a+="&hellip;"),a},r.normalizeEvents=function(){for(var e=0;e<r.items.length;e++){var t=r.items[e];t.title=r.trimByWords(t.title,57),t.html=r.trimByWords(n.htmlToPlaintext(t.text),160),t.link=r.baseHref+t.id,t.occurrence_id&&(t.link+="/"+t.occurrence_id)}},r.cache={},r.loadEvents=function(t){var e,a,i,o={sphere_id:r.sphere,fields:"id,title,date,date_timestamp,date_from_timestamp,date_to_timestamp,text",expand:"spots",page:1,"per-page":50},n=(e=o,a=new Date,(a=-3!=(i=a.getTimezoneOffset()/60)?new Date(a.getTime()+3600*i*1e3+108e5):a).setHours(0,0,0,0),r.dateFrom?r.dateFrom=new Date(r.dateFrom).setHours(0,0,0,0):r.dateFrom=new Date((new Date).setDate(1)).setHours(0,0,0,0),r.dateTo?r.dateTo=new Date(r.dateTo).setHours(23,59,59,0):r.dateTo=new Date((new Date).setDate(r.days)).setHours(23,59,59,0),e.from=l("date")(r.dateFrom,"yyyy-MM-dd HH:mm:ss"),e.to=l("date")(r.dateTo,"yyyy-MM-dd HH:mm:ss"),e.filter||(e.filter={}),e.from&&(e.filter[">=date_to"]=e.from,delete e.from),e.to&&(e.filter["<=date_from"]=e.to,delete e.to),r.dateFrom);r.cache[n]?(r.items=JSON.parse(r.cache[n]),r.fillBusyDays(),r.fillInclude(),r.prepareViewModel(moment(r.currentDate).date(r.include[0])),r.setPicker(r.currentDate)):p.get(o,angular.element(s).find(".calendar-month__loader-container")).then(function(e){r.items=e,r.items.length?(r.normalizeEvents(),r.fillBusyDays(),r.fillInclude(),t?r.prepareViewModel(moment(r.currentDate).date(r.include[0])):r.prepareViewModel(r.today),r.setPicker(r.currentDate),r.cache[n]=JSON.stringify(r.items)):r.noEvents=!0})},r.setPicker=function(e){e=void 0===e?r.today:new Date(e.valueOf());var t=s.find(".dates");t.data("dateRangePicker")&&t.data("dateRangePicker").destroy(),r.datepicker=t.dateRangePicker({defaultTime:e,inline:!0,container:t,alwaysOpen:!0,singleDate:!0,singleMonth:!0,showTopbar:!1,language:r.lang,showShortcuts:!1,startOfWeek:"monday",beforeShowDay:function(e){var t=!(e.getDay()<7);return[t=-1<r.include.indexOf(e.getDate())&&e.getMonth()==r.month&&e.getFullYear()==r.year?1:t]}}),t.data("dateRangePicker")&&(e=moment(e).format("YYYY-MM-DD"),t.data("dateRangePicker").setDateRange(e,e)),r.datepicker.unbind("datepicker-change").bind("datepicker-change",function(e,t){r.prepareViewModel(t.date1)}),r.datepicker.unbind("datepicker-month-change").bind("datepicker-month-change",function(e,t){r.monthChangeBind(t)})},r.monthChangeBind=function(e){var e=e.monthNew,t=moment(e).month(),a=1;t<r.month&&(a=moment(e).daysInMonth()),moment(r.today).month()==t&&moment(r.today).year()==moment(e).year()?r.setCurrents(moment(r.today)):r.setCurrents(moment(e).date(a)),r.reinit()},r.initDatepicker=function(){d.load({}).then(function(){r.loadEvents(),r.setPicker()})},r.setCurrents=function(e){r.today=new Date,e=e||r.today,r.month=moment(e).month(),r.year=moment(e).year(),r.days=moment(e).daysInMonth(),r.currentDate=r.currentDate?moment(e):moment(r.today),r.dateFrom=moment({years:r.year,months:r.month,days:1}),r.dateTo=moment({years:r.year,months:r.month,days:r.days})},r.reinit=function(){r.cleanUpView(),r.generateFillOut(),r.loadEvents(!0)},r.init=function(){r.createCSS(),r.setCurrents(),r.generateFillOut(),r.initDatepicker(r.today)},r.init()},templateUrl:"mosCalendarMonth/mosCalendarMonth.tpl.html"}}]).service("mosCalendarMonthEvents",["UrlSrvc","apiSrvc","$q",function(e,a,i){this.get=function(e,t){return i(function(r){var s=[];!function i(o,n){if((o=angular.isObject(o)?o:{}).sphere_id){o.filter=o.filter||{};try{o.filter["spheres.id"]=JSON.parse("["+o.sphere_id+"]"),delete o.sphere_id}catch(e){}}o.page=isNaN(o.page)?1:o.page,a.getData("newsfeed","afishaBricks",o,!1,n).then(function(e){if(e&&angular.isArray(e.items)){for(var t,a=0;a<e.items.length;a++)Array.isArray(e.items[a].spots)&&(t=e.items[a].spots.map(function(e){return e.title})).length&&(e.items[a].place=t.join(", "));s=s.concat(e.items),angular.isObject(e._meta)&&e._meta.pageCount>e._meta.currentPage?(o.page=e._meta.currentPage+1,i(o,n)):r(s)}},function(){r(s)})}(e,t)})}}]).service("mosCalendarMonthInternational",[function(){return{words:function(e){var t={};t="en"===e?{noData:"No events were found",moreData:"More",toDay:"Today",currentDay:"Current day",disablDay:"No events",upScroll:"Calendar"}:{noData:"По вашему запросу событий не найдено.",moreData:"Подробнее",toDay:"Текущий день",currentDay:"Выбранный день",disablDay:"Нет мероприятий",upScroll:"К календарю"};return t}}}]).service("daterangepickerlibsrvc",["UrlSrvc","$q","$rootScope",function(a,e,i){this.load=function(){return e(function(e){var t;i.daterangepickerlib?"ready"!==i.daterangepickerlib.status?(t=document.getElementById("daterangepickerlibapiscript"),$(t).on("load",function(){e()})):e():(i.daterangepickerlib={},i.daterangepickerlib.status="load",(t=document.createElement("script")).id="daterangepickerlibapiscript",t.async="true",document.getElementsByTagName("head")[0].appendChild(t),t.src=a.jsPath("jquery.daterangepicker.min.js"),$(t).on("load",function(){i.daterangepickerlib.status="ready",e()}))})}}]),angular.module("mosapp.news.list.mosNewsLite",["mosapp.filters.prepareDateSince"]).directive("mosNewsLite",["UrlSrvc","apiSrvc","$timeout","$filter",function(e,o,r,s){return{scope:{category:"@",sphere:"@",limit:"@",target:"@",style:"@",dateFrom:"@",dateTo:"@"},link:function(n,a,i){n.overImg={src:"%markup_images_dir%"+("main"===n.style?"pt_calendar-lite":"pt")+".png"},n.isRemoveDates=!1,n.items=[],n.posts=[],n.baseHref=e.getLangLink(e.pagePath("pulse","item")).replace(/\/$/,""),n.limit=n.limit||4,n.setDateParams=function(){var e=new Date,t=e.getTimezoneOffset()/60;(e=-3!=t?new Date(e.getTime()+3600*t*1e3+108e5):e).setHours(0,0,0,0),n.dateFrom?n.dateFrom=new Date(n.dateFrom).setHours(0,0,0,0):n.dateFrom=e,n.dateTo?n.dateTo=new Date(n.dateTo).setHours(23,59,59,99):n.dateTo=(new Date).setDate(e.getDate()+7),e<=n.dateFrom&&e<n.dateTo?(n.params.from=s("date")(n.dateFrom,"yyyy-MM-dd HH:mm:ss"),n.params.to=s("date")(n.dateTo,"yyyy-MM-dd HH:mm:ss")):n.dateFrom<=e&&i.dateTo&&e<n.dateTo?(n.params.from=s("date")(e,"yyyy-MM-dd HH:mm:ss"),n.params.to=s("date")(n.dateTo,"yyyy-MM-dd HH:mm:ss")):(i.dateFrom&&(n.params.from=s("date")(n.dateFrom,"yyyy-MM-dd HH:mm:ss")),i.dateTo&&(n.params.to=s("date")(n.dateTo,"yyyy-MM-dd HH:mm:ss")))},n.loadNews=function(){var e,t=a.find(".news__more-loader");return angular.isObject(n.params)||(n.params={}),n.category&&(e=parseInt(n.category.trim()),isNaN(e)||(n.params.filter=n.params.filter||{},n.params.filter["spheres.id"]=[e])),n.sphere&&(e=parseInt(n.sphere.trim()),isNaN(e)||(n.params.filter=n.params.filter||{},n.params.filter["spheres.id"]=[e])),n.page&&(n.params.page=n.page+1),!i.dateFrom&&!i.dateTo||n.isRemoveDates||n.setDateParams(),n.params.fields="id,title,image,sphere,date_timestamp",o.getData("newsfeed","newsMinor",n.params,!1,{elems:t,loaderType:"plainDots"}).then(function(e){e&&(n.page||!n.params.from&&!n.params.to||!Array.isArray(e.items)||e.items.length||n.isRemoveDates?n.dataHandler(e):(n.isRemoveDates=!0,delete n.params.from,delete n.params.to,n.loadNews()))})},n.dataHandler=function(e){if(e.items){n.items=n.items.concat(e.items);for(var t=n.posts.length,a=0,i=n.items.length;a<i;a++){var o=Math.floor((t+a)/3);n.items[a].withImage=0===o||o%3==0}}e._meta&&(n.meta=e._meta,n.page=e._meta.currentPage),n.updateList(),n.loading=!1},n.updateList=function(){n.items.length>=n.limit?e=n.items.splice(0,n.limit):0<n.items.length&&(e=n.items.splice(0,n.items.length));for(var e,t=e.length;t--;)e[t].isNew=!0;n.posts=n.posts.concat(e),r(function(){for(var e=n.posts.length;e--;)n.posts[e].isNew=!1},50),(0<n.items.length||n.meta&&n.meta.currentPage<n.page.pageCount)&&(n.canBeMore=!0)},n.newsList=function(){n.loading=!0,n.canBeMore=!1,!(n.items.length>n.limit)&&(angular.isObject(n.meta)&&n.meta.currentPage<n.meta.pageCount||!n.items.length)?n.loadNews():(n.updateList(),n.loading=!1)},n.newsList(),n.getMoreData=function(){n.newsList()}},templateUrl:"mosNewsLite/mosNewsLite.tpl.html"}}]),angular.module("mosapp.calendar.list.mosInteractiveSchedule",[]).directive("mosInteractiveSchedule",["UrlSrvc","apiSrvc","$timeout","loader","$filter","LangSrvc",function(_,b,w,M,k,S){return{scope:{category:"@",spheres:"@",dateFrom:"@",dateTo:"@",baseHref:"@",height:"@"},link:function(d,p,e){var t,m=183*d.height,a=(d.lang=S.getCurrentLang(),d.baseHref||(d.baseHref=_.getLangLink(_.pagePath("afisha","event"))),d.height=+d.height?+d.height:3,d.spheres=d.category&&!d.spheres?d.category:d.spheres,d.spheres.replace(/\s+/g,"").split(",")),u=(a.splice(3),[]),g=a.map(function(e){return{id:e}}),f=[],i=angular.element(window);d.schedule=[],n(),M.switchOn(p);for(var o=0;o<g.length;o++)r(g[o]);function n(){i.width()<1024?d.breakpoint||(d.breakpoint=!0,u.length&&(s(),w(function(){y()},0))):d.breakpoint&&(d.breakpoint=!1,u.length&&(s(),w(function(){y()},0)))}function r(i,e,t){i.loading=!0;var a,o,n,r,s,l,c={page:i.meta?i.meta.currentPage+1:1,"per-page":2,fields:"id,title,date_timestamp,date_from_timestamp,date_to_timestamp",sort:"date_to,-date_from",expand:"spheres",filter:{"spheres.id":i.id}};a=c,o=new Date,(o=-3!=(n=o.getTimezoneOffset()/60)?new Date(o.getTime()+3600*n*1e3+108e5):o).setHours(0,0,0,0),d.dateFrom?d.dateFrom=new Date(d.dateFrom).setHours(0,0,0,0):d.dateFrom=o,d.dateTo?d.dateTo=new Date(d.dateTo).setHours(23,59,59,0):d.dateTo=(new Date).setMonth(o.getMonth()+1),o=(n=!(o<=d.dateFrom)&&d.dateFrom<=o&&o<d.dateTo?k("date")(o,"yyyy-MM-dd HH:mm:ss"):k("date")(d.dateFrom,"yyyy-MM-dd HH:mm:ss"),k("date")(d.dateTo,"yyyy-MM-dd HH:mm:ss")),a.filter||(a.filter={}),a.filter["<=date_from"]=o,a.filter[">=date_to"]=n,c=a,b.getData("newsfeed","afishaBricks",c,!1).then(function(e){if(e&&e.items&&e.items.length){e.items=e.items.map(function(e){var t=(t=e.spheres.filter(function(e){return e.id==i.id})).length?t[0]:{};return{id:e.id,title:e.title,source_url:e.source_url,date:(e.date_timestamp,e.date_from_timestamp,k("date")(1e3*e.date_from_timestamp,"yyyy-MM-dd HH:mm:ss")),date_from_timestamp:e.date_from_timestamp,sphere:t}}),i.title=e.items[0].sphere?e.items[0].sphere.title:"";for(var t=e.items,a=0;a<t.length;a++)t[a].link=(d.baseHref||"/afisha/event")+"/"+t[a].id,t[a].occurrence_id&&(t[a].link+="/"+t[a].occurrence_id);i.items=e.items,d.events=e.items,i.meta=e._meta}}).finally((r=i,s=e,l=t,function(){for(var e=r.loading=!1,t=0;t<g.length;t++)g[t].loading&&(e=!0);if(!e){if(!f.length)for(t=0;t<g.length;t++)g[t].items?f.push([]):(g.splice(t,t+1),t-=1);u.push(angular.copy(g)),h(g),M.switchOff(s||p),w(function(){var e=angular.element(document.querySelector(".schedule-table"));e.height()>m?angular.element(".mos-i-schedule__schedule").height(m):angular.element(".mos-i-schedule__schedule").height(e.height()),w(function(){var e;e=document.querySelector(".mos-i-schedule__content"),$(e).mCustomScrollbar({callbacks:{whileScrolling:function(){99<this.mcs.topPct?d.scrollDown=!0:d.scrollDown=!1}}})},0)},0),w(function(){y()},0)}}))}function h(e){var t=[],a=!1;if(d.colWidth=0,d.breakpoint){d.colWidth=1;for(i=0;i<e.length;i++)if((o=e[i]).items){c(o.items),v(o.items);for(n=0;n<o.items.length;n++)o.items[n].sphereIdx=i,t.push(o.items[n]);o.meta&&o.meta.currentPage<o.meta.pageCount&&(a=!0)}c(t)}else for(var i=0;i<e.length;i++){var o=e[i];if(d.colWidth++,o.items){c(o.items),v(o.items);for(var n=0;n<o.items.length;n++){o.items[n].sphereIdx=i;var r,s=new Date(1e3*o.items[n].date_from_timestamp);!function(e,t){for(var a=0;a<e.length;a++)if(l(e[a].date,t))return 1}(t,s)?((r=angular.copy(f))[i].index=i,r[i].push(o.items[n]),(r=r).date=s,t.push(r)):((r=t.filter(function(e){return l(e.date,s)})[0])[i].index=i,r[i].push(o.items[n]))}o.meta&&o.meta.currentPage<o.meta.pageCount&&(a=!0)}}d.isExistMore=a,t.sort(function(e,t){return e.date>t.date?1:e.date<t.date?-1:0}),d.colWidth=12/d.colWidth,d.spheresView=e,d.schedule=d.schedule.concat(t)}function s(){d.schedule.splice(0);for(var e=0;e<u.length;e++)h(u[e])}function l(e,t){if(e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear())return!0}function c(e){e.sort(function(e,t){e=new Date(1e3*e.date_from_timestamp),t=new Date(1e3*t.date_from_timestamp);return t<e?1:e<t?-1:0})}function v(e){for(var t,a,i,o=["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],n=["Sunday","Monday","Tuesday","Wednesday","Thursday","\tFriday","\tSaturday"],r=0;r<e.length;r++)e[r].date_from_timestamp&&(a=(a=(t=new Date(1e3*e[r].date_from_timestamp)).getHours())<10?"0"+a:a,i=(i=t.getMinutes())<10?"0"+i:i,e[r].timeString=a+":"+i,e[r].weekDay=("en"===d.lang?n:o)[t.getDay()])}function y(){var e=document.querySelector(".mos-i-schedule__content"),t=document.querySelector(".schedule-table"),e=e.getBoundingClientRect();t.getBoundingClientRect().bottom-e.bottom<5?d.scrollDown=!0:d.scrollDown=!1}d.isExistMore=!0,d.getMore=function(){!function(){for(var e=0;e<g.length;e++)g[e].items&&delete g[e].items}();var e=document.querySelector(".mos-i-schedule__arrow-container_get-more");M.switchOn(e);for(var t=0;t<g.length;t++)g[t].meta.currentPage<g[t].meta.pageCount&&r(g[t],e,!0)},d.scrollToTop=function(){$(document.querySelector(".mos-i-schedule__content")).mCustomScrollbar("scrollTo","+="+m)},d.scrollToBottom=function(){$(document.querySelector(".mos-i-schedule__content")).mCustomScrollbar("scrollTo","-="+m)},i.on("resize",function(){w.cancel(t),t=w(n,50)})},templateUrl:"mosInteractiveSchedule/mosInteractiveSchedule.tpl.html"}}]),angular.module("mosapp.press.categories",[]).directive("mosPressCategories",["UrlSrvc","LangSrvc",function(e,o){return{restrict:"A",replace:!0,link:function(a,e,i,t){a.$watch("categories",function(e){for(var t in a.lang=o.getCurrentLang(),"en"==a.lang?a.allTitle="All":a.title="Все",a.categories)a.categories[t].preTitle="en"==a.lang?"News: ":"Новости: ";if(angular.isArray(e)&&!a.hideEmptyValue&&e[0]&&""!==e[0].id){e={id:"",title:i.placeholder||a.allTitle};a.categories.unshift(e);for(t=0;t<a.categories.length;t++){if(a.categories[t].id===a.category.id){a.category.title||(a.category=a.categories[0]);break}t!==a.categories.length-1||a.categories[t].active||(a.category=a.categories[0])}}}),a.$watch("category",function(e,t){!e||!e.hasOwnProperty("id")||a.categories&&!a.categories.length||t&&e.id===t.id||(""===e.id&&(a.category=a.categories[0]),a.changeCategory(e.id))}),a.changeCategory=function(e){a.catid=e,i.onCategoryChange&&a.catid!==a.category.id&&a.onCategoryChange({catid:e})}},scope:{categories:"=",category:"=",onCategoryChange:"&",hideEmptyValue:"=",h1:"="},templateUrl:e.tmplPath("pressCategories/pressCategories.tpl.html")}}]),angular.module("mgcrea.ngStrap.dropdown").run(["$templateCache",function(e){e.put("dropdown/dropdown.press.categories.tpl.html",'<div tabindex="-1" class="dropdown-menu customScrollbar" role="menu"><div role="presentation" ng-repeat="item in content" data-ng-class="{active: category.id==item.id}"><a role="menuitem" tabindex="-1" href="" ng-click="$hide();changeCategory(item.id);" ng-bind="item.title"></a></div></div>')}]),angular.module("mosapp.press.category",[]).directive("mosPressCategory",["UrlSrvc",function(e){return{restrict:"A",link:function(){},scope:{items:"=",section:"@",sectionCategory:"@",sectionStory:"@",settings:"=",getMoreBricks:"&",getNextPageUrl:"=",morebutton:"=",notfound:"="},templateUrl:e.tmplPath("pressCategory/pressCategory.tpl.html")}}]),angular.module("mosapp.press.categoriesCheckbox",[]).directive("mosPressCategoriesCheckbox",["UrlSrvc","LangSrvc",function(e,o){return{restrict:"A",replace:!0,link:function(a,e,i,t){a.lang=o.getCurrentLang(),"en"==a.lang?a.allTitle="All":a.title="Все",a.$watch("categories",function(e){if(angular.isArray(e)&&!a.hideEmptyValue&&e[0]&&""!==e[0].id){e={id:"",title:i.placeholder||a.allTitle};a.categories.unshift(e);for(var t=0;t<a.categories.length;t++){if(a.categories[t].id===a.category.id){a.category.title||(a.category=a.categories[0]);break}t!==a.categories.length-1||a.categories[t].active||(a.category=a.categories[0])}}}),a.changeCategory=function(e){a.catid=e,i.onCategoryChange&&a.catid!==a.category.id&&a.onCategoryChange({catid:e})}},scope:{categories:"=",category:"=",onCategoryChange:"&",hideEmptyValue:"="},templateUrl:e.tmplPath("pressCategoriesCheckbox/pressCategoriesCheckbox.tpl.html")}}]).directive("mosPressCategoriesCheckboxLabel",["UrlSrvc","$http","$templateCache","$compile","$timeout","$window","toolsSrvc",function(i,o,n,s,l,c,d){return{restrict:"A",replace:!0,scope:{categories:"=",category:"=",placeholder:"@",onCategoryChange:"&",resetTitle:"@"},templateUrl:i.tmplPath("pressCategoriesCheckbox/pressCategoriesCheckboxLabel.tpl.html"),link:function(r,a,e,t){r.$watch(function(){return d.colorScheme()},function(e){r.colorScheme=e}),r.resetTitle&&(r.$watch("category",function(e){var t=[];1<e.length&&(e.forEach(function(e){e.title!=r.placeholder&&t.push(e)}),r.category=t)},!0),r.$watch("categories",function(e){angular.isArray(e)&&e.length&&e[0].title!=r.placeholder&&r.categories.unshift({id:"",title:r.placeholder})},!0)),angular.element(c).on("click",function(e){var t=$(e.target),e=0<a.find(e.target).length;a.hasClass("open")?t.closest(".dropdown-menu")&&e&&!t.hasClass("b-dropdown__opener")&&!t.hasClass("ico")||(a.find(".dropdown-menu-label").addClass("dropdown-menu-label__opacity0"),l(function(){a.removeClass("open"),a.find(".dropdown-menu").remove()},500)):e&&(a.addClass("open"),o.get(i.tmplPath("dropdown/dropdown.press.categoriesCheckboxLabel.tpl.html"),{cache:n}).then(function(e){r.content=angular.copy(r.categories);var t=s(e.data)(r);a.append(t),r.$applyAsync(function(){a.find(t).removeClass("dropdown-menu-label__opacity0")})}))});r.changeCategory=function(a){r.resetTitle&&(r.setAll=r.category.some(function(e){return e.title==r.placeholder}),a&&a.title==r.placeholder&&!r.setAll&&(r.category.forEach(function(e,t){e.title!=r.placeholder&&r.changeCategory(e)}),r.categories.forEach(function(e){try{e.title==r.category[0].title&&r.changeCategory(e)}catch(e){}})),a&&a.title!=r.placeholder&&r.setAll&&r.changeCategory(r.categories[0]));var i,o,n,e=angular.copy(r.category);e.length?(i=!0,angular.forEach(e,function(e,t){a.id==e.id&&(i=!1)}),i?r.category.push(a):r.category.splice((e=r.category,o=a,n=null,angular.forEach(e,function(e,t){o.id==e.id&&(n=t)}),n),1)):r.category.push(a),r.onCategoryChange(r.category)},r.isActive=function(a){var i=!1;return angular.forEach(r.category,function(e,t){a.id==e.id&&(i=!0)}),!!i},r.getTitle=function(e,t){return t}}}}]).filter("listTitles",[function(){return function(e){var a=e.length,i="",o=",";return angular.forEach(e,function(e,t){a-1==t&&(o=""),i+=e.title+o}),i}}]),angular.module("mgcrea.ngStrap.dropdown").run(["$templateCache",function(e){e.put("dropdown/dropdown.press.categoriesCheckbox.tpl.html",'<div tabindex="-1" class="dropdown-menu customScrollbar" role="menu"> <label ng-repeat="item in content" class="b-dropdown-checkbox__label"> <input type="checkbox" class="b-dropdown-checkbox__input" value="{{item.id}}"> {{item.title}} </label> </div>'),e.put("dropdown/dropdown.press.categoriesCheckboxLabel.tpl.html",'<div tabindex="-1" class="dropdown-menu dropdown-menu-label  dropdown-menu-label__opacity0 customScrollbar" role="menu"> <label ng-repeat="item in content" class="b-dropdown-checkbox__label" data-ng-class="{\'grayscale\':colorScheme==\'contrast\', \'active\':isActive(item)}" data-ng-click="changeCategory(item)">{{item.title}} </label></div>')}]),angular.module("mosapp.filter.calendar",[]).directive("filterCalendar",["UrlSrvc","toolsSrvc","daterangepickerlibsrvc","$timeout",function(e,s,l,c){return{restrict:"A",link:function(i,o,n,e){var t=angular.element(document).find(".filter-news .b-filter__calendar .calendar-inner .icon");function a(){var e,t;i.datepicker&&(e=i.fromDate?moment(s.ruStrToDate(i.fromDate)).format("DD MMMM YYYY").toString():undefined,t=i.untilDate?moment(s.ruStrToDate(i.untilDate)).format("DD MMMM YYYY").toString():undefined,e&&t?i.datepicker.data("dateRangePicker").setDateRange(e,t):i.datepicker.data("dateRangePicker").clear())}i.placeholder=n.placeholder||"Выберите диапазон дат",i.$watch(function(){return s.colorScheme()},function(e){e="contrast"===e?"2px;":"12px;";Function("/*@cc_on return document.documentMode===10@*/")()&&t.attr("style","background-position: right -35px top "+e),document.body.style.msTextCombineHorizontal!==undefined&&t.attr("style","background-position: right -35px top "+e)}),i.watchEnable&&(i.$watch("fromDate",function(){a()}),i.$watch("untilDate",function(e){a()}));var r=!(i.datepicker=null);l.load({}).then(function(e){i.clearDatepicker=function(){i.datepicker&&c(function(){i.silentSet=!0,i.applyNewRange(null,null),i.datepicker.data("dateRangePicker").clear(),c(function(){i.silentSet=!1},100)},50)},i.$on("$stateChangeStart",function(){var e;i.datepicker&&(e=$(i.datepicker[0]).data("dateRangePicker")).length&&e.destroy()}),i.$on("$stateChangeSuccess",function(){var e;i.datepicker&&i.datepicker.data("dateRangePicker")&&c(function(){i.silentSet=!0;var e=i.fromDate?moment(s.ruStrToDate(i.fromDate)).format("DD MMMM YYYY").toString():undefined,t=i.untilDate?moment(s.ruStrToDate(i.untilDate)).format("DD MMMM YYYY").toString():undefined;if(e&&t)try{i.datepicker.data("dateRangePicker").setDateRange(e,t)}catch(e){}else try{i.datepicker.data("dateRangePicker").clear()}catch(e){}c(function(){i.silentSet=!1},100)},50),i.datepicker&&i.datepicker.data("dateRangePicker")&&(e=i.datepicker.data("dateRangePicker"),r?o.hasClass("js-daterange-input")&&(e.open(),r=!1):(e.close(),r=!0))}),c(function(){var t,e=o.find("input.js-daterange-input"),a=(i.datepicker=e.dateRangePicker({format:"D MMMM YYYY",separator:" — ",language:"ru",startOfWeek:"monday",startDate:!!i.dateDiffs&&moment(i.dateDiffs.split("-")[0],"YYYY.MM.DD HH:mm:ss").format("D MMMM YYYY"),endDate:!!i.dateDiffs&&moment(i.dateDiffs.split("-")[1],"YYYY.MM.DD HH:mm:ss").format("D MMMM YYYY"),container:e.parent(),setValue:function(e){$(this).is(":disabled")||e==$(this).val()||$(this).val(e)},showShortcuts:!1,autoClose:!0}),i.datepicker.unbind("datepicker-closed").bind("datepicker-closed",function(){var e=document.querySelector('meta[name="viewport"]');e&&(e.content="width=device-width"),t&&t()}),i.datepicker.unbind("datepicker-open").bind("datepicker-open",function(){var e=document.querySelector('meta[name="viewport"]');e&&(e.content="width=device-width, initial-scale=1, user-scalable=no"),t=i.$watchCollection(function(){for(var e=$(".month-wrapper table"),t=[],a=0;a<e.length;a++){var i=$(e[a]).find("tr:last-child td:first-child>div")[0];t.push(i)}return t},function(e){for(var t=0;t<e.length;t++){var a=angular.element(e[t]);a.hasClass("nextMonth")&&a.parent().parent().remove()}})}),!1);i.datepicker.unbind("datepicker-change").bind("datepicker-change",function(e,t){n.applyNewRange&&(a&&c.cancel(a),a=c(function(){i.silentSet||i.applyNewRange({fromDate:t.date1,untilDate:t.date2}),a=!1},50))}),c(function(){i.silentSet=!0;var e=i.fromDate?moment(s.ruStrToDate(i.fromDate)).format("DD MMMM YYYY").toString():undefined,t=i.untilDate?moment(s.ruStrToDate(i.untilDate)).format("DD MMMM YYYY").toString():undefined;e&&t?i.datepicker.data("dateRangePicker").setDateRange(e,t):i.datepicker.data("dateRangePicker").clear(),c(function(){i.silentSet=!1},100)},50)},200);var t=device&&device.tablet()?"touchstart.closedatepicker":"click.closedatepicker";$("body").on(t,function(e){var t;i.datepicker&&i.datepicker.data("dateRangePicker")&&(t=i.datepicker.data("dateRangePicker"),r?$(e.target).hasClass("js-daterange-input")&&(t.open(),r=!1):$(e.target).closest(".dates").hasClass("dates")||(t.close(),r=!0))})},function(e){})},templateUrl:e.tmplPath("filterCalendar/filterCalendar.tpl.html"),scope:{fromDate:"@",untilDate:"@",applyNewRange:"&",clearDatepicker:"&",icon:"=",uniqId:"=",watchEnable:"@",dateDiffs:"@"}}}]).service("testDate",[function(){this.retDate=function(e){var t,a,i,o,n=null;return angular.isString(e)&&(i=e.split(".")).length&&(t=+i[2],a=+i[1]-1,i=+i[0],n=new Date(t,a,i),o=Date.parse(n),(n=!(isNaN(o)||o<0)&&n)&&n.getUTCDate()===i&&n.getUTCMonth()===a&&n.getUTCFullYear()===t&&(n=!0)),n?e:null}}]).service("daterangepickerlibsrvc",["UrlSrvc","$q","$rootScope","$window",function(i,t,o,e){this.load=function(e){return t(function(e,t){var a;o.daterangepickerlib?"ready"!==o.daterangepickerlib.status?(a=document.getElementById("daterangepickerlibapiscript"),$(a).on("load",function(){e()})):e():(o.daterangepickerlib={},o.daterangepickerlib.status="load",(a=document.createElement("script")).id="daterangepickerlibapiscript",a.async="true",document.getElementsByTagName("head")[0].appendChild(a),a.src=i.jsPath("jquery.daterangepicker.min.js"),$(a).on("load",function(){o.daterangepickerlib.status="ready",e()}))})}}]),angular.module("mosapp.responce.dialog",[]).directive("responceDialog",["UrlSrvc","apiSrvc","$stateParams","$state",function(e,t,a,i){return{restrict:"A",scope:{notFound:"="},link:function(e,t,a){e.title=a.title},templateUrl:"responceDialog/responceDialog.tpl.html"}}]),angular.module("mosapp.parallax",[]).directive("mosParallax",["UrlSrvc","libsLoader",function(e,o){return{restrict:"A",scope:{height:"@"},transclude:!0,link:function(e,t,a){function i(){void 0===t.parallax()&&setTimeout(i,300)}o.get({js:"jquery.parallax.js",id:"jquery.parallax.js",api:"Parallax"}),t.addClass("mos-parallax"),function e(){void 0===$(window).parallax?setTimeout(e,300):i()}()}}}]).directive("parallaxAdaptive",[function(){return{restrict:"A",link:function(e,a,t){function i(e,t){for(var a,i=Object.keys(e),o=0;o<i.length&&t>i[o];o++)a=e[i[o]];return a}var o,n;function r(){var e,t=window.innerWidth;o&&(e=i(o,t))&&("IMG"===a.prop("tagName")?a.attr("src",e):a.css({"background-image":"url("+e+")","background-size":"cover","background-position":"50% 0%","background-repeat":"no-repeat"})),n&&(e=i(n,t))&&a.css(e)}var s=!1;if(_WINDOW.on("resize",function(){clearTimeout(s),s=setTimeout(r,100)}),t.parallaxAdaptiveImages&&"string"==typeof t.parallaxAdaptiveImages)try{o=JSON.parse(t.parallaxAdaptiveImages)}catch(e){}if(t.parallaxAdaptiveStyles&&"string"==typeof t.parallaxAdaptiveStyles)try{n=JSON.parse(t.parallaxAdaptiveStyles)}catch(e){}r()}}}]).service("parallaxHash",[function(){return{}}]),angular.module("mosapp.calendar.filter.lite",[]).directive("calendarFilterLite",["UrlSrvc","$timeout","$filter","apiCache","LangSrvc",function(e,c,d,p,m){return{restrict:"A",scope:{filter:"=",defaultFilter:"=",onFilterApply:"&",onFilterClear:"&",updateEvent:"@",showFilter:"=",display:"@",clearOn:"@"},link:function(n,o){o.on("$destroy",function(){n.$destroy()}),n.lang=m.getCurrentLang();var r={calendarPlaces:{api:"directories",itemsKey:"itemsArea",func:"setCurrentArea",elem:".calendar-filter-lite__filter_area"},calendarDaytimes:{api:"dayTimes",itemsKey:"itemsDayinterval",func:"setCurrentDayinterval",elem:".calendar-filter-lite__filter_time"},calendarPlaceTypes:{api:"placesTypes",itemsKey:"itemsPlaceTypes",func:"setCurrentPlaceType",elem:".calendar-filter-lite__filter_place"},calendarEventTypes:{api:"auditory",itemsKey:"itemsEventTypes",func:"setCurrentEventType",elem:".calendar-filter-lite__filter_event"}},t={auditory:[],daytime:{id:""},place:{id:""},place_type:[],period:{mode:"period"}};function a(){e(),n.onFilterApply&&c(function(){n.onFilterApply()},0)}function e(){angular.forEach(n.viewFilter,function(e,t){if(angular.isArray(e))if(e.length){for(var a=[],i=0;i<e.length;i++)a.push(e[i].id);var o=a.join("|");o?n.filter[t]=o:n.filter[t]&&delete n.filter[t]}else n.filter[t]&&delete n.filter[t];else angular.isObject(e)?e.id?n.filter[t]=e.id:"function"==typeof e.getTime?n.filter[t]=d("date")(e,"yyyy-MM-dd HH:mm:ss"):n.filter[t]&&delete n.filter[t]:e?n.filter[t]=e:n.filter[t]&&delete n.filter[t]})}function s(){n.filter&&n.filter.from&&n.filter.to&&(n.viewFilter.period.mode="period",n.viewFilter.period.from=new Date(i(n.filter.from)),n.viewFilter.period.to=new Date(i(n.filter.to)))}function i(e){return e="string"==typeof e&&e.match(/\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}/)?e.replace(/(\d{4}-\d{2}-\d{2})(\s)(\d{2}:\d{2}:\d{2})/,"$1T$3"):e}function l(e,a){var i=[];return angular.forEach(e,function(t){angular.forEach(a,function(e){t.id==e&&i.push(t)})}),i}n.defaultFilter&&angular.extend(t,angular.copy(n.defaultFilter)),n.viewFilter=angular.copy(t),n.itemsEventTypes=[],n.itemsDayinterval=[],n.itemsArea=[],n.itemsPlaceTypes=[],n.applyFilter=a,n.clearFilter=function(){n.viewFilter=angular.copy(t),n.viewFilter&&n.viewFilter.from&&n.viewFilter.to&&(n.viewFilter.period.mode="period",n.viewFilter.from=n.viewFilter.period.from=new Date(i(n.viewFilter.from)),n.viewFilter.to=n.viewFilter.period.to=new Date(i(n.viewFilter.to))),e(),n.onFilterClear&&c(function(){n.onFilterClear()},0);angular.forEach(r,function(e){e.func&&n[e.func]()})},n.setNewDayinterval=function(e){e?(e=l(n.itemsDayinterval,[e])).length&&(n.viewFilter.daytime=e[0]):n.viewFilter.daytime=angular.copy(t.daytime);a()},n.setNewArea=function(e){e?(e=l(n.itemsArea,[e])).length&&(n.viewFilter.place=e[0]):n.viewFilter.place=angular.copy(t.place);a()},n.setNewDateRange=function(){var e=n.viewFilter.period.from,t=n.viewFilter.period.to;e&&(n.viewFilter.from=e);t&&(n.viewFilter.to=t);a()},n.setNewAuditory=function(){a()},n.setNewPlaceTypes=function(){a()},n.setCurrentEventType=function(){var e=n.filter&&n.filter.auditory||"";(e="all"===e?"":e)?(e=n.filter.auditory&&n.filter.auditory.match("|")?n.filter.auditory.split("|"):[n.filter.auditory],n.viewFilter.auditory=l(n.itemsEventTypes,e)):n.viewFilter.auditory=angular.copy(t.auditory)},n.setCurrentDayinterval=function(){var e=n.filter&&n.filter.daytime||"";e="all"===e?"":e;for(var t=0;t<n.itemsDayinterval.length;t++)n.itemsDayinterval[t].id.toString()===e&&(n.viewFilter.daytime=n.itemsDayinterval[t])},n.setCurrentArea=function(){var e=n.filter&&n.filter.place||"";e="all"===e?"":e;for(var t=0;t<n.itemsArea.length;t++)n.itemsArea[t].id!==e&&n.itemsArea[t].id.toString()!==e||(n.viewFilter.place=n.itemsArea[t])},n.setCurrentPlaceType=function(){n.filter&&n.place_type;{var e;e=n.filter.place_type&&n.filter.place_type.match("|")?n.filter.place_type.split("|"):[n.filter.place_type]}n.viewFilter.place_type=l(n.itemsPlaceTypes,e)},n.$watch("display",function(e){if(e){n.displayConfig={};for(var t=e.split(","),a=0;a<t.length;a++)n.displayConfig[t[a]]=!0}}),s(),Object.keys(r).forEach(function(e,t){var a,i;e=r[a=e].api?"newsfeed":"pulse",i=r[a].api||a,p.getData(e,i,r[a].params,!0,o.find(r[a].elem)).then(function(e){n[r[a].itemsKey]=e.items,n[r[a].func](),Object.keys(r).length-1===t&&n.updateEvent&&n.$on(n.updateEvent,function(){angular.forEach(r,function(e){e.func&&n[e.func]()}),s()})})})},templateUrl:e.tmplPath("00_afisha/calendarFilterLite/calendarFilterLite.tpl.html")}}]),angular.module("mosapp.news.feed.newsfeedMixedList",["mosapp.filters.prepareDateSince"]).directive("newsfeedMixedList",["UrlSrvc","apiSrvc","$timeout","mosconfig","toolsSrvc",function(e,a,i,n,r){return{scope:{className:"@",kinds:"@",sphere:"@",limit:"@",target:"@",showMore:"@",imagePosition:"@",style:"@"},link:function(o,t){o.overImg={src:"%markup_images_dir%"+("main"===o.style?"pt_calendar-lite":"pt")+".png"},o.items=[],o.posts=[],o.limit=o.limit||4,o.kinds?o.kinds=o.kinds.replace("|"," ").replace(","," ").split(" "):o.kinds=[n.newsfeed.defaultKind],o.sphere&&(o.sphere=o.sphere.replace("|"," ").replace(","," ").split(" ")),o.target||(o.target="_blank"),o.showMoreButton=!o.showMore||o.showMore&&"false"!==o.showMore,o.imagePosition="top"!==o.imagePosition&&o.imagePosition?"bottom":"top",o.$watch(function(){return r.colorScheme()},function(e){o.colorScheme=e}),o.colorScheme=r.colorScheme(),o.loadData=function(i){var e=i?t.find(".nf-mixed-list__more-loader"):t.find(".nf-mixed-list__loader-container");return angular.isObject(o.params)||(o.params={fields:"id,title,date,date_timestamp,image",expand:"kind,url",sort:"-date",filter:{"kind.id":o.kinds,status:"public"}}),o.page&&(o.params.page=o.page+1),o.sphere&&(o.params.filter["spheres.id"]=o.sphere),a.getData("newsfeed","materialAggregator",o.params,!1,{elems:e,loaderType:"plainDots"}).then(function(e){if(e){if(angular.isArray(e.items)&&e.items.length){o.notFound=!1;for(var t=0,a=e.items.length;t<a;t++)e.items[t].link=e.items[t].url,angular.isObject(e.items[t].image)&&(e.items[t].image.original||e.items[t].image["1x1_s"]||e.items[t].image.big)&&(e.items[t].withImage=!0),e.items[t].date&&angular.isString(e.items[t].date)&&(e.items[t].date=new Date(e.items[t].date));i||(o.items=[],o.posts=[]),o.items=o.items.concat(e.items)}else i||(o.notFound=!0);e._meta&&(o.meta=e._meta,o.page=e._meta.currentPage)}else i||(o.notFound=!0)})},o.updateList=function(){o.items.length>=o.limit?e=o.items.splice(0,o.limit):0<o.items.length&&(e=o.items.splice(0,o.items.length));for(var e,t=e.length;t--;)e[t].isNew=!0;o.posts=o.posts.concat(e),i(function(){for(var e=o.posts.length;e--;)o.posts[e].isNew=!1},50),(0<o.items.length||o.meta&&o.meta.currentPage<o.meta.pageCount)&&(o.canBeMore=!0)},o.newsList=function(e){o.loading=!0,o.canBeMore=!1,!(angular.isArray(o.items)&&0<o.items.length&&e)&&(angular.isObject(o.meta)&&o.meta.currentPage<o.meta.pageCount||!o.items.length)?o.loadData(e).then(function(){o.items&&o.items.length&&0<o.items.length&&(o.updateList(),o.loading=!1)}):(o.updateList(),o.loading=!1)},o.newsList(),o.getMoreData=function(){o.loading||o.newsList(!0)}},templateUrl:"newsfeedMixedList/newsfeedMixedList.tpl.html"}}]),!function(){"use strict";angular.module("ui.mask",[]).value("uiMaskConfig",{maskDefinitions:{9:/\d/,A:/[a-zA-Z]/,"*":/[a-zA-Z0-9]/},clearOnBlur:!0,clearOnBlurPlaceholder:!1,escChar:"\\",eventsToHandle:["input","keyup","click","focus"],addDefaultPlaceholder:!0,allowInvalidValue:!1}).provider("uiMask.Config",function(){var i={};this.maskDefinitions=function(e){return i.maskDefinitions=e},this.clearOnBlur=function(e){return i.clearOnBlur=e},this.clearOnBlurPlaceholder=function(e){return i.clearOnBlurPlaceholder=e},this.eventsToHandle=function(e){return i.eventsToHandle=e},this.addDefaultPlaceholder=function(e){return i.addDefaultPlaceholder=e},this.allowInvalidValue=function(e){return i.allowInvalidValue=e},this.$get=["uiMaskConfig",function(e){var t,a=e;for(t in i)angular.isObject(i[t])&&!angular.isArray(i[t])?angular.extend(a[t],i[t]):a[t]=i[t];return a}]}).directive("uiMask",["uiMask.Config",function(e){function R(e){return e===document.activeElement&&(!document.hasFocus||document.hasFocus())&&(e.type||e.href||~e.tabIndex)}return{priority:100,require:"ngModel",restrict:"A",compile:function(){var z=angular.copy(e);return function(w,M,s,k){function e(e){{if(angular.isDefined(e)){var i=0,o,n,r;if($=[],g=[],A="",angular.isString(e)&&(o=!1,n=h=0,e=e.split(""),r=!1,angular.forEach(e,function(e,t){var a;r?(r=!1,A+=e,i++):j.escChar===e?r=!0:j.maskDefinitions[e]?($.push(i),A+=(t=t-n,a=angular.isDefined(s.uiMaskPlaceholder)?s.uiMaskPlaceholder:s.placeholder,angular.isDefined(a)&&a[t]?a[t]:"space"===(a=angular.isDefined(s.uiMaskPlaceholderChar)&&s.uiMaskPlaceholderChar?s.uiMaskPlaceholderChar:"_").toLowerCase()?" ":a[0]),g.push(j.maskDefinitions[e]),i++,o||h++,o=!1):"?"===e?(o=!0,n++):(A+=e,i++)})),$.push($.slice().pop()+1),f=function(){var a,e,t=A.split(""),i=($&&!isNaN($[0])&&angular.forEach($,function(e){t[e]="_"}),a=t.join(""),e=(e=a.replace(/[_]+/g,"_").split("_")).filter(function(e){return""!==e}),0);return e.map(function(e){var t=a.indexOf(e,i);return i=t+1,{value:e,position:t}})}(),_=1<$.length){v=E=S(k.$modelValue||""),I=D(v),y=c(v),s.maxlength&&M.attr("maxlength",2*$[$.length-1]),!N&&j.addDefaultPlaceholder&&M.attr("placeholder",A);for(var t=k.$modelValue,a=k.$formatters.length;a--;)t=k.$formatters[a](t);return k.$viewValue=t||"",k.$render(),b||(M.bind("blur",d),M.bind("mousedown mouseup",p),M.bind("keydown",m),M.bind(j.eventsToHandle.join(" "),u),b=!0),!0}return l()}return l()}}function t(e){e&&(A=e,!_||0===M.val().length&&angular.isDefined(s.placeholder)||M.val(D(S(M.val()))))}function a(e){return _?(v=S(e||""),y=c(v),k.$setValidity("mask",y),v.length&&(y||j.allowInvalidValue)?D(v):void 0):e}function l(){return _=!1,b&&(M.unbind("blur",d),M.unbind("mousedown",p),M.unbind("mouseup",p),M.unbind("keydown",m),M.unbind("input",u),M.unbind("keyup",u),M.unbind("click",u),M.unbind("focus",u),b=!1),angular.isDefined(N)?M.attr("placeholder",N):M.removeAttr("placeholder"),angular.isDefined(o)?M.attr("maxlength",o):M.removeAttr("maxlength"),M.val(k.$modelValue),k.$viewValue=k.$modelValue,!1}function c(e){return!e.length||e.length>=h}function S(a){var i,o,t="",e=M[0],n=g.slice(),r=O,s=r+x(e),l="";return a=a.toString(),i=0,o=a.length-A.length,angular.forEach(f,function(e){var t=e.position;r<=t&&t<s||(r<=t&&(t+=o),a.substring(t,t+e.value.length)===e.value&&(l+=a.slice(i,t),i=t+e.value.length))}),a=l+a.slice(i),angular.forEach(a.split(""),function(e){n.length&&n[0].test(e)&&(t+=e,n.shift())}),t}function D(a){var i="",o=$.slice();return angular.forEach(A.split(""),function(e,t){a.length&&t===o[0]?(i+=a.charAt(0)||"_",a=a.substr(1),o.shift()):i+=e}),i}function d(){var e,t,a,i;(j.clearOnBlur||j.clearOnBlurPlaceholder&&0===v.length&&s.placeholder)&&(L=O=0,y&&0!==v.length||(M.val(""),w.$apply(function(){k.$pristine||k.$setViewValue("")}))),v!==H&&(e=M.val(),(t=""===v&&e&&angular.isDefined(s.uiMaskPlaceholderChar)&&"space"===s.uiMaskPlaceholderChar)&&M.val(""),a=M[0],angular.isFunction(window.Event)&&!a.fireEvent?(i=new Event("change",{view:window,bubbles:!0,cancelable:!1}),a.dispatchEvent(i)):"createEvent"in document?((i=document.createEvent("HTMLEvents")).initEvent("change",!1,!0),a.dispatchEvent(i)):a.fireEvent&&a.fireEvent("onchange"),t&&M.val(e)),H=v}function p(e){"mousedown"===e.type?M.bind("mouseout",i):M.unbind("mouseout",i)}function i(){L=x(this),M.unbind("mouseout",i)}function m(e){var t=8===e.which,a=C(this)-1||0,i=90===e.which&&e.ctrlKey;if(t){for(;0<=a;){if(T(a)){P(this,a+1);break}a--}F=-1===a}i&&(M.val(""),e.preventDefault())}function u(e){var t=(e=e||{}).which,a=e.type;if(16!==t&&91!==t){var i,o=M.val(),n=I,r=!1,s=S(o),l=E,c=C(this)||0,d=O||0,p=c-d,m=$[0],u=$[s.length]||$.slice().shift(),g=L||0,f=0<x(this),h=0<g,v=o.length>n.length||g&&o.length>n.length-g,n=o.length<n.length||g&&o.length===n.length-g,g=37<=t&&t<=40&&e.shiftKey,y=8===t||"keyup"!==a&&n&&-1==p,_=46===t||"keyup"!==a&&n&&0==p&&!h,b=(37===t||y||"click"===a)&&m<c;if(L=x(this),!g&&(!f||"click"!==a&&"keyup"!==a&&"focus"!==a)){if(y&&F)return M.val(A),w.$apply(function(){k.$setViewValue("")}),void P(this,d);if("input"===a&&n&&!h&&s===l){for(;y&&m<c&&!T(c);)c--;for(;_&&c<u&&-1===$.indexOf(c);)c++;e=$.indexOf(c);(s=s.substring(0,e)+s.substring(e+1))!==l&&(r=!0)}for(i=D(s),I=i,E=s,!r&&o.length>i.length&&(r=!0),M.val(i),r&&w.$apply(function(){k.$setViewValue(i)}),v&&c<=m&&(c=m+1),b&&c--,c=u<c?u:c<m?m:c;!T(c)&&m<c&&c<u;)c+=b?-1:1;(b&&c<u||v&&!T(d))&&c++,P(this,O=c)}}}function T(e){return-1<$.indexOf(e)}function C(e){return e?void 0!==e.selectionStart?e.selectionStart:document.selection&&R(M[0])?(e.focus(),(t=document.selection.createRange()).moveStart("character",e.value?-e.value.length:0),t.text.length):0:0;var t}function P(e,t){if(!e)return 0;0!==e.offsetWidth&&0!==e.offsetHeight&&(e.setSelectionRange?R(M[0])&&(e.focus(),e.setSelectionRange(t,t)):e.createTextRange&&((e=e.createTextRange()).collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select()))}function x(e){return e?void 0!==e.selectionStart?e.selectionEnd-e.selectionStart:window.getSelection?window.getSelection().toString().length:document.selection?document.selection.createRange().text.length:0:0}var $,g,A,f,h,v,y,I,E,O,L,F,_=!1,b=!1,N=s.placeholder,o=s.maxlength,n=k.$isEmpty,r=!(k.$isEmpty=function(e){return n(_?S(e||""):e)}),j=(s.$observe("modelViewValue",function(e){"true"===e&&(r=!0)}),s.$observe("allowInvalidValue",function(e){j.allowInvalidValue=""===e||!!e,a(k.$modelValue)}),{}),j=s.uiOptions?(j=w.$eval("["+s.uiOptions+"]"),angular.isObject(j[0])?function(e,t){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(void 0===t[a]?t[a]=angular.copy(e[a]):angular.isObject(t[a])&&!angular.isArray(t[a])&&(t[a]=angular.extend({},e[a],t[a])));return t}(z,j[0]):z):z,H=(s.$observe("uiMask",e),angular.isDefined(s.uiMaskPlaceholder)?s.$observe("uiMaskPlaceholder",t):s.$observe("placeholder",t),angular.isDefined(s.uiMaskPlaceholderChar)&&s.$observe("uiMaskPlaceholderChar",function(){return e(s.uiMask)}),k.$formatters.unshift(a),k.$parsers.unshift(function(e){return _?(v=S(e||""),y=c(v),k.$viewValue=v.length?D(v):"",k.$setValidity("mask",y),y||j.allowInvalidValue?r?k.$viewValue:v:void 0):e}),M.val());M.bind("mousedown mouseup",p),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null===this)throw new TypeError;var t=Object(this),a=t.length>>>0;if(0==a)return-1;var i=0;if(1<arguments.length&&((i=Number(arguments[1]))!=i?i=0:0!==i&&i!==1/0&&i!==-1/0&&(i=(0<i||-1)*Math.floor(Math.abs(i)))),a<=i)return-1;for(var o=0<=i?i:Math.max(a-Math.abs(i),0);o<a;o++)if(o in t&&t[o]===e)return o;return-1})}}}}])}(),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.datepicker","ui.bootstrap.dateparser","ui.bootstrap.isClass"]),angular.module("ui.bootstrap.tpls",["uib/template/datepicker/datepicker.html","uib/template/datepicker/day.html","uib/template/datepicker/month.html","uib/template/datepicker/year.html"]),angular.module("ui.bootstrap.datepicker",["ui.bootstrap.dateparser","ui.bootstrap.isClass"]).value("$datepickerSuppressError",!1).value("$datepickerLiteralWarning",!0).constant("uibDatepickerConfig",{datepickerMode:"day",formatDay:"dd",formatMonth:"MMMM",formatYear:"yyyy",formatDayHeader:"EEE",formatDayTitle:"MMMM yyyy",formatMonthTitle:"yyyy",maxDate:null,maxMode:"year",minDate:null,minMode:"day",monthColumns:3,ngModelOptions:{},shortcutPropagation:!1,showWeeks:!0,yearColumns:5,yearRows:4}).controller("UibDatepickerController",["$scope","$element","$attrs","$parse","$interpolate","$locale","$log","dateFilter","uibDatepickerConfig","$datepickerLiteralWarning","$datepickerSuppressError","uibDateParser",function(o,e,t,a,i,n,r,s,l,c,d,p){function m(e){o.datepickerMode=e,o.datepickerOptions.datepickerMode=e}var u=this,g={$setViewValue:angular.noop},f={},h=[];e.addClass("uib-datepicker"),t.$set("role","application"),o.datepickerOptions||(o.datepickerOptions={}),this.modes=["day","month","year"],["customClass","dateDisabled","datepickerMode","formatDay","formatDayHeader","formatDayTitle","formatMonth","formatMonthTitle","formatYear","maxDate","maxMode","minDate","minMode","monthColumns","showWeeks","shortcutPropagation","startingDay","yearColumns","yearRows"].forEach(function(t){switch(t){case"customClass":case"dateDisabled":o[t]=o.datepickerOptions[t]||angular.noop;break;case"datepickerMode":o.datepickerMode=(angular.isDefined(o.datepickerOptions.datepickerMode)?o.datepickerOptions:l).datepickerMode;break;case"formatDay":case"formatDayHeader":case"formatDayTitle":case"formatMonth":case"formatMonthTitle":case"formatYear":u[t]=angular.isDefined(o.datepickerOptions[t])?i(o.datepickerOptions[t])(o.$parent):l[t];break;case"monthColumns":case"showWeeks":case"shortcutPropagation":case"yearColumns":case"yearRows":u[t]=(angular.isDefined(o.datepickerOptions[t])?o.datepickerOptions:l)[t];break;case"startingDay":u.startingDay=angular.isDefined(o.datepickerOptions.startingDay)?o.datepickerOptions.startingDay:angular.isNumber(l.startingDay)?l.startingDay:(n.DATETIME_FORMATS.FIRSTDAYOFWEEK+8)%7;break;case"maxDate":case"minDate":o.$watch("datepickerOptions."+t,function(e){e?angular.isDate(e)?u[t]=p.fromTimezone(new Date(e),f.getOption("timezone")):(c&&r.warn("Literal date support has been deprecated, please switch to date object usage"),u[t]=new Date(s(e,"medium"))):u[t]=l[t]?p.fromTimezone(new Date(l[t]),f.getOption("timezone")):null,u.refreshView()});break;case"maxMode":case"minMode":o.datepickerOptions[t]?o.$watch(function(){return o.datepickerOptions[t]},function(e){u[t]=o[t]=angular.isDefined(e)?e:o.datepickerOptions[t],("minMode"===t&&u.modes.indexOf(o.datepickerOptions.datepickerMode)<u.modes.indexOf(u[t])||"maxMode"===t&&u.modes.indexOf(o.datepickerOptions.datepickerMode)>u.modes.indexOf(u[t]))&&(o.datepickerMode=u[t],o.datepickerOptions.datepickerMode=u[t])}):u[t]=o[t]=l[t]||null}}),o.uniqueId="datepicker-"+o.$id+"-"+Math.floor(1e4*Math.random()),o.disabled=angular.isDefined(t.disabled)||!1,angular.isDefined(t.ngDisabled)&&h.push(o.$parent.$watch(t.ngDisabled,function(e){o.disabled=e,u.refreshView()})),o.isActive=function(e){return 0===u.compare(e.date,u.activeDate)&&(o.activeDateId=e.uid,!0)},this.init=function(e){e=g=e,angular.version.minor<6?(a=e.$options||o.datepickerOptions.ngModelOptions||l.ngModelOptions||{}).getOption=function(e){return a[e]}:(t=e.$options.getOption("timezone")||(o.datepickerOptions.ngModelOptions?o.datepickerOptions.ngModelOptions.timezone:null)||(l.ngModelOptions?l.ngModelOptions.timezone:null),a=e.$options.createChild(l.ngModelOptions).createChild(o.datepickerOptions.ngModelOptions).createChild(e.$options).createChild({timezone:t})),f=a,o.datepickerOptions.initDate?(u.activeDate=p.fromTimezone(o.datepickerOptions.initDate,f.getOption("timezone"))||new Date,o.$watch("datepickerOptions.initDate",function(e){e&&(g.$isEmpty(g.$modelValue)||g.$invalid)&&(u.activeDate=p.fromTimezone(e,f.getOption("timezone")),u.refreshView())})):u.activeDate=new Date;var t,a,e=g.$modelValue?new Date(g.$modelValue):new Date;this.activeDate=isNaN(e)?p.fromTimezone(new Date,f.getOption("timezone")):p.fromTimezone(e,f.getOption("timezone")),g.$render=function(){u.render()}},this.render=function(){var e;g.$viewValue&&(e=new Date(g.$viewValue),!isNaN(e)?this.activeDate=p.fromTimezone(e,f.getOption("timezone")):d||r.error('Datepicker directive: "ng-model" value must be a Date object')),this.refreshView()},this.refreshView=function(){var e;this.element&&(o.selectedDt=null,this._refreshView(),o.activeDt&&(o.activeDateId=o.activeDt.uid),e=g.$viewValue?new Date(g.$viewValue):null,e=p.fromTimezone(e,f.getOption("timezone")),g.$setValidity("dateDisabled",!e||this.element&&!this.isDisabled(e)))},this.createDateObject=function(e,t){var a=g.$viewValue?new Date(g.$viewValue):null,a=p.fromTimezone(a,f.getOption("timezone")),i=new Date,i=p.fromTimezone(i,f.getOption("timezone")),i=this.compare(e,i),t={date:e,label:p.filter(e,t),selected:a&&0===this.compare(e,a),disabled:this.isDisabled(e),past:i<0,current:0===i,future:0<i,customClass:this.customClass(e)||null};return a&&0===this.compare(e,a)&&(o.selectedDt=t),u.activeDate&&0===this.compare(t.date,u.activeDate)&&(o.activeDt=t),t},this.isDisabled=function(e){return o.disabled||this.minDate&&this.compare(e,this.minDate)<0||this.maxDate&&0<this.compare(e,this.maxDate)||o.dateDisabled&&o.dateDisabled({date:e,mode:o.datepickerMode})},this.customClass=function(e){return o.customClass({date:e,mode:o.datepickerMode})},this.split=function(e,t){for(var a=[];0<e.length;)a.push(e.splice(0,t));return a},o.select=function(e){var t;o.datepickerMode===u.minMode?((t=g.$viewValue?p.fromTimezone(new Date(g.$viewValue),f.getOption("timezone")):new Date(0,0,0,0,0,0,0)).setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t=p.toTimezone(t,f.getOption("timezone")),g.$setViewValue(t),g.$render()):(u.activeDate=e,m(u.modes[u.modes.indexOf(o.datepickerMode)-1]),o.$emit("uib:datepicker.mode")),o.$broadcast("uib:datepicker.focus")},o.move=function(e){var t=u.activeDate.getFullYear()+e*(u.step.years||0),e=u.activeDate.getMonth()+e*(u.step.months||0);u.activeDate.setFullYear(t,e,1),u.refreshView()},o.toggleMode=function(e){e=e||1,o.datepickerMode===u.maxMode&&1===e||o.datepickerMode===u.minMode&&-1===e||(m(u.modes[u.modes.indexOf(o.datepickerMode)+e]),o.$emit("uib:datepicker.mode"))},o.keys={13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down"};o.$on("uib:datepicker.focus",function(){u.element[0].focus()}),o.keydown=function(e){var t=o.keys[e.which];!t||e.shiftKey||e.altKey||o.disabled||(e.preventDefault(),u.shortcutPropagation||e.stopPropagation(),"enter"===t||"space"===t?u.isDisabled(u.activeDate)||o.select(u.activeDate):!e.ctrlKey||"up"!==t&&"down"!==t?(u.handleKeyDown(t,e),u.refreshView()):o.toggleMode("up"===t?1:-1))},e.on("keydown",function(e){o.$apply(function(){o.keydown(e)})}),o.$on("$destroy",function(){for(;h.length;)h.shift()()})}]).controller("UibDaypickerController",["$scope","$element","dateFilter",function(p,e,m){function i(e,t){return 1!==t||e%4!=0||e%100==0&&e%400!=0?a[t]:29}var a=[31,28,31,30,31,30,31,31,30,31,30,31];this.step={months:1},this.element=e,this.init=function(e){angular.extend(e,this),p.showWeeks=e.showWeeks,e.refreshView()},this.getDates=function(e,t){for(var a,i=new Array(t),o=new Date(e),n=0;n<t;)a=new Date(o),i[n++]=a,o.setDate(o.getDate()+1);return i},this._refreshView=function(){var e=this.activeDate.getFullYear(),t=this.activeDate.getMonth(),a=new Date(this.activeDate),e=(a.setFullYear(e,t,1),this.startingDay-a.getDay()),e=0<e?7-e:-e,a=new Date(a);0<e&&a.setDate(1-e);for(var i=this.getDates(a,42),o=0;o<42;o++)i[o]=angular.extend(this.createDateObject(i[o],this.formatDay),{secondary:i[o].getMonth()!==t,uid:p.uniqueId+"-"+o});p.labels=new Array(7);for(var n,r,s=0;s<7;s++)p.labels[s]={abbr:m(i[s].date,this.formatDayHeader),full:m(i[s].date,"EEEE")};if(p.title=m(this.activeDate,this.formatDayTitle),p.rows=this.split(i,7),p.showWeeks){p.weekNumbers=[];for(var l=(11-this.startingDay)%7,c=p.rows.length,d=0;d<c;d++)p.weekNumbers.push((n=p.rows[d][l].date,r=void 0,(n=new Date(n)).setDate(n.getDate()+4-(n.getDay()||7)),r=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((r-n)/864e5)/7)+1))}},this.compare=function(e,t){var a=new Date(e.getFullYear(),e.getMonth(),e.getDate()),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());return a.setFullYear(e.getFullYear()),i.setFullYear(t.getFullYear()),a-i},this.handleKeyDown=function(e){var t,a=this.activeDate.getDate();"left"===e?--a:"up"===e?a-=7:"right"===e?a+=1:"down"===e?a+=7:"pageup"===e||"pagedown"===e?(t=this.activeDate.getMonth()+("pageup"===e?-1:1),this.activeDate.setMonth(t,1),a=Math.min(i(this.activeDate.getFullYear(),this.activeDate.getMonth()),a)):"home"===e?a=1:"end"===e&&(a=i(this.activeDate.getFullYear(),this.activeDate.getMonth())),this.activeDate.setDate(a)}}]).controller("UibMonthpickerController",["$scope","$element","dateFilter",function(o,e,n){this.step={years:1},this.element=e,this.init=function(e){angular.extend(e,this),e.refreshView()},this._refreshView=function(){for(var e,t=new Array(12),a=this.activeDate.getFullYear(),i=0;i<12;i++)(e=new Date(this.activeDate)).setFullYear(a,i,1),t[i]=angular.extend(this.createDateObject(e,this.formatMonth),{uid:o.uniqueId+"-"+i});o.title=n(this.activeDate,this.formatMonthTitle),o.rows=this.split(t,this.monthColumns),o.yearHeaderColspan=3<this.monthColumns?this.monthColumns-2:1},this.compare=function(e,t){var a=new Date(e.getFullYear(),e.getMonth()),i=new Date(t.getFullYear(),t.getMonth());return a.setFullYear(e.getFullYear()),i.setFullYear(t.getFullYear()),a-i},this.handleKeyDown=function(e){var t,a=this.activeDate.getMonth();"left"===e?--a:"up"===e?a-=this.monthColumns:"right"===e?a+=1:"down"===e?a+=this.monthColumns:"pageup"===e||"pagedown"===e?(t=this.activeDate.getFullYear()+("pageup"===e?-1:1),this.activeDate.setFullYear(t)):"home"===e?a=0:"end"===e&&(a=11),this.activeDate.setMonth(a)}}]).controller("UibYearpickerController",["$scope","$element","dateFilter",function(o,e){function n(e){return parseInt((e-1)/s,10)*s+1}var r,s;this.element=e,this.yearpickerInit=function(){r=this.yearColumns,s=this.yearRows*r,this.step={years:s}},this._refreshView=function(){for(var e,t=new Array(s),a=0,i=n(this.activeDate.getFullYear());a<s;a++)(e=new Date(this.activeDate)).setFullYear(i+a,0,1),t[a]=angular.extend(this.createDateObject(e,this.formatYear),{uid:o.uniqueId+"-"+a});o.title=[t[0].label,t[s-1].label].join(" - "),o.rows=this.split(t,r),o.columns=r},this.compare=function(e,t){return e.getFullYear()-t.getFullYear()},this.handleKeyDown=function(e){var t=this.activeDate.getFullYear();"left"===e?--t:"up"===e?t-=r:"right"===e?t+=1:"down"===e?t+=r:"pageup"===e||"pagedown"===e?t+=("pageup"===e?-1:1)*s:"home"===e?t=n(this.activeDate.getFullYear()):"end"===e&&(t=n(this.activeDate.getFullYear())+s-1),this.activeDate.setFullYear(t)}}]).directive("uibDatepicker",function(){return{templateUrl:function(e,t){return t.templateUrl||"uib/template/datepicker/datepicker.html"},scope:{datepickerOptions:"=?"},require:["uibDatepicker","^ngModel"],restrict:"A",controller:"UibDatepickerController",controllerAs:"datepicker",link:function(e,t,a,i){var o=i[0],i=i[1];o.init(i)}}}).directive("uibDaypicker",function(){return{templateUrl:function(e,t){return t.templateUrl||"uib/template/datepicker/day.html"},require:["^uibDatepicker","uibDaypicker"],restrict:"A",controller:"UibDaypickerController",link:function(e,t,a,i){var o=i[0];i[1].init(o)}}}).directive("uibMonthpicker",function(){return{templateUrl:function(e,t){return t.templateUrl||"uib/template/datepicker/month.html"},require:["^uibDatepicker","uibMonthpicker"],restrict:"A",controller:"UibMonthpickerController",link:function(e,t,a,i){var o=i[0];i[1].init(o)}}}).directive("uibYearpicker",function(){return{templateUrl:function(e,t){return t.templateUrl||"uib/template/datepicker/year.html"},require:["^uibDatepicker","uibYearpicker"],restrict:"A",controller:"UibYearpickerController",link:function(e,t,a,i){var o=i[0];angular.extend(o,i[1]),o.yearpickerInit(),o.refreshView()}}}),angular.module("ui.bootstrap.dateparser",[]).service("uibDateParser",["$log","$locale","dateFilter","orderByFilter","filterFilter",function(g,f,a,h,t){function i(e){return t(y,{key:e},!0)[0]}function o(e){for(var t,a,i=[],o=0;o<e.length;)if(angular.isNumber(a)){if("'"===e.charAt(o))(o+1>=e.length||"'"!==e.charAt(o+1))&&(i.push(function(e,t,a){return function(){return e.substr(t+1,a-t-1)}}(e,a,o)),a=null);else if(o===e.length)for(;a<e.length;)t=n(e,a),i.push(t),a=t.endIdx;o++}else"'"!==e.charAt(o)?(t=n(e,o),i.push(t.parser),o=t.endIdx):(a=o,o++);return i}function n(e,t){for(var a,i=e.substr(t),o=0;o<y.length;o++)if(new RegExp("^"+y[o].key).test(i))return{endIdx:t+(a=y[o]).key.length,parser:a.formatter};return{endIdx:t+1,parser:function(){return i.charAt(0)}}}function r(e){return parseInt(e,10)}function s(e,t){e=e.replace(/:/g,"");e=Date.parse("Jan 01, 1970 00:00:00 "+e)/6e4;return isNaN(e)?t:e}function l(e,t){return(e=new Date(e.getTime())).setMinutes(e.getMinutes()+t),e}function c(e,t,a){a=a?-1:1;var i=e.getTimezoneOffset();return l(e,a*(s(t,i)-i))}var v,y,_=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;this.init=function(){v=f.id,this.parsers={},this.formatters={},y=[{key:"yyyy",regex:"\\d{4}",apply:function(e){this.year=+e},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),a(t,"yyyy")}},{key:"yy",regex:"\\d{2}",apply:function(e){this.year=(e=+e)<69?e+2e3:e+1900},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),a(t,"yy")}},{key:"y",regex:"\\d{1,4}",apply:function(e){this.year=+e},formatter:function(e){var t=new Date;return t.setFullYear(Math.abs(e.getFullYear())),a(t,"y")}},{key:"M!",regex:"0?[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){var t=e.getMonth();return/^[0-9]$/.test(t)?a(e,"MM"):a(e,"M")}},{key:"MMMM",regex:f.DATETIME_FORMATS.MONTH.join("|"),apply:function(e){this.month=f.DATETIME_FORMATS.MONTH.indexOf(e)},formatter:function(e){return a(e,"MMMM")}},{key:"MMM",regex:f.DATETIME_FORMATS.SHORTMONTH.join("|"),apply:function(e){this.month=f.DATETIME_FORMATS.SHORTMONTH.indexOf(e)},formatter:function(e){return a(e,"MMM")}},{key:"MM",regex:"0[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){return a(e,"MM")}},{key:"M",regex:"[1-9]|1[0-2]",apply:function(e){this.month=e-1},formatter:function(e){return a(e,"M")}},{key:"d!",regex:"[0-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){var t=e.getDate();return/^[1-9]$/.test(t)?a(e,"dd"):a(e,"d")}},{key:"dd",regex:"[0-2][0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){return a(e,"dd")}},{key:"d",regex:"[1-2]?[0-9]{1}|3[0-1]{1}",apply:function(e){this.date=+e},formatter:function(e){return a(e,"d")}},{key:"EEEE",regex:f.DATETIME_FORMATS.DAY.join("|"),formatter:function(e){return a(e,"EEEE")}},{key:"EEE",regex:f.DATETIME_FORMATS.SHORTDAY.join("|"),formatter:function(e){return a(e,"EEE")}},{key:"HH",regex:"(?:0|1)[0-9]|2[0-3]",apply:function(e){this.hours=+e},formatter:function(e){return a(e,"HH")}},{key:"hh",regex:"0[0-9]|1[0-2]",apply:function(e){this.hours=+e},formatter:function(e){return a(e,"hh")}},{key:"H",regex:"1?[0-9]|2[0-3]",apply:function(e){this.hours=+e},formatter:function(e){return a(e,"H")}},{key:"h",regex:"[0-9]|1[0-2]",apply:function(e){this.hours=+e},formatter:function(e){return a(e,"h")}},{key:"mm",regex:"[0-5][0-9]",apply:function(e){this.minutes=+e},formatter:function(e){return a(e,"mm")}},{key:"m",regex:"[0-9]|[1-5][0-9]",apply:function(e){this.minutes=+e},formatter:function(e){return a(e,"m")}},{key:"sss",regex:"[0-9][0-9][0-9]",apply:function(e){this.milliseconds=+e},formatter:function(e){return a(e,"sss")}},{key:"ss",regex:"[0-5][0-9]",apply:function(e){this.seconds=+e},formatter:function(e){return a(e,"ss")}},{key:"s",regex:"[0-9]|[1-5][0-9]",apply:function(e){this.seconds=+e},formatter:function(e){return a(e,"s")}},{key:"a",regex:f.DATETIME_FORMATS.AMPMS.join("|"),apply:function(e){12===this.hours&&(this.hours=0),"PM"===e&&(this.hours+=12)},formatter:function(e){return a(e,"a")}},{key:"Z",regex:"[+-]\\d{4}",apply:function(e){var e=e.match(/([+-])(\d{2})(\d{2})/),t=e[1],a=e[2],e=e[3];this.hours+=r(t+a),this.minutes+=r(t+e)},formatter:function(e){return a(e,"Z")}},{key:"ww",regex:"[0-4][0-9]|5[0-3]",formatter:function(e){return a(e,"ww")}},{key:"w",regex:"[0-9]|[1-4][0-9]|5[0-3]",formatter:function(e){return a(e,"w")}},{key:"GGGG",regex:f.DATETIME_FORMATS.ERANAMES.join("|").replace(/\s/g,"\\s"),formatter:function(e){return a(e,"GGGG")}},{key:"GGG",regex:f.DATETIME_FORMATS.ERAS.join("|"),formatter:function(e){return a(e,"GGG")}},{key:"GG",regex:f.DATETIME_FORMATS.ERAS.join("|"),formatter:function(e){return a(e,"GG")}},{key:"G",regex:f.DATETIME_FORMATS.ERAS.join("|"),formatter:function(e){return a(e,"G")}},{key:"LLLL",regex:f.DATETIME_FORMATS.STANDALONEMONTH.join("|"),apply:function(e){this.month=f.DATETIME_FORMATS.STANDALONEMONTH.indexOf(e)},formatter:function(e){return a(e,"LLLL")}}],1<=angular.version.major&&4<angular.version.minor&&y.push({key:"LLLL",regex:f.DATETIME_FORMATS.STANDALONEMONTH.join("|"),apply:function(e){this.month=f.DATETIME_FORMATS.STANDALONEMONTH.indexOf(e)},formatter:function(e){return a(e,"LLLL")}})},this.init(),this.getParser=function(e){e=i(e);return e&&e.apply||null},this.overrideParser=function(e,t){e=i(e);e&&angular.isFunction(t)&&(this.parsers={},e.apply=t)}.bind(this),this.filter=function(a,e){return angular.isDate(a)&&!isNaN(a)&&e?(e=f.DATETIME_FORMATS[e]||e,f.id!==v&&this.init(),this.formatters[e]||(this.formatters[e]=o(e)),this.formatters[e].reduce(function(e,t){return e+t(a)},"")):""},this.parse=function(e,t,a){if(!angular.isString(e)||!t)return e;t=(t=f.DATETIME_FORMATS[t]||t).replace(_,"\\$&"),f.id!==v&&this.init(),this.parsers[t]||(this.parsers[t]=function(o){var n=[],r=o.split(""),e=o.indexOf("'");if(-1<e){var t=!1;o=o.split("");for(var a=e;a<o.length;a++)t?("'"===o[a]&&(a+1<o.length&&"'"===o[a+1]?(o[a+1]="$",r[a+1]=""):(r[a]="",t=!1)),o[a]="$"):"'"===o[a]&&(o[a]="$",t=!(r[a]=""));o=o.join("")}return angular.forEach(y,function(e){var t=o.indexOf(e.key);if(-1<t){o=o.split(""),r[t]="("+e.regex+")",o[t]="$";for(var a=t+1,i=t+e.key.length;a<i;a++)r[a]="",o[a]="$";o=o.join(""),n.push({index:t,key:e.key,apply:e.apply,matcher:e.regex})}}),{regex:new RegExp("^"+r.join("")+"$"),map:h(n,"index")}}(t));var i,o,t=this.parsers[t],n=t.regex,r=t.map,s=e.match(n),l=!1;if(s&&s.length){for(var c,d=angular.isDate(a)&&!isNaN(a.getTime())?{year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds(),milliseconds:a.getMilliseconds()}:(a&&g.warn("dateparser:","baseDate is not a valid date"),{year:1900,month:0,date:1,hours:0,minutes:0,seconds:0,milliseconds:0}),p=1,m=s.length;p<m;p++){var u=r[p-1];"Z"===u.matcher&&(l=!0),u.apply&&u.apply.call(d,s[p])}t=l?Date.prototype.setUTCFullYear:Date.prototype.setFullYear,e=l?Date.prototype.setUTCHours:Date.prototype.setHours;return n=d.year,i=d.month,(o=d.date)<1||!(1===i&&28<o?29===o&&(n%4==0&&n%100!=0||n%400==0):3!==i&&5!==i&&8!==i&&10!==i||o<31)||(!angular.isDate(a)||isNaN(a.getTime())||l?(c=new Date(0),t.call(c,d.year,d.month,d.date),e.call(c,d.hours||0,d.minutes||0,d.seconds||0,d.milliseconds||0)):(c=new Date(a),t.call(c,d.year,d.month,d.date),e.call(c,d.hours,d.minutes,d.seconds,d.milliseconds))),c}},this.toTimezone=function(e,t){return e&&t?c(e,t):e},this.fromTimezone=function(e,t){return e&&t?c(e,t,!0):e},this.timezoneToOffset=s,this.addDateMinutes=l,this.convertTimezoneToLocal=c}]),angular.module("ui.bootstrap.isClass",[]).directive("uibIsClass",["$animate",function(d){var n=/^\s*([\s\S]+?)\s+on\s+([\s\S]+?)\s*$/,p=/^\s*([\s\S]+?)\s+for\s+([\s\S]+?)\s*$/;return{restrict:"A",compile:function(e,t){function a(e){var t,a=e.targetScope,e=i.indexOf(a);i.splice(e,1),s.splice(e,1),i.length?(t=i[0],angular.forEach(l,function(e){e.scope===a&&(e.watcher=t.$watch(e.compareWithExp,e.watchFn),e.scope=t)})):l={}}var i=[],s=[],l={},t=t.uibIsClass.match(n),c=t[2],o=t[1].split(",");return function(r,e){i.push(r),s.push({scope:r,element:e}),o.forEach(function(e){var t,a=r,i=e.match(p),o=a.$eval(i[1]),i=i[2],n=l[e];n||(t=function(t){var a=null;s.some(function(e){return e.scope.$eval(c)===t?(a=e,!0):void 0}),n.lastActivated!==a&&(n.lastActivated&&d.removeClass(n.lastActivated.element,o),a&&d.addClass(a.element,o),n.lastActivated=a)},l[e]=n={lastActivated:null,scope:a,watchFn:t,compareWithExp:i,watcher:a.$watch(i,t)}),n.watchFn(a.$eval(i))}),r.$on("$destroy",a)}}}}]),angular.module("uib/template/datepicker/datepicker.html",[]).run(["$templateCache",function(e){e.put("uib/template/datepicker/datepicker.html",'<div ng-switch="datepickerMode">\n  <div uib-daypicker ng-switch-when="day" tabindex="0" class="uib-daypicker"></div>\n  <div uib-monthpicker ng-switch-when="month" tabindex="0" class="uib-monthpicker"></div>\n  <div uib-yearpicker ng-switch-when="year" tabindex="0" class="uib-yearpicker"></div>\n</div>\n')}]),angular.module("uib/template/datepicker/day.html",[]).run(["$templateCache",function(e){e.put("uib/template/datepicker/day.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left uib-left" ng-click="move(-1)" tabindex="-1"><i aria-hidden="true" class="glyphicon glyphicon-chevron-left"></i><span class="sr-only">previous</span></button></th>\n      <th colspan="{{::5 + showWeeks}}"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm uib-title" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right uib-right" ng-click="move(1)" tabindex="-1"><i aria-hidden="true" class="glyphicon glyphicon-chevron-right"></i><span class="sr-only">next</span></button></th>\n    </tr>\n    <tr>\n      <th ng-if="showWeeks" class="text-center"></th>\n      <th ng-repeat="label in ::labels track by $index" class="text-center"><small aria-label="{{::label.full}}">{{::label.abbr}}</small></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr class="uib-weeks" ng-repeat="row in rows track by $index" role="row">\n      <td ng-if="showWeeks" class="text-center h6"><em>{{ weekNumbers[$index] }}</em></td>\n      <td ng-repeat="dt in row" class="uib-day text-center" role="gridcell"\n        id="{{::dt.uid}}"\n        ng-class="::dt.customClass">\n        <button type="button" class="btn btn-default btn-sm"\n          uib-is-class="\n            \'btn-info\' for selectedDt,\n            \'active\' for activeDt\n            on dt"\n          ng-click="select(dt.date)"\n          ng-disabled="::dt.disabled"\n          tabindex="-1"><span ng-class="::{\'text-muted\': dt.secondary, \'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("uib/template/datepicker/month.html",[]).run(["$templateCache",function(e){e.put("uib/template/datepicker/month.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left uib-left" ng-click="move(-1)" tabindex="-1"><i aria-hidden="true" class="glyphicon glyphicon-chevron-left"></i><span class="sr-only">previous</span></button></th>\n      <th colspan="{{::yearHeaderColspan}}"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm uib-title" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right uib-right" ng-click="move(1)" tabindex="-1"><i aria-hidden="true" class="glyphicon glyphicon-chevron-right"></i><span class="sr-only">next</span></i></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr class="uib-months" ng-repeat="row in rows track by $index" role="row">\n      <td ng-repeat="dt in row" class="uib-month text-center" role="gridcell"\n        id="{{::dt.uid}}"\n        ng-class="::dt.customClass">\n        <button type="button" class="btn btn-default"\n          uib-is-class="\n            \'btn-info\' for selectedDt,\n            \'active\' for activeDt\n            on dt"\n          ng-click="select(dt.date)"\n          ng-disabled="::dt.disabled"\n          tabindex="-1"><span ng-class="::{\'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("uib/template/datepicker/year.html",[]).run(["$templateCache",function(e){e.put("uib/template/datepicker/year.html",'<table role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}">\n  <thead>\n    <tr>\n      <th><button type="button" class="btn btn-default btn-sm pull-left uib-left" ng-click="move(-1)" tabindex="-1"><i aria-hidden="true" class="glyphicon glyphicon-chevron-left"></i><span class="sr-only">previous</span></button></th>\n      <th colspan="{{::columns - 2}}"><button id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" class="btn btn-default btn-sm uib-title" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1"><strong>{{title}}</strong></button></th>\n      <th><button type="button" class="btn btn-default btn-sm pull-right uib-right" ng-click="move(1)" tabindex="-1"><i aria-hidden="true" class="glyphicon glyphicon-chevron-right"></i><span class="sr-only">next</span></button></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr class="uib-years" ng-repeat="row in rows track by $index" role="row">\n      <td ng-repeat="dt in row" class="uib-year text-center" role="gridcell"\n        id="{{::dt.uid}}"\n        ng-class="::dt.customClass">\n        <button type="button" class="btn btn-default"\n          uib-is-class="\n            \'btn-info\' for selectedDt,\n            \'active\' for activeDt\n            on dt"\n          ng-click="select(dt.date)"\n          ng-disabled="::dt.disabled"\n          tabindex="-1"><span ng-class="::{\'text-info\': dt.current}">{{::dt.label}}</span></button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n')}]),angular.module("ui.bootstrap.datepicker").run(function(){angular.$$csp().noInlineStyle||angular.$$uibDatepickerCss||angular.element(document).find("head").prepend('<style type="text/css">.uib-datepicker .uib-title{width:100%;}.uib-day button,.uib-month button,.uib-year button{min-width:100%;}.uib-left,.uib-right{width:100%}</style>'),angular.$$uibDatepickerCss=!0}),angular.module("mosapp.fields.period.datepickerPopup",["ui.bootstrap.datepicker","ui.bootstrap.tpls","mosapp.fields.period.position"]).value("$datepickerPopupLiteralWarning",!0).constant("mosDatepickerPopupConfig",{altInputFormats:[],appendToBody:!1,clearText:"Clear",closeOnDateSelection:!0,closeText:"Done",currentText:"Today",datepickerPopup:"yyyy-MM-d",datepickerPopupTemplateUrl:"00_fields/period/datepicker-popup/datepicker-popup.tpl.html",datepickerTemplateUrl:"00_fields/period/datepicker-popup/datepicker.tpl.html",html5Types:{date:"yyyy-MM-d","datetime-local":"yyyy-MM-ddTHH:mm:ss.sss",month:"yyyy-MM"},onOpenFocus:!0,showButtonBar:!0,placement:"auto bottom-left"}).controller("MosDatepickerPopupController",["$scope","$element","$attrs","$compile","$log","$parse","$window","$document","$rootScope","mosPosition","dateFilter","uibDateParser","mosDatepickerPopupConfig","$timeout","uibDatepickerConfig","$datepickerPopupLiteralWarning",function(o,n,r,t,a,e,i,s,l,c,d,p,m,u,L,g){var f,h,v,y,_,b,w,M,k,S,D,T,C=!1,P=[];function x(e){var t=p.parse(e,f,o.date);if(isNaN(t))for(var a=0;a<T.length;a++)if(t=p.parse(e,T[a],o.date),!isNaN(t))return t;return t}function $(e){if(!(e=angular.isNumber(e)?new Date(e):e))return null;if(angular.isDate(e)&&!isNaN(e))return e;if(angular.isString(e)){var t=x(e);if(!isNaN(t))return p.toTimezone(t,S.getOption("timezone"))}return S.getOption("allowInvalid")?e:undefined}function A(e,t){e=e||t;return!r.ngRequired&&!e||(!(e=angular.isNumber(e)?new Date(e):e)||(!(!angular.isDate(e)||isNaN(e))||!!angular.isString(e)&&!isNaN(x(e))))}function I(e){var t,a;!o.isOpen&&o.disabled||(a=D[0],t=n[0].contains(e.target),a=a.contains!==undefined&&a.contains(e.target),!o.isOpen||t||a||o.$apply(function(){o.isOpen=!1}))}function E(e){27===e.which&&o.isOpen?(e.preventDefault(),e.stopPropagation(),o.$apply(function(){o.isOpen=!1}),n[0].focus()):40!==e.which||o.isOpen||(e.preventDefault(),e.stopPropagation(),o.$apply(function(){o.isOpen=!0}))}function O(){var e,t,a,i;o.isOpen&&(e=angular.element(D[0].querySelector(".mos-datepicker-popup")),t=angular.element(D[0].querySelector(".arrow")),i=r.popupPlacement||m.placement,a=c.parsePlacement(i),e.addClass(a[0]),a=c.positionElements(n,e,i,v),i=Math.round(a.hostElem.top+(a.hostElem.height-1)/2),e.css({top:a.top+"px",left:a.left+"px"}),t.css({top:i}),e.hasClass("mos-position-measure")&&e.removeClass("mos-position-measure"))}this.init=function(e){if(S=function(e){var t;angular.version.minor<6?(t=angular.isObject(e.$options)?e.$options:{timezone:null}).getOption=function(e){return t[e]}:t=e.$options;return t}(k=e),h=angular.isDefined(r.closeOnDateSelection)?o.$parent.$eval(r.closeOnDateSelection):m.closeOnDateSelection,v=angular.isDefined(r.datepickerAppendToBody)?o.$parent.$eval(r.datepickerAppendToBody):m.appendToBody,y=angular.isDefined(r.onOpenFocus)?o.$parent.$eval(r.onOpenFocus):m.onOpenFocus,w=(angular.isDefined(r.datepickerPopupTemplateUrl)?r:m).datepickerPopupTemplateUrl,_=(angular.isDefined(r.datepickerTemplateUrl)?r:m).datepickerTemplateUrl,T=angular.isDefined(r.altInputFormats)?o.$parent.$eval(r.altInputFormats):m.altInputFormats,o.showButtonBar=angular.isDefined(r.showButtonBar)?o.$parent.$eval(r.showButtonBar):m.showButtonBar,m.html5Types[r.type]?(f=m.html5Types[r.type],C=!0):(f=r.mosDatepickerPopup||m.datepickerPopup,r.$observe("mosDatepickerPopup",function(e,t){e=e||m.datepickerPopup;if(e!==f&&(f=e,k.$modelValue=null,!f))throw new Error("mosDatepickerPopup must have a date format specified.")})),!f)throw new Error("mosDatepickerPopup must have a date format specified.");if(C&&r.mosDatepickerPopup)throw new Error("HTML5 date input types do not support custom formats.");(b=angular.element("<div mos-datepicker-popup-wrap><div uib-datepicker></div></div>")).attr({"ng-model":"date","ng-change":"dateSelection(date)","template-url":w}),(w=angular.element(b.children()[0])).attr("template-url",_),o.datepickerOptions||(o.datepickerOptions={}),C&&"month"===r.type&&(o.datepickerOptions.datepickerMode="month",o.datepickerOptions.minMode="month"),w.attr("datepicker-options","datepickerOptions"),C?k.$formatters.push(function(e){return o.date=p.fromTimezone(e,S.getOption("timezone")),e}):(k.$$parserName="date",k.$validators.date=A,k.$parsers.unshift($),k.$formatters.push(function(e){return k.$isEmpty(e)?o.date=e:(angular.isNumber(e)&&(e=new Date(e)),o.date=p.fromTimezone(e,S.getOption("timezone")),p.filter(o.date,f))})),k.$viewChangeListeners.push(function(){o.date=x(k.$viewValue)}),n.on("keydown",E),D=t(b)(o),b.remove(),v?s.find("body").append(D):n.after(D),o.$on("$destroy",function(){for(!0!==o.isOpen||l.$$phase||o.$apply(function(){o.isOpen=!1}),D.remove(),n.off("keydown",E),s.off("click",I),M&&M.off("scroll",O),angular.element(i).off("resize",O);P.length;)P.shift()()})},o.getText=function(e){return o[e+"Text"]||m[e+"Text"]},o.isDisabled=function(e){"today"===e&&(e=p.fromTimezone(new Date,S.getOption("timezone")));var t={};return angular.forEach(["minDate","maxDate"],function(e){o.datepickerOptions[e]?angular.isDate(o.datepickerOptions[e])?t[e]=new Date(o.datepickerOptions[e]):(g&&a.warn("Literal date support has been deprecated, please switch to date object usage"),t[e]=new Date(d(o.datepickerOptions[e],"medium"))):t[e]=null}),o.datepickerOptions&&t.minDate&&o.compare(e,t.minDate)<0||t.maxDate&&0<o.compare(e,t.maxDate)},o.compare=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate())-new Date(t.getFullYear(),t.getMonth(),t.getDate())},o.dateSelection=function(e){o.date=e;e=o.date?p.filter(o.date,f):null;n.val(e),k.$setViewValue(e),h&&(o.isOpen=!1,n[0].focus())},o.keydown=function(e){27===e.which&&(e.stopPropagation(),o.isOpen=!1,n[0].focus())},o.select=function(e,t){t.stopPropagation(),"today"===e&&(t=new Date,angular.isDate(o.date)?(e=new Date(o.date)).setFullYear(t.getFullYear(),t.getMonth(),t.getDate()):(e=p.fromTimezone(t,S.getOption("timezone"))).setHours(0,0,0,0)),o.dateSelection(e)},o.close=function(e){e.stopPropagation(),o.isOpen=!1,n[0].focus()},o.disabled=angular.isDefined(r.disabled)||!1,r.ngDisabled&&P.push(o.$parent.$watch(e(r.ngDisabled),function(e){o.disabled=e})),o.$watch("isOpen",function(e){e?o.disabled?o.isOpen=!1:u(function(){O(),y&&o.$broadcast("uib:datepicker.focus"),s.on("click",I);var e=r.popupPlacement||m.placement;v||c.parsePlacement(e)[2]?(M=M||angular.element(c.scrollParent(n)))&&M.on("scroll",O):M=null,angular.element(i).on("resize",O)},0,!1):(s.off("click",I),M&&M.off("scroll",O),angular.element(i).off("resize",O))}),o.$on("uib:datepicker.mode",function(){u(O,0,!1)})}]).directive("mosDatepickerPopup",function(){return{require:["ngModel","mosDatepickerPopup"],controller:"MosDatepickerPopupController",scope:{datepickerOptions:"=?",isOpen:"=?",currentText:"@",clearText:"@",closeText:"@",label:"@"},link:function(e,t,a,i){var o=i[0];i[1].init(o)}}}).directive("mosDatepickerPopupWrap",function(){return{restrict:"A",transclude:!0,templateUrl:function(e,t){return t.templateUrl||UrlSrvc.tmplPath("00_fields/period/datepicker-popup.tpl.html")}}}).name;var periodModule=angular.module("mosapp.fields.period",["mosapp.fields.period.datepickerPopup","ui.mask"]),ZERO_CHAR=(periodModule.config(["$provide","$filterProvider",function(e,t){e.decorator("uibDatepickerDirective",["$delegate",function(e){var t=e[0],r=t.link;return t.compile=function(){return function(a,e,t,i){r.apply(this,arguments);var o=i[0],n=i[1];o.customClass=function(e){var t=n.$viewValue?new Date(n.$viewValue):null;return a.customClass({date:e,mode:a.datepickerMode},o.activeDate,t)}}},e}]),t.register("date",dateFilter)}]).directive("mosPeriod",["UrlSrvc",function(e){return{restrict:"AE",require:["mosPeriod","^ngModel"],scope:{label:"=",presets:"=",placement:"=",ngModel:"=ngModel"},controller:"MosPeriodController",controllerAs:"ctrl",templateUrl:e.tmplPath("00_fields/period/period.tpl.html"),link:function(e,t,a,i){var o=i[0],i=i[1];o.init(i)}}}]).controller("MosPeriodController",["$scope","$filter","$tooltip","$element","$timeout","$translate","UrlSrvc","LangSrvc",function(i,o,n,r,a,s,l,e){var c,d=this,p="mosPeriod"+(new Date).getTime(),m=(i.lang=e.getCurrentLang(),d.format="dd.MM.yyyy",d.maskDefinition={"Д":/\d/,"М":/\d/,"Г":/\d/},d.maskOptions={maskDefinitions:d.maskDefinition,addDefaultPlaceholder:!1,clearOnBlurPlaceholder:!0,uiMaskPlaceholder:"ДД.ММ.ГГГГ"},d.model={mode:"all",from:null,to:null},d.focus={},d.datepickerOptions={customClass:function(e,t,a){var i=new Date(e.date).setHours(0,0,0,0),o=new Date;return o.setHours(0,0,0,0),"day"===e.mode&&t&&e.date.getMonth()!==t.getMonth()?"inactive":"month"===e.mode&&a&&e.date.getMonth()===a.getMonth()&&e.date.getFullYear()===a.getFullYear()||"year"===e.mode&&a&&e.date.getFullYear()===a.getFullYear()?"active":"day"===e.mode&&i===o.getTime()||"month"===e.mode&&e.date.getMonth()===o.getMonth()&&e.date.getFullYear()===o.getFullYear()||"year"===e.mode&&e.date.getFullYear()===o.getFullYear()?"today":void 0},formatDayTitle:"LLLL, yyyy",formatMonth:"LLLL",formatDay:"d",showWeeks:!1,startingDay:0},d.fromDpOpts=$.extend({},d.datepickerOptions),d.toDpOpts=$.extend({},d.datepickerOptions),{from:!1,to:!1});function t(){d.isKeyboard?d.isKeyboard=!1:(a.cancel(i.debounceTimer),i.debounceTimer=a(function(){u(),d.widthLT768?g():d.$tooltip.hide()},100))}function u(){d.widthLT768=Modernizr&&Modernizr.mq("(max-width: 767px)"),d.widthLT768}function g(){var e,t="";$(e).css("min-height",t)}function f(e){e=$(e.parentNode);d.$popup.animate({scrollTop:d.$popup[0].scrollTop+e.position().top},"fast")}d.opened=$.extend({},m),i.$on("$destroy",function(){$(window).off("resize.period")}),d.init=function(e){(c=e).$processModelValue=function(){var e=this.$$format();this.$viewValue!==e&&(this.$viewValue=this.$$lastCommittedViewValue=e,this.$render(),this.$$runValidators(this.$modelValue,this.$viewValue,function(){}))},c.$$format=function(){for(var e=this.$formatters,t=e.length,a=this.$modelValue;t--;)a=e[t](a);return a},d.presets=i.presets,d.periods={selectDates:s("fieldPeriod."+(t="selectDates")).then(function(e){return d.periods[t]=e})},d.presets&&d.presets.length?d.presets.forEach(function(e){d.periods[e.code]=e.title}):(d.mode="period",d.model.mode=d.mode),i.$watch(function(){return c.$modelValue},function(e,t){e&&(d.mode=e.mode,"period"===e.mode?(d.model.from=e.from,d.model.to=e.to):(d.model.from=null,d.model.to=null))}),c.$formatters.push(function(e){return!c.$isEmpty(e=e||{mode:"all",from:null,to:null})&&e.from&&e.to?o("date")(e.from,"d MMMM yyyy")+" – "+o("date")(e.to,"d MMMM yyyy"):e&&e.mode&&d.periods[e.mode]||e});var t,a=c.$render;c.$render=function(){a(),d.period=angular.isString(c.$viewValue)?c.$viewValue:""},d.$tooltip=n(r.find(".mos-period__trigger"),{prefixClass:"dropdown",prefixEvent:p,keyboard:!0,html:!1,delay:0,scope:i,template:l.tmplPath("00_fields/period/periodPopup.tpl.html"),placement:"bottom-right",autoClose:!1,trigger:"manual"})},i.$on(p+".show.before",function(){d.opened=$.extend({},m);var e=c.$modelValue;e&&(d.mode=e.mode,"period"===e.mode?(d.model.from=c.$modelValue.from||d.model.from,d.model.to=c.$modelValue.to||d.model.to):(d.model.from=null,d.model.to=null))}),i.$on(p+".show",function(){var e=document.querySelector(".mos-period__popup");d.$popup=$(e),g(),d.$popup.on("touchmove.mos-period",function(e){e.preventDefault(),e.stopPropagation()}),u(),$("body").on("click.mos-period",function(){d.$tooltip.hide()}),$(window).on("resize.mos-period",t)}),i.$on(p+".hide.before",function(){d.$popup.off("touchmove.mos-period"),$("body").off("click.mos-period"),$(window).off("resize.mos-period",t)}),i.$on(p+".hide",function(){d.$popup=null}),d.updateModel=function(e){"from"===e?$.extend(d.toDpOpts,{minDate:d.model.from}):"to"===e&&$.extend(d.fromDpOpts,{maxDate:d.model.to}),d.widthLT768||((e=angular.copy(d.model)).from&&e.to||!e.from&&!e.to)&&(c.$setViewValue(e),c.$processModelValue(),e.from&&e.to&&d.$tooltip.hide())},d.clicked=function(e){var t=$(e.target);t.length&&t.parents(".mos-period__popup").length&&e.stopPropagation(),d.opened=$.extend({},m)},d.inputClicked=function(e,t){d.focus[t]&&d.widthLT768&&(d.isKeyboard=!0,a(function(){f(e.target)},300))},d.focused=function(e,t){d.focus[t]=!0,d.widthLT768?(d.isKeyboard=!0,a(function(){f(e.target)},300)):d.toggle(t,!0)},d.blured=function(e,t){d.focus[t]=!1,d.isKeyboard=!1},d.toggle=function(e,t){var a={};a[e]=t,(a.from||a.to)&&(d.opened=$.extend({},m,a))},d.select=function(e){d.mode=e,"period"!==(d.model.mode=e)&&(d.model.from=null,d.model.to=null,d.widthLT768||d.apply())},d.apply=function(){var e=angular.copy(d.model);c.$setViewValue(e),c.$processModelValue(),d.$tooltip.hide()}}]),"0"),slice=[].slice;function padNumber(e,t,a,i){var o="";for((e<0||i&&e<=0)&&(i?e=1-e:(e=-e,o="-")),e=""+e;e.length<t;)e=ZERO_CHAR+e;return o+(e=a?e.substr(e.length-t):e)}function dateGetter(t,a,i,o,n){return i=i||0,function(e){e=e["get"+t]();return(0<i||-i<e)&&(e+=i),padNumber(e=0===e&&-12===i?12:e,a,o,n)}}function dateStrGetter(a,i,o){return function(e,t){e=e["get"+a]();return t[angular.uppercase((o?"STANDALONE":"")+(i?"SHORT":"")+a)][e]}}function timeZoneGetter(e,t,a){var a=-1*a,i=0<=a?"+":"";return i+=padNumber(Math[0<a?"floor":"ceil"](a/60),2)+padNumber(Math.abs(a%60),2)}function weekGetter(a){return function(e){var t=getFirstThursdayOfYear(e.getFullYear()),e=getThursdayThisWeek(e);return padNumber(1+Math.round((+e-+t)/6048e5),a)}}function ampmGetter(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function eraGetter(e,t){return e.getFullYear()<=0?t.ERAS[0]:t.ERAS[1]}function longEraGetter(e,t){return e.getFullYear()<=0?t.ERANAMES[0]:t.ERANAMES[1]}var DATE_FORMATS={yyyy:dateGetter("FullYear",4,0,!1,!0),yy:dateGetter("FullYear",2,0,!0,!0),y:dateGetter("FullYear",1,0,!1,!0),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),LLLL:dateStrGetter("Month",!1,!0),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:ampmGetter,Z:timeZoneGetter,ww:weekGetter(2),w:weekGetter(1),G:eraGetter,GG:eraGetter,GGG:eraGetter,GGGG:longEraGetter},DATE_FORMATS_SPLIT=/((?:[^yMLdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|m+|s+|a|Z|G+|w+))([\s\S]*)/,NUMBER_STRING=/^\-?\d+$/;function dateFilter(f){var h=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(t,e,a){var i,o,n,r,s,l,c,d,p,m="",u=[];if(e=f.DATETIME_FORMATS[e=e||"mediumDate"]||e,angular.isString(t)&&(t=NUMBER_STRING.test(t)?toInt(t):(p=(n=t).match(h))?(r=new Date(0),d=c=0,l=p[8]?r.setUTCFullYear:r.setFullYear,s=p[8]?r.setUTCHours:r.setHours,p[9]&&(c=toInt(p[9]+p[10]),d=toInt(p[9]+p[11])),l.call(r,toInt(p[1]),toInt(p[2])-1,toInt(p[3])),l=toInt(p[4]||0)-c,c=toInt(p[5]||0)-d,d=toInt(p[6]||0),p=Math.round(1e3*parseFloat("0."+(p[7]||0))),s.call(r,l,c,d,p),r):n),angular.isNumber(t)&&(t=new Date(t)),!angular.isDate(t)||!isFinite(t.getTime()))return t;for(;e;)e=(o=DATE_FORMATS_SPLIT.exec(e))?(u=concat(u,o,1)).pop():(u.push(e),null);var g=t.getTimezoneOffset();return a&&(g=timezoneToOffset(a,g),t=convertTimezoneToLocal(t,a,!0)),angular.forEach(u,function(e){i=DATE_FORMATS[e],m+=i?i(t,f.DATETIME_FORMATS,g):"''"===e?"'":e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),m}}function concat(e,t,a){return e.concat(slice.call(t,a))}function TmplService(){this.transferToPhantom=function(e){e&&(angular.isString(e)&&(e=+e),"function"!=typeof window.phantomJsLastModified||isNaN(e)||window.phantomJsLastModified(moment.unix(e).utcOffset(3).toDate().toUTCString()))}}dateFilter.$inject=["$locale"],angular.module("mosapp.fields.period.position",[]).factory("mosPosition",["$document","$window",function(l,d){var t,a,c={normal:/(auto|scroll)/,hidden:/(auto|scroll|hidden)/},p={auto:/\s?auto?\s?/i,primary:/^(top|bottom|left|right)$/,secondary:/^(top|bottom|left|right|center)$/,vertical:/^(top|bottom)$/},o=/(HTML|BODY)/;return{getRawNode:function(e){return!e.nodeName&&e[0]||e},parseStyle:function(e){return e=parseFloat(e),isFinite(e)?e:0},offsetParent:function(e){var t,a=(e=this.getRawNode(e)).offsetParent||l[0].documentElement;for(;a&&a!==l[0].documentElement&&(t=a,"static"===(d.getComputedStyle(t).position||"static"));)a=a.offsetParent;return a||l[0].documentElement},scrollbarWidth:function(e){return e?(angular.isUndefined(a)&&((e=l.find("body")).addClass("mos-position-body-scrollbar-measure"),a=d.innerWidth-e[0].clientWidth,a=isFinite(a)?a:0,e.removeClass("mos-position-body-scrollbar-measure")),a):(angular.isUndefined(t)&&(e=angular.element('<div class="mos-position-scrollbar-measure"></div>'),l.find("body").append(e),t=e[0].offsetWidth-e[0].clientWidth,t=isFinite(t)?t:0,e.remove()),t)},scrollbarPadding:function(e){e=this.getRawNode(e);var t=d.getComputedStyle(e),a=this.parseStyle(t.paddingRight),t=this.parseStyle(t.paddingBottom),e=this.scrollParent(e,!1,!0),i=this.scrollbarWidth(o.test(e.tagName));return{scrollbarWidth:i,widthOverflow:e.scrollWidth>e.clientWidth,right:a+i,originalRight:a,heightOverflow:e.scrollHeight>e.clientHeight,bottom:t+i,originalBottom:t}},isScrollable:function(e,t){e=this.getRawNode(e);t=t?c.hidden:c.normal,e=d.getComputedStyle(e);return t.test(e.overflow+e.overflowY+e.overflowX)},scrollParent:function(e,t,a){e=this.getRawNode(e);var i=t?c.hidden:c.normal,o=l[0].documentElement,t=d.getComputedStyle(e);if(a&&i.test(t.overflow+t.overflowY+t.overflowX))return e;var n="absolute"===t.position,r=e.parentElement||o;if(r===o||"fixed"===t.position)return o;for(;r.parentElement&&r!==o;){var s=d.getComputedStyle(r);if(!(n=n&&"static"!==s.position?!1:n)&&i.test(s.overflow+s.overflowY+s.overflowX))break;r=r.parentElement}return r},position:function(e,t){e=this.getRawNode(e);var a=this.offset(e),t=(t&&(t=d.getComputedStyle(e),a.top-=this.parseStyle(t.marginTop),a.left-=this.parseStyle(t.marginLeft)),this.offsetParent(e)),i={top:0,left:0};return t!==l[0].documentElement&&((i=this.offset(t)).top+=t.clientTop-t.scrollTop,i.left+=t.clientLeft-t.scrollLeft),{width:Math.round(angular.isNumber(a.width)?a.width:e.offsetWidth),height:Math.round(angular.isNumber(a.height)?a.height:e.offsetHeight),top:Math.round(a.top-i.top),left:Math.round(a.left-i.left)}},offset:function(e){var t=(e=this.getRawNode(e)).getBoundingClientRect();return{width:Math.round(angular.isNumber(t.width)?t.width:e.offsetWidth),height:Math.round(angular.isNumber(t.height)?t.height:e.offsetHeight),top:Math.round(t.top+(d.pageYOffset||l[0].documentElement.scrollTop)),left:Math.round(t.left+(d.pageXOffset||l[0].documentElement.scrollLeft))}},viewportOffset:function(e,t,a){a=!1!==a;var e=(e=this.getRawNode(e)).getBoundingClientRect(),i={top:0,left:0,bottom:0,right:0},o=l[0].documentElement,n=o.getBoundingClientRect();return i.top=n.top+o.clientTop,i.left=n.left+o.clientLeft,o===l[0].documentElement&&(i.top+=d.pageYOffset,i.left+=d.pageXOffset),i.bottom=i.top+o.clientHeight,i.right=i.left+o.clientWidth,a&&(n=d.getComputedStyle(o),i.top+=this.parseStyle(n.paddingTop),i.bottom-=this.parseStyle(n.paddingBottom),i.left+=this.parseStyle(n.paddingLeft),i.right-=this.parseStyle(n.paddingRight)),{top:Math.round(e.top-i.top),bottom:Math.round(i.bottom-e.bottom),left:Math.round(e.left-i.left),right:Math.round(i.right-e.right)}},parsePlacement:function(e){var t=p.auto.test(e);return(e=(e=t?e.replace(p.auto,""):e).split("-"))[0]=e[0]||"top",p.primary.test(e[0])||(e[0]="top"),e[1]=e[1]||"center",p.secondary.test(e[1])||(e[1]="center"),e[2]=!!t,e},positionElements:function(e,t,a,i){e=this.getRawNode(e),t=this.getRawNode(t);var o,n,r=angular.isDefined(t.offsetWidth)?t.offsetWidth:t.prop("offsetWidth"),s=angular.isDefined(t.offsetHeight)?t.offsetHeight:t.prop("offsetHeight"),l=(a=this.parsePlacement(a),i?this.offset(e):this.position(e)),c={top:0,left:0,placement:"",hostElem:l};switch(a[2]&&(o=this.viewportOffset(e,i),t=d.getComputedStyle(t),n={width:r+Math.round(Math.abs(this.parseStyle(t.marginLeft)+this.parseStyle(t.marginRight))),height:s+Math.round(Math.abs(this.parseStyle(t.marginTop)+this.parseStyle(t.marginBottom)))},a[0]="top"===a[0]&&n.height>o.top&&n.height<=o.bottom?"bottom":"bottom"===a[0]&&n.height>o.bottom&&n.height<=o.top?"top":"left"===a[0]&&n.width>o.left&&n.width<=o.right?"right":"right"===a[0]&&n.width>o.right&&n.width<=o.left?"left":a[0],a[1]="top"===a[1]&&n.height-l.height>o.bottom&&n.height-l.height<=o.top?"bottom":"bottom"===a[1]&&n.height-l.height>o.top&&n.height-l.height<=o.bottom?"top":"left"===a[1]&&n.width-l.width>o.right&&n.width-l.width<=o.left?"right":"right"===a[1]&&n.width-l.width>o.left&&n.width-l.width<=o.right?"left":a[1],"center"===a[1]&&(p.vertical.test(a[0])?(t=l.width/2-r/2,o.left+t<0&&n.width-l.width<=o.right?a[1]="left":o.right+t<0&&n.width-l.width<=o.left&&(a[1]="right")):(t=l.height/2-n.height/2,o.top+t<0&&n.height-l.height<=o.bottom?a[1]="top":o.bottom+t<0&&n.height-l.height<=o.top&&(a[1]="bottom")))),a[0]){case"top":c.top=l.top-s;break;case"bottom":c.top=l.top+l.height;break;case"left":c.left=l.left-r;break;case"right":c.left=l.left+l.width}switch(a[1]){case"top":c.top=l.top;break;case"bottom":c.top=l.top+l.height-s;break;case"left":c.left=l.left;break;case"right":c.left=l.left+l.width-r;break;case"center":if(p.vertical.test(a[0]))c.left=l.left+l.width/2-r/2;else{if(!i)if(this.offsetParent(e).getBoundingClientRect().height<n.height){c.top=0;break}c.top=l.top+l.height/2-s/2}}return c.top=Math.round(c.top),c.left=Math.round(c.left),c.placement="center"===a[1]?a[0]:a[0]+"-"+a[1],c},adjustTop:function(e,t,a,i){if(-1!==e.indexOf("top")&&a!==i)return{top:t.top-i+"px"}},positionArrow:function(e,t){var a=(e=this.getRawNode(e)).querySelector(".tooltip-inner, .popover-inner");if(a){var i=angular.element(a).hasClass("tooltip-inner"),o=i?e.querySelector(".tooltip-arrow"):e.querySelector(".arrow");if(o){var n={top:"",bottom:"",left:"",right:""};if("center"===(t=this.parsePlacement(t))[1])angular.element(o).css(n);else{var r="border-"+t[0]+"-width",s=d.getComputedStyle(o)[r],r="border-",a=(p.vertical.test(t[0])?r+=t[0]+"-"+t[1]:r+=t[1]+"-"+t[0],r+="-radius",d.getComputedStyle(i?a:e)[r]);switch(t[0]){case"top":n.bottom=i?"0":"-"+s;break;case"bottom":n.top=i?"0":"-"+s;break;case"left":n.right=i?"0":"-"+s;break;case"right":n.left=i?"0":"-"+s}n[t[1]]=a,angular.element(o).css(n)}}}}}}]).name,angular.module("mosapp.fields.select",[]).directive("mosSelect",["UrlSrvc",function(e){return{restrict:"A",replace:!0,link:function(n,e,r){e.on("$destroy",function(){n.$destroy()}),n.titleView=r.titleView||"title",n.$watch("category",function(e,t){!e||!e.hasOwnProperty("id")||n.categories&&!n.categories.length||t&&e.id===t.id||(""===e.id&&(n.category=n.categories[0]),n.changeCategory(e))});n.changeCategory=function(t){var a,e,i,o;n.multiple?((e=angular.copy(n.category)).length?(a=!0,angular.forEach(e,function(e){t.id==e.id&&(a=!1)}),a?n.category.push(t):n.category.splice((e=n.category,i=t,o=null,angular.forEach(e,function(e,t){i.id==e.id&&(o=t)}),o),1)):n.category.push(t),n.onCategoryChange(n.category)):(n.catid=t.id,r.onCategoryChange&&n.catid!==n.category.id&&n.onCategoryChange({catid:t.id}))},n.isSelected=function(t){var a=!1;return angular.forEach(n.category,function(e){t.id==e.id&&(a=!0)}),!!a}},scope:{categories:"=",category:"=",onCategoryChange:"&",label:"@",multiple:"@",titleView:"@"},templateUrl:e.tmplPath("00_fields/select/select.tpl.html")}}]).directive("scrollMenu",["$timeout",function(a){return{scope:!1,link:function(e,t){a(function(){angular.element(t).mCustomScrollbar({live:!0,scrollInertia:0,liveSelector:".customScrollbar",callbacks:{onScrollStart:function(){this.classList.add("mos-select_scroll-start")},onTotalScrollBack:function(){this.classList.remove("mos-select_scroll-start")}}})},200)}}}]).filter("listTitles",[function(){return function(e){var a=e.length,i="",o=", ";return angular.forEach(e,function(e,t){a-1==t&&(o=""),i+=e.title+o}),i}}]),angular.module("mosapp").service("APsrvc",["UrlSrvc","$q","$rootScope","$window",function(n,e,r,s){var l={default:"audioPlayer",v4:"audioPlayer_v4"};this.playerLoad=function(o){return e(function(e,t){var a,i=o.skin&&l[o.skin]||l.default;r.audioPlayer?"ready"!==r.audioPlayer.status?(a=document.getElementById("jplayerapiscript"),$(a).on("load",function(){e()})):e():(r.audioPlayer={},r.audioPlayer.status="load",(a=document.createElement("script")).id="jplayerapiscript",a.async="true",document.getElementsByTagName("head")[0].appendChild(a),a.src=n.jsPath("jplayer/jquery.jplayer.min.js"),$(a).on("load",function(){r.audioPlayer.api=s.jPlayer,r.audioPlayer.status="ready",e()}),o.nocss||((a=document.createElement("link")).rel="stylesheet",a.href=n.jsPath("jplayer/skin/"+i+".css"),a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a)))})}}]),angular.module("mosapp").value("apiQueue",[]).value("lastReq",!1).service("apiSrvc",["UrlSrvc","$http","$q","transformRequestAsFormPost","apiQueue","$timeout","loader","lastReq","LangSrvc",function(p,s,t,l,m,c,u,d,o){function g(){d&&(d=!1,c(function(){"function"==typeof window.callPhantom&&window.callPhantom({queue:"isempty"})},100))}s.defaults.headers.common["x-caller-id"]="markup-app",this.sendRequestFromQueue=function e(){var a,i,o,t,n,r=Math.floor(50*Math.random()+25);0<m.length&&(a={},angular.forEach(m[0],function(e,t){a[t]=m[0][t]}),"POST"===a.method?(t=(o=a).header,n=o.notTransform,t={url:o.url,method:"POST",data:o.params,headers:t},n||(t.transformRequest=l),s(t).success(function(e,t){var a;o.showError&&e.error&&(a={title:"Ошибка получения данных из API.",content:e.description,placement:"top",type:"warning",show:!0},e.errorMessage=a),u.switchOff(o.loaderEl),g(),o.resolve(e)}).error(function(e,t){u.switchOff(o.loaderEl),g(),o.reject({content:e,code:t})})):s({url:(i=a).url,method:"GET",params:i.params}).success(function(e,t){var a;i.showError&&e.error&&(a={title:"Ошибка получения данных из API.",content:e.description,placement:"top",type:"warning",show:!0},e.errorMessage=a),i.loaderEl&&!i.loaderEl.dontSwitchOff&&u.switchOff(i.loaderEl),g(),i.resolve(e,t)}).error(function(e,t){u.switchOff(i.loaderEl),g(),i.reject({content:e,code:t})}),m.shift(),0===m.length&&(d=!0)),c(e,r)};new Date;function f(e,t,a,i){return console.error("Object '"+e+"' not found! Check config, please."),u.switchOff(i),("function"==typeof a?a:t)({error:"Object '"+e+"' not found! Check config, please."}),!1}function h(a,e){var i=[];angular.forEach(e,function(e,t){-1<a.indexOf("%"+t+"%")&&(a=a.replace("%"+t+"%",e),i.indexOf(t)<0&&i.push(t))});for(var t=0;t<i.length;t++)delete e[i[t]];return a=-1<a.indexOf("[lang]")?a.replace("[lang]",o.getCurrentLang()):a}this.sendRequestFromQueue(),this.getData=function(o,n,r,s,l){return t(function(e,t){u.switchOn(l);var a=angular.copy(r),i=p.apiPath(o);if(!angular.isObject(i))return f(o,e,t,l);if(!(i=i[n]))return f(o+"."+n,e,t,l);angular.isObject(a);i=h(i,a);m.push({method:"GET",url:i,resolve:e,reject:t,params:a,showError:s,loaderEl:l})})},this.getDataByUrl=function(i,o,n,r){return t(function(e,t){u.switchOn(r);var a=angular.copy(o);if(!i)return f(i,e,t,r);angular.isObject(a);e={method:"GET",url:i=h(i,a),resolve:e,reject:t,params:a,showError:n,loaderEl:r};m.push(e)})},this.getDataCancelable=function(o,n,r,s,l){var c,e=t(function(e,t){u.switchOn(l);var a=angular.copy(r),i=p.apiPath(o);return angular.isObject(i)?(i=i[n])?(angular.isObject(a),i=h(i,a),c={method:"GET",url:i,resolve:e,reject:t,params:a,showError:s,loaderEl:l},void m.push(c)):f(o+"."+n,e,t,l):f(o,e,t,l)});return e.cancel=function(){c.resolve({state:"cancelled"})},e},this.postData=function(o,n,r,s,l,c,d){return t(function(e,t){u.switchOn(l);var a=angular.copy(r),i=p.apiPath(o);if(!angular.isObject(i))return f(o,e,t,l);if(!(i=i[n]))return f(o+"."+n,e,t,l);i=h(i,a);m.push({method:"POST",url:i,resolve:e,reject:t,params:a,showError:s,loaderEl:l,header:c,notTransform:d})})}}]).factory("transformRequestAsFormPost",function(){return function(e,t){t()["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8";var a,i=e;if(!angular.isObject(i))return null===i?"":i.toString();var o,n=[];for(o in i)i.hasOwnProperty(o)&&(a=i[o],n.push(encodeURIComponent(o)+"="+encodeURIComponent(null===a?"":a)));return n.join("&").replace(/%20/g,"+")}}).service("loader",["toolsSrvc",function(a){var i=50,n=.7;function r(e,t){"plainDots"===t.loaderType?(e.addClass("rel"),t.animate&&e.css({height:i+"px",overflow:"hidden"}),e.prepend('<div class="dots-loader-backdrop"></div><div class="dots-loader"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>')):(t="contrast"==a.colorScheme()?"grayscale":"",e.addClass("rel"),e.prepend('<div class="loader"><div class=" '+t+' loader-image"><div class="cssload-progress cssload-float cssload-shadow"><div class="cssload-progress-item"></div></div></div></div>'))}function s(e,t){var a;"plainDots"===t.loaderType?t.animate?(a=e,TweenLite.set(a,{height:""}),TweenLite.from(a,n,{height:i+"px",ease:Power2.easeIn,onComplete:function(){TweenLite.set(a,{height:"",overflow:""}),a.removeClass("rel"),a.find(".dots-loader-backdrop,.dots-loader").remove()}})):(e.removeClass("rel"),e.find(".dots-loader-backdrop,.dots-loader").remove()):(e.removeClass("rel"),e.find(".loader").remove())}function t(e){return e instanceof angular.element||("object"==typeof HTMLElement||"function"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof o&&null!==e&&1===o.nodeType&&"string"==typeof e.nodeName)}this.switchOn=function(a){var e;a&&(t(a)?(e=angular.element(a)).length&&r(e,a):a.hasOwnProperty("elems")&&(a.elems.hasOwnProperty("length")?a.elems.length&&angular.forEach(a.elems,function(e,t){r(angular.element(e),a),a.elems.length===t&&"function"==typeof a.onSwitchOn&&a.onSwitchOn()}):(r(e=angular.element(a.elems),a),"function"==typeof a.onSwitchOn&&a.onSwitchOn())))},this.switchOff=function(a){var e;a&&(t(a)?(e=angular.element(a)).length&&s(e,a):a.hasOwnProperty("elems")&&(a.elems.hasOwnProperty("length")?a.elems.length&&angular.forEach(a.elems,function(e,t){s(angular.element(e),a),a.elems.length===t&&"function"==typeof a.onSwitchOn&&a.onSwitchOn()}):(s(e=angular.element(a.elems),a),"function"==typeof a.onSwitchOff&&a.onSwitchOff()),"function"==typeof a.onSwitchOff&&a.onSwitchOff()))}}]).service("apiCache",["$q","apiSrvc",function(r,s){var l={};this.getData=function(e,t,a,i,o){var n=e+t+JSON.stringify(a);if(l[n])return r.when(l[n]);return s.getData(e,t,a,i,o).then(function(e){return l[n]=e})}}]),angular.module("mosapp.customisation",[]).service("CustomisationSrvc",[function(){var o={};return{add:function(e,t,a,i){return!o[e]&&(o[e]={name:e,fromWhere:t,options:a,callback:i},o.name)},get:function(e){return o[e]},delete:function(e){return delete o[e]},rewrite:function(e,t,a,i){return o[e]={name:e,fromWhere:t,options:a,callback:i},o[e]}}}]),angular.module("mosapp").service("districtsSrvc",["apiSrvc","$q","UrlSrvc","LangSrvc",function(e,t,a,n){var r=this,i={};function s(e){(e=e||{}).category=e.category||"";var t=(t=a.getLangLink(a.pagePath("search",""))).replace(new RegExp("/$","g"),"");return t=(t+="?category="+e.category)+("&hostApplied=false&page=1&skip_stat=2&q="+(e.query||"")),e.districts&&(t+="&districts="+e.districts),e.areas&&(t+="&areas="+e.areas),t}this.getDistricts=function(){return i.districtsMap?t.when(i.districtsMap):e.getData("newsfeed","directories",{expand:"areas"},!1).then(function(e){var a;return e.items&&e.items.length&&(a={},e.items.forEach(function(e){var t={};e.areas.forEach(function(e){t[e.id]=e}),e.areas=t,a[e.id]=e}),i.districtsMap=a),i.districtsMap},function(){return null})},this.extractDistrictsAndAreasFromMap=function(a,e,i){var o=[],n=[];return angular.forEach(e,function(e){var t=angular.copy(a[e.id]);t&&(t.url=s({districts:t.id,category:i.category,query:i.query}),o.push(t),e.area_ids&&e.area_ids.length&&angular.forEach(e.area_ids,function(e){e=t.areas[e];e&&(e.url=s({districts:t.id,areas:e.id,category:i.category,query:i.query}),n.push(e))}))}),{districts:o,areas:n}},this.handleDistricts=function(t,a,i){i=i||{};var o="ru"===n.getCurrentLang()?"title":"title_en";t&&t.length&&r.getDistricts().then(function(e){e&&(a.districts=[],a.areas=[],a.maxExtra=i.maxExtra||2,e=r.extractDistrictsAndAreasFromMap(e,t,{category:i.category}),a.districts=e.districts.map(function(e){return e.title=e[o],e}),a.areas=e.areas.map(function(e){return e.title=e[o],e}),a.districts.length>a.maxExtra?a.districtsMax=a.maxExtra:a.districtsMax=a.districts.length,a.areas.length>a.maxExtra?a.areasMax=a.maxExtra:a.areasMax=a.areas.length,a.moreClicked=function(e,t){t.widthLT768||(a[e+"Max"]=a[e].length)},a.moreReset=function(e){a[e+"Max"]=a.maxExtra})})}}]),angular.module("mosapp").service("GIS2srvc",["UrlSrvc","$q","$rootScope","$window","mosconfig","$timeout",function(e,a,t,i,o,n){var r={},s="no";this.add=function(e,t){r[e]=t},this.get=function(e){return r[e]},this.loadLibrary=function(){var e,t=a.defer();return"no"!==s?n(function e(){"yes"===s?t.resolve():"loading"===s&&n(e,100)},100):(s="loading",(e=document.createElement("script")).id="GisApi",e.async="true",document.getElementsByTagName("head")[0].appendChild(e),e.src=o["2GisApi"].url,$(e).on("load",function(){window.DG===undefined?(s="no",t.reject("API not found")):(s="yes",t.resolve())})),t.promise}}]),angular.module("mosapp").service("headmetaSrvc",["mosconfig","$timeout","LangSrvc","UrlSrvc","toolsSrvc",function(s,e,l,c,d){var p=this;this.expandWithSiteName=!0,this.reSetMetaTag=function(e,t,a){var i=document.querySelector("head"),o=i.querySelector("meta["+e+'="'+t+'"]');a?(o||(o=document.createElement("meta"),i.appendChild(o)),o.setAttribute(e,t),o.setAttribute("content",a)):o&&o.parentNode.removeChild(o)},this.removeMetaTag=function(e){var t=document.querySelector("head"),a=t.querySelector('meta[property="'+e+'"]');(a=a||t.querySelector('meta[name="'+e+'"]'))&&a.parentNode.removeChild(a)},this.setTitle=function(){for(var e=document.querySelector("head"),t=e.querySelector("title"),a=l.getCurrentLang(),i=s.titleParams||{},o=i.separator||" / ",i=i.siteName[a]||"Сайт Москвы",n=[],r=0;r<arguments.length;r++)n.push(d.htmlToPlaintext(arguments[r]));a=Array.prototype.slice.call(n,0);return a.push(i),t||(t=document.createElement("title"),e.appendChild(t)),t.innerHTML=a.join(o),this},this.setDescription=function(e){if(!e||""==e)return this;e=this.expandWithSiteName?this.expandDataWithSiteName(e):e;return p.reSetMetaTag("name","description",e),this},this.expandDataWithSiteName=function(e){var t=l.getCurrentLang(),t=(s.altParams||{})[t]||"Официальный сайт Мэра Москвы",a=" ";return e+(a="."!==e[e.length-1]?". ":a)+t},this.setKeywords=function(e){e&&""!=e&&p.reSetMetaTag("name","keywords",e)},this.addAmpHtml=function(e){var t=document.querySelector("head"),a=t.querySelector('link[rel="amphtml"]');a&&a.parentNode.removeChild(a),(e.match(/^\/mayor\/telegrams\/[\d]+\/$/)||e.match(/^\/mayor\/interviews\/[\d]+\/$/)||e.match(/^\/mayor\/transcripts\/[\d]+\/$/)||e.match(/^\/mayor\/media\/photo\/[\d]+\//)||e.match(/^\/mayor\/media\/video\/[\d]+\/$/))&&(a=document.createElement("link"),t.appendChild(a),a.setAttribute("rel","amphtml"),a.setAttribute("href","/amp"+e))},this.setPageMeta=function(e,t){if(!e[t])return this;var a,i=c.getMainDomain()||"",o=l.getCurrentLang(),n=(s.altParams||{})[o]||"Официальный сайт Мэра Москвы",r=angular.isObject(e[t].image)&&e[t].image.src?angular.copy(e[t].image):{src:(s.imagesPath||"")+"favicon/icon200x200.png",width:200,height:200,title:n};return r.src=0===r.src.indexOf("http")?r.src:i+"/"+r.src.replace(new RegExp("^/"),""),p.removeMetaTag("og:image"),p.removeMetaTag("og:image:width"),p.removeMetaTag("og:image:height"),p.removeMetaTag("og:image:alt"),"/mayor/themes/"!==window.location.pathname&&"/mayor/biography/"!==window.location.pathname&&0!==window.location.pathname.indexOf("/mayor/transcripts/")&&0!==window.location.pathname.indexOf("/mayor/telegrams/")&&0!==window.location.pathname.indexOf("/mayor/interviews/")&&0!==window.location.pathname.indexOf("/mayor/media/")&&!window.location.pathname.match("^/mayor/themes/[\\d]+/$")||(r.src="https://"+window.location.hostname+"/open-graph/v1/frontend"+window.location.pathname,r.width="1200",r.height="630"),p.reSetMetaTag("property","og:image",r.src),p.reSetMetaTag("property","og:image:url",r.src),p.reSetMetaTag("property","og:image:width",r.width),p.reSetMetaTag("property","og:image:height",r.height),p.reSetMetaTag("property","og:image:alt",r.fullTitle||r.title),p.addAmpHtml(location.pathname),p.reSetMetaTag("property","og:url",i+"/"+location.pathname.replace(new RegExp("^/"),"")),p.reSetMetaTag("property","og:site_name",n),t&&e[t]&&(a=d.htmlToPlaintext(e[t].description),setTimeout(function(){p.reSetMetaTag("property","og:title",d.htmlToPlaintext(e[t].title)),p.reSetMetaTag("property","og:description",a)}),p.setDescription(a),p.setKeywords(e[t].keywords),"article"===e[t].type?(p.reSetMetaTag("property","og:type",e[t].type),p.reSetMetaTag("property","article:publisher",s.linksPath.social[o].facebook),p.reSetMetaTag("property","article:author",s.linksPath.social[o].facebook),isNaN(+e[t].published_time)?p.removeMetaTag("article:published_time"):p.reSetMetaTag("property","article:published_time",moment.unix(+e[t].published_time).utcOffset(3).format()),p.reSetMetaTag("name","twitter:site_name",s.domain.replace("www.","")),p.reSetMetaTag("name","twitter:creator",s.linksPath.social[o].twitter_creator)):(p.removeMetaTag("article:publisher"),p.removeMetaTag("article:author"),p.removeMetaTag("article:published_time"),p.removeMetaTag("twitter:site_name"),p.removeMetaTag("twitter:creator"),p.reSetMetaTag("property","og:type",e[t].type||"website"))),this},this.extractMeta=function(){return{title:document.title,description:d.htmlToPlaintext(this.getContentFor("description")),keywords:this.getContentFor("keywords")}},this.getContentFor=function(e){e=document.querySelector('meta[name="'+e+'"]');return null!==e?e.getAttribute("content"):""},this.withoutSiteName=function(){return this.expandWithSiteName=!1,this},this.withSiteName=function(){return this.expandWithSiteName=!0,this}}]),angular.module("mosapp").service("libsLoader",["UrlSrvc","$q","$window",function(n,t,r){var a={};this.get=function(i){var o,e;return void 0===a[i.id]&&(o={},i.js&&(o.js=t(function(e,t){var a;o.status="load",i.js&&((a=document.createElement("script")).id=i.id,a.async="true"),document.getElementsByTagName("head")[0].appendChild(a),a.src=n.jsPath(i.js),$(a).on("load",function(){i.api&&(o.api=r[i.api]),o.status="ready",e(o)})})),a[i.id]=o,i.css&&((e=document.createElement("link")).rel="stylesheet",e.href=n.jsPath(i.css),e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e))),a[i.id]}}]),angular.module("mosapp").config(["mosconfig","$translateProvider","$translatePartialLoaderProvider","LangSrvcProvider",function(e,t,a,i){t.usePostCompiling(!0),t.useSanitizeValueStrategy("escape"),t.useLoader("$translatePartialLoader",{urlTemplate:e.i18nPath+"{part}/{lang}.json?1677769505234"}),t.preferredLanguage(i.setCurrentLang())}]),angular.module("mosapp").service("opengraphSrvc",["mosconfig","$timeout","LangSrvc","UrlSrvc","toolsSrvc","headmetaSrvc","$location",function(e,t,a,i,o,n,r){this.invalidateWithGlobalMeta=function(){var e=n.extractMeta();return t(function(){n.reSetMetaTag("property","og:title",e.title),n.reSetMetaTag("property","og:description",e.description)}),this},this.passUrl=function(){return n.reSetMetaTag("property","og:url",r.absUrl().replace(new RegExp("all/$"),"")),this}}]),angular.module("mosapp").service("tColumn",["UrlSrvc","$q","$rootScope","$window",function(i,t,o,n){this.columnizerLoad=function(e){return t(function(e,t){var a;o.textColumnizer?"ready"!==o.textColumnizer.status?(a=document.getElementById("columnizerapiscript"),$(a).on("load",function(){e()})):e():(o.textColumnizer={},o.textColumnizer.status="load",(a=document.createElement("script")).id="columnizerapiscript",a.async="true",document.getElementsByTagName("head")[0].appendChild(a),a.src=i.jsPath("columnizer/jquery.columnizer.js"),$(a).on("load",function(){o.textColumnizer.api=n.columnizer,o.textColumnizer.status="ready",e()}))})}}]),angular.module("mosapp").service("tmplSrvc",TmplService),angular.module("mosapp").service("toolsSrvc",["mosconfig","$timeout","LangSrvc","UrlSrvc","$filter",function(mosconfig,$timeout,LangSrvc,UrlSrvc,$filter){var errorInfo,self=this;this.ruStrToDate=function(e){var t,a=!1;return(a=angular.isString(e)&&2<(t=e.split(".")).length?new Date(t[2],t[1]-1,t[0]):a)||e},this.getMaxDate=function(e){return Math.max.apply(null,e)},this.sanitize=function(e){return e.replace(/\u200B/g,"")},this.getSiteLogo=function(){return mosconfig.siteLogo||null},this.fillOutPages=function(e,t){for(var a=[],i=1;i<t+1;i++)a.push({num:i});return a},this.scrollTop=function(e){TweenLite.to(window,e||.75,{scrollTo:{y:0},ease:Power2.easeOut,onComplete:function(){}})},this.colorScheme=function(){return"true"===localStorage.getItem("contrast")?"contrast":"default"},this.htmlToPlaintext=function(e){return(e=e?String(e).replace(/\&\w{4,5};/gm," "):"")?String(e).replace(/<[^>]+>/gm,""):""},this.getMetaForImage=function(e){var t=LangSrvc.getCurrentLang();return{alt:e+". "+mosconfig.altParams[t],title:e}},this.removeMetaTag=function(e){var t=document.querySelector("head"),a=t.querySelector('meta[property="'+e+'"]');(a=a||t.querySelector('meta[name="'+e+'"]'))&&a.parentNode.removeChild(a)},this.setMeta=function(e,t,a){var i=UrlSrvc.getMainDomain(),e=e.image&&""!==e.image&&e.image.indexOf("data:image",0)<0?e.image:(mosconfig.imagesPath||"")+"favicon/icon200x200.png",o=(e=0===e.indexOf("http")?e:i+"/"+e.replace(new RegExp("^/"),""),LangSrvc.getCurrentLang()),o=(mosconfig.altParams||{})[o]||"Официальный сайт Мэра Москвы";0===window.location.pathname.indexOf("/news/maintheme/")||"/city/projects/"===window.location.pathname||"/city/about/plan/"===window.location.pathname||"/authority/documents/"===window.location.pathname||0===window.location.pathname.indexOf("/authority/documents/doc/")||0===window.location.pathname.indexOf("/authority/projects/active/")||0===window.location.pathname.indexOf("/authority/projects/archive/")||0===window.location.pathname.indexOf("/authority/projects/doc/")||"/authority/discussion/"===window.location.pathname||0===window.location.pathname.indexOf("/authority/discussion/doc/")||0===window.location.pathname.indexOf("/city/about/symbols/")||0===window.location.pathname.indexOf("/city/about/honors/")?(e="https://"+window.location.hostname+"/open-graph/v1/frontend"+window.location.pathname,$('meta[property="og:image:width"]').attr("content",1200),$('meta[property="og:image:height"]').attr("content",630)):(self.removeMetaTag("og:image:width"),self.removeMetaTag("og:image:height")),$('meta[property="og:url"]').attr("content",i+"/"+location.pathname.replace(new RegExp("^/"),"")),$('meta[property="og:type"]').attr("content","website"),$('meta[property="og:site_name"]').attr("content",o),a&&t[a]&&(i=this.htmlToPlaintext(t[a].description),$('meta[property="og:title"]').attr("content",this.htmlToPlaintext(t[a].title)),$('meta[property="og:description"]').attr("content",i),self.setDescription(i)),$('meta[property="og:image"]').attr("content",e),$('meta[property="og:image:url"]').attr("content",e),self.removeMetaTag("article:publisher"),self.removeMetaTag("article:author"),self.removeMetaTag("article:published_time"),self.removeMetaTag("og:image:alt")},this.setTitle=function(){for(var e=LangSrvc.getCurrentLang(),t=mosconfig.titleParams||{},a=t.separator||" / ",t=t.siteName[e]||"Сайт Москвы",i=[],o=0;o<arguments.length;o++)i.push(this.htmlToPlaintext(arguments[o]));e=Array.prototype.slice.call(i,0);e.push(t),$("title").text(e.join(a))},this.setTitleClean=function(){for(var e=(mosconfig.titleParams||{}).separator||" / ",t=[],a=0;a<arguments.length;a++)t.push(this.htmlToPlaintext(arguments[a]));var i=Array.prototype.slice.call(t,0);$("title").text(i.join(e))},this.setDescription=function(e){var t,a=LangSrvc.getCurrentLang();e&&""!=e&&(a=(mosconfig.altParams||{})[a]||"Официальный сайт Мэра Москвы",t=" ","."!==e[e.length-1]&&(t=". "),self._setMeta("description",e+t+a))},this.setRawDescription=function(e){self._setMeta("description",e)},this.setRawTitle=function(e){$("title").text(e)},this.setKeywords=function(e){e&&""!=e&&self._setMeta("keywords",e)},this.setVerification=function(){self._setMeta("baidu-site-verification","Jauog7E16g")},this._setMeta=function(e,t){var a;e&&0!=e.length&&(0<(a=$("meta[name="+e+"]")).length?a.attr("content",t):((a=document.createElement("meta")).name=e,a.content=t,document.getElementsByTagName("head")[0].appendChild(a)))},this.togglerBlackAndWhite=function(e,t,a){a instanceof $||"string"!=typeof a?a instanceof $&&void 0!==a||(a=$(document.body)):a=$(a),"contrast"===t?(a.find(e).addClass("grayscale"),a.find(".grayscale-img").addClass("grayscale"),a.find(".grayscale").gray()):(a.find(".grayscale").toggleClass("grayscale-off"),a.find(e).removeClass("grayscale"),a.find(".grayscale-img").removeClass("grayscale"))},this.prepareTags=function(e){var t=[];return angular.isString(e)?e:angular.isArray(e)?(e.forEach(function(e){t.push(e.title)}),t.join(", ")):void 0},this.setErrorInfo=function(e){errorInfo=e},this.getErrorInfo=function(){return errorInfo},this.statCounter=function statCounter(params){var maxAttempts=20;function trySendMetrika(COUNTER_ID,TARGET_NAME,GOAL_PARAMS,cnt){var js="yaCounter"+COUNTER_ID+".reachGoal('"+TARGET_NAME+"');",params;try{GOAL_PARAMS?(params="yaCounter"+COUNTER_ID+".params("+(angular.isObject(GOAL_PARAMS)?JSON.stringify(GOAL_PARAMS):GOAL_PARAMS)+");",eval(params)):eval(js)}catch(e){cnt++,cnt<maxAttempts&&$timeout(function(){trySendMetrika(COUNTER_ID,TARGET_NAME,GOAL_PARAMS,cnt)},500)}}if(angular.isObject(params)&&angular.isObject(params.metrika)&&params.metrika.TARGET_NAME){var COUNTER_ID,TARGET_NAME=angular.isObject(params.metrika)&&params.metrika.TARGET_NAME?params.metrika.TARGET_NAME:null,GOAL_PARAMS=angular.isObject(params.params)?params.params:null;try{COUNTER_ID=mosconfig.stat.metrika.id}catch(e){}COUNTER_ID&&TARGET_NAME&&trySendMetrika(COUNTER_ID,TARGET_NAME,GOAL_PARAMS,0)}},this.localeNum=function(e,t){if("number"!=typeof(e=+e))return"";if((!t||t.length<1)&&(t=new Array("")),0<(e=e.toString()).indexOf(".")||0<e.indexOf(","))return t[1];var a=e.length,i=new Number(a<2?0:e.substr(a-2,1)),e=new Number(e.substr(a-1,1));return 1!=i?1<e&&e<5?t[1]:4<e&&e<=9||0==e?t[2]:1==e?t[0]:void 0:t[2]},this.hideContentArea=function(e){e.css("opacity",0)},this.showContentArea=function(e){e&&e.length&&TweenLite.to(e,.5,{opacity:1,ease:Power1.easeIn,onComplete:function(){e.css("opacity","")}})},this.transformDateToMos=function(e){var t=e.getTimezoneOffset()/60;return e=-3!=t?new Date(e.getTime()+3600*t*1e3+108e5):e},this.handleAlternateTags=function(i,e,t){for(var a=document.querySelectorAll('link[rel="alternate"]'),o=function(e){var t,a=[];for(t in e)a.push({lang:t,href:e[t].href,fromState:e[t].fromState});return a}(i.current.alternateLinks),n=0;n<a.length;n++){var r=a[n].attributes.href.nodeValue,s=a[n].attributes.hreflang.nodeValue;(o=o||[]).push({lang:s,href:r,fromState:!1})}o&&o.length&&o.forEach(function(a){(function(e,t){"zn"===e&&(e="cn");return UrlSrvc.getMainDomain()+("ru"===e?"":"/"+e)+("ru"===LangSrvc.getCurrentLang()?t:t.slice(3))})(a.lang,i.href(e)).replace(/^https/,"http")!==a.href.replace(/^https/,"http")?(t.forEach(function(e){var t=i.href(e),t=new RegExp(("ru"===LangSrvc.getCurrentLang()?t:t.slice(3))+"$","i"),e=i.get(e);t.test(a.href)&&(e.alternateLinks||(e.alternateLinks={}),e.alternateLinks[a.lang]||(e.alternateLinks[a.lang]={}),e.alternateLinks[a.lang].href=a.href,e.alternateLinks[a.lang].fromState=!0)}),document.querySelector('link[rel="alternate"][hreflang="'+a.lang+'"][href="'+a.href+'"]').remove()):a.fromState&&angular.element("head").append('<link rel="alternate" hreflang="'+a.lang+'" href="'+a.href+'">')})},this.joinProperty=function(e,t,a){var i="";return t&&e?e.map(function(e){return e[t]}).join(a):i},this.statsMosCounter=function(e){if(angular.isObject(e)){e={eventType:e.type,eventSrc:"mos.ru",eventDst:"stats",eventTime:parseInt((new Date).getTime()/1e3,10),mosId:getCookie("mos_id"),eventObject:e.params},e=JSON.stringify(e);try{fetch("https://stats.mos.ru/eds.gif?o="+e,{credentials:"include"})}catch(e){}}},this.dateRange=function(e,t){var a="d MMMM",i="d MMMM yyyy",o=(e=!!e&&new Date(e),t=!!t&&new Date(t),new Date),n=o.getTimezoneOffset()/60;if(-3!=n&&(o=new Date(o.getTime()+3600*n*1e3+108e5)),!e&&!t)return"";if(!e||!t)return r=(n=e||t).getFullYear()===o.getFullYear(),$filter("date")(n,r?a:i);var r,n=(r=e.getFullYear()===o.getFullYear())?a:i;return e.getFullYear()===t.getFullYear()?e.getMonth()===t.getMonth()?e.getDate()===t.getDate()?$filter("date")(e,n):e.getDate()+" – "+$filter("date")(t,n):$filter("date")(e,a)+" – "+$filter("date")(t,n):$filter("date")(e,i)+" – "+$filter("date")(t,i)},this.formatHoursMinutes=function(e){var e=self.transformDateToMos(new Date(1e3*e)),t=((t=e.getHours())<10?"0":"")+t,e=e.getMinutes();return t+":"+((e<10?"0":"")+e)}}]),angular.module("mosapp").service("UrlSrvc",["mosconfig","LangSrvc","$rootScope",function(n,a,e){function i(e){var t,a;if(!(e.length<=1))return t=e.split("/"),t=t[t.length-1].split("?"),a="/"!=e[e.length-1],a&&1===t.length?e+"/":a&&1!=t.length&&""!=t[0]?e.replace("?","/?"):e}function o(e){var e=i(e),t=a.getCurrentLang();return"ru"==t?e:"/"+t+e}function r(e,t){t=t((e=e||1)+1);return t?o(t):""}function s(e,t){t=t((e=e||1)-1);return t?o(t):""}function l(e,t,a){var i,o;e&&t&&(o=!1,(i=a?document.getElementById(a):i)||(i=document.createElement("link"),o=!0),i.id=a,i.rel=e,i.href=function(){var e="";n.domain&&(e=(e=(0===n.domain.indexOf("http")?"":location.protocol+"//")+n.domain).replace(new RegExp("/$"),""));return e}()+t,o&&document.getElementsByTagName("head")[0].appendChild(i))}function c(e){e=document.getElementById(e);e&&"LINK"===e.tagName&&document.getElementsByTagName("head")[0].removeChild(e)}e.$on("$stateChangeSuccess",function(){try{setTimeout(window.$mos_layouts.api.setActive,0)}catch(e){}}),this.getMainDomain=function(){var e="";return e=n.domain?(e=(0===n.domain.indexOf("http")?"":location.protocol+"//")+n.domain).replace(new RegExp("/$"),""):e},this.getLangLink=o,this.getLangLinkPrefix=function(){var e=a.getCurrentLang();return"ru"==e?"":"/"+e},this.getLangPath=function(e,t){return this.getLangLink(this.pagePath(e,t))},this.tmplPath=function(e){return e},this.apiPath=function(e,t){return n.restAPI[e]},this.jsPath=function(e){return((n.jsPath||"")+e).replace(new RegExp("//","g"),"/")},this.cssPath=function(e){return((n.cssPath||"")+e).replace(new RegExp("//","g"),"/")},this.pagePath=function(e,t){return i((n.pagePath[e]||"")+t).replace(new RegExp("//","g"),"/")},this.linksPath=function(e){return n.linksPath[e]},this.specialType=function(e){return n.specialType[e]||""},this.currentEmergency=function(e){if(e||n.emergency)return n.emergency[e]||""},this.currentEmergencyPath=function(e){if(e||n.emergency||n.emergency.path)return n.emergency.path[e]||""},this.getBanners=function(e,t){if(e&&n.banners&&n.banners[e])return t=t||a.getCurrentLang(),{domain:n.banners.domain,urlPath:n.banners.urlPath,items:n.banners[e][t]}},this.isExternalUrl=function(e){return!/(^((http(s)?:\/\/)?(www.)?|\/\/)?mos.ru)|^\/{1}([^\/]+|$)/gi.test(e)},this.addParamsToUrl=function(e,t){if(!t)return e;var a=(o=e.split("#"))[1]?"#"+o[1]:"",i=[],o=o[0].split("?");return angular.forEach(t,function(e,t){i.push(t+"="+e)}),1===o.length?e=o[0]+"?"+i.join("&"):2===o.length&&(e=o[0]+"?"+o[1]+"&"+i.join("&")),e+a},this.setCanonical=function(e){var t,a="";n.domain&&(a=(a=(0===n.domain.indexOf("http")?"":location.protocol+"//")+n.domain).replace(new RegExp("/$"),"")),e&&((t=document.createElement("link")).id="canonicalLink",t.rel="canonical",t.href=a+e,document.getElementsByTagName("head")[0].appendChild(t))},this.setPrevNextLinks=function(e,t,a,i){var o=r(e,a),e=s(e,a);t&&o?l("next",o,"link-rel-next"):c("link-rel-next"),e?l("prev",e,"link-rel-prev"):c("link-rel-prev")},this.getNextPageUrl=r,this.getPrevPageUrl=s,this.appendLink=l}]),angular.module("mosapp").filter("imagesPath",["mosconfig",function(t){return function(e){return((t.imagesPath||"")+e).replace(new RegExp("//","g"),"/")}}]),angular.module("mosapp").run(["$state","$stateParams","$window",function(e,t,a){function i(){if(angular.isObject(e))try{e.transitionTo(e.current,t,{reload:!0,inherit:!1,notify:!0})}catch(e){return window.location=window.location.href,!1}else window.location=window.location.href}a.addEventListener?a.addEventListener("contrastTrigger",i):a.attachEvent("oncontrastTrigger",function(){i.call(a)})}]),angular.module("mosapp").provider("LangSrvc",function(){var e=!1;this.setCurrentLang=function(){return e=e||((e=document.documentElement.lang)||"ru")},this.$get=function(){return{getCurrentLang:function(){return e}}}}).service("linksInterceptor",[function(){var a,r=0,s=new Object(null),l=(s[++r]={regExp:[/\/pgu\./],attr:"href",callback:function(e,t){"object"==typeof _paq&&"function"==typeof _paq.push&&(e.preventDefault(),e=$(t).attr("href"),_paq.push(["trackLink",e,"link"]),(t=window.open(e,"_blank"))&&t.focus())},id:r},s[++r]={regExp:[/\/pgu\//],attr:"href",callback:function(e,t){"object"==typeof window._paq&&"function"==typeof window._paq.push&&(t=$(t).attr("href"),_paq.push(["trackLink",t,"link"]))},id:r},{openInNewTab:function(e,t){e.preventDefault();e=$(t).attr("href"),t=window.open(e,"_blank");t&&t.focus()}});function c(e){return"function"==typeof e.exec}return function e(){var t=$("div.b-content");a&&$timeout.cancel(a),t.length?t.on("click","a",function(o){var n=$(this);Object.keys(s).forEach(function(e){var t=s[e],a=n.attr(t.attr);if(a&&""!==a)for(var i=0;i<t.regExp.length;i++)if(null!==t.regExp[i].exec(a)){t.callback(o,n,t.cbParams);break}})}):a=$timeout(e,100)}(),{add:function(e,t,a,i){var o,n=new Object(null);if(Array.isArray(e)?(o=[],e.forEach(function(e){c(e)&&o.push(e)}),n.regExp=o):c(e)&&(n.regExp=[e]),n.attr="string"==typeof a?a:"href","function"==typeof t)n.callback=t;else if("string"==typeof t){if("function"!=typeof l[t])return!1;n.callback=l[t]}return n.cbParams="object"==typeof i?i:new Object(null),n.id=++r,s[r]=n},remove:function(e){return!!s[e]&&(delete s[e],!0)},check:function(e){return!!s[e]}}}]),angular.module("mosapp").service("VPsrvc",["UrlSrvc","$q","$rootScope","$window","$timeout",function(r,e,s,l,c){this.playerLoad=function(i){return e(function(e,t){var a;s.videoPlayer?"ready"!==s.videoPlayer.status?(a=document.getElementById("flowplayerapiscript"),$(a).on("load",function(){e()})):e():(s.videoPlayer={},s.videoPlayer.status="load",(a=document.createElement("script")).id="flowplayerapiscript",a.async="true",document.getElementsByTagName("head")[0].appendChild(a),a.src=r.jsPath("flowplayer/flowplayer.min.js"),$(a).on("load",function(){s.videoPlayer.api=l.flowplayer,s.videoPlayer.status="ready",s.videoPlayer.api.conf={splash:!0,key:"$219658761613389, $156847843995181, $217505261009336, $438958512312610"},e()}),i.nocss||((a=document.createElement("link")).rel="stylesheet",a.href=r.jsPath("flowplayer/skin/playful.css"),a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a)))})},this.playerVideoJSLoad=function(n){return e(function(t,e){var a,i,o;s.videoPlayerJS?"load"===s.videoPlayerJS.status?c(function e(){"ready"===s.videoPlayerJS.status?t():c(e,100)},100):t():(s.videoPlayerJS={},s.videoPlayerJS.status="load",(o=document.createElement("script")).id="videojs_script",o.async="true",(i=document.getElementsByTagName("head")[0]).appendChild(o),o.src=r.jsPath("videojs/video.js"),$(o).on("load",function(){(a=document.createElement("script")).id="videojs_hls_script",a.async="true",a.src=r.jsPath("videojs/videojs-contrib-hls.js"),i.appendChild(a),$(a).on("load",function(){window.videojs.options.flash.swf=r.jsPath("videojs/video-js.swf"),s.videoPlayerJS.api=l.videojs,s.videoPlayerJS.status="ready",t()})}),n.nocss||((o=document.createElement("link")).rel="stylesheet",o.href=r.jsPath("videojs/video-js.min.css"),o.type="text/css",i.appendChild(o)))})}}]),angular.module("projects.templates",[]).run(["$templateCache",function(e){e.put("mosBanner/mosBanner.tpl.html",'<div class="extconts-service-container"></div>'),e.put("socialWidget/informerWeatherTraffic.tpl.html",'<ul class="weather-traffic-informer"><li data-ng-repeat="informer in informers" data-ng-if="!informer.hideme" data-ng-class="informer.api"><span class="title">{{informer.title}}</span><img class="ico" data-ng-if="informer.data.image &amp;&amp; informer.api !== \'infoTraffic\'" data-ng-class="{\'grayscale-modern\': colorScheme == \'contrast\'}" data-ng-src="{{informer.data.image | imageSrc}}" data-ng-style="{width:((colorScheme==\'contrast\')?(informer.data.image.width*2) : informer.data.image.width) + \'px\',height:((colorScheme==\'contrast\')?(informer.data.image.height*2) : informer.data.image.height) + \'px\'}" alt=""/><div class="ico icon-traffic-lights" data-ng-if="informer.api == \'infoTraffic\'" data-ng-class="{\'grayscale-modern\': colorScheme == \'contrast\', \'{{informer.class}}\': informer.class}"></div><span class="data">{{ informer.data.value }} {{ informer.units }}</span></li></ul>'),e.put("socialWidget/socialWidget.tpl.html",'<div class="subhead"><div class="row" data-ng-style="border"><ul class="mayor-social col-sm-7" data-ng-if="lang === \'ru\'"><li class="mayor-social__logo"><img ng-src="{{\'mayour-logo.jpg\' | imagesPath}}" alt=""/></li><li class="title"><strong>{{\'social_widget.mayor_in_social_first\' | translate}}</strong><span> {{\'social_widget.mayor_in_social_last\' | translate}}</span></li><li><a class="icon icon-share-vk" data-ng-href="{{social.vkMayor}}" target="_blank" href="" title="vk"></a></li></ul><div class="weater-trafic-informer-wrapper hidden-xs col-sm-5" informer-weather-traffic="" data-ng-class="{\'pull-left\': lang !== \'ru\'}"></div></div></div>'),e.put("projectsMain/projectsMain.tpl.html",'<div data-mos-error="mosError" data-ng-if="mosError"></div><div class="projects-main" data-ng-if="!mosError"><div class="projects-main__items row"><div class="col-xs-12 col-sm-6 col-md-6" data-ng-repeat="item in items track by $index"><a class="projects-main__item" data-ng-if="item.type == \'tilda\'" data-ng-href="{{item.url}}"><div class="projects-main__item-bg" data-ng-class="{\'grayscale\':colorScheme==\'contrast\'}" data-ng-style="{\'background-image\': \'url(&quot;{{item.image | imageSrc}}&quot;)\'}"></div><div class="projects-main__item-title"> {{item.title}}</div></a><a class="projects-main__item" data-ng-if="item.type != \'tilda\'" data-ng-href="{{item.url}}" target="{{item.type === \'outer\' ? \'_blank\' : \'\'}}"><div class="projects-main__item-bg" data-ng-class="{\'grayscale\':colorScheme==\'contrast\'}" data-ng-style="{\'background-image\': \'url(&quot;{{item.image | imageSrc}}&quot;)\'}"></div><div class="projects-main__item-title"> {{item.title}}</div></a></div></div><div class="projects-main__items_get-more"><a class="projects-main__items_get-more_button" data-ng-click="getMore(); $event.preventDefault(); $event.stopPropagation();" data-ng-href="{{ getNextPageUrl() }}" data-ng-if="isThereMorePages" data-translate="projectsMain.see"></a></div></div>'),e.put("sharing/sharing.tpl.html",'<div class="b-sharing"><div class="b-sharing__share-button" data-ng-if="isModal()"><button class="b-iconic-btn" data-ng-click="openPopup()"><i class="icon-share_blue"></i><span class="b-iconic-btn__text" data-translate="mosSharing.shareTitle"></span></button></div><div class="b-sharing-links" id="{{id}}" data-ng-class="dynClass" data-ng-if="!isModal()"></div></div>'),e.put("sharingPopup/sharingPopup.tpl.html",'<div class="b-popup-sharing"><div class="b-popup-sharing__body"><div class="b-popup-sharing__header"><h3 class="b-popup-sharing__title" data-translate="mosSharingPopup.shareTitle"></h3><button class="b-popup-sharing__close" data-ng-click="closePopup()"></button></div><div class="b-popup-sharing__content"><div class="b-popup-sharing__socials"><div class="b-sharing-links b-sharing-links_type_horizontal b-sharing-links_behaviour_form" id="{{id}}"></div></div></div><div class="b-popup-sharing__footer"></div></div></div>'),e.put("banner/banner.tpl.html",'<div class="insertionHeader" ng-if="flagon === &quot;on&quot;"><iframe name="insertionHeader" scrolling="no" data-ng-src="{{path}}"></iframe></div>'),e.put("mosError/mosError.tpl.html",'<div class="mos-error error-page"><div class="header"><h1 class="errorMessage" data-ng-if="pageInfo.title" data-translate="mosError.errorMessage_{{pageInfo.title}}" ng-class="{ header_cn: lang === \'cn\'}"></h1><p class="errorText" data-ng-if="pageInfo.title" data-translate="mosError.errorText_{{pageInfo.title}}"></p><div ng-if="showSearch" id="{{ appId }}"></div></div><div class="live" ng-if="lang === \'ru\'" data-widget="widget-live"></div><script ng-if="lang === \'ru\' &amp;&amp; isClientError" type="text/javascript" src="/widget-collection/main.js"><\/script></div>'),e.put("mosSpecialMap/lightbox.tpl.html",'<div class="lightbox-popup-modal" data-ng-class="{\'{{prefixClass}}\': prefixClass, \'scrollbar\': scrollOn }"><div class="lightbox-popup-modal-cont"><div class="lightbox-popup-modal__close"><span class="ico icon-close_black" data-ng-click="hidePop()"></span></div><span class="lightbox-popup-modal__wrapper"><img data-ng-src="{{ popupImage.src }}"/><div class="lightbox-popup-modal__description-wrapper" data-ng-if="popupImage.description"><span class="lightbox-popup-modal__description" data-ng-bind-html="popupImage.description"></span></div></span></div></div>'),e.put("mosSpecialMap/mosSpecialMap.tpl.html",'<div class="specMap"><div class="specMap-wrapper" data-ng-class="{portable: isMobileMapView}"><div class="specMap__map-mobile-content" data-ng-if="isMobileDevice &amp;&amp; !isMobileMapView" data-ng-click="toggleMapOn()"><div class="specMap__map-mobile-top-ico"></div><div class="specMap__map-mobile-text">Посмотреть на карте</div><div class="specMap__map-mobile-link"></div></div><div class="specMap-preloader" data-ng-class="{isMobilePreloader:isMobile}"></div><div class="specMap__areas-mobile"><div class="specMap__areas-select" data-ng-if="categories.items.length &amp;&amp; isMobile"><div class="specMap__dropdown-wrapper"><div class="dropdown" data-bs-dropdown="" aria-haspopup="true" aria-expanded="false" data-animation="am-fade" data-template="dropdown/dropdown.mosSpecialMap.category.tpl.html">{{ categories.currentCategory.title }}<span class="ico icon-arrow_down_01_black"></span></div></div></div><div class="specMap__areas-select" data-ng-if="categories.items.length &amp;&amp; isMobile"><div class="specMap__dropdown-wrapper"><div class="dropdown" data-bs-dropdown="" aria-haspopup="true" aria-expanded="false" data-animation="am-fade" data-template="dropdown/dropdown.mosSpecialMap.point.tpl.html">{{ currentPoint.title ? currentPoint.title : \'Выберите место\' }}<span class="ico icon-arrow_down_01_black"></span></div></div></div><div class="specMap__areas-mobile__close" data-ng-click="toggleMapOff()" data-ng-if="isMobileDevice &amp;&amp; isMobileMapView"></div></div><div class="specMap__areas" data-ng-if="categories.items.length &amp;&amp; !isMobile"><div class="specMap__areas-wrapper customScrollbar" data-bs-collapse="" data-ng-model="categories.activeCategoryIndex" data-scroll-to-current="" data-current-point="{{pointChanged}}"><div class="specMap__area-wrapper" data-ng-repeat="category in categories.items track by category.id" data-ng-class="category.id == categories.currentCategory.id ? \'specMap__area-wrapper-active\' : \'\'"><a class="specMap__area" role="tab" data-bs-collapse-toggle="" data-ng-click="setCurrentCategory(category)"><div class="specMap__area__caption">{{ category.title }}<span class="specMap__area__count">{{ category.points_count}}</span></div><div class="icon icon_down icon-arrow_down_01_black"></div><div class="icon icon_up icon-arrow_up_01_white"></div></a><div class="specMap__list" role="tabpanel" data-bs-collapse-target=""><div class="specMap__list__item" data-ng-repeat="place in category.points" data-ng-click="setCurrentPoint(mapId, place)" data-ng-dblclick="setDoubleClick(mapId, place)" data-ng-class="place.focus? \'specMap__area_active\' : \'\'">{{place.title}}</div></div></div></div></div><div class="specMap__mapinfo customScrollbar" data-ng-if="currentPoint" data-ng-class="currentPoint.sideBarSize"><div class="specMap__mapinfo__close" data-ng-click="toggleInfoOff()" data-ng-if="isMobileDevice &amp;&amp; isMobileMapView">{{scope.currentPoint}}</div><div class="specMap__mapinfo__content specMap__info-content-wrapper"><div class="container-fluid"><div class="row"><div class="col-md-12 col specMap__mapinfo__content-image" data-ng-show="currentPoint.images[0].src &amp;&amp; currentPoint.images.length === 1" data-ng-class="{ \'.col-sm-6\': currentPoint.images[0].src }"><div class="specMap__caption specMap__mapinfo-img"><img data-mos-lightbox="" data-ng-src="{{ currentPoint.images[0] | imageSrc }}"/><span class="specMap__mapinfo__text">&nbsp;</span></div></div><div class="specMap__mapinfo__content-image" data-ng-if="currentPoint.images &amp;&amp; currentPoint.images.length &gt; 1" data-ng-class="{ \'.col-sm-6\': currentPoint.images[0].src }"><div class="specMap__caption specMap__mapinfo__content-image-slider"><div class="specMap__caption specMap__mapinfo-img" data-ng-repeat="image in currentPoint.images" data-repeat-is-finished="" data-parent="element" data-last="$last" data-slider=".specMap__mapinfo__content-image-slider"><img data-mos-lightbox="" data-ng-src="{{ image | imageSrc }}"/><span class="specMap__mapinfo__text">&nbsp;</span></div></div></div><div class="col-md-12 col specMap__mapinfo__content-descr" data-ng-class="{ \'.col-sm-6\': currentPoint.images[0].src }"><div class="specMap__mapinfo__title">{{ currentPoint.title }}</div><div class="specMap__caption"><div class="specMap__description-wrapper"><div class="specMap__description-pin"><img data-ng-src="{{currentPoint.icon | imageSrc}}"/></div><span class="specMap__description-text">{{ currentPoint.address }}</span></div></div><div class="specMap__caption"><div><span class="specMap__mapinfo__description" data-ng-bind-html="currentPoint.description"></span><p data-ng-if="currentPoint.eventLink &amp;&amp; (!currentPoint.link || !currentPoint.link.url)"><a class="specMap__mapinfo__description-more" data-ng-href="{{currentPoint.eventLink}}">Перейти</a></p></div></div><div class="specMap__mapinfo__links" data-ng-if="currentPoint.link &amp;&amp; currentPoint.link.url"><a class="mos-button mos-button_type_primary mos-button_size_standard" data-ng-if="currentPoint.link &amp;&amp; currentPoint.link.url" href="{{currentPoint.link.url}}" target="{{currentPoint.link.in_new_tab ? \'_blank\' : \'\'}}">{{ currentPoint.link.title }}</a><a class="mos-button mos-button_type_primary mos-button_size_standard" data-ng-if="currentPoint.link &amp;&amp; currentPoint.link.url_alt" href="{{currentPoint.link.url_alt}}" target="{{currentPoint.link.in_new_tab_alt ? \'_blank\' : \'\'}}">{{ currentPoint.link.title_alt }}</a></div></div></div></div></div></div><div class="specMap__map" data-ng-class="{notShowCategories:!categories.items.length}" data-ng-style="isMobileMapView &amp;&amp; { \'height\': \'100%\' }" data-mos2-gis-map="" data-zoom="zoomLevel" data-controls="zoom" data-scroll-zoom="{{scrollZoom}}" data-center="centerCoords"></div></div></div>'),e.put("mosSeasonsMap/mosSeasonsMap_categories.tpl.html",'<div class="mosSeasonsMap_categories" data-ng-class="{\'mobile\': isMobile || isTablet}" data-ng-if="categories &amp;&amp; categories.length &gt; 1"><div class="mosSeasonsMap_categories__head" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:false" data-ng-if="isMobile || isTablet"><span class="mosSeasonsMap_categories__head-title" data-ng-if="isMobile || isTablet">{{ activeCategory.title }}</span><span class="mosSeasonsMap_categories__arrow_down" data-ng-class="{\'active\': isActive}" data-ng-if="isMobile || isTablet"></span></div><div class="mosSeasonsMap_categories__list customScrollbar"><ul class="mosSeasonsMap_categories__scroll-list"><li data-ng-repeat="category in categories" data-ng-if="category.count" data-ng-class="{\'active\': category === activeCategory}"><div class="mosSeasonsMap_categories__title" data-ng-click="category !== activeCategory &amp;&amp; setActiveCategory(category); toggleCategory.showSub = !toggleCategory.showSub" data-ng-class="{ \'isOpened\': toggleCategory.showSub}"><span>{{ category.title }}</span><span>{{ category.count }}</span></div><ul class="mosSeasonsMap_categories__points" data-ng-if="!(isMobile || isTablet) &amp;&amp; category === activeCategory" data-ng-hide="!toggleCategory.showSub"><li class="mosSeasonsMap_categories__point" data-ng-repeat="point in category.points" data-ng-class="{\'active-point\': !popupIsClosed &amp;&amp; point.id === activePoint.id}" data-ng-click="setActivePoint($event, point)"><span>{{ point.title }}</span></li></ul></li></ul></div></div>'),e.put("mosSeasonsMap/mosSeasonsMap_pin.tpl.html",'<div class="seasonsMap_pin"><div class="seasonsMap_pin-panel" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:false" data-ng-click="closeMap()" data-ng-if="mobile"></div><div class="wrapper customScrollbar"><div class="seasonsMap_pin__image-wrapper"><div class="seasonsMap_pin__image" data-ng-if="point.images &amp;&amp; point.images.length &amp;&amp; point.images[0].src" data-ng-style="{\'background-image\': \'url(&quot;\'+ point.images[0].src +\'&quot;)\', height: point.images[0].src? \'150px\': 0}"></div></div><div class="seasonsMap_pin__body seasonsMap_pin__body-dir"><div class="seasonsMap_pin__body-title">{{ point.title }}</div><div class="seasonsMap_pin__body-description" data-ng-if="point.description" data-ng-bind-html="point.description"></div><div class="seasonsMap_pin__body-link"><a data-ng-if="point.link &amp;&amp; point.link.url" data-ng-href="{{point.link.url}}" target="{{point.link.in_new_tab ? \'_blank\' : \'\' }}">{{point.link.title}}</a></div></div></div></div>'),e.put("mosSeasonsMap/mosSeasonsMap.tpl.html",'<div class="seasonsMap__wrap"><div class="seasonsMap" data-ng-class="{\'full-screen\': (isMobile || isTablet) &amp;&amp; mapOpened}"><div class="seasonsMap__wrapper clearfix" data-ng-class="{\'closed\': (isMobile || isTablet) &amp;&amp; !mapOpened,\'portable\': (isMobile || isTablet)}"><div class="seasonsMap__top-bar clearfix" data-ng-if="((isMobile || isTablet) &amp;&amp; !mapOpened) || !(isTablet || isMobile)"></div><div class="seasonsMap__mobile-opener" data-ng-if="(isMobile || isTablet) &amp;&amp; !mapOpened" data-ng-click="openMap()"><div class="seasonsMap__mobile-opener-bg" data-custom-colors="" data-colors="{{ colors }}" data-color="true"></div><div class="seasonsMap__mobile-opener-text">Посмотреть на карте<div class="icon"></div></div></div><div class="seasonsMap__mapWrapper" data-ng-class="{\'portable\': (isMobile || isTablet) &amp;&amp; mapOpened, \'full-height\': isMobile, \'closed\': !mapOpened}"><div class="seasonsMap__mapWrapper__close" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:false" data-ng-click="closeMap()" data-ng-if="((isMobile || isTablet) &amp;&amp; mapOpened)"></div><div class="seasonsMap__left-bar" data-ng-if="((isMobile || isTablet) &amp;&amp; mapOpened) || !(isMobile || isTablet)" data-ng-class="{\'portable\': (isMobile || isTablet), \'active\': categoriesActive}" data-ng-click="toggleCategories()"><div class="seasonsMap__left-bar__categories" mos-seasons-map-categories="" data-categories="mapCategories" data-active-category="activeCategory" data-toggle-category="view.toggleCategory" data-active-point="activePoint" data-set-category="setActiveCategory" data-set-point="setActivePoint" data-popup-is-closed="popupIsClosed" data-colors="colors" data-is-mobile="isMobile" data-is-tablet="isTablet" data-is-active="categoriesActive"></div></div><div class="mos-seasons-map-pin" data-ng-if="mobilePinOpened" mos-seasons-map-pin="" data-point="activePoint" data-colors="colors" data-mobile="isMobile" data-close="closeMobilePopup"></div><div class="seasonsMap__map clearfix" data-ng-class="{\'portable\': (isMobile || isTablet)}" data-mos2-gis-map="" data-zoom="zoom" data-controls="zoom" data-events-map="true" data-scroll-zoom="{{scrollZoom}}" data-center="centerCoords"></div></div></div></div></div>'),e.put("00_map/mosEventsMap/mosEventsMap.tpl.html",'<div class="eventsMap" data-ng-class="{\'full-screen\': (isMobile || isTablet) &amp;&amp; mapOpened}" events-map-mobile=""><div class="eventsMap__wrapper" events-map-mobile=""><div class="eventsMap__close" data-ng-if="(isMobile || isTablet) &amp;&amp; mapOpened" data-ng-click="closeMap()" data-custom-colors="" data-colors="{{ colors }}" data-color="true">Вернуться на страницу</div><div class="eventsMap__panels" data-ng-if="(!isMobile &amp;&amp; !isTablet) || mapOpened &amp;&amp; rootGroup" events-map-mobile=""><div class="eventsMap__groups no-shadow" data-ng-class="{\'eventsMapCustomScrollbar\': !isMobile &amp;&amp; (!isTablet &amp;&amp; !isPortrait)}" data-ng-if="groups.length &gt; 1" data-custom-colors="" data-colors="{{ colors }}" data-color="true" events-map-mobile=""><div class="eventsMap__groups-current" data-ng-if="isMobile || (isTablet &amp;&amp; isPortrait)" data-custom-colors="" data-colors="{{ colors }}" data-active="true" events-map-mobile="" data-ng-click="toggleDropDown()"><div class="title-wrapper" data-ng-if="activeGroup.activeImage" data-events-map-group-bg="" data-background="{{activeGroup.activeImage}}"><div class="title">{{ activeGroup.title }}</div></div><div class="eventsMap__groups-current-btn" data-custom-colors="" data-colors="{{ colors }}" data-color="{{dropDownOpened}}" data-ng-class="{\'opened\': dropDownOpened}"></div></div><div class="eventsMap__groups-list eventsMapCustomScrollbar no-shadow" data-ng-if="!isMobile || !(isTablet &amp;&amp; isPortrait)" data-custom-colors="" data-colors="{{ colors }}" data-color="true"><ul><li data-ng-repeat="group in groups" data-custom-colors="" data-colors="{{ colors }}" data-hover="true" data-active="{{ group.active }}" data-ng-click="setActiveGroup(group)"><div class="title-wrapper" data-events-map-group-bg="" data-background="{{group.activeImage}}"><div class="title">{{ group.title }}</div></div></li></ul></div><div class="eventsMap__groups-list eventsMapCustomScrollbar dropdown no-shadow" data-ng-if="isMobile || (isTablet &amp;&amp; isPortrait)" data-ng-class="{\'opened\': dropDownOpened}" data-custom-colors="" data-colors="{{ colors }}" data-color="true"><ul><li data-ng-repeat="group in groups" data-custom-colors="" data-colors="{{ colors }}" data-hover="true" data-active="{{ group.active }}" data-ng-click="setActiveGroup(group)"><div class="title-wrapper" data-events-map-group-bg="" data-background="{{group.activeImage}}"><div class="title">{{ group.title }}</div></div></li></ul></div></div><div class="eventsMap__events-wrapper" data-ng-show="(activePointVisible || activeEventVisible)" data-ng-class="{\'wide\': activePointVisible &amp;&amp; activeEventVisible, \'left\': groups.length &lt;= 1}" events-map-mobile=""><div class="eventsMap__events" data-ng-class="{\'wide\': activePointVisible &amp;&amp; !activeEventVisible,\'animate\': !isIpad &amp;&amp; (isMobile || (isTablet &amp;&amp; isPortrait)),}" data-ng-if="activePointVisible" data-ng-hide="activeEventVisible &amp;&amp; (isMobile || (isTablet &amp;&amp; isPortrait))" events-map-mobile=""><div class="eventsMap__event-close" data-ng-click="closeActivePoint()" data-ng-if="!activeEventVisible" data-custom-colors="" data-colors="{{ colors }}" data-hover="true" events-map-mobile=""></div><div class="eventsMap__event-back" data-ng-click="closeActivePoint()" data-custom-colors="" data-colors="{{ colors }}" data-color="true" events-map-mobile="" data-ng-if="isMobile || (isTablet &amp;&amp; isPortrait)"><div class="eventsMap__event-back-hint">Вернуться к карте</div></div><div class="eventsMapCustomScrollbar" events-map-mobile=""><div class="eventsMap__events-image"><img data-ng-if="activePoint.images" data-ng-src="{{ activePoint.images[0].src }}"/></div><div class="eventsMap__events-info-wrapper"><div class="eventsMap__events-title">{{ activePoint.title }}</div><div class="eventsMap__events-credentials" data-in-if="activePoint.address &amp;&amp; activePoint.address !== \'\'">{{ activePoint.address }}</div><div class="eventsMap__events-description" data-ng-show="events.length === 0 &amp;&amp; !eventsLoading &amp;&amp; activePoint.description &amp;&amp; activePoint.description !== \'\'" data-ng-bind-html="activePoint.description"></div><div class="eventsMap__events-link" data-ng-if="activePoint.link &amp;&amp; activePoint.link.url &amp;&amp; activePoint.link.title"><a href="{{activePoint.link.url}}" data-ng-bind-html="activePoint.link.title" target="{{ activePoint.link.in_new_tab ? \'_blank\' : \'_top\' }}"></a></div><div class="eventsMap__events-hint" data-ng-show="events.length &gt; 0">События в этом месте</div></div><ul class="eventsMap__events-list" data-ng-show="events.length &gt; 0"><li data-ng-repeat="event in events | orderBy:\'date_from_timestamp\':false" data-ng-click="setActiveEvent(event)" data-ng-class="{\'active\': event.id === activeEvent.id}"><div class="date">{{ event.dates }}</div><div class="title">{{ event.title }}</div></li></ul></div></div><div class="eventsMap__event" data-ng-class="{\'wide\': !activePointVisible &amp;&amp; activeEventVisible,\'animate\': !isIpad &amp;&amp; (isMobile || (isTablet &amp;&amp; isPortrait))}" data-ng-if="activeEventVisible" events-map-mobile=""><div class="eventsMap__event-close" data-ng-click="closeEvent()" data-custom-colors="" data-colors="{{ colors }}" data-hover="true" events-map-mobile=""></div><div class="eventsMap__event-back" data-ng-click="closeEvent()" data-custom-colors="" data-colors="{{ colors }}" data-color="true" events-map-mobile="" data-ng-if="isMobile || (isTablet &amp;&amp; isPortrait)"><div class="eventsMap__event-back-hint">Вернуться к списку</div></div><div class="eventsMapCustomScrollbar"><div class="eventsMap__event-image" data-ng-if="activeEvent.image" data-ng-style="{\'background-image\': \'url(&quot;{{activeEvent.image[0] | imageSetSrc:\'a|2|s\':\'b|4|m\':\'c|2|s\':\'d|2|s\':\'e|2|s\'}}&quot;)\'}"></div><div class="eventsMap__event-credentials"><div class="eventsMap__event-credentials__category" data-ng-if="activeEvent.category &amp;&amp; activeEvent.category.title">{{ activeEvent.category.title }}</div><div class="eventsMap__event-credentials__district" data-ng-if="districts &amp;&amp; districts[activeEvent.territory_district_id]">{{ districts[activeEvent.territory_district_id] }}</div></div><div class="eventsMap__event__details"><div class="eventsMap__event__details-date" data-ng-bind-html="activeEvent.dates"></div></div><div class="eventsMap__event-title">{{ activeEvent.title }}</div><div class="eventsMap__event-text" data-ng-bind-html="activeEvent.text"></div></div></div></div></div><div class="eventsMap__map" data-ng-class="{\'fullWidth\': !groups,\'closed\': (isMobile || isTablet) &amp;&amp; !mapOpened,\'slide-out\': !isIpad &amp;&amp; (activePointVisible || activeEventVisible) &amp;&amp; (isMobile || (isTablet &amp;&amp; isPortrait)) }" events-map-mobile="" data-mos2-gis-map="" data-zoom="zoomLevel" data-controls="zoomControl" data-events-map="true" data-scroll-zoom="{{scrollZoom}}" data-center="centerCoords"></div><div class="eventsMap__mobile-opener" data-ng-if="(isMobile || isTablet) &amp;&amp; !mapOpened" data-ng-click="openMap()"><div class="eventsMap__mobile-opener-button" data-custom-colors="" data-colors="{{ colors }}" data-color="true"><div class="eventsMap__mobile-opener-text">Карта событий</div></div></div></div></div>'),e.put("00_map/mosEventsDatasetsMap/mosEventsDatasetsMap_categories.tpl.html",'<div class="mosEventsDatasetsMap_categories" data-ng-if="categories &amp;&amp; categories.length &gt; 1"><div class="mosEventsDatasetsMap_categories__head" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:false"><span data-ng-if="!(isMobile || isTablet)">КАТЕГОРИИ</span><span class="mosEventsDatasetsMap_categories__head-title" data-ng-if="isMobile || isTablet">{{ activeCategory.title }}</span><span class="icon-arrow_down_01_white" data-ng-class="{\'active\': isActive}" data-ng-if="isMobile || isTablet"></span></div><div class="mosEventsDatasetsMap_categories__list customScrollbar"><ul><li data-ng-repeat="category in categories" data-ng-if="category.count" data-ng-class="{\'active\': category === activeCategory}" data-ng-click="setActive(category)"><span>{{ category.title }}<span>&nbsp;/&nbsp; {{ category.count }}</span></span></li></ul></div></div>'),e.put("00_map/mosEventsDatasetsMap/mosEventsDatasetsMap_pin.tpl.html",'<div class="eventsDatasetsMap_pin"><div class="eventsDatasetsMap_pin-panel" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:false" data-ng-click="closeMap()" data-ng-if="mobile"></div><div class="wrapper pinCustomScrollbar"><div class="eventsDatasetsMap_pin__image-wrapper"><div class="eventsDatasetsMap_pin__image" data-ng-if="point.type === \'ehd\' &amp;&amp; point.image" data-ng-style="{\'background-image\': \'url(//op.mos.ru/MEDIA/showFile?id=\'+ point.image +\'&amp;size=medium)\'}"></div></div><div class="eventsDatasetsMap_pin__body" data-ng-if="point.type === \'ehd\'"><div class="eventsDatasetsMap_pin__body-title">{{ point.title }}</div><div class="eventsDatasetsMap_pin__body-time" data-ng-if="point.WorkingHoursWinter &amp;&amp; point.WorkingHoursWinter.length &gt; 0"><div class="eventsDatasetsMap_pin__body-time-title" data-ng-class="{\'eventsDatasetsMap_pin__body-time-title-active\': open }" data-ng-click="toggleSchedule()">{{ openText }} {{ point.WorkingHoursWinter[day].Hours }}<span class="icon icon-arrow_down_01_black" data-ng-class="{\'eventsDatasetsMap_pin__body-time-schedule-active\': scheduleOpened }"></span></div></div><div class="eventsDatasetsMap_pin__body-wrapper"><div class="eventsDatasetsMap_pin__body-details"><div class="eventsDatasetsMap_pin__body-details-schedule" data-ng-if="point.WorkingHoursWinter &amp;&amp; point.WorkingHoursWinter.length &gt; 0" data-ng-class="{\'eventsDatasetsMap_pin__body-details-schedule-active\': scheduleOpened }"><ul><li class="eventsDatasetsMap_pin__body-details-schedule-item" data-ng-repeat="day in point.WorkingHoursWinter"><div class="eventsDatasetsMap_pin__body-details-schedule-item-day">{{ day.DayOfWeek }}</div><div class="eventsDatasetsMap_pin__body-details-schedule-item-dots"></div><div class="eventsDatasetsMap_pin__body-details-schedule-item-time">{{ day.Hours }}</div></li></ul></div><div class="eventsDatasetsMap_pin__body-phone">{{ point.tel }}</div><div class="eventsDatasetsMap_pin__body-address">{{ point.address }}</div><a class="eventsDatasetsMap_pin__body-site" ng-href="{{ point.WebSiteLink }}" target="_blank">{{ point.WebSite }}</a></div><div class="eventsDatasetsMap_pin__body-icons"><div class="icon" data-ng-repeat="item in point.features" data-ng-if="item.val" data-ng-class="{\'icon-{{item.key}}\': item.val}"></div></div></div></div><div class="eventsDatasetsMap_pin__body eventsDatasetsMap_pin__body-dir" data-ng-if="point.type === \'dir\'"><div class="eventsDatasetsMap_pin__body-title">{{ point.title }}</div><div class="eventsDatasetsMap_pin__body-address-dir" data-ng-if="point.address &amp;&amp; point.address !== \'\'">{{ point.address }}</div><div class="eventsDatasetsMap_pin__body-description" data-ng-if="point.description" data-ng-bind-html="point.description"></div><hr class="line"/><div class="eventsDatasetsMap_pin__body-events" data-ng-if="point.events &amp;&amp; point.events.length &gt; 0"><div class="eventsDatasetsMap_pin__body-events-title" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="color:false">События здесь:</div><div class="eventsDatasetsMap_pin__body-events-event" data-ng-repeat="event in point.events"><a class="eventsDatasetsMap_pin__body-events-event-title" data-ng-href="{{ event.link }}" target="_blank">{{ event.title }}</a><span class="eventsDatasetsMap_pin__body-events-event-time">{{ event.date_from_timestamp * 1000 | date:\'dd.MM\' }} - {{ event.date_to_timestamp * 1000 | date:\'dd.MM\' }}</span></div></div></div></div><img class="eventsDatasetsMap_pin__icon" data-ng-if="!mobile" data-ng-src="{{point.icon_hover.options.iconUrl}}" data-ng-style="{\'bottom\': \'-{{point.icon_hover.options.iconSize[1]/2}}px\'}"/></div>'),e.put("00_map/mosEventsDatasetsMap/mosEventsDatasetsMap.tpl.html",'<div class="eventsDatasetsMap" data-ng-class="{\'full-screen\': (isMobile || isTablet) &amp;&amp; mapOpened}"><div class="eventsDatasetsMap__wrapper clearfix" data-ng-class="{\'closed\': (isMobile || isTablet) &amp;&amp; !mapOpened,\'portable\': (isMobile || isTablet)}"><div class="eventsDatasetsMap__mobile-opener" data-ng-if="(isMobile || isTablet) &amp;&amp; !mapOpened" data-ng-click="openMap()"><div class="eventsDatasetsMap__mobile-opener-bg" data-custom-colors="" data-colors="{{ colors }}" data-color="true"></div><div class="eventsDatasetsMap__mobile-opener-text">Посмотреть на карте<div class="icon"></div></div></div><div class="eventsDatasetsMap__top-bar clearfix" data-ng-if="((isMobile || isTablet) &amp;&amp; mapOpened) || !(isTablet || isMobile)" data-ng-class="{\'portable\': (isMobile || isTablet), \'no-height\': isMobile}"><div class="eventsDatasetsMap__top-bar__title" data-ng-if="(isTablet &amp;&amp; title) || !((isTablet || isMobile) &amp;&amp; title)" data-custom-colors="" data-colors="{{ colors }}" data-active="false" data-text="true">{{ title }}</div><ul class="eventsDatasetsMap__top-bar__tabs" data-ng-if="tabs &amp;&amp; tabs.length &gt; 1 &amp;&amp; !(isTablet || isMobile)"><li class="eventsDatasetsMap__top-bar__tabs-item" data-ng-repeat="tab in tabs" data-ng-click="selectTab(tab)" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="border:false"><span data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:{{tab!==activeTab}}|color:{{tab==activeTab}}">{{ tab.title }}</span></li></ul></div><div class="eventsDatasetsMap__mapWrapper" data-ng-class="{\'portable\': (isMobile || isTablet) &amp;&amp; mapOpened, \'full-height\': isMobile, \'closed\': !mapOpened}"><div class="eventsDatasetsMap__mapWrapper__close" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:false" data-ng-click="closeMap()" data-ng-if="((isMobile || isTablet) &amp;&amp; mapOpened)"></div><div class="eventsDatasetsMap__left-bar" data-ng-if="((isMobile || isTablet) &amp;&amp; mapOpened) || !(isMobile || isTablet)" data-ng-class="{\'portable\': (isMobile || isTablet), \'active\': categoriesActive}" data-ng-click="toggleCategories()"><div class="eventsDatasetsMap__left-bar__categories" mos-events-datasets-map-categories="" data-categories="activeMap.categories" data-active-category="activeCategory" data-set="setActiveCategory" data-colors="colors" data-is-mobile="isMobile" data-is-tablet="isTablet" data-is-active="categoriesActive"></div></div><div class="eventsDatasetsMap__bottom-bar" data-ng-if="(isMobile || isTablet) &amp;&amp; mapOpened"><ul class="eventsDatasetsMap__top-bar__tabs" data-ng-if="tabs &amp;&amp; tabs.length &gt; 1 &amp;&amp; (isTablet || isMobile)"><li class="eventsDatasetsMap__top-bar__tabs-item" data-ng-repeat="tab in tabs" data-ng-click="selectTab(tab)" data-custom-colors-smart="" data-colors="{{ colors }}" data-params="border:false"><span data-custom-colors-smart="" data-colors="{{ colors }}" data-params="background:{{tab!==activeTab}}|color:{{tab==activeTab}}">{{ tab.title }}</span></li></ul></div><div class="mos-events-datasets-map-pin" data-ng-if="mobilePinOpened" mos-events-datasets-map-pin="" data-point="activePoint" data-colors="colors" data-mobile="isMobile" data-close="closeMobilePopup"></div><div class="eventsDatasetsMap__map clearfix" data-ng-class="{\'portable\': (isMobile || isTablet)}" data-mos2-gis-map="" data-center="centerCoords" data-zoom="zoom" data-controls="zoom" data-events-map="true" data-scroll-zoom="{{scrollZoom}}"></div></div></div></div>'),e.put("egipMap/egipMap.tpl.html",'<div class="b-egip-map"><div class="b-egip-items" data-ng-transclude="data-ng-transclude"></div><div class="b-egip-map__zoom-control" data-ng-if="mapLoadedAndReady &amp;&amp; hasControl(\'zoom\')"><div class="b-egip-map__btn b-egip-map__zoom-in" data-ng-click="zoomIn()">+</div><div class="b-egip-map__btn b-egip-map__zoom-out" data-ng-click="zoomOut()">-</div></div></div>'),e.put("mos2GisMap/mos2GisMap.tpl.html",'<div class="b-egip-map"><div class="b-egip-items" data-ng-transclude="data-ng-transclude"></div></div>'),e.put("mosSpecialPhotobank/mosSpecialPhotobank.tpl.html",'<div class="photobank-loader"></div><div class="mos-special-photobank" data-ng-if="galleryId" data-mos-media-photo="" data-inline="on" data-gallery-id="{{galleryId}}" data-api-root="{{apiRoot}}" data-gallery-api="{{galleryApi}}" data-images-api="{{imagesApi}}" data-mode="{{mode}}"></div>'),e.put("photoBank/photoBank.tpl.html",'<div class="photobank-loader"></div><div data-ng-if="galleryId" data-mos-media-photo="" data-gallery-info-id="1" data-state-root="{{stateRoot}}" data-state-mode="{{stateMode}}" data-gallery-id="{{galleryId}}" data-api-root="{{apiRoot}}" data-gallery-api="{{galleryApi}}" data-images-api="{{imagesApi}}" data-first-person="firstPerson" data-person="person" data-err-code="errCode" data-postfix="{{postfix}}" data-is-authority="{{isAuthority}}"></div>'),e.put("photoBankTabs/photoBankTabs.tpl.html",'<div class="bank-tabs-wrap" data-ng-if="blockVisible"><div class="bank-tabs-wrap__header" data-ng-if="tabs.length" data-translate="photoBankTabs.galleryTitle"></div><div class="bank-tabs-wrap-tabs" data-ng-if="tabs.length &gt; 1"><div class="bank-tabs-wrap-tabs__item" data-ng-click="changeTab(tab.id)" data-ng-class="{\'bank-tabs-wrap-tabs__item_state_active\': tab.active}" data-ng-repeat="tab in tabs" data-translate="photoBankTabs.tabTitle{{$index}}"></div></div><div data-mos-media-photo="" data-inline="on" data-gallery-info-id="galleryInfoId" data-api-root="{{apiRoot}}" data-gallery-api="{{galleryApi}}" data-images-api="{{imagesApi}}" data-postfix="{{postfixImg}}"></div></div>'),e.put("mediaPhoto/mediaPhoto.tpl.html",'<div data-mos-error="mosError" data-ng-if="mosError"></div><div class="media-photo-loader"></div><div class="media-photo" data-ng-if="gallery &amp;&amp; !mosError"><div class="carousel__header wrapper"><div class="carousel__title-wrapper" data-ng-if="media.title &amp;&amp; (!inline || inline &amp;&amp; galleryId)"><h1 class="carousel__title" ng-bind-html="::media.title"></h1><div class="carousel__info" data-ng-if="media.date_timestamp || picsTotal"><span class="carousel__date" data-ng-if="media.date_timestamp">{{media.date_timestamp*1000 | date : \'d MMMM yyyy\'}} года</span><span class="carousel__number" data-ng-if="picsTotal">{{picsTotal}} фото</span></div></div><div class="carousel__title-wrapper person-title" data-ng-if="person.title"><h1 class="carousel__title"><a data-ng-href="{{person.personUrl}}">{{person.title}}</a></h1><div class="carousel__info" data-ng-if="person.post || person.section.title || picsTotal"><span class="carousel__number" data-ng-if="picsTotal">{{picsTotal}} фото</span><a class="carousel__person-info" data-ng-if="person.section" data-ng-href="{{person.sectionUrl}}">{{person.section}}</a><span class="carousel__person-info" data-ng-if="person.post">{{person.post}}</span></div></div><div class="carousel__toggle toggle noprint"><a class="toggle__item toggle__item_type_list" data-ng-click="changeMode(\'tiles\')" data-ng-class="{\'toggle__item_state_active\': params.mode == \'tiles\'}"></a><a class="toggle__item toggle__item_type_grid" data-ng-click="changeMode(\'carousel\')" data-ng-class="{\'toggle__item_state_active\' : params.mode == \'carousel\'}"></a></div></div><div class="carousel" data-ng-if="params.mode == \'carousel\' &amp;&amp; photoItems.length"><a class="goto_tiles_mobile" href="" data-ng-click="changeMode(\'tiles\')"><span class="ico icon-close_white"></span></a><div class="carousel__printonly"><img class="carousel__printonly_image" data-ng-if="currentImageSrc" data-ng-src="{{currentImageSrc}}"/><p data-ng-if="currentItem.image.title">Фотография {{currentItem.image.title}}</p></div><div data-mos-media-photo-carousel="" data-inline="inline" data-params="params" data-pics-total="picsTotal" data-get-more-items="getMoreItems" data-photo-items="photoItems" data-lock-more="lockMore" data-per-page="perPage" data-action="action" data-postfix="{{postfix}}" data-current-item="currentItem" data-current-tile-item="currentTileItem" data-current-image-src="currentImageSrc" data-gallery="gallery" data-set-current-image="setCurrentImage(pic, order)" data-page-type="{{pageType}}" data-is-authority="{{isAuthority}}"></div></div><div class="tiles" data-ng-if="params.mode == \'tiles\' &amp;&amp; photoItems.length" data-mos-media-photo-tiles="" data-photo-items="photoItems" data-gallery="gallery" data-lock-more="lockMore" data-params="params" data-show-slide="showSlide" data-per-page="perPage" data-postfix="{{postfix}}" data-current-tile-item="currentTileItem" data-get-more-items="getMoreItems" data-from-carousel="fromCarousel" data-set-current-image="setCurrentImage(pic)"></div><div class="media-photo__extras-wrap"><div class="b-article__text b-video_tags" data-mos-tags="" data-section="media" data-tags="gallery.tags" data-ng-if="gallery.tags &amp;&amp; gallery.tags.length &gt; 0"></div><div class="media-photo__extras" data-ng-if="districts.length"><span class="media-photo__extras-title" data-translate="mediaPhoto.districts"></span> <a class="media-photo__extras-item" data-ng-repeat="district in districts | limitTo: districtsMax" data-ng-href="{{ district.url }}">{{ district.title }}<span data-ng-if="$index != districtsMax - 1">, </span></a><span class="media-photo__extras-item" data-ng-if="districts.length &gt; districtsMax"> и </span><a class="media-photo__extras-item" data-ng-show="districts.length &gt; districtsMax" href="#" data-mos-hidden-list="" data-list="districts" data-on-click="moreClicked(\'districts\', evt)" data-on-reset="moreReset(\'districts\')" data-popup-title="{{ districtsTitle }}">еще {{ districts.length - districtsMax }} <ng-pluralize count="districts.length - districtsMax" when="{\'one\': \'округ\',\'few\': \'округа\',\'many\': \'округов\',\'other\': \'округов\'}"></ng-pluralize></a></div><div class="media-photo__extras" data-ng-if="areas.length"><span class="media-photo__extras-title" data-translate="mediaPhoto.areas"></span> <a class="media-photo__extras-item" data-ng-repeat="area in areas | limitTo: areasMax" data-ng-href="{{ area.url }}">{{ area.title }}<span data-ng-if="$index != areasMax - 1">, </span></a><span class="media-photo__extras-item" data-ng-if="areas.length &gt; areasMax"> и </span><a class="media-photo__extras-item" data-ng-show="areas.length &gt; areasMax" href="#" data-mos-hidden-list="" data-list="areas" data-on-click="moreClicked(\'areas\', evt)" data-on-reset="moreReset(\'areas\')" data-popup-title="{{ areasTitle }}">еще {{ areas.length - areasMax }} <ng-pluralize count="areas.length - areasMax" when="{\'one\': \'район\',\'few\': \'района\',\'many\': \'районов\',\'other\': \'районов\'}"></ng-pluralize></a></div></div></div>'),e.put("mediaPhotoCarousel/mediaPhotoCarousel.tpl.html",'<div class="carousel-vertical noprint"><div class="carousel-vertical__social"><div class="b-iconic-btn-list"><div class="carousel-vertical__info"><span class="js-current-number">{{currentSlide + 1}}</span> / <span class="js-all-number">{{picsTotal}}</span></div><a class="b-iconic-btn carousel-vertical__btn carousel-vertical__btn_type_print" data-ng-click="printThis()"><i class="icon-print_blue"></i><span class="b-iconic-btn__text"></span></a><a class="b-iconic-btn carousel-vertical__btn carousel-vertical__btn_type_download" target="_blank" data-ng-if="currentItem.image" data-ng-href="{{currentItem.image | imgDownload}}" download="{{currentItem.image | imgFileName}}"><i class="icon-save_blue"></i><span class="b-iconic-btn__text"></span></a><div class="carousel-vertical__btn carousel-vertical__btn_type_share" data-id="media" data-mos-sharing="" data-type="modal" data-let-alone-og="1" data-title="{{currentItem.title}}" data-preview="{{sharingPreview}}" data-image="{{currentItem.image | imgDownload}}"></div><a class="carousel-vertical__btn carousel-vertical__btn_type_info" href="#"></a></div></div><div class="carousel-vertical__list slick-slider"><div class="carousel-vertical__list-prev" data-ng-if="currentSlide &gt; 0 &amp;&amp; fullItems &amp;&amp; fullItems.length &gt; 1" data-ng-click="getPrevSlide()"></div><div class="carousel-vertical__list-next" data-ng-if="(currentSlide !== picsTotal - 1) &amp;&amp; fullItems &amp;&amp; fullItems.length &gt; 1" data-ng-click="getNextSlide()"></div><div class="slick-list"><div class="slick-track"><div class="carousel-vertical__item slick-slide" data-ng-repeat="item in fullItems track by $index" data-ng-class="{videoitem : item.type == \'video\', \'current-slide\':item.current,\'grayscale\': colorScheme == \'contrast\'}" data-media-photo-carousel-full="" data-item="item" data-postfix="{{postfix}}" data-gallery="gallery" data-current-slide="currentSlide" data-get-next-slide="getNextSlide()" data-get-prev-slide="getPrevSlide()" data-pics-total="picsTotal"></div></div></div></div><div class="carousel-vertical__nav"><div class="carousel-vertical__nav-prev slick-arrow" data-ng-class="{disabled:currentSlide==0}" data-ng-click="getPrevSlide()"></div><div class="carousel-vertical__nav-next slick-arrow" data-ng-class="{disabled:currentSlide==picsTotal-1}" data-ng-click="getNextSlide()"></div><div class="carousel-vertical__nav_track"><div class="carousel-vertical__nav_list"><div class="carousel-vertical__nav-item" data-ng-repeat="item in photoItems track by $index" data-ng-class="{videoitem : item.type == \'video\', \'current\': item.current, \'grayscale\': colorScheme == \'contrast\'}" data-index="{{$index}}" data-ng-click="goToSlide($index)"><div class="table" data-media-photo-carousel-thumb="" data-item="item" data-ind="$index" data-postfix="{{postfix}}" data-gallery="gallery" data-current-slide="currentSlide" data-pics-total="picsTotal"></div></div></div></div></div></div>'),e.put("mediaPhotoCarousel/mediaPhotoCarouselFull.tpl.html",'<div class="carousel-vertical__mask" data-ng-if="item.showImage" data-ng-swipe-left="getNextSlide()" data-ng-swipe-right="getPrevSlide()"></div><div class="carousel-vertical__content-image nonDraggableImage" data-ng-swipe-left="getNextSlide()" data-ng-swipe-right="getPrevSlide()"><div class="carousel-vertical__image-wrap"><div class="b-large-img__description" data-ng-if="displayInfo &amp;&amp; item.image.title"><div data-ng-if="showPhotoTitle"><span class="b-large-img__description-f">Фотография</span></div><span class="b-large-img__description-s">{{item.image.title}}</span></div></div></div>'),e.put("mediaPhotoCarousel/mediaPhotoCarouselThumb.tpl.html",'<div class="table-cell" data-ng-if="item.showImage"><div class="carousel-vertical__blur-wrapper" data-ng-style="{\'background-image\': \'url(&quot;{{item.image | imgThumb}}&quot;)\'}"></div><div class="carousel-vertical__image"><img data-ng-src="{{item.image | imgThumb}}" alt="{{metaImage.alt}}" title="{{metaImage.title}}"/></div></div><div class="carousel-vertical__number" data-ng-if="item.current"><span class="js-current-number">{{currentSlide + 1}}</span> / <span class="js-all-number">{{picsTotal}}</span></div>'),e.put("mediaPhotoTiles/mediaPhotoTiles.tpl.html",'<div>{{currentSlide}}</div><div class="tiles__container" data-masonry=""><div class="tiles__item" data-ng-class="{\'grayscale\': colorScheme == \'contrast\'}" data-masonry-tile="" data-ng-repeat="item in showItem track by $index" data-ng-click="open({item:item, index:$index})"><div class="tiles_anchor" data-ng-if="item.current"></div><img data-ng-src="{{item.image | imgThumb}}" width="100%" height="100%" alt="{{metaImage.alt}}" title="{{metaImage.title}}"/></div></div><div class="tiles__container"><div class="tiles__btn tiles__btn_up" data-ng-click="goToTop()"><div class="icon icon-arrow_up_03_gray"></div></div><div class="tiles__btn tiles__btn_expand" data-ng-if="!lockMore" data-ng-click="getMoreItems()"><span class="icon icon-arrow_down_03_black"></span><span data-translate="mosMediaPhotoTiles.see"></span></div></div>'),e.put("mosLightbox/mosLightbox.tpl.html",'<div class="mos-lightbox-popup-modal" data-ng-class="{\'{{prefixClass}}\': prefixClass }"><div class="mos-lightbox__icon mos-lightbox-popup-modal__close" data-ng-click="hidePop()"></div><div class="mos-lightbox__zoom-controls" data-ng-class="{\'mos-lightbox__zoom-controls_zoom\': zoom &gt; 1}"><div class="mos-lightbox__icon mos-lightbox__zoom-in" data-ng-click="zoomIn()"></div><div class="mos-lightbox__icon mos-lightbox__zoom-out" data-ng-click="zoomOut()"></div><div class="mos-lightbox__icon mos-lightbox__zoom" data-ng-click="zoomIn()"></div></div><div class="mos-lightbox-popup-modal__cont-wrapper"><div class="mos-lightbox-popup-modal__cont"><div class="mos-lightbox-popup-modal__wrapper"></div></div></div></div>'),e.put("mosCalendarLite/mosCalendarLite.tpl.html",'<div class="calendar-lite" data-ng-class="{\'main-style\':style==\'main\'}"><div class="calendar-lite__filters" data-ng-class="{\'calendar-lite__filters_date\':dateOnly, \'calendar-lite__filters_holidays\':newYearFlag}" data-calendar-filter-lite="" data-filter="params" data-default-filter="defaultFilter" data-clear-on="{{ filterClearOn }}" data-on-filter-apply="onFilterApply()" data-on-filter-clear="clearFilter()" data-update-event="calendarFilter:update" data-display="{{filterDisplay}}" data-show-filter="showFilter"></div><div class="calendar-lite__loader-container"></div><div class="calendar-lite__notfound" data-responce-dialog="data-responce-dialog" data-title="{{ noData }}" data-not-found="notFound" data-ng-if="lang === \'ru\'"></div><div class="calendar-lite__block" data-ng-if="events.length &gt; 0"><div data-ng-class="{\'calendar-lite__holidays\':newYearFlag}"><div class="mos-row"><div class="main-style__item mos-col-xs-12 mos-col-sm-3 mos-col-md-4 mos-col-xl-3" data-ng-repeat="event in events track by $index" data-ng-class="{\'postLoading\':event.isNew}"><div class="calendar-lite__item" data-ng-class="{\'no-image\': !event.image}"><a data-ng-href="{{event.link}}" target="{{target}}"><div class="calendar-lite__imgbox" data-ng-style="{\'background-image\': \'url(&quot;{{ ::event.image | imageSetSrc:\'a|2|s\':\'b|2|m\':\'c|2|m\':\'d|2|m\':\'e|2|m\'}}&quot;)\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div><div class="calendar-lite__textwrapper"><div class="calendar-lite__time" data-ng-if="displayDate &amp;&amp; event.date_from_timestamp">{{ event.dateString }}</div><div class="calendar-lite__title" data-ng-bind-html="::event.title"></div></div></a></div></div></div><div class="mos-row"><div class="calendar__more mos-col-sm-6 mos-col-md-12 mos-col-xl-12"><div class="calendar__more-btn-nav"><div class="calendar__more-loader"></div><a class="calendar__more-btn ng-scope" data-ng-if="(items.length &gt; 0) &amp;&amp; canBeMore &amp;&amp; !loading" data-ng-click="getMoreData()"><span class="calendar__more-btn-text" data-translate="mosCalendarLite.see"><div class="calendar__more-btn-icon ico icon-arrow_down_03_black"></div></span></a></div></div></div></div></div></div>'),e.put("mosCalendarLiteNew/mosCalendarLiteNew.tpl.html",'<div class="calendar-lite-new" data-ng-class="{\'main-style\':style==\'main\'}"><div class="calendar-lite-new__loader-container"></div><div class="calendar-lite-new__notfound" data-responce-dialog="data-responce-dialog" data-title="{{ noData }}" data-not-found="notFound" data-ng-if="lang === \'ru\'"></div><div class="calendar-lite-new__block" data-ng-if="events.length &gt; 0"><div data-ng-class="{\'calendar-lite-new__holidays\':newYearFlag}"><div class="mos-row"><div class="lables_container"><h1 class="afisha">Афиша</h1><div class="link_all_events"><a class="all_events link-animated__all" data-ng-href="/afisha/">Все события<div class="icon-arrow"><span class="link-animated__all-icon"></span></div><div class="icon"></div></a></div></div><div class="main-style__row"><div class="main-style__item mos-col-xs-12 mos-col-sm-3 mos-col-md-4 mos-col-xl-3" data-ng-repeat="event in events track by $index" data-ng-class="{\'postLoading\':event.isNew}"><div class="calendar-lite-new__item" data-ng-class="{\'no-image\': !event.hasImage}"><a class="calendar-lite-new__link" data-ng-href="{{event.link}}" target="{{target}}"><div class="calendar-lite-new__wrapper-imgbox" data-ng-if="event.hasImage"><div class="calendar-lite-new__imgbox" data-ng-style="{\'background-image\': \'url(&quot;{{ ::event.image | imageSetSrc:\'a|2|s\':\'b|2|m\':\'c|2|m\':\'d|2|m\':\'e|2|m\'}}&quot;)\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div></div><div class="calendar-lite-new__textwrapper"><div class="flex"><div class="calendar-lite-new__wrapper-info"><div class="free" data-ng-if="displayFree &amp;&amp; event.free">{{ event.free === 1 ? "Бесплатно" : null }}</div><div class="calendar-lite-new__time" data-ng-if="displayDate &amp;&amp; event.date_from_timestamp">{{ event.dateString }}</div></div><span class="type" data-ng-if="displaySphere &amp;&amp; event.spheres">{{ event.spheres[0].title  }}</span></div><div class="calendar-lite-new__title" data-ng-bind-html="::event.title"></div></div></a></div></div></div></div><div class="mos-row"><div class="calendar__more mos-col-sm-6 mos-col-md-12 mos-col-xl-12"><hr class="line"/><div class="calendar__more-btn-nav"><div class="calendar__more-loader"></div><a class="calendar__more-btn ng-scope" data-ng-if="(items.length &gt; 0) &amp;&amp; canBeMore &amp;&amp; !loading" data-ng-click="getMoreData()"><span class="calendar__more-btn-text" data-translate="mosCalendarLiteNew.see"><div class="calendar__more-btn-icon ico icon-arrow_down_03_black"></div></span></a></div><hr class="line"/></div><a class="all_events2" data-ng-href="/afisha/">Все события</a></div></div></div></div>'),e.put("mosCalendarMonth/mosCalendarMonth.tpl.html",'<div class="calendar-month container-fluid"><div class="row"><div class="calendar-inner col-xs-12 col-sm-12 col-md-6 col-lg-5" data-range-apply=""><div class="dates"></div><div class="date-picker-legend"><div class="date-picker-invalid">{{disablDay}}</div><div class="date-picker-today">{{toDay}}</div><div class="date-picker-active">{{currentDay}}</div></div></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-7 calendar-month__loader-container"></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-7 calendar-month__header">{{currentDateView}}</div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-7" data-responce-dialog="" data-title="{{noData}}" data-not-found="noEvents"></div><div class="col-xs-12 col-sm-12 col-md-6 col-lg-7 calendar-month__block" data-ng-if="events.length &gt; 0"><div class="customScrollbar"><div class="calendar-month__item" data-ng-repeat="event in events track by $index" data-ng-class="{\'postLoading\':event.isNew}"><a class="calendar-month__title" data-ng-href="{{event.link}}" target="_blank" data-ng-bind-html="event.title"></a><div class="calendar-month__text" data-ng-if="event.html" data-ng-bind-html="event.html"></div><div class="calendar-month__time" data-ng-if="event.date_to_timestamp &amp;&amp; event.date_from_timestamp">{{ event.date_from_timestamp * 1000 | date:\'HH:mm\' }} &mdash; {{ event.date_to_timestamp * 1000 | date:\'HH:mm\' }},&nbsp;</div><div class="calendar-month__place" data-ng-if="event.place">{{ event.place }}</div><a class="calendar-month__more" data-ng-href="{{event.link}}" target="_blank">{{moreData}}</a></div></div></div></div><div class="calendar-month__up" data-ng-if="events.length" data-ng-click="scrollUp()">{{upScroll}}</div></div>'),e.put("mosNewsLite/mosNewsLite.tpl.html",'<div class="news__mos-news-lite main-style"><div class="news__mos-news-lite__block" data-ng-if="posts.length &gt; 0"><div><div class="link_all_events"><a class="all_events" data-ng-href="/news/">Больше новостей по теме<span class="link_all_events-icon"><svg width="32" height="32" viewBox="0 0 32 32" fill="none">\n<circle cx="16" cy="16" r="15.5" stroke="currentColor" />\n<path fill-rule="evenodd" clip-rule="evenodd" d="M21.6008 15.4956L16.1735 10.5669C15.9047 10.3229 15.9047 9.92714 16.1735 9.68306C16.4422 9.43898 16.878 9.43898 17.1468 9.68306L24.2406 16.125L17.1468 22.5669C16.878 22.811 16.4422 22.811 16.1735 22.5669C15.9047 22.3229 15.9047 21.9271 16.1735 21.6831L21.6106 16.7456H9.59913C9.21903 16.7456 8.91089 16.4657 8.91089 16.1206C8.91089 15.7754 9.21903 15.4956 9.59913 15.4956H21.6008Z" fill="currentColor" />\n</svg></span></a></div><div class="news__mos-news-lite__row mos-row"><div class="main-style__item mos-col-xs-12 mos-col-sm-3 mos-col-md-4 mos-col-xl-3" data-ng-repeat="post in posts track by $index" data-ng-class="{\'postLoading\':post.isNew}"><div class="news__mos-news-lite__item" data-ng-class="{\'no-image\':!post.withImage}"><a data-ng-href="{{ ::baseHref +&quot;/&quot;+ post.id }}" target="{{target}}"><div class="news__mos-news-lite__imgbox" data-ng-if="post.withImage" data-ng-style="{\'background-image\': \'url(&quot;{{ ::post.image | imageSetSrc:\'a|2|s\':\'b|2|m\':\'c|2|m\':\'d|2|m\':\'e|2|m\'}}&quot;)\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div><div class="rel"><div class="news__mos-news-lite__info" data-ng-if="style"><span class="info__date">{{ post.date_timestamp*1000 | prepareDateSince : \'d MMM\'}}</span><span class="info__category" data-ng-if="post.sphere.title" data-ng-class="{\'special-sphere\':post.sphere.special}">{{ post.sphere.title }}</span></div><div class="news__mos-news-lite__textwrapper"><div class="news__mos-news-lite__title" data-ng-bind-html="::post.title"></div></div></div></a></div></div><div class="news__more-btn-wrapper flex"> <hr class="line"/><div class="news__more-btn-nav"><div class="news__more-loader"></div><button class="news__more-btn ng-scope" data-ng-if="(items.length &gt; 0) &amp;&amp; canBeMore &amp;&amp; !loading" data-ng-click="getMoreData()"><span data-translate="mosNewsLite.see"><div class="news__more-btn-icon ico icon-arrow_down_03_black"></div></span></button></div><hr class="line"/></div><a class="all_events_bottom" data-ng-href="/news/">Больше новостей по теме</a></div></div></div></div>'),e.put("mosInteractiveSchedule/mosInteractiveSchedule.tpl.html",'<div class="mos-i-schedule" data-ng-if="!hideMe" data-ng-class="{\'mos-i-schedule_with-get-more\': scrollDown}"><div class="mos-i-schedule__titles row" data-ng-if="!breakpoint"><div class="mos-i-schedule__title col-xs-{{colWidth}} mos-i-schedule__title_{{$index}} mos-i-schedule__title_{{spheresView.length}}-col" data-ng-repeat="sphere in spheresView">{{sphere.title}}</div></div><div class="mos-i-schedule__arrow-container mos-i-schedule__arrow-container_top" data-ng-click="scrollToTop()"><span class="mos-i-schedule__icon-arrow mos-i-schedule__icon-arrow_up"></span></div><div class="mos-i-schedule__schedule"><div class="mos-i-schedule__content"><div class="mos-i-schedule__schedule-table schedule-table" data-ng-if="!breakpoint"><div class="schedule-table__row row" data-ng-repeat="scheduleItem in schedule track by $index" data-ng-class="{\'schedule-table__row_first\': $first,\t\t\t\t\t\t\t\'schedule-table__row_last\': $last}"><div class="schedule-table__col schedule-table__col_{{$index}} col-xs-{{colWidth}}" data-ng-repeat="sphere in scheduleItem"><div class="schedule-item" data-ng-repeat="event in sphere track by $index"><div class="schedule-item__right-block"><div class="time-tile"><div class="time-tile__wrapper"><div class="time-tile__time">{{event.timeString}}</div><div class="time-tile__weekday">{{event.weekDay}}</div></div></div></div><div class="schedule-item__left-block"><div class="schedule-item__date">{{event.date}}</div><div class="schedule-item__speaker" data-ng-if="event.source_url">{{event.source_url}}</div><a class="schedule-item__title" data-ng-href="{{event.link}}">{{event.title}}</a></div></div></div></div></div><div class="mos-i-schedule__schedule-table schedule-table schedule-table_mobile" data-ng-if="breakpoint"><div class="schedule-table__row row" data-ng-repeat="event in schedule track by $index" data-ng-class="{\'schedule-table__row_first\': $first,\t\t\t\t\t\t\t\'schedule-table__row_last\': $last}"><div class="schedule-table__col schedule-table__col_{{event.sphereIdx}} col-xs-{{colWidth}}"><div class="schedule-item"><div class="schedule-item__right-block"><div class="time-tile"><div class="time-tile__wrapper"><div class="time-tile__time">{{event.timeString}}</div><div class="time-tile__weekday">{{event.weekDay}}</div></div></div></div><div class="schedule-item__left-block"><div class="schedule-item__date">{{event.date}}</div><div class="schedule-item__speaker" data-ng-if="event.source_url">{{scheduleItem[0].source_url}}</div><a class="schedule-item__title" data-ng-href="{{event.link}}">{{event.title}}</a></div></div></div></div></div></div></div><div class="mos-i-schedule__arrow-container mos-i-schedule__arrow-container_bottom" data-ng-if="!isExistMore || !scrollDown" data-ng-click="scrollToBottom()"><span class="mos-i-schedule__icon-arrow mos-i-schedule__icon-arrow_down"></span></div><div class="mos-i-schedule__arrow-container mos-i-schedule__arrow-container_bottom mos-i-schedule__arrow-container_get-more" data-ng-if="isExistMore &amp;&amp; scrollDown" data-ng-click="getMore()"><span class="mos-i-schedule__icon-arrow mos-i-schedule__icon-arrow_get-more"></span></div></div>'),e.put("pressCategories/pressCategories.tpl.html",'<div class="b-press-dropdown"><h1 class="b-dropdown__opener" data-bs-dropdown="categories" data-animation="am-fade" data-template="dropdown/dropdown.press.categories.tpl.html" data-ng-if="h1">{{category.title}}<span class="ico icon-arrow_down_01_black"></span></h1><span class="b-dropdown__opener" data-bs-dropdown="categories" data-animation="am-fade" data-template="dropdown/dropdown.press.categories.tpl.html" data-ng-if="!h1">{{category.title}}<span class="ico icon-arrow_down_01_black"></span></span></div>'),e.put("pressCategory/pressCategory.tpl.html",'<div class="row b-press-category__not-found" data-ng-if="notfound"><div class="col-xs-12"><p>Публикаций не найдено</p></div></div><div data-mos-press-brickwork="" data-ng-if="items &amp;&amp; items.length &gt; 0" data-items="items" data-section="{{section}}" data-section-category="{{sectionCategory}}" data-section-story="{{sectionStory}}"></div><div class="b-more__loader"></div><div class="row b-press-nav" data-ng-if="items &amp;&amp; items.length &gt; 0 &amp;&amp; morebutton"><div class="col-xs-12 b-press-bricks__morebutton"><a data-ng-if="getNextPageUrl()" data-ng-href="{{ getNextPageUrl() }}" data-ng-click="getMoreBricks(); $event.preventDefault(); $event.stopPropagation();"><span class="ico icon-arrow_down_03_black"></span><span class="text">Посмотреть еще</span></a><a data-ng-if="!getNextPageUrl()" href="" data-ng-click="getMoreBricks(); $event.preventDefault(); $event.stopPropagation();"><span class="ico icon-arrow_down_03_black"></span><span class="text">Посмотреть еще</span></a></div></div>'),e.put("pressCategoriesCheckbox/pressCategoriesCheckbox.tpl.html",'<div class="b-press-dropdown"><span class="b-dropdown__opener" data-bs-dropdown="categories" data-animation="am-fade" data-template="dropdown/dropdown.press.categoriesCheckbox.tpl.html">{{category.title}}<span class="ico icon-arrow_down_01_black"></span></span></div>'),e.put("pressCategoriesCheckbox/pressCategoriesCheckboxLabel.tpl.html",'<div class="b-press-dropdown"><span class="b-dropdown__opener" data-ng-if="category.length" data-template="dropdown/dropdown.press.categoriesCheckbox.tpl.html">{{category | listTitles}}<span class="ico icon-arrow_down_01_black"></span></span><span class="b-dropdown__opener" data-ng-if="!category.length" data-template="dropdown/dropdown.press.categoriesCheckbox.tpl.html">{{placeholder}}<span class="ico icon-arrow_down_01_black"></span></span></div>'),e.put("filterCalendar/filterCalendar.tpl.html",'<div class="calendar-inner" data-range-apply=""><div class="dates"><input class="js-daterange-input icon" type="text" data-ng-readonly="true" placeholder="{{placeholder}}" data-ng-class="icon || \'icon-calendar-gray\'" id="{{ uniqId || \'calendar1\' }}"/><span class="calendar-clear" data-ng-click="clearDatepicker()">Сбросить</span></div></div>'),e.put("responceDialog/responceDialog.tpl.html",'<div class="b-depdoc-result" data-ng-if="notFound"><div class="b-depdoc-result__title">{{title}}</div></div>'),e.put("00_afisha/calendarFilterLite/calendarFilterLite.tpl.html",'<div class="calendar-filter-lite"><div class="calendar-filter-lite__filters" data-ng-show="showFilter"><div class="calendar-filter-lite__row"><div class="calendar-filter-lite__col calendar-filter-lite__col_period mos-col-sm-3 mos-col-md-4 mos-order-md-0 mos-order-sm-0" data-ng-if="!displayConfig || displayConfig.date" data-mos-period="" placement="\'auto right\'" data-ng-model="viewFilter.period" data-ng-change="setNewDateRange()"></div><div class="calendar-filter-lite__col calendar-filter-lite__col_daytime mos-col-sm-3 mos-col-md-4 mos-order-md-1 mos-order-sm-1" data-ng-if="!displayConfig || displayConfig.dayTime"><div class="mos-select" data-mos-select="" data-on-category-change="setNewDayinterval(catid)" data-categories="itemsDayinterval" data-category="viewFilter.daytime" data-label="{{ \'calendarFilterLite.timeOfDay\' | translate }}"></div></div><div class="calendar-filter-lite__col calendar-filter-lite__col_event-type mos-col-sm-3 mos-col-md-4 mos-order-md-2 mos-order-sm-4" data-ng-if="!displayConfig || displayConfig.eventType"><div class="mos-select__multi" data-mos-select="" data-categories="itemsEventTypes" data-category="viewFilter.auditory" data-multiple="true" data-label="{{ \'calendarFilterLite.type\' | translate }}" data-on-category-change="setNewAuditory()"></div></div><div class="calendar-filter-lite__col calendar-filter-lite__col_area mos-col-sm-3 mos-col-md-4 mos-order-md-3 mos-order-sm-2" data-ng-if="!displayConfig || displayConfig.area"><div class="mos-select" data-mos-select="" data-on-category-change="setNewArea(catid)" data-categories="itemsArea" data-category="viewFilter.place" data-label="{{ \'calendarFilterLite.area\' | translate }}" data-title-view="{{ lang===\'en\'?\'title_en\':\'title\' }}"></div></div><div class="calendar-filter-lite__col calendar-filter-lite__col_place mos-col-sm-3 mos-col-md-4 mos-order-md-4 mos-order-sm-3" data-ng-if="!displayConfig || displayConfig.placeType"><div class="mos-select__multi" data-mos-select="" data-categories="itemsPlaceTypes" data-category="viewFilter.place_type" data-multiple="true" data-on-category-change="setNewPlaceTypes()" data-label="{{ \'calendarFilterLite.place\' | translate }}"></div></div><div class="calendar-filter-lite__col calendar-filter-lite__col_reset mos-col-sm-3 mos-col-md-4 mos-order-md-5 mos-order-sm-5" data-ng-if="clearOn"><div class="calendar-filter-lite__reset" data-ng-click="clearFilter()" title="{{ \'calendarFilterLite.resetTitle\' | translate }}" data-translate="calendarFilterLite.resetTitle"></div></div></div></div><div class="calendar-filter-lite__loader-container"></div></div>'),e.put("newsfeedMixedList/newsfeedMixedList.tpl.html",'<div class="nf-mixed-list__loader-container"></div><div class="nf-mixed-list {{className}}" data-ng-class="{\'contrast\':colorScheme==\'contrast\', \'main-style\':style==\'main\'}" data-ng-if="posts.length &gt; 0"><div class="nf-mixed-list__container" data-ng-class="{\'mos-row\':style==\'main\'||className, \'t-container\':style!=\'main\'}"><div data-ng-repeat="post in posts track by $index" data-ng-class="{\'postLoading\':post.isNew,\t\t\t\t\'main-style__item mos-col-xs-12 mos-col-sm-3 mos-col-md-4 mos-col-lg-3\':style==\'main\',\t\t\t\t\'t-col t-col_3 t-align_center\':style!=\'main\',\t\t\t\t\'with-image\':post.withImage}"><div class="nf-mixed-list__item"><a class="nf-mixed-list__item-link" data-ng-href="{{ post.link }}" target="{{target}}"><div class="nf-mixed-list__item-imgbox" data-ng-if="::post.withImage &amp;&amp; style" data-ng-style="{\'background-image\': \'url(&quot;{{ ::post.image | imageSetSrc:\'a|2|s\':\'b|2|m\':\'c|2|m\':\'d|2|m\':\'e|2|m\'}}&quot;)\'}" data-ng-class="{\'grayscale\': colorScheme==\'contrast\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div><div class="nf-mixed-list__item-noimage" data-ng-if="!post.withImage &amp;&amp; style" data-ng-style="{\'background-image\': \'url(&quot;{{ ::post.image | imageSetSrc:\'a|2|s\':\'b|2|m\':\'c|2|m\':\'d|2|m\':\'e|2|m\'}}&quot;)\'}" data-ng-class="{\'grayscale\': colorScheme==\'contrast\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div><div class="nf-mixed-list__item-imgbox" data-ng-if="::!style &amp;&amp; imagePosition == \'top\' &amp;&amp; post.withImage" data-ng-style="{\'background-image\': \'url(&quot;{{ ::post.image | imageSrc }}&quot;)\'}" data-ng-class="{\'grayscale\': colorScheme==\'contrast\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div><div class="nf-mixed-list__item-noimagebox" data-ng-if="::!style &amp;&amp; !post.withImage" data-ng-style="{\'background-image\': \'url(&quot;{{ ::post.image | imageSrc }}&quot;)\'}" data-ng-class="{\'grayscale\': colorScheme==\'contrast\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div><div class="nf-mixed-list__item-rel"><div class="nf-mixed-list__item-info" data-ng-if="::(style || className)"><span class="nf-mixed-list__item-info-date" data-ng-if="post.date_timestamp">{{ post.date_timestamp*1000 | prepareDateSince : \'d MMM\'}}</span></div><div class="nf-mixed-list__item-textwrapper"><div class="nf-mixed-list__item-title t-name t-name_md" data-ng-bind-html="post.title"></div></div></div><div class="nf-mixed-list__item-imgbox" data-ng-if="::!style &amp;&amp; imagePosition == \'bottom\' &amp;&amp; post.withImage" data-ng-style="{\'background-image\': \'url(&quot;{{ ::post.image | imageSrc }}&quot;)\'}" data-ng-class="{\'grayscale\': colorScheme==\'contrast\'}"><img data-ng-src="{{overImg | imageSrc}}" width="100%"/></div></a></div></div></div><div class="nf-mixed-list__more" data-ng-if="showMoreButton"><div class="nf-mixed-list__more-loader"></div><a class="nf-mixed-list__more-btn ng-scope" data-ng-if="canBeMore &amp;&amp; !loading" data-ng-click="getMoreData()"><span class="nf-mixed-list__more-btn-text" data-translate="newsfeedMixedList.see"><div class="nf-mixed-list__more-btn-icon ico icon-arrow_down_03_black"></div></span></a></div></div>'),e.put("00_fields/period/datepicker-popup/datepicker-popup.tpl.html",'<ul class="mos-datepicker-popup dropdown-menu mos-position-measure" mos-datepicker-classes="mos-datepicker-classes" role="presentation" dropdown-nested="dropdown-nested" ng-if="isOpen" ng-keydown="keydown($event)" ng-click="$event.stopPropagation()"><div class="arrow"></div><div class="mos-datepicker-popup__close" ng-click="close($event)"></div><div class="mos-datepicker-popup__label">{{ label }}</div><li ng-transclude="ng-transclude"></li></ul>'),e.put("00_fields/period/datepicker-popup/datepicker.tpl.html",'<div ng-switch="datepickerMode"><div class="uib-daypicker" uib-daypicker="uib-daypicker" ng-switch-when="day" tabindex="0" template-url="00_fields/period/datepicker-popup/daypicker.tpl.html"></div><div class="uib-monthpicker" uib-monthpicker="uib-monthpicker" ng-switch-when="month" tabindex="0"></div><div class="uib-yearpicker" uib-yearpicker="uib-yearpicker" ng-switch-when="year" tabindex="0"></div></div>'),e.put("00_fields/period/datepicker-popup/daypicker.tpl.html",'<table class="daypicker-head" role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}"><thead><tr><th><button class="btn btn-default btn-sm pull-left uib-left" type="button" ng-click="move(-1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-left" aria-hidden="true"></i><span class="sr-only">&laquo;</span></button></th><th colspan="{{::5 + showWeeks}}"><button class="btn btn-default btn-sm uib-title" id="{{::uniqueId}}-title" role="heading" aria-live="assertive" aria-atomic="true" type="button" ng-click="toggleMode()" ng-disabled="datepickerMode === maxMode" tabindex="-1"><strong>{{title}}</strong></button></th><th><button class="btn btn-default btn-sm pull-right uib-right" type="button" ng-click="move(1)" tabindex="-1"><i class="glyphicon glyphicon-chevron-right" aria-hidden="true"></i><span class="sr-only">&raquo;</span></button></th></tr></thead></table><table class="daypicker-body" role="grid" aria-labelledby="{{::uniqueId}}-title" aria-activedescendant="{{activeDateId}}"><thead><tr><th class="text-center" ng-if="showWeeks"></th><th class="text-center" ng-repeat="label in ::labels track by $index"><small aria-label="{{::label.full}}">{{::label.abbr}}</small></th></tr></thead><tbody><tr class="uib-weeks" ng-repeat="row in rows track by $index" role="row"><td class="text-center h6" ng-if="showWeeks"><em>{{ weekNumbers[$index] }}</em></td><td class="uib-day text-center" ng-repeat="dt in row" role="gridcell" id="{{::dt.uid}}" ng-class="::dt.customClass" uib-is-class="\'active\' for selectedDt on dt"><button class="btn btn-default btn-sm" type="button" ng-click="select(dt.date)" ng-disabled="::dt.disabled" tabindex="-1"><span ng-class="::{\'text-muted\': dt.secondary}">{{::dt.label}}</span></button></td></tr></tbody></table>'),e.put("00_fields/period/period.tpl.html",'<div class="mos-period" ng-click="ctrl.clicked($event)"><div class="mos-period__trigger" ng-class="{\'field-has-value\': ctrl.period}" ng-click="ctrl.$tooltip.toggle()"><label>{{ label }}</label><div class="mos-period__value" title="{{ctrl.period}}">{{ ctrl.period }}</div></div></div>'),e.put("00_fields/period/periodPopup.tpl.html",'<div class="mos-period__popup dropdown-menu dropdown-menu-right" role="menu" ng-form="period"><div class="mos-period__label" data-translate="fieldPeriod.label"></div><div class="mos-period__close-popup" ng-click="$hide()"></div><div class="mos-period__body"><div class="mos-period__menu-item" ng-repeat="preset in ctrl.presets" ng-click="ctrl.select(preset.code)" ng-class="{\'mos-period__menu-item_selected\': ctrl.mode === preset.code}"><span>{{ preset.title }}</span></div><div class="mos-period__menu-item" ng-if="ctrl.presets.length" ng-click="ctrl.select(\'period\')" ng-class="{\'mos-period__menu-item_selected\': ctrl.mode === \'period\'}"><span>{{ ctrl.periods.selectDates }}</span></div><div ng-show="ctrl.mode === \'period\' || !ctrl.presets.length"><div class="mos-period__input-wrap" mos-field-wrap="" ng-click="$event.stopPropagation()" ng-class="{\'field-has-value\': ctrl.model.from, \'mos-period__input-wrap_error\': period.from.$invalid}"><label translate="fieldPeriod.from"></label><i class="mos-period__input-icon" ng-click="ctrl.toggle(\'from\', true)"></i><input type="text" name="from" spellcheck="false" ng-model="ctrl.model.from" ng-change="ctrl.updateModel(\'from\')" ng-focus="ctrl.focused($event, \'from\')" ng-blur="ctrl.blured($event, \'from\')" ng-click="ctrl.inputClicked($event, \'from\')" placeholder="" mos-field="" mos-datepicker-popup="{{ctrl.format}}" datepicker-options="ctrl.fromDpOpts" label="Искать с" popup-placement="{{ placement }}" on-open-focus="false" is-open="ctrl.opened.from" ui-mask="ДД.ММ.ГГГГ" ui-mask-placeholder="{{ lang==\'en\'? \'DD.MM.YYYY\' : \'ДД.ММ.ГГГГ\' }}" ui-options="ctrl.maskOptions" model-view-value="true"/></div><div class="mos-period__input-wrap" mos-field-wrap="" ng-click="$event.stopPropagation()" ng-class="{\'field-has-value\': ctrl.model.to, \'mos-period__input-wrap_error\': period.to.$invalid}"><label translate="fieldPeriod.to"></label><i class="mos-period__input-icon" ng-click="ctrl.toggle(\'to\', true)"></i><input type="text" name="to" spellcheck="false" ng-model="ctrl.model.to" ng-change="ctrl.updateModel(\'to\')" ng-focus="ctrl.focused($event, \'to\')" ng-blur="ctrl.blured($event, \'to\')" ng-click="ctrl.inputClicked($event, \'to\')" mos-field="" mos-datepicker-popup="{{ctrl.format}}" datepicker-options="ctrl.toDpOpts" label="Искать по" popup-placement="{{ placement }}" on-open-focus="false" is-open="ctrl.opened.to" ui-mask="ДД.ММ.ГГГГ" ui-mask-placeholder="{{ lang==\'en\'? \'DD.MM.YYYY\' : \'ДД.ММ.ГГГГ\' }}" ui-options="ctrl.maskOptions" model-view-value="true"/></div></div><button class="mos-period__btn" ng-click="ctrl.apply()" translate="fieldPeriod.apply" ng-disabled="!(ctrl.model.from &amp;&amp; ctrl.model.to || !ctrl.model.from &amp;&amp; !ctrl.model.to)"></button></div></div>'),e.put("00_fields/select/select.tpl.html",'<div class="mos-select dropdown" ng-class="{\'mos-select_has-value\': category.id || (multiple &amp;&amp; category.length)}"><div class="mos-select__select" bs-dropdown="categories" aria-haspopup="true" aria-expanded="false" data-animation="am-fade" data-template="00_fields/select/selectDropdown.tpl.html"><label data-ng-if="label">{{ label }}</label><div class="mos-select__selected" title="{{category[titleView]}}" ng-if="category.id &amp;&amp; !multiple">{{ category[titleView] }}</div><div class="mos-select__selected" title="{{category | listTitles}}" ng-if="category.length &amp;&amp; multiple">{{category | listTitles}}</div></div></div>'),e.put("00_fields/select/selectDropdown.tpl.html",'<div class="mos-select__options dropdown-menu" role="menu" data-scroll-menu=""><ul><li class="mos-select__option" ng-click="$hide();changeCategory({id:\'\'});" ng-if="category.id &amp;&amp; categories[0].id !== \'\'">{{ label }}</li><li class="mos-select__option" ng-repeat="option in categories" ng-if="multiple || option.id !== category.id" ng-class="{\'mos-select__option_selected\': option.id === category.id}" ng-click="$hide();changeCategory(option);"><div class="mos-select__option-mark" ng-if="multiple" ng-class="{\'mos-select__option-mark_checked\': isSelected(option) }"></div><span>{{ option[titleView] }}</span></li></ul></div>')}])}(window,window.angular);